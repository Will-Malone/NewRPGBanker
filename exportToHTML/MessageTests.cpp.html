<html>
<head>
<title>MessageTests.cpp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #bbb529;}
.s3 { color: #6a8759;}
.s4 { color: #cc7832;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
MessageTests.cpp</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 * Copyright (c) Meta Platforms, Inc. and affiliates. 
 * 
 * This source code is licensed under the MIT license found in the 
 * LICENSE file in the root directory of this source tree. 
 */</span>

<span class="s2">#include </span><span class="s3">&lt;hermes/inspector/chrome/MessageTypes.h&gt;</span>

<span class="s2">#include </span><span class="s3">&lt;iostream&gt;</span>

<span class="s2">#include </span><span class="s3">&lt;folly/dynamic.h&gt;</span>
<span class="s2">#include </span><span class="s3">&lt;folly/json.h&gt;</span>
<span class="s2">#include </span><span class="s3">&lt;gtest/gtest.h&gt;</span>

<span class="s4">namespace </span><span class="s1">facebook {</span>
<span class="s4">namespace </span><span class="s1">hermes {</span>
<span class="s4">namespace </span><span class="s1">inspector {</span>
<span class="s4">namespace </span><span class="s1">chrome {</span>
<span class="s4">namespace </span><span class="s1">message {</span>

<span class="s4">using </span><span class="s1">folly::dynamic</span><span class="s4">;</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSerializeSomeFieldsInRequest) {</span>
  <span class="s1">debugger::SetBreakpointByUrlRequest req</span><span class="s4">;</span>
  <span class="s0">// req.id should default to 0</span>
  <span class="s1">req.lineNumber = </span><span class="s5">2</span><span class="s4">;</span>
  <span class="s1">req.url = </span><span class="s3">&quot;http://example.com/example.js&quot;</span><span class="s4">;</span>

  <span class="s1">dynamic result = req.toDynamic()</span><span class="s4">;</span>
  <span class="s1">dynamic expected = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 0, 
    &quot;method&quot;: &quot;Debugger.setBreakpointByUrl&quot;, 
    &quot;params&quot;: { 
      &quot;lineNumber&quot;: 2, 
      &quot;url&quot;: &quot;http://example.com/example.js&quot; 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(result</span><span class="s4">, </span><span class="s1">expected)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testDeserializeSomeFieldsInRequest) {</span>
  <span class="s1">dynamic message = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.setBreakpointByUrl&quot;, 
      &quot;params&quot;: { 
        &quot;lineNumber&quot;: 42, 
        &quot;url&quot;: &quot;http://example.com&quot; 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointByUrlRequest req(message)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(req.toDynamic()</span><span class="s4">, </span><span class="s1">message)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setBreakpointByUrl&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.lineNumber</span><span class="s4">, </span><span class="s5">42</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(req.columnNumber.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(req.condition.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.url</span><span class="s4">, </span><span class="s3">&quot;http://example.com&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(req.urlRegex.has_value())</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSerializeAllFieldsInRequest) {</span>
  <span class="s1">debugger::SetBreakpointByUrlRequest req</span><span class="s4">;</span>
  <span class="s1">req.id = </span><span class="s5">1</span><span class="s4">;</span>
  <span class="s1">req.lineNumber = </span><span class="s5">2</span><span class="s4">;</span>
  <span class="s1">req.columnNumber = </span><span class="s5">3</span><span class="s4">;</span>
  <span class="s1">req.condition = </span><span class="s3">&quot;foo == 42&quot;</span><span class="s4">;</span>
  <span class="s1">req.url = </span><span class="s3">&quot;http://example.com/example.js&quot;</span><span class="s4">;</span>
  <span class="s1">req.urlRegex = </span><span class="s3">&quot;http://example.com/.*&quot;</span><span class="s4">;</span>

  <span class="s1">dynamic result = req.toDynamic()</span><span class="s4">;</span>
  <span class="s1">dynamic expected = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;method&quot;: &quot;Debugger.setBreakpointByUrl&quot;, 
    &quot;params&quot;: { 
      &quot;lineNumber&quot;: 2, 
      &quot;columnNumber&quot;: 3, 
      &quot;condition&quot;: &quot;foo == 42&quot;, 
      &quot;url&quot;: &quot;http://example.com/example.js&quot;, 
      &quot;urlRegex&quot;: &quot;http://example.com/.*&quot; 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(result</span><span class="s4">, </span><span class="s1">expected)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testDeserializeAllFieldsInRequest) {</span>
  <span class="s1">dynamic message = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;method&quot;: &quot;Debugger.setBreakpointByUrl&quot;, 
    &quot;params&quot;: { 
      &quot;lineNumber&quot;: 2, 
      &quot;columnNumber&quot;: 3, 
      &quot;condition&quot;: &quot;foo == 42&quot;, 
      &quot;url&quot;: &quot;http://example.com/example.js&quot;, 
      &quot;urlRegex&quot;: &quot;http://example.com/.*&quot; 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointByUrlRequest req(message)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(req.id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setBreakpointByUrl&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.condition</span><span class="s4">, </span><span class="s3">&quot;foo == 42&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.url</span><span class="s4">, </span><span class="s3">&quot;http://example.com/example.js&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req.urlRegex</span><span class="s4">, </span><span class="s3">&quot;http://example.com/.*&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSerializeResponse) {</span>
  <span class="s1">debugger::Location location</span><span class="s4">;</span>
  <span class="s1">location.scriptId = </span><span class="s3">&quot;myScriptId&quot;</span><span class="s4">;</span>
  <span class="s1">location.lineNumber = </span><span class="s5">2</span><span class="s4">;</span>
  <span class="s1">location.columnNumber = </span><span class="s5">3</span><span class="s4">;</span>

  <span class="s1">debugger::SetBreakpointByUrlResponse resp</span><span class="s4">;</span>
  <span class="s1">resp.id = </span><span class="s5">1</span><span class="s4">;</span>
  <span class="s1">resp.breakpointId = </span><span class="s3">&quot;myBreakpointId&quot;</span><span class="s4">;</span>
  <span class="s1">resp.locations = {location}</span><span class="s4">;</span>

  <span class="s1">dynamic result = resp.toDynamic()</span><span class="s4">;</span>
  <span class="s1">dynamic expected = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;result&quot;: { 
      &quot;breakpointId&quot;: &quot;myBreakpointId&quot;, 
      &quot;locations&quot;: [ 
        { 
          &quot;lineNumber&quot;: 2, 
          &quot;columnNumber&quot;: 3, 
          &quot;scriptId&quot;: &quot;myScriptId&quot; 
        } 
      ] 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(result</span><span class="s4">, </span><span class="s1">expected)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testDeserializeResponse) {</span>
  <span class="s1">dynamic message = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;result&quot;: { 
      &quot;breakpointId&quot;: &quot;myBreakpointId&quot;, 
      &quot;locations&quot;: [ 
        { 
          &quot;lineNumber&quot;: 2, 
          &quot;columnNumber&quot;: 3, 
          &quot;scriptId&quot;: &quot;myScriptId&quot; 
        } 
      ] 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointByUrlResponse resp(message)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resp.toDynamic()</span><span class="s4">, </span><span class="s1">message)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resp.id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resp.breakpointId</span><span class="s4">, </span><span class="s3">&quot;myBreakpointId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resp.locations.size()</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resp.locations[</span><span class="s5">0</span><span class="s1">].lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resp.locations[</span><span class="s5">0</span><span class="s1">].columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resp.locations[</span><span class="s5">0</span><span class="s1">].scriptId</span><span class="s4">, </span><span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSerializeNotification) {</span>
  <span class="s1">debugger::Location startLocation</span><span class="s4">;</span>
  <span class="s1">startLocation.lineNumber = </span><span class="s5">1</span><span class="s4">;</span>
  <span class="s1">startLocation.scriptId = </span><span class="s3">&quot;script1&quot;</span><span class="s4">;</span>

  <span class="s1">debugger::Location endLocation</span><span class="s4">;</span>
  <span class="s1">endLocation.lineNumber = </span><span class="s5">2</span><span class="s4">;</span>
  <span class="s1">endLocation.scriptId = </span><span class="s3">&quot;script2&quot;</span><span class="s4">;</span>

  <span class="s1">debugger::Scope scope</span><span class="s4">;</span>
  <span class="s1">scope.type = </span><span class="s3">&quot;closure&quot;</span><span class="s4">;</span>
  <span class="s1">scope.object.type = </span><span class="s3">&quot;object&quot;</span><span class="s4">;</span>
  <span class="s1">scope.object.subtype = </span><span class="s3">&quot;regexp&quot;</span><span class="s4">;</span>
  <span class="s1">scope.object.className = </span><span class="s3">&quot;RegExp&quot;</span><span class="s4">;</span>
  <span class="s1">scope.object.value = dynamic::object(</span><span class="s3">&quot;foo&quot;</span><span class="s4">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">scope.object.unserializableValue = </span><span class="s3">&quot;nope&quot;</span><span class="s4">;</span>
  <span class="s1">scope.object.description = </span><span class="s3">&quot;myDesc&quot;</span><span class="s4">;</span>
  <span class="s1">scope.object.objectId = </span><span class="s3">&quot;id1&quot;</span><span class="s4">;</span>
  <span class="s1">scope.name = </span><span class="s3">&quot;myScope&quot;</span><span class="s4">;</span>
  <span class="s1">scope.startLocation = startLocation</span><span class="s4">;</span>
  <span class="s1">scope.endLocation = endLocation</span><span class="s4">;</span>

  <span class="s1">debugger::CallFrame frame</span><span class="s4">;</span>
  <span class="s1">frame.callFrameId = </span><span class="s3">&quot;callFrame1&quot;</span><span class="s4">;</span>
  <span class="s1">frame.functionName = </span><span class="s3">&quot;foo1&quot;</span><span class="s4">;</span>
  <span class="s1">frame.location.scriptId = </span><span class="s3">&quot;script1&quot;</span><span class="s4">;</span>
  <span class="s1">frame.location.lineNumber = </span><span class="s5">3</span><span class="s4">;</span>
  <span class="s1">frame.location.columnNumber = </span><span class="s5">4</span><span class="s4">;</span>
  <span class="s1">frame.url = </span><span class="s3">&quot;foo.js&quot;</span><span class="s4">;</span>
  <span class="s1">frame.scopeChain = std::vector&lt;debugger::Scope&gt;{scope}</span><span class="s4">;</span>
  <span class="s1">frame.thisObj.type = </span><span class="s3">&quot;function&quot;</span><span class="s4">;</span>

  <span class="s1">debugger::PausedNotification note</span><span class="s4">;</span>
  <span class="s1">note.callFrames = std::vector&lt;debugger::CallFrame&gt;{frame}</span><span class="s4">;</span>
  <span class="s1">note.reason = </span><span class="s3">&quot;debugCommand&quot;</span><span class="s4">;</span>
  <span class="s1">note.data = dynamic::object(</span><span class="s3">&quot;foo&quot;</span><span class="s4">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">note.hitBreakpoints = std::vector&lt;std::string&gt;{</span><span class="s3">&quot;a&quot;</span><span class="s4">, </span><span class="s3">&quot;b&quot;</span><span class="s1">}</span><span class="s4">;</span>

  <span class="s1">dynamic result = note.toDynamic()</span><span class="s4">;</span>
  <span class="s1">dynamic expected = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;method&quot;: &quot;Debugger.paused&quot;, 
    &quot;params&quot;: { 
      &quot;callFrames&quot;: [ 
        { 
          &quot;callFrameId&quot;: &quot;callFrame1&quot;, 
          &quot;functionName&quot;: &quot;foo1&quot;, 
          &quot;location&quot;: { 
            &quot;scriptId&quot;: &quot;script1&quot;, 
            &quot;lineNumber&quot;: 3, 
            &quot;columnNumber&quot;: 4 
          }, 
          &quot;url&quot;: &quot;foo.js&quot;, 
          &quot;scopeChain&quot;: [ 
            { 
              &quot;type&quot;: &quot;closure&quot;, 
              &quot;object&quot;: { 
                &quot;type&quot;: &quot;object&quot;, 
                &quot;subtype&quot;: &quot;regexp&quot;, 
                &quot;className&quot;: &quot;RegExp&quot;, 
                &quot;value&quot;: { &quot;foo&quot;: &quot;bar&quot; }, 
                &quot;unserializableValue&quot;: &quot;nope&quot;, 
                &quot;description&quot;: &quot;myDesc&quot;, 
                &quot;objectId&quot;: &quot;id1&quot; 
              }, 
              &quot;name&quot;: &quot;myScope&quot;, 
              &quot;startLocation&quot;: { 
                &quot;lineNumber&quot;: 1, 
                &quot;scriptId&quot;: &quot;script1&quot; 
              }, 
              &quot;endLocation&quot;: { 
                &quot;lineNumber&quot;: 2, 
                &quot;scriptId&quot;: &quot;script2&quot; 
              } 
            } 
          ], 
          &quot;this&quot;: { &quot;type&quot;: &quot;function&quot; } 
        } 
      ], 
      &quot;reason&quot;: &quot;debugCommand&quot;, 
      &quot;data&quot;: { 
        &quot;foo&quot;: &quot;bar&quot; 
      }, 
      &quot;hitBreakpoints&quot;: [ &quot;a&quot;, &quot;b&quot; ] 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(result</span><span class="s4">, </span><span class="s1">expected)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testDeserializeNotification) {</span>
  <span class="s1">dynamic message = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;method&quot;: &quot;Debugger.paused&quot;, 
    &quot;params&quot;: { 
      &quot;callFrames&quot;: [ 
        { 
          &quot;callFrameId&quot;: &quot;callFrame1&quot;, 
          &quot;functionName&quot;: &quot;foo1&quot;, 
          &quot;location&quot;: { 
            &quot;scriptId&quot;: &quot;script1&quot;, 
            &quot;lineNumber&quot;: 3, 
            &quot;columnNumber&quot;: 4 
          }, 
          &quot;url&quot;: &quot;foo.js&quot;, 
          &quot;scopeChain&quot;: [ 
            { 
              &quot;type&quot;: &quot;closure&quot;, 
              &quot;object&quot;: { 
                &quot;type&quot;: &quot;object&quot;, 
                &quot;subtype&quot;: &quot;regexp&quot;, 
                &quot;className&quot;: &quot;RegExp&quot;, 
                &quot;value&quot;: { &quot;foo&quot;: &quot;bar&quot; }, 
                &quot;unserializableValue&quot;: &quot;nope&quot;, 
                &quot;description&quot;: &quot;myDesc&quot;, 
                &quot;objectId&quot;: &quot;id1&quot; 
              }, 
              &quot;name&quot;: &quot;myScope&quot;, 
              &quot;startLocation&quot;: { 
                &quot;lineNumber&quot;: 1, 
                &quot;scriptId&quot;: &quot;script1&quot; 
              }, 
              &quot;endLocation&quot;: { 
                &quot;lineNumber&quot;: 2, 
                &quot;scriptId&quot;: &quot;script2&quot; 
              } 
            } 
          ], 
          &quot;this&quot;: { &quot;type&quot;: &quot;function&quot; } 
        } 
      ], 
      &quot;reason&quot;: &quot;debugCommand&quot;, 
      &quot;data&quot;: { 
        &quot;foo&quot;: &quot;bar&quot; 
      }, 
      &quot;hitBreakpoints&quot;: [ &quot;a&quot;, &quot;b&quot; ] 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">debugger::PausedNotification note(message)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(note.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.paused&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(note.callFrames.size()</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(note.reason</span><span class="s4">, </span><span class="s3">&quot;debugCommand&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(note.data</span><span class="s4">, static_cast</span><span class="s1">&lt;dynamic&gt;(dynamic::object(</span><span class="s3">&quot;foo&quot;</span><span class="s4">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)))</span><span class="s4">;</span>
  <span class="s4">auto </span><span class="s1">expectedHitBreakpoints = std::vector&lt;std::string&gt;{</span><span class="s3">&quot;a&quot;</span><span class="s4">, </span><span class="s3">&quot;b&quot;</span><span class="s1">}</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(note.hitBreakpoints</span><span class="s4">, </span><span class="s1">expectedHitBreakpoints)</span><span class="s4">;</span>

  <span class="s1">debugger::CallFrame &amp;callFrame = note.callFrames[</span><span class="s5">0</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(callFrame.callFrameId</span><span class="s4">, </span><span class="s3">&quot;callFrame1&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(callFrame.functionName</span><span class="s4">, </span><span class="s3">&quot;foo1&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(callFrame.location.scriptId</span><span class="s4">, </span><span class="s3">&quot;script1&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(callFrame.location.lineNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(callFrame.location.columnNumber</span><span class="s4">, </span><span class="s5">4</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(callFrame.url</span><span class="s4">, </span><span class="s3">&quot;foo.js&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(callFrame.scopeChain.size()</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(callFrame.thisObj.type</span><span class="s4">, </span><span class="s3">&quot;function&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">debugger::Scope &amp;scope = callFrame.scopeChain[</span><span class="s5">0</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(scope.type</span><span class="s4">, </span><span class="s3">&quot;closure&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(scope.object.type</span><span class="s4">, </span><span class="s3">&quot;object&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(scope.object.subtype</span><span class="s4">, </span><span class="s3">&quot;regexp&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(scope.object.className</span><span class="s4">, </span><span class="s3">&quot;RegExp&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">scope.object.value</span><span class="s4">, static_cast</span><span class="s1">&lt;dynamic&gt;(dynamic::object(</span><span class="s3">&quot;foo&quot;</span><span class="s4">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)))</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(scope.object.unserializableValue</span><span class="s4">, </span><span class="s3">&quot;nope&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(scope.object.description</span><span class="s4">, </span><span class="s3">&quot;myDesc&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(scope.object.objectId</span><span class="s4">, </span><span class="s3">&quot;id1&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(scope.name</span><span class="s4">, </span><span class="s3">&quot;myScope&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">debugger::Location &amp;startLocation = scope.startLocation.value()</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(startLocation.lineNumber</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(startLocation.columnNumber.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(startLocation.scriptId</span><span class="s4">, </span><span class="s3">&quot;script1&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">debugger::Location &amp;endLocation = scope.endLocation.value()</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(endLocation.lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(endLocation.columnNumber.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(endLocation.scriptId</span><span class="s4">, </span><span class="s3">&quot;script2&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">TestSerializeAsyncStackTrace) {</span>
  <span class="s1">runtime::StackTrace stack</span><span class="s4">;</span>
  <span class="s1">stack.description = </span><span class="s3">&quot;childStack&quot;</span><span class="s4">;</span>
  <span class="s1">stack.parent = std::make_unique&lt;runtime::StackTrace&gt;()</span><span class="s4">;</span>
  <span class="s1">stack.parent-&gt;description = </span><span class="s3">&quot;parentStack&quot;</span><span class="s4">;</span>

  <span class="s1">dynamic result = stack.toDynamic()</span><span class="s4">;</span>
  <span class="s1">dynamic expected = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;description&quot;: &quot;childStack&quot;, 
    &quot;callFrames&quot;: [], 
    &quot;parent&quot;: { 
      &quot;description&quot;: &quot;parentStack&quot;, 
      &quot;callFrames&quot;: [] 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(result</span><span class="s4">, </span><span class="s1">expected)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">TestDeserializeAsyncStackTrace) {</span>
  <span class="s1">dynamic message = folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;description&quot;: &quot;childStack&quot;, 
    &quot;callFrames&quot;: [], 
    &quot;parent&quot;: { 
      &quot;description&quot;: &quot;parentStack&quot;, 
      &quot;callFrames&quot;: [] 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">runtime::StackTrace stack(message)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(stack.description</span><span class="s4">, </span><span class="s3">&quot;childStack&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(stack.callFrames.size()</span><span class="s4">, </span><span class="s5">0</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(stack.parent-&gt;description</span><span class="s4">, </span><span class="s3">&quot;parentStack&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(stack.parent-&gt;callFrames.size()</span><span class="s4">, </span><span class="s5">0</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">TestRequestFromJson) {</span>
  <span class="s1">std::unique_ptr&lt;Request&gt; baseReq1 = Request::fromJsonThrowOnError(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;method&quot;: &quot;Debugger.enable&quot; 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s4">auto </span><span class="s1">req1 = </span><span class="s4">static_cast</span><span class="s1">&lt;debugger::EnableRequest *&gt;(baseReq1.get())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req1-&gt;id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req1-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.enable&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">std::unique_ptr&lt;Request&gt; baseReq2 = Request::fromJsonThrowOnError(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 2, 
    &quot;method&quot;: &quot;Debugger.removeBreakpoint&quot;, 
    &quot;params&quot;: { 
      &quot;breakpointId&quot;: &quot;foobar&quot; 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s4">auto </span><span class="s1">req2 = </span><span class="s4">static_cast</span><span class="s1">&lt;debugger::RemoveBreakpointRequest *&gt;(baseReq2.get())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req2-&gt;id</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req2-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.removeBreakpoint&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req2-&gt;breakpointId</span><span class="s4">, </span><span class="s3">&quot;foobar&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">folly::Try&lt;std::unique_ptr&lt;Request&gt;&gt; invalidReq =</span>
      <span class="s1">Request::fromJson(</span><span class="s3">&quot;invalid&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(invalidReq.hasException())</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">TestBreakpointRequestFromJSON) {</span>
  <span class="s1">std::unique_ptr&lt;Request&gt; baseReq = Request::fromJsonThrowOnError(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;method&quot;: &quot;Debugger.setBreakpoint&quot;, 
    &quot;params&quot;: { 
      &quot;location&quot;: { 
        &quot;scriptId&quot;: &quot;23&quot;, 
        &quot;lineNumber&quot;: 45, 
        &quot;columnNumber&quot;: 67 
      } 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s4">auto </span><span class="s1">req = </span><span class="s4">static_cast</span><span class="s1">&lt;debugger::SetBreakpointRequest *&gt;(baseReq.get())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req-&gt;location.scriptId</span><span class="s4">, </span><span class="s3">&quot;23&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req-&gt;location.lineNumber</span><span class="s4">, </span><span class="s5">45</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(req-&gt;location.columnNumber.value()</span><span class="s4">, </span><span class="s5">67</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">struct </span><span class="s1">MyHandler : </span><span class="s4">public </span><span class="s1">NoopRequestHandler {</span>
  <span class="s4">void </span><span class="s1">handle(</span><span class="s4">const </span><span class="s1">debugger::EnableRequest &amp;req) override {</span>
    <span class="s1">enableReq = req</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">void </span><span class="s1">handle(</span><span class="s4">const </span><span class="s1">debugger::RemoveBreakpointRequest &amp;req) override {</span>
    <span class="s1">removeReq = req</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s1">debugger::EnableRequest enableReq</span><span class="s4">;</span>
  <span class="s1">debugger::RemoveBreakpointRequest removeReq</span><span class="s4">;</span>
<span class="s1">}</span><span class="s4">;</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">TestRequestHandler) {</span>
  <span class="s1">MyHandler handler</span><span class="s4">;</span>

  <span class="s1">std::unique_ptr&lt;Request&gt; enableReq = Request::fromJsonThrowOnError(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;method&quot;: &quot;Debugger.enable&quot; 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">enableReq-&gt;accept(handler)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(handler.enableReq.id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(handler.enableReq.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.enable&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">std::unique_ptr&lt;Request&gt; removeReq = Request::fromJsonThrowOnError(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 2, 
    &quot;method&quot;: &quot;Debugger.removeBreakpoint&quot;, 
    &quot;params&quot;: { 
      &quot;breakpointId&quot;: &quot;foobar&quot; 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">removeReq-&gt;accept(handler)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(handler.removeReq.id</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(handler.removeReq.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.removeBreakpoint&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(handler.removeReq.breakpointId</span><span class="s4">, </span><span class="s3">&quot;foobar&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testEnableRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.enable&quot; 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::EnableRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::EnableRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::EnableRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.enable&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testDisableRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.disable&quot; 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::DisableRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::DisableRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::DisableRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.disable&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testEvaluateOnCallFrameRequestMinimal) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.evaluateOnCallFrame&quot;, 
      &quot;params&quot;:{ 
        &quot;callFrameId&quot; : &quot;42&quot;, 
        &quot;expression&quot;: &quot;Foo Bar&quot; 
    } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::EvaluateOnCallFrameRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::EvaluateOnCallFrameRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::EvaluateOnCallFrameRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.evaluateOnCallFrame&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;callFrameId</span><span class="s4">, </span><span class="s3">&quot;42&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;expression</span><span class="s4">, </span><span class="s3">&quot;Foo Bar&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;callFrameId</span><span class="s4">, </span><span class="s1">deserializedReq.callFrameId)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;expression</span><span class="s4">, </span><span class="s1">deserializedReq.expression)</span><span class="s4">;</span>

  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;objectGroup.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;includeCommandLineAPI.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;silent.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;returnByValue.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;throwOnSideEffect.has_value())</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testEvaluateOnCallFrameRequestFull) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.evaluateOnCallFrame&quot;, 
      &quot;params&quot;:{ 
        &quot;callFrameId&quot; : &quot;42&quot;, 
        &quot;expression&quot;: &quot;Foo Bar&quot;, 
        &quot;objectGroup&quot; : &quot;FooBarGroup&quot;, 
        &quot;includeCommandLineAPI&quot; : false, 
        &quot;silent&quot; : true, 
        &quot;returnByValue&quot; : false, 
        &quot;throwOnSideEffect&quot; : true 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::EvaluateOnCallFrameRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::EvaluateOnCallFrameRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::EvaluateOnCallFrameRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics, resolvedReq is correct</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.evaluateOnCallFrame&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;callFrameId</span><span class="s4">, </span><span class="s3">&quot;42&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;expression</span><span class="s4">, </span><span class="s3">&quot;Foo Bar&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;objectGroup.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;includeCommandLineAPI.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;silent.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;returnByValue.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;throwOnSideEffect.has_value())</span><span class="s4">;</span>

  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;objectGroup.value() == </span><span class="s3">&quot;FooBarGroup&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;includeCommandLineAPI.value() == </span><span class="s4">false</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;silent.value() == </span><span class="s4">true</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;returnByValue.value() == </span><span class="s4">false</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;throwOnSideEffect.value() == </span><span class="s4">true</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Specifics, resolvedReq and deserialized match</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;callFrameId</span><span class="s4">, </span><span class="s1">deserializedReq.callFrameId)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;expression</span><span class="s4">, </span><span class="s1">deserializedReq.expression)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;objectGroup.value()</span><span class="s4">, </span><span class="s1">deserializedReq.objectGroup.value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;includeCommandLineAPI.value()</span><span class="s4">,</span>
      <span class="s1">deserializedReq.includeCommandLineAPI.value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;silent.value()</span><span class="s4">, </span><span class="s1">deserializedReq.silent.value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;returnByValue.value()</span><span class="s4">,</span>
      <span class="s1">deserializedReq.returnByValue.value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;throwOnSideEffect.value()</span><span class="s4">,</span>
      <span class="s1">deserializedReq.throwOnSideEffect.value())</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testPauseRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.pause&quot; 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::PauseRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::PauseRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::PauseRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.pause&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testRemoveBreakpointRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.removeBreakpoint&quot;, 
      &quot;params&quot;:{ 
        &quot;breakpointId&quot; : &quot;42&quot; 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::RemoveBreakpointRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::RemoveBreakpointRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::RemoveBreakpointRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.removeBreakpoint&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;breakpointId == </span><span class="s3">&quot;42&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;breakpointId</span><span class="s4">, </span><span class="s1">deserializedReq.breakpointId)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testResumeRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.resume&quot;, 
      &quot;params&quot;: { 
        &quot;terminateOnResume&quot;: false 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::ResumeRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::ResumeRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::ResumeRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.resume&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetBreakpointRequestMinimal) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.setBreakpoint&quot;, 
      &quot;params&quot;:{ 
        &quot;location&quot; : 
        { 
          &quot;lineNumber&quot;: 2, 
          &quot;columnNumber&quot;: 3, 
          &quot;scriptId&quot;: &quot;myScriptId&quot; 
        } 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::SetBreakpointRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">debugger::Location location</span><span class="s4">;</span>
  <span class="s1">location.scriptId = </span><span class="s3">&quot;myScriptId&quot;</span><span class="s4">;</span>
  <span class="s1">location.lineNumber = </span><span class="s5">2</span><span class="s4">;</span>
  <span class="s1">location.columnNumber = </span><span class="s5">3</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setBreakpoint&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;location.scriptId</span><span class="s4">, </span><span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;location.lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;location.columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;condition.has_value())</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;location.scriptId</span><span class="s4">, </span><span class="s1">deserializedReq.location.scriptId)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;location.lineNumber</span><span class="s4">, </span><span class="s1">deserializedReq.location.lineNumber)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;location.columnNumber</span><span class="s4">,</span>
      <span class="s1">deserializedReq.location.columnNumber)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetBreakpointRequestFull) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.setBreakpoint&quot;, 
      &quot;params&quot;:{ 
        &quot;location&quot; : 
        { 
          &quot;lineNumber&quot;: 2, 
          &quot;columnNumber&quot;: 3, 
          &quot;scriptId&quot;: &quot;myScriptId&quot; 
        }, 
        &quot;condition&quot;: &quot;FooBarCondition&quot; 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::SetBreakpointRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setBreakpoint&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;location.scriptId</span><span class="s4">, </span><span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;location.lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;location.columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;condition.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;condition.value()</span><span class="s4">, </span><span class="s3">&quot;FooBarCondition&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;location.scriptId</span><span class="s4">, </span><span class="s1">deserializedReq.location.scriptId)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;location.lineNumber</span><span class="s4">, </span><span class="s1">deserializedReq.location.lineNumber)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;location.columnNumber</span><span class="s4">,</span>
      <span class="s1">deserializedReq.location.columnNumber)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;condition.value()</span><span class="s4">, </span><span class="s1">deserializedReq.condition.value())</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetBreakpointByUrlRequestMinimal) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 1, 
      &quot;method&quot;: &quot;Debugger.setBreakpointByUrl&quot;, 
      &quot;params&quot;: { 
        &quot;lineNumber&quot;: 2 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointByUrlRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::SetBreakpointByUrlRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointByUrlRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setBreakpointByUrl&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;condition.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;columnNumber.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;url.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(resolvedReq-&gt;urlRegex.has_value())</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;lineNumber</span><span class="s4">, </span><span class="s1">deserializedReq.lineNumber)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetBreakpointByUrlRequestFull) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 1, 
      &quot;method&quot;: &quot;Debugger.setBreakpointByUrl&quot;, 
      &quot;params&quot;: { 
        &quot;lineNumber&quot;: 2, 
        &quot;columnNumber&quot;: 3, 
        &quot;condition&quot;: &quot;foo == 42&quot;, 
        &quot;url&quot;: &quot;http://example.com/example.js&quot;, 
        &quot;urlRegex&quot;: &quot;http://example.com/.*&quot; 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointByUrlRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::SetBreakpointByUrlRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointByUrlRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setBreakpointByUrl&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;condition.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;condition.value()</span><span class="s4">, </span><span class="s3">&quot;foo == 42&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;columnNumber.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;columnNumber.value()</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;url.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;url.value()</span><span class="s4">, </span><span class="s3">&quot;http://example.com/example.js&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(resolvedReq-&gt;urlRegex.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;urlRegex.value()</span><span class="s4">, </span><span class="s3">&quot;http://example.com/.*&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;lineNumber</span><span class="s4">, </span><span class="s1">deserializedReq.lineNumber)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;condition.value()</span><span class="s4">, </span><span class="s1">deserializedReq.condition.value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;columnNumber.value()</span><span class="s4">, </span><span class="s1">deserializedReq.columnNumber.value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;url.value()</span><span class="s4">, </span><span class="s1">deserializedReq.url.value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;urlRegex.value()</span><span class="s4">, </span><span class="s1">deserializedReq.urlRegex.value())</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetBreakpointsActiveRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 1, 
      &quot;method&quot;: &quot;Debugger.setBreakpointsActive&quot;, 
      &quot;params&quot;: { 
        &quot;active&quot;: true 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointsActiveRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::SetBreakpointsActiveRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointsActiveRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setBreakpointsActive&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;active</span><span class="s4">, true</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;active</span><span class="s4">, </span><span class="s1">deserializedReq.active)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetInstrumentationBreakpointRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 1, 
      &quot;method&quot;: &quot;Debugger.setInstrumentationBreakpoint&quot;, 
      &quot;params&quot;: { 
        &quot;instrumentation&quot;: &quot;TODO: THIS SHOULD NOT BE ACCEPTED BY ENUM&quot; 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetInstrumentationBreakpointRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::SetInstrumentationBreakpointRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetInstrumentationBreakpointRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setInstrumentationBreakpoint&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">resolvedReq-&gt;instrumentation</span><span class="s4">,</span>
      <span class="s3">&quot;TODO: THIS SHOULD NOT BE ACCEPTED BY ENUM&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;instrumentation</span><span class="s4">, </span><span class="s1">deserializedReq.instrumentation)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetPauseOnExceptionsRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 1, 
      &quot;method&quot;: &quot;Debugger.setPauseOnExceptions&quot;, 
      &quot;params&quot;: { 
        &quot;state&quot;: &quot;TODO: THIS SHOULD NOT BE ACCEPTED BY ENUM&quot; 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetPauseOnExceptionsRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::SetPauseOnExceptionsRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetPauseOnExceptionsRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.setPauseOnExceptions&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;state</span><span class="s4">, </span><span class="s3">&quot;TODO: THIS SHOULD NOT BE ACCEPTED BY ENUM&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;state</span><span class="s4">, </span><span class="s1">deserializedReq.state)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testStepIntoRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.stepInto&quot; 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::StepIntoRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::StepIntoRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::StepIntoRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.stepInto&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testStepOutRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.stepOut&quot; 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::StepOutRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::StepOutRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::StepOutRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.stepOut&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testStepOverRequest) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;id&quot;: 10, 
      &quot;method&quot;: &quot;Debugger.stepOver&quot; 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Builder does not throw</span>
  <span class="s4">auto </span><span class="s1">req = Request::fromJsonThrowOnError(message)</span><span class="s4">;</span>
  <span class="s1">debugger::StepOverRequest *resolvedReq =</span>
      <span class="s4">dynamic_cast</span><span class="s1">&lt;debugger::StepOverRequest *&gt;(req.get())</span><span class="s4">;</span>

  <span class="s0">// Builder returns correct type</span>
  <span class="s1">EXPECT_FALSE(resolvedReq == </span><span class="s4">nullptr</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::StepOverRequest deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s3">&quot;Debugger.stepOver&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(resolvedReq-&gt;id</span><span class="s4">, </span><span class="s1">deserializedReq.id)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(resolvedReq-&gt;method</span><span class="s4">, </span><span class="s1">deserializedReq.method)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testEvaluateOnCallFrameResponseMinimal) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;result&quot;: 
        { 
          &quot;result&quot;:{ 
            &quot;type&quot;: &quot;string&quot; 
          } 
        }, 
      &quot;id&quot;:2 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::EvaluateOnCallFrameResponse deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s1">EXPECT_FALSE(deserializedReq.result.subtype.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(deserializedReq.result.value.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(deserializedReq.result.unserializableValue.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(deserializedReq.result.description.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(deserializedReq.result.objectId.has_value())</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(deserializedReq.id</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.result.type</span><span class="s4">, </span><span class="s3">&quot;string&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testEvaluateOnCallFrameResponseFull) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;result&quot;: 
        { 
          &quot;result&quot;:{ 
            &quot;type&quot;: &quot;string&quot;, 
            &quot;subtype&quot;: &quot;SuperString&quot;, 
            &quot;value&quot;: {&quot;foobarkey&quot;: &quot;foobarval&quot;}, 
            &quot;unserializableValue&quot;: &quot;unserializableValueVal&quot;, 
            &quot;description&quot;: &quot;A Wonderful desc&quot;, 
            &quot;objectId&quot;: &quot;AnObjectID&quot; 
          } 
        }, 
      &quot;id&quot;:2 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::EvaluateOnCallFrameResponse deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s1">EXPECT_TRUE(deserializedReq.result.subtype.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.result.value.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.result.unserializableValue.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.result.description.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.result.objectId.has_value())</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(deserializedReq.result.subtype.value()</span><span class="s4">, </span><span class="s3">&quot;SuperString&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.result.value.value()</span><span class="s4">,</span>
      <span class="s1">folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{&quot;foobarkey&quot;: &quot;foobarval&quot;}</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">))</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.result.unserializableValue.value()</span><span class="s4">,</span>
      <span class="s3">&quot;unserializableValueVal&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.result.description.value()</span><span class="s4">, </span><span class="s3">&quot;A Wonderful desc&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.result.objectId.value()</span><span class="s4">, </span><span class="s3">&quot;AnObjectID&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(deserializedReq.id</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.result.type</span><span class="s4">, </span><span class="s3">&quot;string&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetBreakpointByUrlResponse) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;result&quot;:{ 
      &quot;breakpointId&quot;: &quot;myBreakpointId&quot;, 
      &quot;locations&quot;: [ 
        { 
          &quot;lineNumber&quot;: 2, 
          &quot;columnNumber&quot;: 3, 
          &quot;scriptId&quot;: &quot;myScriptId&quot; 
        } 
      ] 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointByUrlResponse deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(deserializedReq.id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.breakpointId</span><span class="s4">, </span><span class="s3">&quot;myBreakpointId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.locations.size()</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.locations[</span><span class="s5">0</span><span class="s1">].lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.locations[</span><span class="s5">0</span><span class="s1">].columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.locations[</span><span class="s5">0</span><span class="s1">].scriptId</span><span class="s4">, </span><span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetBreakpointResponse) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;result&quot;:{ 
      &quot;breakpointId&quot;: &quot;myBreakpointId&quot;, 
      &quot;actualLocation&quot;: 
        { 
          &quot;lineNumber&quot;: 2, 
          &quot;columnNumber&quot;: 3, 
          &quot;scriptId&quot;: &quot;myScriptId&quot; 
        } 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetBreakpointResponse deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(deserializedReq.breakpointId</span><span class="s4">, </span><span class="s3">&quot;myBreakpointId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.actualLocation.lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.actualLocation.columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.actualLocation.scriptId</span><span class="s4">, </span><span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testSetInstrumentationBreakpointResponse) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{ 
    &quot;id&quot;: 1, 
    &quot;result&quot;:{ 
      &quot;breakpointId&quot;: &quot;myBreakpointId&quot; 
    } 
  }</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::SetInstrumentationBreakpointResponse deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(deserializedReq.breakpointId</span><span class="s4">, </span><span class="s3">&quot;myBreakpointId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.id</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testBreakpointResolvedNotification) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;method&quot;: &quot;Debugger.breakpointResolved&quot;, 
      &quot;params&quot;:{ 
        &quot;breakpointId&quot; : &quot;42&quot;, 
        &quot;location&quot;: 
        { 
          &quot;lineNumber&quot;: 2, 
          &quot;columnNumber&quot;: 3, 
          &quot;scriptId&quot;: &quot;myScriptId&quot; 
        } 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::BreakpointResolvedNotification deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(deserializedReq.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.breakpointResolved&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.breakpointId</span><span class="s4">, </span><span class="s3">&quot;42&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.location.lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.location.columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.location.scriptId</span><span class="s4">, </span><span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testPauseNotificationMinimal) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;method&quot;: &quot;Debugger.paused&quot;, 
      &quot;params&quot;:{ 
        &quot;reason&quot;: &quot;Some Valid Reason&quot;, 
        &quot;callFrames&quot;:[ 
          { 
            &quot;callFrameId&quot;: &quot;aCallFrameId&quot;, 
            &quot;functionName&quot;: &quot;aFunctionName&quot;, 
            &quot;location&quot;:{ 
              &quot;lineNumber&quot;: 2, 
              &quot;columnNumber&quot;: 3, 
              &quot;scriptId&quot;: &quot;myScriptId&quot; 
            }, 
            &quot;url&quot;: &quot;aURL&quot;, 
            &quot;scopeChain&quot;: [ 
              { 
                &quot;type&quot;: &quot;aType&quot;, 
                &quot;object&quot;: { 
                  &quot;type&quot;: &quot;aRemoteObjectType&quot; 
                } 
              } 
            ], 
            &quot;this&quot;: { 
              &quot;type&quot;: &quot;aType&quot; 
            } 
          } 
        ] 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::PausedNotification deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s1">EXPECT_FALSE(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].functionLocation.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(deserializedReq.asyncStackTrace.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(deserializedReq.hitBreakpoints.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_FALSE(deserializedReq.data.has_value())</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(deserializedReq.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.paused&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.reason</span><span class="s4">, </span><span class="s3">&quot;Some Valid Reason&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].functionName</span><span class="s4">, </span><span class="s3">&quot;aFunctionName&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].callFrameId</span><span class="s4">, </span><span class="s3">&quot;aCallFrameId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].url</span><span class="s4">, </span><span class="s3">&quot;aURL&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].location.lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].location.columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].location.scriptId</span><span class="s4">, </span><span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].scopeChain[</span><span class="s5">0</span><span class="s1">].type</span><span class="s4">, </span><span class="s3">&quot;aType&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].scopeChain[</span><span class="s5">0</span><span class="s1">].object.type</span><span class="s4">,</span>
      <span class="s3">&quot;aRemoteObjectType&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].thisObj.type</span><span class="s4">, </span><span class="s3">&quot;aType&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testPauseNotificationFull) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;method&quot;: &quot;Debugger.paused&quot;, 
      &quot;params&quot;:{ 
        &quot;reason&quot;: &quot;Some Valid Reason&quot;, 
        &quot;callFrames&quot;:[ 
          { 
            &quot;functionLocation&quot;: { 
              &quot;lineNumber&quot;: 2, 
              &quot;columnNumber&quot;: 3, 
              &quot;scriptId&quot;: &quot;myScriptId&quot; 
            }, 
            &quot;returnValue&quot; : { 
              &quot;type&quot;: &quot;aRemoteObjectType&quot;, 
              &quot;subtype&quot;: &quot;subtype&quot;, 
              &quot;className&quot;:&quot;className&quot;, 
              &quot;value&quot;: &quot;value&quot;, 
              &quot;unserializableValue&quot;: &quot;unserializableValue&quot;, 
              &quot;description&quot;: &quot;description&quot;, 
              &quot;objectId&quot;: &quot;objectId&quot; 
            }, 
            &quot;callFrameId&quot;: &quot;aCallFrameId&quot;, 
            &quot;functionName&quot;: &quot;aFunctionName&quot;, 
            &quot;location&quot;:{ 
              &quot;lineNumber&quot;: 2, 
              &quot;columnNumber&quot;: 3, 
              &quot;scriptId&quot;: &quot;myScriptId&quot; 
            }, 
            &quot;url&quot;: &quot;aURL&quot;, 
            &quot;scopeChain&quot;: [ 
              { 
                &quot;type&quot;: &quot;aType&quot;, 
                &quot;object&quot;: { 
                  &quot;type&quot;: &quot;aRemoteObjectType&quot; 
                } 
              } 
            ], 
            &quot;this&quot;: { 
              &quot;type&quot;: &quot;aType&quot; 
            } 
          } 
        ], 
        &quot;data&quot;: {&quot;dataKey&quot;: &quot;dataVal&quot;}, 
        &quot;hitBreakpoints&quot;: [ 
          &quot;foo&quot;,&quot;bar&quot; 
        ], 
        &quot;asyncStackTrace&quot;:{ 
          &quot;description&quot;: &quot;an asyncStackTrace Desc&quot;, 
          &quot;callFrames&quot;:[ 
          { 
            &quot;functionName&quot;: &quot;aFunctionName&quot;, 
            &quot;lineNumber&quot;: 2, 
            &quot;columnNumber&quot;: 3, 
            &quot;scriptId&quot;: &quot;myScriptId&quot;, 
            &quot;url&quot;: &quot;aURL&quot; 
          } 
        ] 
      } 
      } 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s1">std::optional&lt;debugger::Location&gt; functionLocation</span><span class="s4">;</span>
  <span class="s1">std::optional&lt;runtime::RemoteObject&gt; returnValue</span><span class="s4">;</span>
  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::PausedNotification deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Check optionnals</span>
  <span class="s0">// ----------------</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].functionLocation.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.asyncStackTrace.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.hitBreakpoints.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.data.has_value())</span><span class="s4">;</span>

  <span class="s1">EXPECT_TRUE(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().subtype.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().className.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">]</span>
                  <span class="s1">.returnValue.value()</span>
                  <span class="s1">.unserializableValue.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().value.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">]</span>
                  <span class="s1">.returnValue.value()</span>
                  <span class="s1">.description.has_value())</span><span class="s4">;</span>
  <span class="s1">EXPECT_TRUE(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().objectId.has_value())</span><span class="s4">;</span>

  <span class="s0">// Check optionnals Values</span>
  <span class="s0">// -----------------------</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].functionLocation.value().lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].functionLocation.value().columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].functionLocation.value().scriptId</span><span class="s4">,</span>
      <span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().type</span><span class="s4">,</span>
      <span class="s3">&quot;aRemoteObjectType&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().subtype.has_value()</span><span class="s4">,</span>
      <span class="s4">true</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().subtype.value()</span><span class="s4">,</span>
      <span class="s3">&quot;subtype&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().className.has_value()</span><span class="s4">,</span>
      <span class="s4">true</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().className.value()</span><span class="s4">,</span>
      <span class="s3">&quot;className&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().value.has_value()</span><span class="s4">,</span>
      <span class="s4">true</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().value.value()</span><span class="s4">, </span><span class="s3">&quot;value&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">]</span>
          <span class="s1">.returnValue.value()</span>
          <span class="s1">.unserializableValue.has_value()</span><span class="s4">,</span>
      <span class="s4">true</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">]</span>
          <span class="s1">.returnValue.value()</span>
          <span class="s1">.unserializableValue.value()</span><span class="s4">,</span>
      <span class="s3">&quot;unserializableValue&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().description.has_value()</span><span class="s4">,</span>
      <span class="s4">true</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().description.value()</span><span class="s4">,</span>
      <span class="s3">&quot;description&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().objectId.has_value()</span><span class="s4">,</span>
      <span class="s4">true</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].returnValue.value().objectId.value()</span><span class="s4">,</span>
      <span class="s3">&quot;objectId&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(deserializedReq.hitBreakpoints.value()[</span><span class="s5">0</span><span class="s1">]</span><span class="s4">, </span><span class="s3">&quot;foo&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.hitBreakpoints.value()[</span><span class="s5">1</span><span class="s1">]</span><span class="s4">, </span><span class="s3">&quot;bar&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.data.value()</span><span class="s4">,</span>
      <span class="s1">folly::parseJson(</span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span><span class="s3">{&quot;dataKey&quot;: &quot;dataVal&quot;}</span><span class="s4">)</span><span class="s3">&quot;</span><span class="s1">))</span><span class="s4">;</span>

  <span class="s0">// Check Compulsory</span>
  <span class="s0">// ----------------</span>
  <span class="s1">EXPECT_EQ(deserializedReq.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.paused&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.reason</span><span class="s4">, </span><span class="s3">&quot;Some Valid Reason&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].functionName</span><span class="s4">, </span><span class="s3">&quot;aFunctionName&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].callFrameId</span><span class="s4">, </span><span class="s3">&quot;aCallFrameId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].url</span><span class="s4">, </span><span class="s3">&quot;aURL&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].location.lineNumber</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].location.columnNumber</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].location.scriptId</span><span class="s4">, </span><span class="s3">&quot;myScriptId&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].scopeChain[</span><span class="s5">0</span><span class="s1">].type</span><span class="s4">, </span><span class="s3">&quot;aType&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(</span>
      <span class="s1">deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].scopeChain[</span><span class="s5">0</span><span class="s1">].object.type</span><span class="s4">,</span>
      <span class="s3">&quot;aRemoteObjectType&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.callFrames[</span><span class="s5">0</span><span class="s1">].thisObj.type</span><span class="s4">, </span><span class="s3">&quot;aType&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">TEST(MessageTests</span><span class="s4">, </span><span class="s1">testResumedNotification) {</span>
  <span class="s1">std::string message = </span><span class="s4">R</span><span class="s3">&quot;</span><span class="s4">(</span>
    <span class="s3">{ 
      &quot;method&quot;: &quot;Debugger.resumed&quot; 
    } 
  </span><span class="s4">)</span><span class="s3">&quot;</span><span class="s4">;</span>

  <span class="s0">// Serialize and Deserialize are inverse functions</span>
  <span class="s1">dynamic messageJSON = folly::parseJson(message)</span><span class="s4">;</span>
  <span class="s1">debugger::ResumedNotification deserializedReq(messageJSON)</span><span class="s4">;</span>
  <span class="s1">EXPECT_EQ(deserializedReq.toDynamic()</span><span class="s4">, </span><span class="s1">messageJSON)</span><span class="s4">;</span>

  <span class="s0">// Specifics</span>
  <span class="s1">EXPECT_EQ(deserializedReq.method</span><span class="s4">, </span><span class="s3">&quot;Debugger.resumed&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">} </span><span class="s0">// namespace message</span>
<span class="s1">} </span><span class="s0">// namespace chrome</span>
<span class="s1">} </span><span class="s0">// namespace inspector</span>
<span class="s1">} </span><span class="s0">// namespace hermes</span>
<span class="s1">} </span><span class="s0">// namespace facebook</span>
</pre>
</body>
</html>