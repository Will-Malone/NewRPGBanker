<html>
<head>
<title>ReactTextInputManager.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ReactTextInputManager.java</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 * Copyright (c) Meta Platforms, Inc. and affiliates. 
 * 
 * This source code is licensed under the MIT license found in the 
 * LICENSE file in the root directory of this source tree. 
 */</span>

<span class="s2">package </span><span class="s1">com.facebook.react.views.textinput</span><span class="s2">;</span>

<span class="s2">import static </span><span class="s1">com.facebook.react.uimanager.UIManagerHelper.getReactContext</span><span class="s2">;</span>

<span class="s2">import </span><span class="s1">android.content.Context</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.content.res.ColorStateList</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.graphics.BlendMode</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.graphics.BlendModeColorFilter</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.graphics.Paint</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.graphics.PorterDuff</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.graphics.drawable.Drawable</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.os.Build</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.text.Editable</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.text.InputFilter</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.text.InputType</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.text.Layout</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.text.Spannable</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.text.SpannableStringBuilder</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.text.TextWatcher</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.view.Gravity</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.view.KeyEvent</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.view.View</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.view.ViewGroup</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.view.inputmethod.EditorInfo</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.widget.TextView</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">androidx.annotation.Nullable</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">androidx.autofill.HintConstants</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">androidx.core.content.ContextCompat</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.common.logging.FLog</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.infer.annotation.Assertions</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.Dynamic</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReactContext</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReactSoftExceptionLogger</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReadableArray</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReadableMap</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReadableNativeMap</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReadableType</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.WritableMap</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.WritableNativeMap</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.common.MapBuilder</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.common.ReactConstants</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.common.mapbuffer.MapBuffer</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.module.annotations.ReactModule</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.BaseViewManager</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.FabricViewStateManager</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.LayoutShadowNode</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.PixelUtil</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.ReactStylesDiffMap</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.Spacing</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.StateWrapper</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.ThemedReactContext</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.UIManagerHelper</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.ViewDefaults</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.ViewProps</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.annotations.ReactProp</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.annotations.ReactPropGroup</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.events.EventDispatcher</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.imagehelper.ResourceDrawableIdHelper</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.scroll.ScrollEvent</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.scroll.ScrollEventType</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.DefaultStyleValuesUtil</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.ReactBaseTextShadowNode</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.ReactTextUpdate</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.ReactTextViewManagerCallback</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.ReactTypefaceUtils</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.TextAttributeProps</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.TextInlineImageSpan</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.TextLayoutManager</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.TextLayoutManagerMapBuffer</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.views.text.TextTransform</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.yoga.YogaConstants</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.lang.reflect.Field</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.util.HashMap</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.util.LinkedList</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.util.Locale</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.util.Map</span><span class="s2">;</span>

<span class="s3">/** Manages instances of TextInput. */</span>
<span class="s1">@ReactModule(name = ReactTextInputManager.REACT_CLASS)</span>
<span class="s2">public class </span><span class="s1">ReactTextInputManager </span><span class="s2">extends </span><span class="s1">BaseViewManager&lt;ReactEditText</span><span class="s2">, </span><span class="s1">LayoutShadowNode&gt; {</span>
  <span class="s2">public static final </span><span class="s1">String TAG = ReactTextInputManager.</span><span class="s2">class</span><span class="s1">.getSimpleName()</span><span class="s2">;</span>
  <span class="s2">public static final </span><span class="s1">String REACT_CLASS = </span><span class="s4">&quot;AndroidTextInput&quot;</span><span class="s2">;</span>

  <span class="s0">// See also ReactTextViewManager</span>
  <span class="s2">private static final short </span><span class="s1">TX_STATE_KEY_ATTRIBUTED_STRING = </span><span class="s5">0</span><span class="s2">;</span>
  <span class="s2">private static final short </span><span class="s1">TX_STATE_KEY_PARAGRAPH_ATTRIBUTES = </span><span class="s5">1</span><span class="s2">;</span>
  <span class="s2">private static final short </span><span class="s1">TX_STATE_KEY_HASH = </span><span class="s5">2</span><span class="s2">;</span>
  <span class="s2">private static final short </span><span class="s1">TX_STATE_KEY_MOST_RECENT_EVENT_COUNT = </span><span class="s5">3</span><span class="s2">;</span>

  <span class="s2">private static final int</span><span class="s1">[] SPACING_TYPES = {</span>
    <span class="s1">Spacing.ALL</span><span class="s2">, </span><span class="s1">Spacing.LEFT</span><span class="s2">, </span><span class="s1">Spacing.RIGHT</span><span class="s2">, </span><span class="s1">Spacing.TOP</span><span class="s2">, </span><span class="s1">Spacing.BOTTOM</span><span class="s2">,</span>
  <span class="s1">}</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">String&gt; REACT_PROPS_AUTOFILL_HINTS_MAP =</span>
      <span class="s2">new </span><span class="s1">HashMap&lt;String</span><span class="s2">, </span><span class="s1">String&gt;() {</span>
        <span class="s1">{</span>
          <span class="s1">put(</span><span class="s4">&quot;birthdate-day&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_BIRTH_DATE_DAY)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;birthdate-full&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_BIRTH_DATE_FULL)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;birthdate-month&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_BIRTH_DATE_MONTH)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;birthdate-year&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_BIRTH_DATE_YEAR)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;cc-csc&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_CREDIT_CARD_SECURITY_CODE)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;cc-exp&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_CREDIT_CARD_EXPIRATION_DATE)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;cc-exp-day&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_CREDIT_CARD_EXPIRATION_DAY)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;cc-exp-month&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_CREDIT_CARD_EXPIRATION_MONTH)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;cc-exp-year&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_CREDIT_CARD_EXPIRATION_YEAR)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;cc-number&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_CREDIT_CARD_NUMBER)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;email&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_EMAIL_ADDRESS)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;gender&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_GENDER)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;name&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PERSON_NAME)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;name-family&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PERSON_NAME_FAMILY)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;name-given&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PERSON_NAME_GIVEN)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;name-middle&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PERSON_NAME_MIDDLE)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;name-middle-initial&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PERSON_NAME_MIDDLE_INITIAL)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;name-prefix&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PERSON_NAME_PREFIX)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;name-suffix&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PERSON_NAME_SUFFIX)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;password&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PASSWORD)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;password-new&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_NEW_PASSWORD)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;postal-address&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_POSTAL_ADDRESS)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;postal-address-country&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_POSTAL_ADDRESS_COUNTRY)</span><span class="s2">;</span>
          <span class="s1">put(</span>
              <span class="s4">&quot;postal-address-extended&quot;</span><span class="s2">,</span>
              <span class="s1">HintConstants.AUTOFILL_HINT_POSTAL_ADDRESS_EXTENDED_ADDRESS)</span><span class="s2">;</span>
          <span class="s1">put(</span>
              <span class="s4">&quot;postal-address-extended-postal-code&quot;</span><span class="s2">,</span>
              <span class="s1">HintConstants.AUTOFILL_HINT_POSTAL_ADDRESS_EXTENDED_POSTAL_CODE)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;postal-address-locality&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_POSTAL_ADDRESS_LOCALITY)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;postal-address-region&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_POSTAL_ADDRESS_REGION)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;postal-code&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_POSTAL_CODE)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;street-address&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_POSTAL_ADDRESS_STREET_ADDRESS)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;sms-otp&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_SMS_OTP)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;tel&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PHONE_NUMBER)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;tel-country-code&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PHONE_COUNTRY_CODE)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;tel-national&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PHONE_NATIONAL)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;tel-device&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_PHONE_NUMBER_DEVICE)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;username&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_USERNAME)</span><span class="s2">;</span>
          <span class="s1">put(</span><span class="s4">&quot;username-new&quot;</span><span class="s2">, </span><span class="s1">HintConstants.AUTOFILL_HINT_NEW_USERNAME)</span><span class="s2">;</span>
        <span class="s1">}</span>
      <span class="s1">}</span><span class="s2">;</span>

  <span class="s2">private static final int </span><span class="s1">FOCUS_TEXT_INPUT = </span><span class="s5">1</span><span class="s2">;</span>
  <span class="s2">private static final int </span><span class="s1">BLUR_TEXT_INPUT = </span><span class="s5">2</span><span class="s2">;</span>
  <span class="s2">private static final int </span><span class="s1">SET_MOST_RECENT_EVENT_COUNT = </span><span class="s5">3</span><span class="s2">;</span>
  <span class="s2">private static final int </span><span class="s1">SET_TEXT_AND_SELECTION = </span><span class="s5">4</span><span class="s2">;</span>

  <span class="s2">private static final int </span><span class="s1">INPUT_TYPE_KEYBOARD_NUMBER_PAD = InputType.TYPE_CLASS_NUMBER</span><span class="s2">;</span>
  <span class="s2">private static final int </span><span class="s1">INPUT_TYPE_KEYBOARD_DECIMAL_PAD =</span>
      <span class="s1">INPUT_TYPE_KEYBOARD_NUMBER_PAD | InputType.TYPE_NUMBER_FLAG_DECIMAL</span><span class="s2">;</span>
  <span class="s2">private static final int </span><span class="s1">INPUT_TYPE_KEYBOARD_NUMBERED =</span>
      <span class="s1">INPUT_TYPE_KEYBOARD_DECIMAL_PAD | InputType.TYPE_NUMBER_FLAG_SIGNED</span><span class="s2">;</span>
  <span class="s2">private static final int </span><span class="s1">PASSWORD_VISIBILITY_FLAG =</span>
      <span class="s1">InputType.TYPE_TEXT_VARIATION_VISIBLE_PASSWORD &amp; ~InputType.TYPE_TEXT_VARIATION_PASSWORD</span><span class="s2">;</span>
  <span class="s2">private static final int </span><span class="s1">AUTOCAPITALIZE_FLAGS =</span>
      <span class="s1">InputType.TYPE_TEXT_FLAG_CAP_SENTENCES</span>
          <span class="s1">| InputType.TYPE_TEXT_FLAG_CAP_WORDS</span>
          <span class="s1">| InputType.TYPE_TEXT_FLAG_CAP_CHARACTERS</span><span class="s2">;</span>

  <span class="s2">private static final </span><span class="s1">String KEYBOARD_TYPE_EMAIL_ADDRESS = </span><span class="s4">&quot;email-address&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String KEYBOARD_TYPE_NUMERIC = </span><span class="s4">&quot;numeric&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String KEYBOARD_TYPE_DECIMAL_PAD = </span><span class="s4">&quot;decimal-pad&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String KEYBOARD_TYPE_NUMBER_PAD = </span><span class="s4">&quot;number-pad&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String KEYBOARD_TYPE_PHONE_PAD = </span><span class="s4">&quot;phone-pad&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String KEYBOARD_TYPE_VISIBLE_PASSWORD = </span><span class="s4">&quot;visible-password&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String KEYBOARD_TYPE_URI = </span><span class="s4">&quot;url&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">InputFilter[] EMPTY_FILTERS = </span><span class="s2">new </span><span class="s1">InputFilter[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">;</span>
  <span class="s2">private static final int </span><span class="s1">UNSET = -</span><span class="s5">1</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String[] DRAWABLE_FIELDS = {</span>
    <span class="s4">&quot;mCursorDrawable&quot;</span><span class="s2">, </span><span class="s4">&quot;mSelectHandleLeft&quot;</span><span class="s2">, </span><span class="s4">&quot;mSelectHandleRight&quot;</span><span class="s2">, </span><span class="s4">&quot;mSelectHandleCenter&quot;</span>
  <span class="s1">}</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String[] DRAWABLE_RESOURCES = {</span>
    <span class="s4">&quot;mCursorDrawableRes&quot;</span><span class="s2">,</span>
    <span class="s4">&quot;mTextSelectHandleLeftRes&quot;</span><span class="s2">,</span>
    <span class="s4">&quot;mTextSelectHandleRightRes&quot;</span><span class="s2">,</span>
    <span class="s4">&quot;mTextSelectHandleRes&quot;</span>
  <span class="s1">}</span><span class="s2">;</span>

  <span class="s2">protected </span><span class="s1">@Nullable ReactTextViewManagerCallback mReactTextViewManagerCallback</span><span class="s2">;</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">String getName() {</span>
    <span class="s2">return </span><span class="s1">REACT_CLASS</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">ReactEditText createViewInstance(ThemedReactContext context) {</span>
    <span class="s1">ReactEditText editText = </span><span class="s2">new </span><span class="s1">ReactEditText(context)</span><span class="s2">;</span>
    <span class="s2">int </span><span class="s1">inputType = editText.getInputType()</span><span class="s2">;</span>
    <span class="s1">editText.setInputType(inputType &amp; (~InputType.TYPE_TEXT_FLAG_MULTI_LINE))</span><span class="s2">;</span>
    <span class="s1">editText.setReturnKeyType(</span><span class="s4">&quot;done&quot;</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s0">// Set default layoutParams to avoid NullPointerException to be thrown by Android EditTextView</span>
    <span class="s0">// when update props (PlaceHolder) is executed before the view is layout.</span>
    <span class="s0">// This change should not affect layout for TextInput components because layout will be</span>
    <span class="s0">// overridden on the first RN commit.</span>
    <span class="s1">editText.setLayoutParams(</span>
        <span class="s2">new </span><span class="s1">ViewGroup.LayoutParams(</span>
            <span class="s1">ViewGroup.LayoutParams.WRAP_CONTENT</span><span class="s2">, </span><span class="s1">ViewGroup.LayoutParams.WRAP_CONTENT))</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">editText</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">ReactBaseTextShadowNode createShadowNodeInstance() {</span>
    <span class="s2">return new </span><span class="s1">ReactTextInputShadowNode()</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">public </span><span class="s1">ReactBaseTextShadowNode createShadowNodeInstance(</span>
      <span class="s1">@Nullable ReactTextViewManagerCallback reactTextViewManagerCallback) {</span>
    <span class="s2">return new </span><span class="s1">ReactTextInputShadowNode(reactTextViewManagerCallback)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">Class&lt;? </span><span class="s2">extends </span><span class="s1">LayoutShadowNode&gt; getShadowNodeClass() {</span>
    <span class="s2">return </span><span class="s1">ReactTextInputShadowNode.</span><span class="s2">class;</span>
  <span class="s1">}</span>

  <span class="s1">@Nullable</span>
  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; getExportedCustomBubblingEventTypeConstants() {</span>
    <span class="s1">@Nullable</span>
    <span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; baseEventTypeConstants =</span>
        <span class="s2">super</span><span class="s1">.getExportedCustomBubblingEventTypeConstants()</span><span class="s2">;</span>
    <span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; eventTypeConstants =</span>
        <span class="s1">baseEventTypeConstants == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">new </span><span class="s1">HashMap&lt;String</span><span class="s2">, </span><span class="s1">Object&gt;() : baseEventTypeConstants</span><span class="s2">;</span>
    <span class="s1">eventTypeConstants.putAll(</span>
        <span class="s1">MapBuilder.&lt;String</span><span class="s2">, </span><span class="s1">Object&gt;builder()</span>
            <span class="s1">.put(</span>
                <span class="s4">&quot;topSubmitEditing&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s4">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span>
                        <span class="s4">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s4">&quot;onSubmitEditing&quot;</span><span class="s2">, </span><span class="s4">&quot;captured&quot;</span><span class="s2">, </span><span class="s4">&quot;onSubmitEditingCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s4">&quot;topEndEditing&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s4">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s4">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s4">&quot;onEndEditing&quot;</span><span class="s2">, </span><span class="s4">&quot;captured&quot;</span><span class="s2">, </span><span class="s4">&quot;onEndEditingCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s4">&quot;topTextInput&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s4">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s4">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s4">&quot;onTextInput&quot;</span><span class="s2">, </span><span class="s4">&quot;captured&quot;</span><span class="s2">, </span><span class="s4">&quot;onTextInputCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s4">&quot;topFocus&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s4">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s4">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s4">&quot;onFocus&quot;</span><span class="s2">, </span><span class="s4">&quot;captured&quot;</span><span class="s2">, </span><span class="s4">&quot;onFocusCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s4">&quot;topBlur&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s4">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s4">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s4">&quot;onBlur&quot;</span><span class="s2">, </span><span class="s4">&quot;captured&quot;</span><span class="s2">, </span><span class="s4">&quot;onBlurCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s4">&quot;topKeyPress&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s4">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s4">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s4">&quot;onKeyPress&quot;</span><span class="s2">, </span><span class="s4">&quot;captured&quot;</span><span class="s2">, </span><span class="s4">&quot;onKeyPressCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.build())</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">eventTypeConstants</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Nullable</span>
  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; getExportedCustomDirectEventTypeConstants() {</span>
    <span class="s1">@Nullable</span>
    <span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; baseEventTypeConstants = </span><span class="s2">super</span><span class="s1">.getExportedCustomDirectEventTypeConstants()</span><span class="s2">;</span>
    <span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; eventTypeConstants =</span>
        <span class="s1">baseEventTypeConstants == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">new </span><span class="s1">HashMap&lt;String</span><span class="s2">, </span><span class="s1">Object&gt;() : baseEventTypeConstants</span><span class="s2">;</span>
    <span class="s1">eventTypeConstants.putAll(</span>
        <span class="s1">MapBuilder.&lt;String</span><span class="s2">, </span><span class="s1">Object&gt;builder()</span>
            <span class="s1">.put(</span>
                <span class="s1">ScrollEventType.getJSEventName(ScrollEventType.SCROLL)</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span><span class="s4">&quot;registrationName&quot;</span><span class="s2">, </span><span class="s4">&quot;onScroll&quot;</span><span class="s1">))</span>
            <span class="s1">.build())</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">eventTypeConstants</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">@Nullable Map&lt;String</span><span class="s2">, </span><span class="s1">Integer&gt; getCommandsMap() {</span>
    <span class="s2">return </span><span class="s1">MapBuilder.of(</span><span class="s4">&quot;focusTextInput&quot;</span><span class="s2">, </span><span class="s1">FOCUS_TEXT_INPUT</span><span class="s2">, </span><span class="s4">&quot;blurTextInput&quot;</span><span class="s2">, </span><span class="s1">BLUR_TEXT_INPUT)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">receiveCommand(</span>
      <span class="s1">ReactEditText reactEditText</span><span class="s2">, int </span><span class="s1">commandId</span><span class="s2">, </span><span class="s1">@Nullable ReadableArray args) {</span>
    <span class="s2">switch </span><span class="s1">(commandId) {</span>
      <span class="s2">case </span><span class="s1">FOCUS_TEXT_INPUT:</span>
        <span class="s2">this</span><span class="s1">.receiveCommand(reactEditText</span><span class="s2">, </span><span class="s4">&quot;focus&quot;</span><span class="s2">, </span><span class="s1">args)</span><span class="s2">;</span>
        <span class="s2">break;</span>
      <span class="s2">case </span><span class="s1">BLUR_TEXT_INPUT:</span>
        <span class="s2">this</span><span class="s1">.receiveCommand(reactEditText</span><span class="s2">, </span><span class="s4">&quot;blur&quot;</span><span class="s2">, </span><span class="s1">args)</span><span class="s2">;</span>
        <span class="s2">break;</span>
      <span class="s2">case </span><span class="s1">SET_MOST_RECENT_EVENT_COUNT:</span>
        <span class="s0">// TODO: delete, this is no longer used from JS</span>
        <span class="s2">break;</span>
      <span class="s2">case </span><span class="s1">SET_TEXT_AND_SELECTION:</span>
        <span class="s2">this</span><span class="s1">.receiveCommand(reactEditText</span><span class="s2">, </span><span class="s4">&quot;setTextAndSelection&quot;</span><span class="s2">, </span><span class="s1">args)</span><span class="s2">;</span>
        <span class="s2">break;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">receiveCommand(</span>
      <span class="s1">ReactEditText reactEditText</span><span class="s2">, </span><span class="s1">String commandId</span><span class="s2">, </span><span class="s1">@Nullable ReadableArray args) {</span>
    <span class="s2">switch </span><span class="s1">(commandId) {</span>
      <span class="s2">case </span><span class="s4">&quot;focus&quot;</span><span class="s1">:</span>
      <span class="s2">case </span><span class="s4">&quot;focusTextInput&quot;</span><span class="s1">:</span>
        <span class="s1">reactEditText.requestFocusFromJS()</span><span class="s2">;</span>
        <span class="s2">break;</span>
      <span class="s2">case </span><span class="s4">&quot;blur&quot;</span><span class="s1">:</span>
      <span class="s2">case </span><span class="s4">&quot;blurTextInput&quot;</span><span class="s1">:</span>
        <span class="s1">reactEditText.clearFocusFromJS()</span><span class="s2">;</span>
        <span class="s2">break;</span>
      <span class="s2">case </span><span class="s4">&quot;setTextAndSelection&quot;</span><span class="s1">:</span>
        <span class="s2">int </span><span class="s1">mostRecentEventCount = args.getInt(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s2">if </span><span class="s1">(mostRecentEventCount == UNSET) {</span>
          <span class="s2">return;</span>
        <span class="s1">}</span>

        <span class="s2">int </span><span class="s1">start = args.getInt(</span><span class="s5">2</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s2">int </span><span class="s1">end = args.getInt(</span><span class="s5">3</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s2">if </span><span class="s1">(end == UNSET) {</span>
          <span class="s1">end = start</span><span class="s2">;</span>
        <span class="s1">}</span>

        <span class="s2">if </span><span class="s1">(!args.isNull(</span><span class="s5">1</span><span class="s1">)) {</span>
          <span class="s1">String text = args.getString(</span><span class="s5">1</span><span class="s1">)</span><span class="s2">;</span>
          <span class="s1">reactEditText.maybeSetTextFromJS(getReactTextUpdate(text</span><span class="s2">, </span><span class="s1">mostRecentEventCount))</span><span class="s2">;</span>
        <span class="s1">}</span>
        <span class="s1">reactEditText.maybeSetSelection(mostRecentEventCount</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">end)</span><span class="s2">;</span>
        <span class="s2">break;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">private </span><span class="s1">ReactTextUpdate getReactTextUpdate(String text</span><span class="s2">, int </span><span class="s1">mostRecentEventCount) {</span>
    <span class="s1">SpannableStringBuilder sb = </span><span class="s2">new </span><span class="s1">SpannableStringBuilder()</span><span class="s2">;</span>
    <span class="s1">sb.append(TextTransform.apply(text</span><span class="s2">, </span><span class="s1">TextTransform.UNSET))</span><span class="s2">;</span>

    <span class="s2">return new </span><span class="s1">ReactTextUpdate(</span>
        <span class="s1">sb</span><span class="s2">, </span><span class="s1">mostRecentEventCount</span><span class="s2">, false, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">Gravity.NO_GRAVITY</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">updateExtraData(ReactEditText view</span><span class="s2">, </span><span class="s1">Object extraData) {</span>
    <span class="s2">if </span><span class="s1">(extraData </span><span class="s2">instanceof </span><span class="s1">ReactTextUpdate) {</span>
      <span class="s1">ReactTextUpdate update = (ReactTextUpdate) extraData</span><span class="s2">;</span>

      <span class="s0">// TODO T58784068: delete this block of code, these are always unset in Fabric</span>
      <span class="s2">int </span><span class="s1">paddingLeft = (</span><span class="s2">int</span><span class="s1">) update.getPaddingLeft()</span><span class="s2">;</span>
      <span class="s2">int </span><span class="s1">paddingTop = (</span><span class="s2">int</span><span class="s1">) update.getPaddingTop()</span><span class="s2">;</span>
      <span class="s2">int </span><span class="s1">paddingRight = (</span><span class="s2">int</span><span class="s1">) update.getPaddingRight()</span><span class="s2">;</span>
      <span class="s2">int </span><span class="s1">paddingBottom = (</span><span class="s2">int</span><span class="s1">) update.getPaddingBottom()</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(paddingLeft != UNSET</span>
          <span class="s1">|| paddingTop != UNSET</span>
          <span class="s1">|| paddingRight != UNSET</span>
          <span class="s1">|| paddingBottom != UNSET) {</span>
        <span class="s1">view.setPadding(</span>
            <span class="s1">paddingLeft != UNSET ? paddingLeft : view.getPaddingLeft()</span><span class="s2">,</span>
            <span class="s1">paddingTop != UNSET ? paddingTop : view.getPaddingTop()</span><span class="s2">,</span>
            <span class="s1">paddingRight != UNSET ? paddingRight : view.getPaddingRight()</span><span class="s2">,</span>
            <span class="s1">paddingBottom != UNSET ? paddingBottom : view.getPaddingBottom())</span><span class="s2">;</span>
      <span class="s1">}</span>

      <span class="s2">if </span><span class="s1">(update.containsImages()) {</span>
        <span class="s1">Spannable spannable = update.getText()</span><span class="s2">;</span>
        <span class="s1">TextInlineImageSpan.possiblyUpdateInlineImageSpans(spannable</span><span class="s2">, </span><span class="s1">view)</span><span class="s2">;</span>
      <span class="s1">}</span>

      <span class="s0">// Ensure that selection is handled correctly on text update</span>
      <span class="s2">boolean </span><span class="s1">isCurrentSelectionEmpty = view.getSelectionStart() == view.getSelectionEnd()</span><span class="s2">;</span>
      <span class="s2">int </span><span class="s1">selectionStart = UNSET</span><span class="s2">;</span>
      <span class="s2">int </span><span class="s1">selectionEnd = UNSET</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(isCurrentSelectionEmpty) {</span>
        <span class="s0">// if selection is not set by state, shift current selection to ensure constant gap to</span>
        <span class="s0">// text end</span>
        <span class="s2">int </span><span class="s1">textLength = view.getText() == </span><span class="s2">null </span><span class="s1">? </span><span class="s5">0 </span><span class="s1">: view.getText().length()</span><span class="s2">;</span>
        <span class="s2">int </span><span class="s1">selectionOffset = textLength - view.getSelectionStart()</span><span class="s2">;</span>
        <span class="s1">selectionStart = update.getText().length() - selectionOffset</span><span class="s2">;</span>
        <span class="s1">selectionEnd = selectionStart</span><span class="s2">;</span>
      <span class="s1">}</span>

      <span class="s1">view.maybeSetTextFromState(update)</span><span class="s2">;</span>
      <span class="s1">view.maybeSetSelection(update.getJsEventCounter()</span><span class="s2">, </span><span class="s1">selectionStart</span><span class="s2">, </span><span class="s1">selectionEnd)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.FONT_SIZE</span><span class="s2">, </span><span class="s1">defaultFloat = ViewDefaults.FONT_SIZE_SP)</span>
  <span class="s2">public void </span><span class="s1">setFontSize(ReactEditText view</span><span class="s2">, float </span><span class="s1">fontSize) {</span>
    <span class="s1">view.setFontSize(fontSize)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.FONT_FAMILY)</span>
  <span class="s2">public void </span><span class="s1">setFontFamily(ReactEditText view</span><span class="s2">, </span><span class="s1">String fontFamily) {</span>
    <span class="s1">view.setFontFamily(fontFamily)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.MAX_FONT_SIZE_MULTIPLIER</span><span class="s2">, </span><span class="s1">defaultFloat = Float.NaN)</span>
  <span class="s2">public void </span><span class="s1">setMaxFontSizeMultiplier(ReactEditText view</span><span class="s2">, float </span><span class="s1">maxFontSizeMultiplier) {</span>
    <span class="s1">view.setMaxFontSizeMultiplier(maxFontSizeMultiplier)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.FONT_WEIGHT)</span>
  <span class="s2">public void </span><span class="s1">setFontWeight(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String fontWeight) {</span>
    <span class="s1">view.setFontWeight(fontWeight)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.FONT_STYLE)</span>
  <span class="s2">public void </span><span class="s1">setFontStyle(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String fontStyle) {</span>
    <span class="s1">view.setFontStyle(fontStyle)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.FONT_VARIANT)</span>
  <span class="s2">public void </span><span class="s1">setFontVariant(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable ReadableArray fontVariant) {</span>
    <span class="s1">view.setFontFeatureSettings(ReactTypefaceUtils.parseFontVariant(fontVariant))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.INCLUDE_FONT_PADDING</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">true</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setIncludeFontPadding(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">includepad) {</span>
    <span class="s1">view.setIncludeFontPadding(includepad)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;importantForAutofill&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setImportantForAutofill(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String value) {</span>
    <span class="s2">int </span><span class="s1">mode = View.IMPORTANT_FOR_AUTOFILL_AUTO</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s4">&quot;no&quot;</span><span class="s1">.equals(value)) {</span>
      <span class="s1">mode = View.IMPORTANT_FOR_AUTOFILL_NO</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;noExcludeDescendants&quot;</span><span class="s1">.equals(value)) {</span>
      <span class="s1">mode = View.IMPORTANT_FOR_AUTOFILL_NO_EXCLUDE_DESCENDANTS</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;yes&quot;</span><span class="s1">.equals(value)) {</span>
      <span class="s1">mode = View.IMPORTANT_FOR_AUTOFILL_YES</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;yesExcludeDescendants&quot;</span><span class="s1">.equals(value)) {</span>
      <span class="s1">mode = View.IMPORTANT_FOR_AUTOFILL_YES_EXCLUDE_DESCENDANTS</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s1">setImportantForAutofill(view</span><span class="s2">, </span><span class="s1">mode)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private void </span><span class="s1">setImportantForAutofill(ReactEditText view</span><span class="s2">, int </span><span class="s1">mode) {</span>
    <span class="s0">// Autofill hints were added in Android API 26.</span>
    <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>
    <span class="s1">view.setImportantForAutofill(mode)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private void </span><span class="s1">setAutofillHints(ReactEditText view</span><span class="s2">, </span><span class="s1">String... hints) {</span>
    <span class="s0">// Autofill hints were added in Android API 26.</span>
    <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>
    <span class="s1">view.setAutofillHints(hints)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;onSelectionChange&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setOnSelectionChange(</span><span class="s2">final </span><span class="s1">ReactEditText view</span><span class="s2">, boolean </span><span class="s1">onSelectionChange) {</span>
    <span class="s2">if </span><span class="s1">(onSelectionChange) {</span>
      <span class="s1">view.setSelectionWatcher(</span><span class="s2">new </span><span class="s1">ReactSelectionWatcher(view))</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setSelectionWatcher(</span><span class="s2">null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;submitBehavior&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setSubmitBehavior(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String submitBehavior) {</span>
    <span class="s1">view.setSubmitBehavior(submitBehavior)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;onContentSizeChange&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setOnContentSizeChange(</span><span class="s2">final </span><span class="s1">ReactEditText view</span><span class="s2">, boolean </span><span class="s1">onContentSizeChange) {</span>
    <span class="s2">if </span><span class="s1">(onContentSizeChange) {</span>
      <span class="s1">view.setContentSizeWatcher(</span><span class="s2">new </span><span class="s1">ReactContentSizeWatcher(view))</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setContentSizeWatcher(</span><span class="s2">null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;onScroll&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setOnScroll(</span><span class="s2">final </span><span class="s1">ReactEditText view</span><span class="s2">, boolean </span><span class="s1">onScroll) {</span>
    <span class="s2">if </span><span class="s1">(onScroll) {</span>
      <span class="s1">view.setScrollWatcher(</span><span class="s2">new </span><span class="s1">ReactScrollWatcher(view))</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setScrollWatcher(</span><span class="s2">null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;onKeyPress&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setOnKeyPress(</span><span class="s2">final </span><span class="s1">ReactEditText view</span><span class="s2">, boolean </span><span class="s1">onKeyPress) {</span>
    <span class="s1">view.setOnKeyPress(onKeyPress)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s0">// Sets the letter spacing as an absolute point size.</span>
  <span class="s0">// This extra handling, on top of what ReactBaseTextShadowNode already does, is required for the</span>
  <span class="s0">// correct display of spacing in placeholder (hint) text.</span>
  <span class="s1">@ReactProp(name = ViewProps.LETTER_SPACING</span><span class="s2">, </span><span class="s1">defaultFloat = </span><span class="s5">0</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setLetterSpacing(ReactEditText view</span><span class="s2">, float </span><span class="s1">letterSpacing) {</span>
    <span class="s1">view.setLetterSpacingPt(letterSpacing)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.ALLOW_FONT_SCALING</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">true</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setAllowFontScaling(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">allowFontScaling) {</span>
    <span class="s1">view.setAllowFontScaling(allowFontScaling)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;placeholder&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPlaceholder(ReactEditText view</span><span class="s2">, </span><span class="s1">String placeholder) {</span>
    <span class="s1">view.setPlaceholder(placeholder)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;placeholderTextColor&quot;</span><span class="s2">, </span><span class="s1">customType = </span><span class="s4">&quot;Color&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPlaceholderTextColor(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable Integer color) {</span>
    <span class="s2">if </span><span class="s1">(color == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s1">view.setHintTextColor(DefaultStyleValuesUtil.getDefaultTextColorHint(view.getContext()))</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setHintTextColor(color)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;selectionColor&quot;</span><span class="s2">, </span><span class="s1">customType = </span><span class="s4">&quot;Color&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setSelectionColor(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable Integer color) {</span>
    <span class="s2">if </span><span class="s1">(color == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s1">view.setHighlightColor(</span>
          <span class="s1">DefaultStyleValuesUtil.getDefaultTextColorHighlight(view.getContext()))</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setHighlightColor(color)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">setCursorColor(view</span><span class="s2">, </span><span class="s1">color)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;cursorColor&quot;</span><span class="s2">, </span><span class="s1">customType = </span><span class="s4">&quot;Color&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setCursorColor(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable Integer color) {</span>
    <span class="s2">if </span><span class="s1">(color == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>

    <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) {</span>
      <span class="s1">Drawable cursorDrawable = view.getTextCursorDrawable()</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(cursorDrawable != </span><span class="s2">null</span><span class="s1">) {</span>
        <span class="s1">cursorDrawable.setColorFilter(</span><span class="s2">new </span><span class="s1">BlendModeColorFilter(color</span><span class="s2">, </span><span class="s1">BlendMode.SRC_IN))</span><span class="s2">;</span>
        <span class="s1">view.setTextCursorDrawable(cursorDrawable)</span><span class="s2">;</span>
      <span class="s1">}</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>

    <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT == Build.VERSION_CODES.P) {</span>
      <span class="s0">// Pre-Android 10, there was no supported API to change the cursor color programmatically.</span>
      <span class="s0">// In Android 9.0, they changed the underlying implementation,</span>
      <span class="s0">// but also &quot;dark greylisted&quot; the new field, rendering it unusable.</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>

    <span class="s0">// The evil code that follows uses reflection to achieve this on Android 8.1 and below.</span>
    <span class="s0">// Based on https://tinyurl.com/3vff8lyu https://tinyurl.com/vehggzs9</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">int </span><span class="s1">i = </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i &lt; DRAWABLE_RESOURCES.length</span><span class="s2">; </span><span class="s1">i++) {</span>
      <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">Field drawableResourceField = TextView.</span><span class="s2">class</span><span class="s1">.getDeclaredField(DRAWABLE_RESOURCES[i])</span><span class="s2">;</span>
        <span class="s1">drawableResourceField.setAccessible(</span><span class="s2">true</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s2">int </span><span class="s1">resourceId = drawableResourceField.getInt(view)</span><span class="s2">;</span>

        <span class="s0">// The view has no cursor drawable.</span>
        <span class="s2">if </span><span class="s1">(resourceId == </span><span class="s5">0</span><span class="s1">) {</span>
          <span class="s2">return;</span>
        <span class="s1">}</span>

        <span class="s1">Drawable drawable = ContextCompat.getDrawable(view.getContext()</span><span class="s2">, </span><span class="s1">resourceId)</span><span class="s2">;</span>

        <span class="s1">Drawable drawableCopy = drawable.mutate()</span><span class="s2">;</span>
        <span class="s1">drawableCopy.setColorFilter(color</span><span class="s2">, </span><span class="s1">PorterDuff.Mode.SRC_IN)</span><span class="s2">;</span>

        <span class="s1">Field editorField = TextView.</span><span class="s2">class</span><span class="s1">.getDeclaredField(</span><span class="s4">&quot;mEditor&quot;</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s1">editorField.setAccessible(</span><span class="s2">true</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s1">Object editor = editorField.get(view)</span><span class="s2">;</span>

        <span class="s1">Field cursorDrawableField = editor.getClass().getDeclaredField(DRAWABLE_FIELDS[i])</span><span class="s2">;</span>
        <span class="s1">cursorDrawableField.setAccessible(</span><span class="s2">true</span><span class="s1">)</span><span class="s2">;</span>
        <span class="s2">if </span><span class="s1">(DRAWABLE_RESOURCES[i] == </span><span class="s4">&quot;mCursorDrawableRes&quot;</span><span class="s1">) {</span>
          <span class="s1">Drawable[] drawables = {drawableCopy</span><span class="s2">, </span><span class="s1">drawableCopy}</span><span class="s2">;</span>
          <span class="s1">cursorDrawableField.set(editor</span><span class="s2">, </span><span class="s1">drawables)</span><span class="s2">;</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
          <span class="s1">cursorDrawableField.set(editor</span><span class="s2">, </span><span class="s1">drawableCopy)</span><span class="s2">;</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s2">catch </span><span class="s1">(NoSuchFieldException ex) {</span>
        <span class="s0">// Ignore errors to avoid crashing if these private fields don't exist on modified</span>
        <span class="s0">// or future android versions.</span>
      <span class="s1">} </span><span class="s2">catch </span><span class="s1">(IllegalAccessException ex) {</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">private static boolean </span><span class="s1">shouldHideCursorForEmailTextInput() {</span>
    <span class="s1">String manufacturer = Build.MANUFACTURER.toLowerCase(Locale.ROOT)</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">(Build.VERSION.SDK_INT == Build.VERSION_CODES.Q &amp;&amp; manufacturer.contains(</span><span class="s4">&quot;xiaomi&quot;</span><span class="s1">))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;caretHidden&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setCaretHidden(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">caretHidden) {</span>
    <span class="s2">if </span><span class="s1">(view.getStagedInputType() == InputType.TYPE_TEXT_VARIATION_EMAIL_ADDRESS</span>
        <span class="s1">&amp;&amp; shouldHideCursorForEmailTextInput()) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>
    <span class="s1">view.setCursorVisible(!caretHidden)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;contextMenuHidden&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setContextMenuHidden(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">contextMenuHidden) {</span>
    <span class="s2">final boolean </span><span class="s1">_contextMenuHidden = contextMenuHidden</span><span class="s2">;</span>
    <span class="s1">view.setOnLongClickListener(</span>
        <span class="s2">new </span><span class="s1">View.OnLongClickListener() {</span>
          <span class="s2">public boolean </span><span class="s1">onLongClick(View v) {</span>
            <span class="s2">return </span><span class="s1">_contextMenuHidden</span><span class="s2">;</span>
          <span class="s1">}</span><span class="s2">;</span>
        <span class="s1">})</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;selectTextOnFocus&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setSelectTextOnFocus(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">selectTextOnFocus) {</span>
    <span class="s1">view.setSelectAllOnFocus(selectTextOnFocus)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.COLOR</span><span class="s2">, </span><span class="s1">customType = </span><span class="s4">&quot;Color&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setColor(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable Integer color) {</span>
    <span class="s2">if </span><span class="s1">(color == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s1">ColorStateList defaultContextTextColor =</span>
          <span class="s1">DefaultStyleValuesUtil.getDefaultTextColor(view.getContext())</span><span class="s2">;</span>

      <span class="s2">if </span><span class="s1">(defaultContextTextColor != </span><span class="s2">null</span><span class="s1">) {</span>
        <span class="s1">view.setTextColor(defaultContextTextColor)</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">Context c = view.getContext()</span><span class="s2">;</span>
        <span class="s1">ReactSoftExceptionLogger.logSoftException(</span>
            <span class="s1">TAG</span><span class="s2">,</span>
            <span class="s2">new </span><span class="s1">IllegalStateException(</span>
                <span class="s4">&quot;Could not get default text color from View Context: &quot;</span>
                    <span class="s1">+ (c != </span><span class="s2">null </span><span class="s1">? c.getClass().getCanonicalName() : </span><span class="s4">&quot;null&quot;</span><span class="s1">)))</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setTextColor(color)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;underlineColorAndroid&quot;</span><span class="s2">, </span><span class="s1">customType = </span><span class="s4">&quot;Color&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setUnderlineColor(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable Integer underlineColor) {</span>
    <span class="s0">// Drawable.mutate() can sometimes crash due to an AOSP bug:</span>
    <span class="s0">// See https://code.google.com/p/android/issues/detail?id=191754 for more info</span>
    <span class="s1">Drawable background = view.getBackground()</span><span class="s2">;</span>
    <span class="s1">Drawable drawableToMutate = background</span><span class="s2">;</span>

    <span class="s2">if </span><span class="s1">(background == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>

    <span class="s2">if </span><span class="s1">(background.getConstantState() != </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">try </span><span class="s1">{</span>
        <span class="s1">drawableToMutate = background.mutate()</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">catch </span><span class="s1">(NullPointerException e) {</span>
        <span class="s1">FLog.e(TAG</span><span class="s2">, </span><span class="s4">&quot;NullPointerException when setting underlineColorAndroid for TextInput&quot;</span><span class="s2">, </span><span class="s1">e)</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s2">if </span><span class="s1">(underlineColor == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s1">drawableToMutate.clearColorFilter()</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s0">// fixes underlineColor transparent not working on API 21</span>
      <span class="s0">// re-sets the TextInput underlineColor https://bit.ly/3M4alr6</span>
      <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT == Build.VERSION_CODES.LOLLIPOP) {</span>
        <span class="s2">int </span><span class="s1">bottomBorderColor = view.getBorderColor(Spacing.BOTTOM)</span><span class="s2">;</span>
        <span class="s1">setBorderColor(view</span><span class="s2">, </span><span class="s1">Spacing.START</span><span class="s2">, </span><span class="s1">underlineColor)</span><span class="s2">;</span>
        <span class="s1">drawableToMutate.setColorFilter(underlineColor</span><span class="s2">, </span><span class="s1">PorterDuff.Mode.SRC_IN)</span><span class="s2">;</span>
        <span class="s1">setBorderColor(view</span><span class="s2">, </span><span class="s1">Spacing.START</span><span class="s2">, </span><span class="s1">bottomBorderColor)</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">drawableToMutate.setColorFilter(underlineColor</span><span class="s2">, </span><span class="s1">PorterDuff.Mode.SRC_IN)</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.TEXT_ALIGN)</span>
  <span class="s2">public void </span><span class="s1">setTextAlign(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String textAlign) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s4">&quot;justify&quot;</span><span class="s1">.equals(textAlign)) {</span>
      <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {</span>
        <span class="s1">view.setJustificationMode(Layout.JUSTIFICATION_MODE_INTER_WORD)</span><span class="s2">;</span>
      <span class="s1">}</span>
      <span class="s1">view.setGravityHorizontal(Gravity.LEFT)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {</span>
        <span class="s1">view.setJustificationMode(Layout.JUSTIFICATION_MODE_NONE)</span><span class="s2">;</span>
      <span class="s1">}</span>

      <span class="s2">if </span><span class="s1">(textAlign == </span><span class="s2">null </span><span class="s1">|| </span><span class="s4">&quot;auto&quot;</span><span class="s1">.equals(textAlign)) {</span>
        <span class="s1">view.setGravityHorizontal(Gravity.NO_GRAVITY)</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;left&quot;</span><span class="s1">.equals(textAlign)) {</span>
        <span class="s1">view.setGravityHorizontal(Gravity.LEFT)</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;right&quot;</span><span class="s1">.equals(textAlign)) {</span>
        <span class="s1">view.setGravityHorizontal(Gravity.RIGHT)</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;center&quot;</span><span class="s1">.equals(textAlign)) {</span>
        <span class="s1">view.setGravityHorizontal(Gravity.CENTER_HORIZONTAL)</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">FLog.w(ReactConstants.TAG</span><span class="s2">, </span><span class="s4">&quot;Invalid textAlign: &quot; </span><span class="s1">+ textAlign)</span><span class="s2">;</span>
        <span class="s1">view.setGravityHorizontal(Gravity.NO_GRAVITY)</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.TEXT_ALIGN_VERTICAL)</span>
  <span class="s2">public void </span><span class="s1">setTextAlignVertical(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String textAlignVertical) {</span>
    <span class="s2">if </span><span class="s1">(textAlignVertical == </span><span class="s2">null </span><span class="s1">|| </span><span class="s4">&quot;auto&quot;</span><span class="s1">.equals(textAlignVertical)) {</span>
      <span class="s1">view.setGravityVertical(Gravity.NO_GRAVITY)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;top&quot;</span><span class="s1">.equals(textAlignVertical)) {</span>
      <span class="s1">view.setGravityVertical(Gravity.TOP)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;bottom&quot;</span><span class="s1">.equals(textAlignVertical)) {</span>
      <span class="s1">view.setGravityVertical(Gravity.BOTTOM)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;center&quot;</span><span class="s1">.equals(textAlignVertical)) {</span>
      <span class="s1">view.setGravityVertical(Gravity.CENTER_VERTICAL)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">FLog.w(ReactConstants.TAG</span><span class="s2">, </span><span class="s4">&quot;Invalid textAlignVertical: &quot; </span><span class="s1">+ textAlignVertical)</span><span class="s2">;</span>
      <span class="s1">view.setGravityVertical(Gravity.NO_GRAVITY)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;inlineImageLeft&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setInlineImageLeft(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String resource) {</span>
    <span class="s2">int </span><span class="s1">id =</span>
        <span class="s1">ResourceDrawableIdHelper.getInstance().getResourceDrawableId(view.getContext()</span><span class="s2">, </span><span class="s1">resource)</span><span class="s2">;</span>
    <span class="s1">view.setCompoundDrawablesWithIntrinsicBounds(id</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;inlineImagePadding&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setInlineImagePadding(ReactEditText view</span><span class="s2">, int </span><span class="s1">padding) {</span>
    <span class="s1">view.setCompoundDrawablePadding(padding)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;editable&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">true</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setEditable(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">editable) {</span>
    <span class="s1">view.setEnabled(editable)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.NUMBER_OF_LINES</span><span class="s2">, </span><span class="s1">defaultInt = </span><span class="s5">1</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setNumLines(ReactEditText view</span><span class="s2">, int </span><span class="s1">numLines) {</span>
    <span class="s1">view.setLines(numLines)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;maxLength&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setMaxLength(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable Integer maxLength) {</span>
    <span class="s1">InputFilter[] currentFilters = view.getFilters()</span><span class="s2">;</span>
    <span class="s1">InputFilter[] newFilters = EMPTY_FILTERS</span><span class="s2">;</span>

    <span class="s2">if </span><span class="s1">(maxLength == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">if </span><span class="s1">(currentFilters.length &gt; </span><span class="s5">0</span><span class="s1">) {</span>
        <span class="s1">LinkedList&lt;InputFilter&gt; list = </span><span class="s2">new </span><span class="s1">LinkedList&lt;&gt;()</span><span class="s2">;</span>
        <span class="s2">for </span><span class="s1">(</span><span class="s2">int </span><span class="s1">i = </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i &lt; currentFilters.length</span><span class="s2">; </span><span class="s1">i++) {</span>
          <span class="s2">if </span><span class="s1">(!(currentFilters[i] </span><span class="s2">instanceof </span><span class="s1">InputFilter.LengthFilter)) {</span>
            <span class="s1">list.add(currentFilters[i])</span><span class="s2">;</span>
          <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(!list.isEmpty()) {</span>
          <span class="s1">newFilters = (InputFilter[]) list.toArray(</span><span class="s2">new </span><span class="s1">InputFilter[list.size()])</span><span class="s2">;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s2">if </span><span class="s1">(currentFilters.length &gt; </span><span class="s5">0</span><span class="s1">) {</span>
        <span class="s1">newFilters = currentFilters</span><span class="s2">;</span>
        <span class="s2">boolean </span><span class="s1">replaced = </span><span class="s2">false;</span>
        <span class="s2">for </span><span class="s1">(</span><span class="s2">int </span><span class="s1">i = </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i &lt; currentFilters.length</span><span class="s2">; </span><span class="s1">i++) {</span>
          <span class="s2">if </span><span class="s1">(currentFilters[i] </span><span class="s2">instanceof </span><span class="s1">InputFilter.LengthFilter) {</span>
            <span class="s1">currentFilters[i] = </span><span class="s2">new </span><span class="s1">InputFilter.LengthFilter(maxLength)</span><span class="s2">;</span>
            <span class="s1">replaced = </span><span class="s2">true;</span>
          <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(!replaced) {</span>
          <span class="s1">newFilters = </span><span class="s2">new </span><span class="s1">InputFilter[currentFilters.length + </span><span class="s5">1</span><span class="s1">]</span><span class="s2">;</span>
          <span class="s1">System.arraycopy(currentFilters</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">newFilters</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">currentFilters.length)</span><span class="s2">;</span>
          <span class="s1">currentFilters[currentFilters.length] = </span><span class="s2">new </span><span class="s1">InputFilter.LengthFilter(maxLength)</span><span class="s2">;</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">newFilters = </span><span class="s2">new </span><span class="s1">InputFilter[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">;</span>
        <span class="s1">newFilters[</span><span class="s5">0</span><span class="s1">] = </span><span class="s2">new </span><span class="s1">InputFilter.LengthFilter(maxLength)</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s1">view.setFilters(newFilters)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;autoComplete&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setTextContentType(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String autoComplete) {</span>
    <span class="s2">if </span><span class="s1">(autoComplete == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s1">setImportantForAutofill(view</span><span class="s2">, </span><span class="s1">View.IMPORTANT_FOR_AUTOFILL_NO)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">&quot;off&quot;</span><span class="s1">.equals(autoComplete)) {</span>
      <span class="s1">setImportantForAutofill(view</span><span class="s2">, </span><span class="s1">View.IMPORTANT_FOR_AUTOFILL_NO)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(REACT_PROPS_AUTOFILL_HINTS_MAP.containsKey(autoComplete)) {</span>
      <span class="s1">setAutofillHints(view</span><span class="s2">, </span><span class="s1">REACT_PROPS_AUTOFILL_HINTS_MAP.get(autoComplete))</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">FLog.w(ReactConstants.TAG</span><span class="s2">, </span><span class="s4">&quot;Invalid autoComplete: &quot; </span><span class="s1">+ autoComplete)</span><span class="s2">;</span>
      <span class="s1">setImportantForAutofill(view</span><span class="s2">, </span><span class="s1">View.IMPORTANT_FOR_AUTOFILL_NO)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;autoCorrect&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setAutoCorrect(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable Boolean autoCorrect) {</span>
    <span class="s0">// clear auto correct flags, set SUGGESTIONS or NO_SUGGESTIONS depending on value</span>
    <span class="s1">updateStagedInputTypeFlag(</span>
        <span class="s1">view</span><span class="s2">,</span>
        <span class="s1">InputType.TYPE_TEXT_FLAG_AUTO_CORRECT | InputType.TYPE_TEXT_FLAG_NO_SUGGESTIONS</span><span class="s2">,</span>
        <span class="s1">autoCorrect != </span><span class="s2">null</span>
            <span class="s1">? (autoCorrect.booleanValue()</span>
                <span class="s1">? InputType.TYPE_TEXT_FLAG_AUTO_CORRECT</span>
                <span class="s1">: InputType.TYPE_TEXT_FLAG_NO_SUGGESTIONS)</span>
            <span class="s1">: </span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;multiline&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setMultiline(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">multiline) {</span>
    <span class="s1">updateStagedInputTypeFlag(</span>
        <span class="s1">view</span><span class="s2">,</span>
        <span class="s1">multiline ? </span><span class="s5">0 </span><span class="s1">: InputType.TYPE_TEXT_FLAG_MULTI_LINE</span><span class="s2">,</span>
        <span class="s1">multiline ? InputType.TYPE_TEXT_FLAG_MULTI_LINE : </span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;secureTextEntry&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setSecureTextEntry(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">password) {</span>
    <span class="s1">updateStagedInputTypeFlag(</span>
        <span class="s1">view</span><span class="s2">,</span>
        <span class="s1">password</span>
            <span class="s1">? InputType.TYPE_TEXT_VARIATION_VISIBLE_PASSWORD</span>
            <span class="s1">: InputType.TYPE_NUMBER_VARIATION_PASSWORD | InputType.TYPE_TEXT_VARIATION_PASSWORD</span><span class="s2">,</span>
        <span class="s1">password ? InputType.TYPE_TEXT_VARIATION_PASSWORD : </span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">checkPasswordType(view)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s0">// This prop temporarily takes both numbers and strings.</span>
  <span class="s0">// Number values are deprecated and will be removed in a future release.</span>
  <span class="s0">// See T46146267</span>
  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;autoCapitalize&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setAutoCapitalize(ReactEditText view</span><span class="s2">, </span><span class="s1">Dynamic autoCapitalize) {</span>
    <span class="s2">int </span><span class="s1">autoCapitalizeValue = InputType.TYPE_TEXT_FLAG_CAP_SENTENCES</span><span class="s2">;</span>

    <span class="s2">if </span><span class="s1">(autoCapitalize.getType() == ReadableType.Number) {</span>
      <span class="s1">autoCapitalizeValue = autoCapitalize.asInt()</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(autoCapitalize.getType() == ReadableType.String) {</span>
      <span class="s2">final </span><span class="s1">String autoCapitalizeStr = autoCapitalize.asString()</span><span class="s2">;</span>

      <span class="s2">if </span><span class="s1">(autoCapitalizeStr.equals(</span><span class="s4">&quot;none&quot;</span><span class="s1">)) {</span>
        <span class="s1">autoCapitalizeValue = </span><span class="s5">0</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(autoCapitalizeStr.equals(</span><span class="s4">&quot;characters&quot;</span><span class="s1">)) {</span>
        <span class="s1">autoCapitalizeValue = InputType.TYPE_TEXT_FLAG_CAP_CHARACTERS</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(autoCapitalizeStr.equals(</span><span class="s4">&quot;words&quot;</span><span class="s1">)) {</span>
        <span class="s1">autoCapitalizeValue = InputType.TYPE_TEXT_FLAG_CAP_WORDS</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(autoCapitalizeStr.equals(</span><span class="s4">&quot;sentences&quot;</span><span class="s1">)) {</span>
        <span class="s1">autoCapitalizeValue = InputType.TYPE_TEXT_FLAG_CAP_SENTENCES</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s1">updateStagedInputTypeFlag(view</span><span class="s2">, </span><span class="s1">AUTOCAPITALIZE_FLAGS</span><span class="s2">, </span><span class="s1">autoCapitalizeValue)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;keyboardType&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setKeyboardType(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String keyboardType) {</span>
    <span class="s2">int </span><span class="s1">flagsToSet = InputType.TYPE_CLASS_TEXT</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(KEYBOARD_TYPE_NUMERIC.equalsIgnoreCase(keyboardType)) {</span>
      <span class="s1">flagsToSet = INPUT_TYPE_KEYBOARD_NUMBERED</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(KEYBOARD_TYPE_NUMBER_PAD.equalsIgnoreCase(keyboardType)) {</span>
      <span class="s1">flagsToSet = INPUT_TYPE_KEYBOARD_NUMBER_PAD</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(KEYBOARD_TYPE_DECIMAL_PAD.equalsIgnoreCase(keyboardType)) {</span>
      <span class="s1">flagsToSet = INPUT_TYPE_KEYBOARD_DECIMAL_PAD</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(KEYBOARD_TYPE_EMAIL_ADDRESS.equalsIgnoreCase(keyboardType)) {</span>
      <span class="s1">flagsToSet = InputType.TYPE_TEXT_VARIATION_EMAIL_ADDRESS | InputType.TYPE_CLASS_TEXT</span><span class="s2">;</span>

      <span class="s0">// Set cursor's visibility to False to fix a crash on some Xiaomi devices with Android Q. This</span>
      <span class="s0">// crash happens when focusing on a email EditText, during which a prompt will be triggered</span>
      <span class="s0">// but</span>
      <span class="s0">// the system fail to locate it properly. Here is an example post discussing about this</span>
      <span class="s0">// issue: https://github.com/facebook/react-native/issues/27204</span>
      <span class="s2">if </span><span class="s1">(shouldHideCursorForEmailTextInput()) {</span>
        <span class="s1">view.setCursorVisible(</span><span class="s2">false</span><span class="s1">)</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(KEYBOARD_TYPE_PHONE_PAD.equalsIgnoreCase(keyboardType)) {</span>
      <span class="s1">flagsToSet = InputType.TYPE_CLASS_PHONE</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(KEYBOARD_TYPE_VISIBLE_PASSWORD.equalsIgnoreCase(keyboardType)) {</span>
      <span class="s0">// This will supersede secureTextEntry={false}. If it doesn't, due to the way</span>
      <span class="s0">//  the flags work out, the underlying field will end up a URI-type field.</span>
      <span class="s1">flagsToSet = InputType.TYPE_TEXT_VARIATION_VISIBLE_PASSWORD</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(KEYBOARD_TYPE_URI.equalsIgnoreCase(keyboardType)) {</span>
      <span class="s1">flagsToSet = InputType.TYPE_TEXT_VARIATION_URI</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">updateStagedInputTypeFlag(view</span><span class="s2">, </span><span class="s1">InputType.TYPE_MASK_CLASS</span><span class="s2">, </span><span class="s1">flagsToSet)</span><span class="s2">;</span>
    <span class="s1">checkPasswordType(view)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;returnKeyType&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setReturnKeyType(ReactEditText view</span><span class="s2">, </span><span class="s1">String returnKeyType) {</span>
    <span class="s1">view.setReturnKeyType(returnKeyType)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;disableFullscreenUI&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setDisableFullscreenUI(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">disableFullscreenUI) {</span>
    <span class="s1">view.setDisableFullscreenUI(disableFullscreenUI)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private static final int </span><span class="s1">IME_ACTION_ID = </span><span class="s5">0x670</span><span class="s2">;</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;returnKeyLabel&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setReturnKeyLabel(ReactEditText view</span><span class="s2">, </span><span class="s1">String returnKeyLabel) {</span>
    <span class="s1">view.setImeActionLabel(returnKeyLabel</span><span class="s2">, </span><span class="s1">IME_ACTION_ID)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactPropGroup(</span>
      <span class="s1">names = {</span>
        <span class="s1">ViewProps.BORDER_RADIUS</span><span class="s2">,</span>
        <span class="s1">ViewProps.BORDER_TOP_LEFT_RADIUS</span><span class="s2">,</span>
        <span class="s1">ViewProps.BORDER_TOP_RIGHT_RADIUS</span><span class="s2">,</span>
        <span class="s1">ViewProps.BORDER_BOTTOM_RIGHT_RADIUS</span><span class="s2">,</span>
        <span class="s1">ViewProps.BORDER_BOTTOM_LEFT_RADIUS</span>
      <span class="s1">}</span><span class="s2">,</span>
      <span class="s1">defaultFloat = YogaConstants.UNDEFINED)</span>
  <span class="s2">public void </span><span class="s1">setBorderRadius(ReactEditText view</span><span class="s2">, int </span><span class="s1">index</span><span class="s2">, float </span><span class="s1">borderRadius) {</span>
    <span class="s2">if </span><span class="s1">(!YogaConstants.isUndefined(borderRadius)) {</span>
      <span class="s1">borderRadius = PixelUtil.toPixelFromDIP(borderRadius)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s2">if </span><span class="s1">(index == </span><span class="s5">0</span><span class="s1">) {</span>
      <span class="s1">view.setBorderRadius(borderRadius)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setBorderRadius(borderRadius</span><span class="s2">, </span><span class="s1">index - </span><span class="s5">1</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;borderStyle&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setBorderStyle(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String borderStyle) {</span>
    <span class="s1">view.setBorderStyle(borderStyle)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;showSoftInputOnFocus&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">true</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">showKeyboardOnFocus(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">showKeyboardOnFocus) {</span>
    <span class="s1">view.setShowSoftInputOnFocus(showKeyboardOnFocus)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s4">&quot;autoFocus&quot;</span><span class="s2">, </span><span class="s1">defaultBoolean = </span><span class="s2">false</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setAutoFocus(ReactEditText view</span><span class="s2">, boolean </span><span class="s1">autoFocus) {</span>
    <span class="s1">view.setAutoFocus(autoFocus)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.TEXT_DECORATION_LINE)</span>
  <span class="s2">public void </span><span class="s1">setTextDecorationLine(ReactEditText view</span><span class="s2">, </span><span class="s1">@Nullable String textDecorationLineString) {</span>
    <span class="s1">view.setPaintFlags(</span>
        <span class="s1">view.getPaintFlags() &amp; ~(Paint.STRIKE_THRU_TEXT_FLAG | Paint.UNDERLINE_TEXT_FLAG))</span><span class="s2">;</span>

    <span class="s2">for </span><span class="s1">(String token : textDecorationLineString.split(</span><span class="s4">&quot; &quot;</span><span class="s1">)) {</span>
      <span class="s2">if </span><span class="s1">(token.equals(</span><span class="s4">&quot;underline&quot;</span><span class="s1">)) {</span>
        <span class="s1">view.setPaintFlags(view.getPaintFlags() | Paint.UNDERLINE_TEXT_FLAG)</span><span class="s2">;</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(token.equals(</span><span class="s4">&quot;line-through&quot;</span><span class="s1">)) {</span>
        <span class="s1">view.setPaintFlags(view.getPaintFlags() | Paint.STRIKE_THRU_TEXT_FLAG)</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@ReactPropGroup(</span>
      <span class="s1">names = {</span>
        <span class="s1">ViewProps.BORDER_WIDTH</span><span class="s2">,</span>
        <span class="s1">ViewProps.BORDER_LEFT_WIDTH</span><span class="s2">,</span>
        <span class="s1">ViewProps.BORDER_RIGHT_WIDTH</span><span class="s2">,</span>
        <span class="s1">ViewProps.BORDER_TOP_WIDTH</span><span class="s2">,</span>
        <span class="s1">ViewProps.BORDER_BOTTOM_WIDTH</span><span class="s2">,</span>
      <span class="s1">}</span><span class="s2">,</span>
      <span class="s1">defaultFloat = YogaConstants.UNDEFINED)</span>
  <span class="s2">public void </span><span class="s1">setBorderWidth(ReactEditText view</span><span class="s2">, int </span><span class="s1">index</span><span class="s2">, float </span><span class="s1">width) {</span>
    <span class="s2">if </span><span class="s1">(!YogaConstants.isUndefined(width)) {</span>
      <span class="s1">width = PixelUtil.toPixelFromDIP(width)</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s1">view.setBorderWidth(SPACING_TYPES[index]</span><span class="s2">, </span><span class="s1">width)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactPropGroup(</span>
      <span class="s1">names = {</span>
        <span class="s4">&quot;borderColor&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;borderLeftColor&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;borderRightColor&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;borderTopColor&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;borderBottomColor&quot;</span>
      <span class="s1">}</span><span class="s2">,</span>
      <span class="s1">customType = </span><span class="s4">&quot;Color&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setBorderColor(ReactEditText view</span><span class="s2">, int </span><span class="s1">index</span><span class="s2">, </span><span class="s1">Integer color) {</span>
    <span class="s2">float </span><span class="s1">rgbComponent =</span>
        <span class="s1">color == </span><span class="s2">null </span><span class="s1">? YogaConstants.UNDEFINED : (</span><span class="s2">float</span><span class="s1">) ((</span><span class="s2">int</span><span class="s1">) color &amp; </span><span class="s5">0x00FFFFFF</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s2">float </span><span class="s1">alphaComponent = color == </span><span class="s2">null </span><span class="s1">? YogaConstants.UNDEFINED : (</span><span class="s2">float</span><span class="s1">) ((</span><span class="s2">int</span><span class="s1">) color &gt;&gt;&gt; </span><span class="s5">24</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setBorderColor(SPACING_TYPES[index]</span><span class="s2">, </span><span class="s1">rgbComponent</span><span class="s2">, </span><span class="s1">alphaComponent)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">protected void </span><span class="s1">onAfterUpdateTransaction(ReactEditText view) {</span>
    <span class="s2">super</span><span class="s1">.onAfterUpdateTransaction(view)</span><span class="s2">;</span>
    <span class="s1">view.maybeUpdateTypeface()</span><span class="s2">;</span>
    <span class="s1">view.commitStagedInputType()</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s0">// Sets the correct password type, since numeric and text passwords have different types</span>
  <span class="s2">private static void </span><span class="s1">checkPasswordType(ReactEditText view) {</span>
    <span class="s2">if </span><span class="s1">((view.getStagedInputType() &amp; INPUT_TYPE_KEYBOARD_NUMBERED) != </span><span class="s5">0</span>
        <span class="s1">&amp;&amp; (view.getStagedInputType() &amp; InputType.TYPE_TEXT_VARIATION_PASSWORD) != </span><span class="s5">0</span><span class="s1">) {</span>
      <span class="s0">// Text input type is numbered password, remove text password variation, add numeric one</span>
      <span class="s1">updateStagedInputTypeFlag(</span>
          <span class="s1">view</span><span class="s2">, </span><span class="s1">InputType.TYPE_TEXT_VARIATION_PASSWORD</span><span class="s2">, </span><span class="s1">InputType.TYPE_NUMBER_VARIATION_PASSWORD)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">private static void </span><span class="s1">updateStagedInputTypeFlag(</span>
      <span class="s1">ReactEditText view</span><span class="s2">, int </span><span class="s1">flagsToUnset</span><span class="s2">, int </span><span class="s1">flagsToSet) {</span>
    <span class="s1">view.setStagedInputType((view.getStagedInputType() &amp; ~flagsToUnset) | flagsToSet)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private static </span><span class="s1">EventDispatcher getEventDispatcher(</span>
      <span class="s1">ReactContext reactContext</span><span class="s2">, </span><span class="s1">ReactEditText editText) {</span>
    <span class="s2">return </span><span class="s1">UIManagerHelper.getEventDispatcherForReactTag(reactContext</span><span class="s2">, </span><span class="s1">editText.getId())</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private final class </span><span class="s1">ReactTextInputTextWatcher </span><span class="s2">implements </span><span class="s1">TextWatcher {</span>
    <span class="s2">private final </span><span class="s1">ReactEditText mEditText</span><span class="s2">;</span>
    <span class="s2">private final </span><span class="s1">EventDispatcher mEventDispatcher</span><span class="s2">;</span>
    <span class="s2">private final int </span><span class="s1">mSurfaceId</span><span class="s2">;</span>
    <span class="s2">private </span><span class="s1">String mPreviousText</span><span class="s2">;</span>

    <span class="s2">public </span><span class="s1">ReactTextInputTextWatcher(</span>
        <span class="s2">final </span><span class="s1">ReactContext reactContext</span><span class="s2">, final </span><span class="s1">ReactEditText editText) {</span>
      <span class="s1">mEventDispatcher = getEventDispatcher(reactContext</span><span class="s2">, </span><span class="s1">editText)</span><span class="s2">;</span>
      <span class="s1">mEditText = editText</span><span class="s2">;</span>
      <span class="s1">mPreviousText = </span><span class="s2">null;</span>
      <span class="s1">mSurfaceId = UIManagerHelper.getSurfaceId(reactContext)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">@Override</span>
    <span class="s2">public void </span><span class="s1">beforeTextChanged(CharSequence s</span><span class="s2">, int </span><span class="s1">start</span><span class="s2">, int </span><span class="s1">count</span><span class="s2">, int </span><span class="s1">after) {</span>
      <span class="s0">// Incoming charSequence gets mutated before onTextChanged() is invoked</span>
      <span class="s1">mPreviousText = s.toString()</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">@Override</span>
    <span class="s2">public void </span><span class="s1">onTextChanged(CharSequence s</span><span class="s2">, int </span><span class="s1">start</span><span class="s2">, int </span><span class="s1">before</span><span class="s2">, int </span><span class="s1">count) {</span>
      <span class="s2">if </span><span class="s1">(mEditText.mDisableTextDiffing) {</span>
        <span class="s2">return;</span>
      <span class="s1">}</span>

      <span class="s0">// Rearranging the text (i.e. changing between singleline and multiline attributes) can</span>
      <span class="s0">// also trigger onTextChanged, call the event in JS only when the text actually changed</span>
      <span class="s2">if </span><span class="s1">(count == </span><span class="s5">0 </span><span class="s1">&amp;&amp; before == </span><span class="s5">0</span><span class="s1">) {</span>
        <span class="s2">return;</span>
      <span class="s1">}</span>

      <span class="s1">Assertions.assertNotNull(mPreviousText)</span><span class="s2">;</span>
      <span class="s1">String newText = s.toString().substring(start</span><span class="s2">, </span><span class="s1">start + count)</span><span class="s2">;</span>
      <span class="s1">String oldText = mPreviousText.substring(start</span><span class="s2">, </span><span class="s1">start + before)</span><span class="s2">;</span>
      <span class="s0">// Don't send same text changes</span>
      <span class="s2">if </span><span class="s1">(count == before &amp;&amp; newText.equals(oldText)) {</span>
        <span class="s2">return;</span>
      <span class="s1">}</span>

      <span class="s1">FabricViewStateManager stateManager = mEditText.getFabricViewStateManager()</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(stateManager.hasStateWrapper()) {</span>
        <span class="s0">// Fabric: communicate to C++ layer that text has changed</span>
        <span class="s0">// We need to call `incrementAndGetEventCounter` here explicitly because this</span>
        <span class="s0">// update may race with other updates.</span>
        <span class="s0">// We simply pass in the cache ID, which never changes, but UpdateState will still be called</span>
        <span class="s0">// on the native side, triggering a measure.</span>
        <span class="s1">stateManager.setState(</span>
            <span class="s2">new </span><span class="s1">FabricViewStateManager.StateUpdateCallback() {</span>
              <span class="s1">@Override</span>
              <span class="s2">public </span><span class="s1">WritableMap getStateUpdate() {</span>
                <span class="s1">WritableMap map = </span><span class="s2">new </span><span class="s1">WritableNativeMap()</span><span class="s2">;</span>
                <span class="s1">map.putInt(</span><span class="s4">&quot;mostRecentEventCount&quot;</span><span class="s2">, </span><span class="s1">mEditText.incrementAndGetEventCounter())</span><span class="s2">;</span>
                <span class="s1">map.putInt(</span><span class="s4">&quot;opaqueCacheId&quot;</span><span class="s2">, </span><span class="s1">mEditText.getId())</span><span class="s2">;</span>
                <span class="s2">return </span><span class="s1">map</span><span class="s2">;</span>
              <span class="s1">}</span>
            <span class="s1">})</span><span class="s2">;</span>
      <span class="s1">}</span>

      <span class="s0">// The event that contains the event counter and updates it must be sent first.</span>
      <span class="s0">// TODO: t7936714 merge these events</span>
      <span class="s1">mEventDispatcher.dispatchEvent(</span>
          <span class="s2">new </span><span class="s1">ReactTextChangedEvent(</span>
              <span class="s1">mSurfaceId</span><span class="s2">,</span>
              <span class="s1">mEditText.getId()</span><span class="s2">,</span>
              <span class="s1">s.toString()</span><span class="s2">,</span>
              <span class="s1">mEditText.incrementAndGetEventCounter()))</span><span class="s2">;</span>

      <span class="s1">mEventDispatcher.dispatchEvent(</span>
          <span class="s2">new </span><span class="s1">ReactTextInputEvent(</span>
              <span class="s1">mSurfaceId</span><span class="s2">, </span><span class="s1">mEditText.getId()</span><span class="s2">, </span><span class="s1">newText</span><span class="s2">, </span><span class="s1">oldText</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">start + before))</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">@Override</span>
    <span class="s2">public void </span><span class="s1">afterTextChanged(Editable s) {}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">protected void </span><span class="s1">addEventEmitters(</span>
      <span class="s2">final </span><span class="s1">ThemedReactContext reactContext</span><span class="s2">, final </span><span class="s1">ReactEditText editText) {</span>
    <span class="s1">editText.setEventDispatcher(getEventDispatcher(reactContext</span><span class="s2">, </span><span class="s1">editText))</span><span class="s2">;</span>
    <span class="s1">editText.addTextChangedListener(</span><span class="s2">new </span><span class="s1">ReactTextInputTextWatcher(reactContext</span><span class="s2">, </span><span class="s1">editText))</span><span class="s2">;</span>
    <span class="s1">editText.setOnFocusChangeListener(</span>
        <span class="s2">new </span><span class="s1">View.OnFocusChangeListener() {</span>
          <span class="s2">public void </span><span class="s1">onFocusChange(View v</span><span class="s2">, boolean </span><span class="s1">hasFocus) {</span>
            <span class="s2">int </span><span class="s1">surfaceId = reactContext.getSurfaceId()</span><span class="s2">;</span>
            <span class="s1">EventDispatcher eventDispatcher = getEventDispatcher(reactContext</span><span class="s2">, </span><span class="s1">editText)</span><span class="s2">;</span>
            <span class="s2">if </span><span class="s1">(hasFocus) {</span>
              <span class="s1">eventDispatcher.dispatchEvent(</span>
                  <span class="s2">new </span><span class="s1">ReactTextInputFocusEvent(surfaceId</span><span class="s2">, </span><span class="s1">editText.getId()))</span><span class="s2">;</span>
            <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
              <span class="s1">eventDispatcher.dispatchEvent(</span>
                  <span class="s2">new </span><span class="s1">ReactTextInputBlurEvent(surfaceId</span><span class="s2">, </span><span class="s1">editText.getId()))</span><span class="s2">;</span>

              <span class="s1">eventDispatcher.dispatchEvent(</span>
                  <span class="s2">new </span><span class="s1">ReactTextInputEndEditingEvent(</span>
                      <span class="s1">surfaceId</span><span class="s2">, </span><span class="s1">editText.getId()</span><span class="s2">, </span><span class="s1">editText.getText().toString()))</span><span class="s2">;</span>
            <span class="s1">}</span>
          <span class="s1">}</span>
        <span class="s1">})</span><span class="s2">;</span>

    <span class="s1">editText.setOnEditorActionListener(</span>
        <span class="s2">new </span><span class="s1">TextView.OnEditorActionListener() {</span>
          <span class="s1">@Override</span>
          <span class="s2">public boolean </span><span class="s1">onEditorAction(TextView v</span><span class="s2">, int </span><span class="s1">actionId</span><span class="s2">, </span><span class="s1">KeyEvent keyEvent) {</span>
            <span class="s2">if </span><span class="s1">((actionId &amp; EditorInfo.IME_MASK_ACTION) != </span><span class="s5">0 </span><span class="s1">|| actionId == EditorInfo.IME_NULL) {</span>
              <span class="s2">boolean </span><span class="s1">isMultiline = editText.isMultiline()</span><span class="s2">;</span>

              <span class="s2">boolean </span><span class="s1">shouldSubmit = editText.shouldSubmitOnReturn()</span><span class="s2">;</span>
              <span class="s2">boolean </span><span class="s1">shouldBlur = editText.shouldBlurOnReturn()</span><span class="s2">;</span>

              <span class="s0">// Motivation:</span>
              <span class="s0">// * shouldSubmit =&gt; Clear focus; prevent default behavior (return true);</span>
              <span class="s0">// * shouldBlur =&gt; Submit; prevent default behavior (return true);</span>
              <span class="s0">// * !shouldBlur &amp;&amp; !shouldSubmit &amp;&amp; isMultiline =&gt; Perform default behavior (return</span>
              <span class="s0">// false);</span>
              <span class="s0">// * !shouldBlur &amp;&amp; !shouldSubmit &amp;&amp; !isMultiline =&gt; Prevent default behavior (return</span>
              <span class="s0">// true);</span>
              <span class="s2">if </span><span class="s1">(shouldSubmit) {</span>
                <span class="s1">EventDispatcher eventDispatcher = getEventDispatcher(reactContext</span><span class="s2">, </span><span class="s1">editText)</span><span class="s2">;</span>
                <span class="s1">eventDispatcher.dispatchEvent(</span>
                    <span class="s2">new </span><span class="s1">ReactTextInputSubmitEditingEvent(</span>
                        <span class="s1">reactContext.getSurfaceId()</span><span class="s2">,</span>
                        <span class="s1">editText.getId()</span><span class="s2">,</span>
                        <span class="s1">editText.getText().toString()))</span><span class="s2">;</span>
              <span class="s1">}</span>

              <span class="s2">if </span><span class="s1">(shouldBlur) {</span>
                <span class="s1">editText.clearFocus()</span><span class="s2">;</span>
              <span class="s1">}</span>

              <span class="s0">// Prevent default behavior except when we want it to insert a newline.</span>
              <span class="s2">if </span><span class="s1">(shouldBlur || shouldSubmit || !isMultiline) {</span>
                <span class="s2">return true;</span>
              <span class="s1">}</span>

              <span class="s0">// If we've reached this point, it means that the TextInput has 'submitBehavior' set</span>
              <span class="s0">// nullish and 'multiline' set to true. But it's still possible to get IME_ACTION_NEXT</span>
              <span class="s0">// and IME_ACTION_PREVIOUS here in case if 'disableFullscreenUI' is false and Android</span>
              <span class="s0">// decides to render this EditText in the full screen mode (when a phone has the</span>
              <span class="s0">// landscape orientation for example). The full screen EditText also renders an action</span>
              <span class="s0">// button specified by the 'returnKeyType' prop. We have to prevent Android from</span>
              <span class="s0">// requesting focus from the next/previous focusable view since it must only be</span>
              <span class="s0">// controlled from JS.</span>
              <span class="s2">return </span><span class="s1">actionId == EditorInfo.IME_ACTION_NEXT</span>
                  <span class="s1">|| actionId == EditorInfo.IME_ACTION_PREVIOUS</span><span class="s2">;</span>
            <span class="s1">}</span>

            <span class="s2">return true;</span>
          <span class="s1">}</span>
        <span class="s1">})</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private static class </span><span class="s1">ReactContentSizeWatcher </span><span class="s2">implements </span><span class="s1">ContentSizeWatcher {</span>
    <span class="s2">private final </span><span class="s1">ReactEditText mEditText</span><span class="s2">;</span>
    <span class="s2">private final </span><span class="s1">EventDispatcher mEventDispatcher</span><span class="s2">;</span>
    <span class="s2">private final int </span><span class="s1">mSurfaceId</span><span class="s2">;</span>
    <span class="s2">private int </span><span class="s1">mPreviousContentWidth = </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s2">private int </span><span class="s1">mPreviousContentHeight = </span><span class="s5">0</span><span class="s2">;</span>

    <span class="s2">public </span><span class="s1">ReactContentSizeWatcher(ReactEditText editText) {</span>
      <span class="s1">mEditText = editText</span><span class="s2">;</span>
      <span class="s1">ReactContext reactContext = getReactContext(editText)</span><span class="s2">;</span>
      <span class="s1">mEventDispatcher = getEventDispatcher(reactContext</span><span class="s2">, </span><span class="s1">editText)</span><span class="s2">;</span>
      <span class="s1">mSurfaceId = UIManagerHelper.getSurfaceId(reactContext)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">@Override</span>
    <span class="s2">public void </span><span class="s1">onLayout() {</span>
      <span class="s2">if </span><span class="s1">(mEventDispatcher == </span><span class="s2">null</span><span class="s1">) {</span>
        <span class="s2">return;</span>
      <span class="s1">}</span>

      <span class="s2">int </span><span class="s1">contentWidth = mEditText.getWidth()</span><span class="s2">;</span>
      <span class="s2">int </span><span class="s1">contentHeight = mEditText.getHeight()</span><span class="s2">;</span>

      <span class="s0">// Use instead size of text content within EditText when available</span>
      <span class="s2">if </span><span class="s1">(mEditText.getLayout() != </span><span class="s2">null</span><span class="s1">) {</span>
        <span class="s1">contentWidth =</span>
            <span class="s1">mEditText.getCompoundPaddingLeft()</span>
                <span class="s1">+ mEditText.getLayout().getWidth()</span>
                <span class="s1">+ mEditText.getCompoundPaddingRight()</span><span class="s2">;</span>
        <span class="s1">contentHeight =</span>
            <span class="s1">mEditText.getCompoundPaddingTop()</span>
                <span class="s1">+ mEditText.getLayout().getHeight()</span>
                <span class="s1">+ mEditText.getCompoundPaddingBottom()</span><span class="s2">;</span>
      <span class="s1">}</span>

      <span class="s2">if </span><span class="s1">(contentWidth != mPreviousContentWidth || contentHeight != mPreviousContentHeight) {</span>
        <span class="s1">mPreviousContentHeight = contentHeight</span><span class="s2">;</span>
        <span class="s1">mPreviousContentWidth = contentWidth</span><span class="s2">;</span>

        <span class="s1">mEventDispatcher.dispatchEvent(</span>
            <span class="s2">new </span><span class="s1">ReactContentSizeChangedEvent(</span>
                <span class="s1">mSurfaceId</span><span class="s2">,</span>
                <span class="s1">mEditText.getId()</span><span class="s2">,</span>
                <span class="s1">PixelUtil.toDIPFromPixel(contentWidth)</span><span class="s2">,</span>
                <span class="s1">PixelUtil.toDIPFromPixel(contentHeight)))</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">private static class </span><span class="s1">ReactSelectionWatcher </span><span class="s2">implements </span><span class="s1">SelectionWatcher {</span>
    <span class="s2">private final </span><span class="s1">ReactEditText mReactEditText</span><span class="s2">;</span>
    <span class="s2">private final </span><span class="s1">EventDispatcher mEventDispatcher</span><span class="s2">;</span>
    <span class="s2">private final int </span><span class="s1">mSurfaceId</span><span class="s2">;</span>
    <span class="s2">private int </span><span class="s1">mPreviousSelectionStart</span><span class="s2">;</span>
    <span class="s2">private int </span><span class="s1">mPreviousSelectionEnd</span><span class="s2">;</span>

    <span class="s2">public </span><span class="s1">ReactSelectionWatcher(ReactEditText editText) {</span>
      <span class="s1">mReactEditText = editText</span><span class="s2">;</span>
      <span class="s1">ReactContext reactContext = getReactContext(editText)</span><span class="s2">;</span>
      <span class="s1">mEventDispatcher = getEventDispatcher(reactContext</span><span class="s2">, </span><span class="s1">editText)</span><span class="s2">;</span>
      <span class="s1">mSurfaceId = UIManagerHelper.getSurfaceId(reactContext)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">@Override</span>
    <span class="s2">public void </span><span class="s1">onSelectionChanged(</span><span class="s2">int </span><span class="s1">start</span><span class="s2">, int </span><span class="s1">end) {</span>
      <span class="s0">// Android will call us back for both the SELECTION_START span and SELECTION_END span in text</span>
      <span class="s0">// To prevent double calling back into js we cache the result of the previous call and only</span>
      <span class="s0">// forward it on if we have new values</span>

      <span class="s0">// Apparently Android might call this with an end value that is less than the start value</span>
      <span class="s0">// Lets normalize them. See https://github.com/facebook/react-native/issues/18579</span>
      <span class="s2">int </span><span class="s1">realStart = Math.min(start</span><span class="s2">, </span><span class="s1">end)</span><span class="s2">;</span>
      <span class="s2">int </span><span class="s1">realEnd = Math.max(start</span><span class="s2">, </span><span class="s1">end)</span><span class="s2">;</span>

      <span class="s2">if </span><span class="s1">(mPreviousSelectionStart != realStart || mPreviousSelectionEnd != realEnd) {</span>
        <span class="s1">mEventDispatcher.dispatchEvent(</span>
            <span class="s2">new </span><span class="s1">ReactTextInputSelectionEvent(</span>
                <span class="s1">mSurfaceId</span><span class="s2">, </span><span class="s1">mReactEditText.getId()</span><span class="s2">, </span><span class="s1">realStart</span><span class="s2">, </span><span class="s1">realEnd))</span><span class="s2">;</span>

        <span class="s1">mPreviousSelectionStart = realStart</span><span class="s2">;</span>
        <span class="s1">mPreviousSelectionEnd = realEnd</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">private static class </span><span class="s1">ReactScrollWatcher </span><span class="s2">implements </span><span class="s1">ScrollWatcher {</span>
    <span class="s2">private final </span><span class="s1">ReactEditText mReactEditText</span><span class="s2">;</span>
    <span class="s2">private final </span><span class="s1">EventDispatcher mEventDispatcher</span><span class="s2">;</span>
    <span class="s2">private final int </span><span class="s1">mSurfaceId</span><span class="s2">;</span>
    <span class="s2">private int </span><span class="s1">mPreviousHoriz</span><span class="s2">;</span>
    <span class="s2">private int </span><span class="s1">mPreviousVert</span><span class="s2">;</span>

    <span class="s2">public </span><span class="s1">ReactScrollWatcher(ReactEditText editText) {</span>
      <span class="s1">mReactEditText = editText</span><span class="s2">;</span>
      <span class="s1">ReactContext reactContext = getReactContext(editText)</span><span class="s2">;</span>
      <span class="s1">mEventDispatcher = getEventDispatcher(reactContext</span><span class="s2">, </span><span class="s1">editText)</span><span class="s2">;</span>
      <span class="s1">mSurfaceId = UIManagerHelper.getSurfaceId(reactContext)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">@Override</span>
    <span class="s2">public void </span><span class="s1">onScrollChanged(</span><span class="s2">int </span><span class="s1">horiz</span><span class="s2">, int </span><span class="s1">vert</span><span class="s2">, int </span><span class="s1">oldHoriz</span><span class="s2">, int </span><span class="s1">oldVert) {</span>
      <span class="s2">if </span><span class="s1">(mPreviousHoriz != horiz || mPreviousVert != vert) {</span>
        <span class="s1">ScrollEvent event =</span>
            <span class="s1">ScrollEvent.obtain(</span>
                <span class="s1">mSurfaceId</span><span class="s2">,</span>
                <span class="s1">mReactEditText.getId()</span><span class="s2">,</span>
                <span class="s1">ScrollEventType.SCROLL</span><span class="s2">,</span>
                <span class="s1">horiz</span><span class="s2">,</span>
                <span class="s1">vert</span><span class="s2">,</span>
                <span class="s5">0f</span><span class="s2">, </span><span class="s0">// can't get x velocity</span>
                <span class="s5">0f</span><span class="s2">, </span><span class="s0">// can't get y velocity</span>
                <span class="s5">0</span><span class="s2">, </span><span class="s0">// can't get content width</span>
                <span class="s5">0</span><span class="s2">, </span><span class="s0">// can't get content height</span>
                <span class="s1">mReactEditText.getWidth()</span><span class="s2">,</span>
                <span class="s1">mReactEditText.getHeight())</span><span class="s2">;</span>

        <span class="s1">mEventDispatcher.dispatchEvent(event)</span><span class="s2">;</span>

        <span class="s1">mPreviousHoriz = horiz</span><span class="s2">;</span>
        <span class="s1">mPreviousVert = vert</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">@Nullable Map getExportedViewConstants() {</span>
    <span class="s2">return </span><span class="s1">MapBuilder.of(</span>
        <span class="s4">&quot;AutoCapitalizationType&quot;</span><span class="s2">,</span>
        <span class="s1">MapBuilder.of(</span>
            <span class="s4">&quot;none&quot;</span><span class="s2">,</span>
            <span class="s5">0</span><span class="s2">,</span>
            <span class="s4">&quot;characters&quot;</span><span class="s2">,</span>
            <span class="s1">InputType.TYPE_TEXT_FLAG_CAP_CHARACTERS</span><span class="s2">,</span>
            <span class="s4">&quot;words&quot;</span><span class="s2">,</span>
            <span class="s1">InputType.TYPE_TEXT_FLAG_CAP_WORDS</span><span class="s2">,</span>
            <span class="s4">&quot;sentences&quot;</span><span class="s2">,</span>
            <span class="s1">InputType.TYPE_TEXT_FLAG_CAP_SENTENCES))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">setPadding(ReactEditText view</span><span class="s2">, int </span><span class="s1">left</span><span class="s2">, int </span><span class="s1">top</span><span class="s2">, int </span><span class="s1">right</span><span class="s2">, int </span><span class="s1">bottom) {</span>
    <span class="s1">view.setPadding(left</span><span class="s2">, </span><span class="s1">top</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">bottom)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">Object updateState(</span>
      <span class="s1">ReactEditText view</span><span class="s2">, </span><span class="s1">ReactStylesDiffMap props</span><span class="s2">, </span><span class="s1">StateWrapper stateWrapper) {</span>
    <span class="s2">if </span><span class="s1">(ReactEditText.DEBUG_MODE) {</span>
      <span class="s1">FLog.e(TAG</span><span class="s2">, </span><span class="s4">&quot;updateState: [&quot; </span><span class="s1">+ view.getId() + </span><span class="s4">&quot;]&quot;</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">FabricViewStateManager stateManager = view.getFabricViewStateManager()</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(!stateManager.hasStateWrapper()) {</span>
      <span class="s0">// HACK: In Fabric, we assume all components start off with zero padding, which is</span>
      <span class="s0">// not true for TextInput components. We expose the theme's default padding via</span>
      <span class="s0">// AndroidTextInputComponentDescriptor, which will be applied later though setPadding.</span>
      <span class="s0">// TODO T58784068: move this constructor once Fabric is shipped</span>
      <span class="s1">view.setPadding(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">stateManager.setStateWrapper(stateWrapper)</span><span class="s2">;</span>

    <span class="s1">MapBuffer stateMapBuffer = stateWrapper.getStateDataMapBuffer()</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(stateMapBuffer != </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s1">getReactTextUpdate(view</span><span class="s2">, </span><span class="s1">props</span><span class="s2">, </span><span class="s1">stateMapBuffer)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">ReadableNativeMap state = stateWrapper.getStateData()</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(state == </span><span class="s2">null </span><span class="s1">|| !state.hasKey(</span><span class="s4">&quot;attributedString&quot;</span><span class="s1">)) {</span>
      <span class="s2">return null;</span>
    <span class="s1">}</span>

    <span class="s1">ReadableMap attributedString = state.getMap(</span><span class="s4">&quot;attributedString&quot;</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">ReadableMap paragraphAttributes = state.getMap(</span><span class="s4">&quot;paragraphAttributes&quot;</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(attributedString == </span><span class="s2">null </span><span class="s1">|| paragraphAttributes == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">throw new </span><span class="s1">IllegalArgumentException(</span><span class="s4">&quot;Invalid TextInput State was received as a parameters&quot;</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">Spannable spanned =</span>
        <span class="s1">TextLayoutManager.getOrCreateSpannableForText(</span>
            <span class="s1">view.getContext()</span><span class="s2">, </span><span class="s1">attributedString</span><span class="s2">, </span><span class="s1">mReactTextViewManagerCallback)</span><span class="s2">;</span>

    <span class="s2">int </span><span class="s1">textBreakStrategy =</span>
        <span class="s1">TextAttributeProps.getTextBreakStrategy(</span>
            <span class="s1">paragraphAttributes.getString(ViewProps.TEXT_BREAK_STRATEGY))</span><span class="s2">;</span>
    <span class="s2">int </span><span class="s1">currentJustificationMode =</span>
        <span class="s1">Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O ? </span><span class="s5">0 </span><span class="s1">: view.getJustificationMode()</span><span class="s2">;</span>

    <span class="s2">return </span><span class="s1">ReactTextUpdate.buildReactTextUpdateFromState(</span>
        <span class="s1">spanned</span><span class="s2">,</span>
        <span class="s1">state.getInt(</span><span class="s4">&quot;mostRecentEventCount&quot;</span><span class="s1">)</span><span class="s2">,</span>
        <span class="s1">TextAttributeProps.getTextAlignment(</span>
            <span class="s1">props</span><span class="s2">, </span><span class="s1">TextLayoutManager.isRTL(attributedString)</span><span class="s2">, </span><span class="s1">view.getGravityHorizontal())</span><span class="s2">,</span>
        <span class="s1">textBreakStrategy</span><span class="s2">,</span>
        <span class="s1">TextAttributeProps.getJustificationMode(props</span><span class="s2">, </span><span class="s1">currentJustificationMode))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">public </span><span class="s1">Object getReactTextUpdate(ReactEditText view</span><span class="s2">, </span><span class="s1">ReactStylesDiffMap props</span><span class="s2">, </span><span class="s1">MapBuffer state) {</span>
    <span class="s0">// If native wants to update the state wrapper but the state data hasn't actually</span>
    <span class="s0">// changed, the MapBuffer may be empty</span>
    <span class="s2">if </span><span class="s1">(state.getCount() == </span><span class="s5">0</span><span class="s1">) {</span>
      <span class="s2">return null;</span>
    <span class="s1">}</span>

    <span class="s1">MapBuffer attributedString = state.getMapBuffer(TX_STATE_KEY_ATTRIBUTED_STRING)</span><span class="s2">;</span>
    <span class="s1">MapBuffer paragraphAttributes = state.getMapBuffer(TX_STATE_KEY_PARAGRAPH_ATTRIBUTES)</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(attributedString == </span><span class="s2">null </span><span class="s1">|| paragraphAttributes == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">throw new </span><span class="s1">IllegalArgumentException(</span>
          <span class="s4">&quot;Invalid TextInput State (MapBuffer) was received as a parameters&quot;</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s1">Spannable spanned =</span>
        <span class="s1">TextLayoutManagerMapBuffer.getOrCreateSpannableForText(</span>
            <span class="s1">view.getContext()</span><span class="s2">, </span><span class="s1">attributedString</span><span class="s2">, </span><span class="s1">mReactTextViewManagerCallback)</span><span class="s2">;</span>

    <span class="s2">int </span><span class="s1">textBreakStrategy =</span>
        <span class="s1">TextAttributeProps.getTextBreakStrategy(</span>
            <span class="s1">paragraphAttributes.getString(TextLayoutManagerMapBuffer.PA_KEY_TEXT_BREAK_STRATEGY))</span><span class="s2">;</span>
    <span class="s2">int </span><span class="s1">currentJustificationMode =</span>
        <span class="s1">Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O ? </span><span class="s5">0 </span><span class="s1">: view.getJustificationMode()</span><span class="s2">;</span>

    <span class="s2">return </span><span class="s1">ReactTextUpdate.buildReactTextUpdateFromState(</span>
        <span class="s1">spanned</span><span class="s2">,</span>
        <span class="s1">state.getInt(TX_STATE_KEY_MOST_RECENT_EVENT_COUNT)</span><span class="s2">,</span>
        <span class="s1">TextAttributeProps.getTextAlignment(</span>
            <span class="s1">props</span><span class="s2">, </span><span class="s1">TextLayoutManagerMapBuffer.isRTL(attributedString)</span><span class="s2">, </span><span class="s1">view.getGravityHorizontal())</span><span class="s2">,</span>
        <span class="s1">textBreakStrategy</span><span class="s2">,</span>
        <span class="s1">TextAttributeProps.getJustificationMode(props</span><span class="s2">, </span><span class="s1">currentJustificationMode))</span><span class="s2">;</span>
  <span class="s1">}</span>
<span class="s1">}</span>
</pre>
</body>
</html>