<html>
<head>
<title>createDebuggerProxyEndpoint.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #6a8759;}
.s2 { color: #6897bb; font-style: italic;}
.s3 { color: #cc7832; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
createDebuggerProxyEndpoint.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;createDebuggerProxyEndpoint&quot;</span><span class="s0">,</span><span class="s1">&quot;WebSocketServer&quot;</span><span class="s0">,</span><span class="s1">&quot;ws&quot;</span><span class="s0">,</span><span class="s1">&quot;Server&quot;</span><span class="s0">,</span><span class="s1">&quot;wss&quot;</span><span class="s0">,</span><span class="s1">&quot;noServer&quot;</span><span class="s0">,</span><span class="s1">&quot;debuggerSocket&quot;</span><span class="s0">,</span><span class="s1">&quot;clientSocket&quot;</span><span class="s0">,</span><span class="s1">&quot;send&quot;</span><span class="s0">,</span><span class="s1">&quot;dest&quot;</span><span class="s0">,</span><span class="s1">&quot;message&quot;</span><span class="s0">,</span><span class="s1">&quot;e&quot;</span><span class="s0">,</span><span class="s1">&quot;logger&quot;</span><span class="s0">,</span><span class="s1">&quot;warn&quot;</span><span class="s0">,</span><span class="s1">&quot;debuggerSocketCloseHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;close&quot;</span><span class="s0">,</span><span class="s1">&quot;clientSocketCloseHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;on&quot;</span><span class="s0">,</span><span class="s1">&quot;socket&quot;</span><span class="s0">,</span><span class="s1">&quot;request&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;indexOf&quot;</span><span class="s0">,</span><span class="s1">&quot;onerror&quot;</span><span class="s0">,</span><span class="s1">&quot;onclose&quot;</span><span class="s0">,</span><span class="s1">&quot;onmessage&quot;</span><span class="s0">,</span><span class="s1">&quot;data&quot;</span><span class="s0">,</span><span class="s1">&quot;server&quot;</span><span class="s0">,</span><span class="s1">&quot;isDebuggerConnected&quot;</span><span class="s0">],</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/websocket/createDebuggerProxyEndpoint.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* Copyright (c) Facebook, Inc. and its affiliates.</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">* This source code is licensed under the MIT license found in the</span><span class="s3">\n </span><span class="s1">* LICENSE file in the root directory of this source tree.</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">* @format</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import ws from 'ws';</span><span class="s3">\n</span><span class="s1">import {logger} from '@react-native-community/cli-tools';</span><span class="s3">\n\n</span><span class="s1">export default function createDebuggerProxyEndpoint(): {</span><span class="s3">\n  </span><span class="s1">server: ws.Server;</span><span class="s3">\n  </span><span class="s1">isDebuggerConnected: () =&gt; boolean;</span><span class="s3">\n</span><span class="s1">} {</span><span class="s3">\n  </span><span class="s1">const WebSocketServer = ws.Server;</span><span class="s3">\n  </span><span class="s1">const wss = new WebSocketServer({</span><span class="s3">\n    </span><span class="s1">noServer: true,</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n\n  </span><span class="s1">let debuggerSocket: ws | null;</span><span class="s3">\n  </span><span class="s1">let clientSocket: ws | null;</span><span class="s3">\n\n  </span><span class="s1">function send(dest: ws | null, message: ws.Data) {</span><span class="s3">\n    </span><span class="s1">if (!dest) {</span><span class="s3">\n      </span><span class="s1">return;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">dest.send(message);</span><span class="s3">\n    </span><span class="s1">} catch (e) {</span><span class="s3">\n      </span><span class="s1">logger.warn(e as any);</span><span class="s3">\n      </span><span class="s1">// Sometimes this call throws 'not opened'</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const debuggerSocketCloseHandler = () =&gt; {</span><span class="s3">\n    </span><span class="s1">debuggerSocket = null;</span><span class="s3">\n    </span><span class="s1">if (clientSocket) {</span><span class="s3">\n      </span><span class="s1">clientSocket.close(1011, 'Debugger was disconnected');</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">const clientSocketCloseHandler = () =&gt; {</span><span class="s3">\n    </span><span class="s1">clientSocket = null;</span><span class="s3">\n    </span><span class="s1">send(debuggerSocket, JSON.stringify({method: '$disconnected'}));</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">wss.on('connection', (socket, request) =&gt; {</span><span class="s3">\n    </span><span class="s1">const {url} = request;</span><span class="s3">\n\n    </span><span class="s1">if (url &amp;&amp; url.indexOf('role=debugger') &gt; -1) {</span><span class="s3">\n      </span><span class="s1">if (debuggerSocket) {</span><span class="s3">\n        </span><span class="s1">socket.close(1011, 'Another debugger is already connected');</span><span class="s3">\n        </span><span class="s1">return;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">debuggerSocket = socket;</span><span class="s3">\n      </span><span class="s1">if (debuggerSocket) {</span><span class="s3">\n        </span><span class="s1">debuggerSocket.onerror = debuggerSocketCloseHandler;</span><span class="s3">\n        </span><span class="s1">debuggerSocket.onclose = debuggerSocketCloseHandler;</span><span class="s3">\n        </span><span class="s1">debuggerSocket.onmessage = ({data}) =&gt; send(clientSocket, data);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} else if (url &amp;&amp; url.indexOf('role=client') &gt; -1) {</span><span class="s3">\n      </span><span class="s1">if (clientSocket) {</span><span class="s3">\n        </span><span class="s1">clientSocket.onerror = () =&gt; {};</span><span class="s3">\n        </span><span class="s1">clientSocket.onclose = () =&gt; {};</span><span class="s3">\n        </span><span class="s1">clientSocket.onmessage = () =&gt; {};</span><span class="s3">\n        </span><span class="s1">clientSocket.close(1011, 'Another client connected');</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">clientSocket = socket;</span><span class="s3">\n      </span><span class="s1">clientSocket.onerror = clientSocketCloseHandler;</span><span class="s3">\n      </span><span class="s1">clientSocket.onclose = clientSocketCloseHandler;</span><span class="s3">\n      </span><span class="s1">clientSocket.onmessage = ({data}) =&gt; send(debuggerSocket, data);</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">socket.close(1011, 'Missing role param');</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n\n  </span><span class="s1">return {</span><span class="s3">\n    </span><span class="s1">server: wss,</span><span class="s3">\n    </span><span class="s1">isDebuggerConnected() {</span><span class="s3">\n      </span><span class="s1">return !!debuggerSocket;</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;;;AASA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAyD;AAVzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAKe,SAASA,2BAA2B,GAGjD;EACA,MAAMC,eAAe,GAAGC,aAAE,CAACC,MAAM;EACjC,MAAMC,GAAG,GAAG,IAAIH,eAAe,CAAC;IAC9BI,QAAQ,EAAE;EACZ,CAAC,CAAC;EAEF,IAAIC,cAAyB;EAC7B,IAAIC,YAAuB;EAE3B,SAASC,IAAI,CAACC,IAAe,EAAEC,OAAgB,EAAE;IAC/C,IAAI,CAACD,IAAI,EAAE;MACT;IACF;IAEA,IAAI;MACFA,IAAI,CAACD,IAAI,CAACE,OAAO,CAAC;IACpB,CAAC,CAAC,OAAOC,CAAC,EAAE;MACVC,kBAAM,CAACC,IAAI,CAACF,CAAC,CAAQ;MACrB;IACF;EACF;;EAEA,MAAMG,0BAA0B,GAAG,MAAM;IACvCR,cAAc,GAAG,IAAI;IACrB,IAAIC,YAAY,EAAE;MAChBA,YAAY,CAACQ,KAAK,CAAC,IAAI,EAAE,2BAA2B,CAAC;IACvD;EACF,CAAC;EAED,MAAMC,wBAAwB,GAAG,MAAM;IACrCT,YAAY,GAAG,IAAI;IACnBC,IAAI,CAACF,cAAc,EAAEW,IAAI,CAACC,SAAS,CAAC;MAACC,MAAM,EAAE;IAAe,CAAC,CAAC,CAAC;EACjE,CAAC;EAEDf,GAAG,CAACgB,EAAE,CAAC,YAAY,EAAE,CAACC,MAAM,EAAEC,OAAO,KAAK;IACxC,MAAM;MAACC;IAAG,CAAC,GAAGD,OAAO;IAErB,IAAIC,GAAG,IAAIA,GAAG,CAACC,OAAO,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE;MAC5C,IAAIlB,cAAc,EAAE;QAClBe,MAAM,CAACN,KAAK,CAAC,IAAI,EAAE,uCAAuC,CAAC;QAC3D;MACF;MACAT,cAAc,GAAGe,MAAM;MACvB,IAAIf,cAAc,EAAE;QAClBA,cAAc,CAACmB,OAAO,GAAGX,0BAA0B;QACnDR,cAAc,CAACoB,OAAO,GAAGZ,0BAA0B;QACnDR,cAAc,CAACqB,SAAS,GAAG,CAAC;UAACC;QAAI,CAAC,KAAKpB,IAAI,CAACD,YAAY,EAAEqB,IAAI,CAAC;MACjE;IACF,CAAC,MAAM,IAAIL,GAAG,IAAIA,GAAG,CAACC,OAAO,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,EAAE;MACjD,IAAIjB,YAAY,EAAE;QAChBA,YAAY,CAACkB,OAAO,GAAG,MAAM,CAAC,CAAC;QAC/BlB,YAAY,CAACmB,OAAO,GAAG,MAAM,CAAC,CAAC;QAC/BnB,YAAY,CAACoB,SAAS,GAAG,MAAM,CAAC,CAAC;QACjCpB,YAAY,CAACQ,KAAK,CAAC,IAAI,EAAE,0BAA0B,CAAC;MACtD;MACAR,YAAY,GAAGc,MAAM;MACrBd,YAAY,CAACkB,OAAO,GAAGT,wBAAwB;MAC/CT,YAAY,CAACmB,OAAO,GAAGV,wBAAwB;MAC/CT,YAAY,CAACoB,SAAS,GAAG,CAAC;QAACC;MAAI,CAAC,KAAKpB,IAAI,CAACF,cAAc,EAAEsB,IAAI,CAAC;IACjE,CAAC,MAAM;MACLP,MAAM,CAACN,KAAK,CAAC,IAAI,EAAE,oBAAoB,CAAC;IAC1C;EACF,CAAC,CAAC;EAEF,OAAO;IACLc,MAAM,EAAEzB,GAAG;IACX0B,mBAAmB,GAAG;MACpB,OAAO,CAAC,CAACxB,cAAc;IACzB;EACF,CAAC;AACH&quot;</span><span class="s0">}</span></pre>
</body>
</html>