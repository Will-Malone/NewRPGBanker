<html>
<head>
<title>VelocityTracker.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #6a8759;}
.s2 { color: #6897bb; font-style: italic;}
.s3 { color: #cc7832; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
VelocityTracker.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;VelocityTracker.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;VelocityTracker&quot;</span><span class="s0">,</span><span class="s1">&quot;constructor&quot;</span><span class="s0">,</span><span class="s1">&quot;samples&quot;</span><span class="s0">,</span><span class="s1">&quot;CircularBuffer&quot;</span><span class="s0">,</span><span class="s1">&quot;historySize&quot;</span><span class="s0">,</span><span class="s1">&quot;add&quot;</span><span class="s0">,</span><span class="s1">&quot;event&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;getVelocityEstimate&quot;</span><span class="s0">,</span><span class="s1">&quot;x&quot;</span><span class="s0">,</span><span class="s1">&quot;y&quot;</span><span class="s0">,</span><span class="s1">&quot;w&quot;</span><span class="s0">,</span><span class="s1">&quot;time&quot;</span><span class="s0">,</span><span class="s1">&quot;sampleCount&quot;</span><span class="s0">,</span><span class="s1">&quot;index&quot;</span><span class="s0">,</span><span class="s1">&quot;size&quot;</span><span class="s0">,</span><span class="s1">&quot;newestSample&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;previousSample&quot;</span><span class="s0">,</span><span class="s1">&quot;sample&quot;</span><span class="s0">,</span><span class="s1">&quot;age&quot;</span><span class="s0">,</span><span class="s1">&quot;delta&quot;</span><span class="s0">,</span><span class="s1">&quot;Math&quot;</span><span class="s0">,</span><span class="s1">&quot;abs&quot;</span><span class="s0">,</span><span class="s1">&quot;horizonMilliseconds&quot;</span><span class="s0">,</span><span class="s1">&quot;assumePointerMoveStoppedMilliseconds&quot;</span><span class="s0">,</span><span class="s1">&quot;minSampleSize&quot;</span><span class="s0">,</span><span class="s1">&quot;xSolver&quot;</span><span class="s0">,</span><span class="s1">&quot;LeastSquareSolver&quot;</span><span class="s0">,</span><span class="s1">&quot;xFit&quot;</span><span class="s0">,</span><span class="s1">&quot;solve&quot;</span><span class="s0">,</span><span class="s1">&quot;ySolver&quot;</span><span class="s0">,</span><span class="s1">&quot;yFit&quot;</span><span class="s0">,</span><span class="s1">&quot;xVelocity&quot;</span><span class="s0">,</span><span class="s1">&quot;coefficients&quot;</span><span class="s0">,</span><span class="s1">&quot;yVelocity&quot;</span><span class="s0">,</span><span class="s1">&quot;getVelocity&quot;</span><span class="s0">,</span><span class="s1">&quot;estimate&quot;</span><span class="s0">,</span><span class="s1">&quot;reset&quot;</span><span class="s0">,</span><span class="s1">&quot;clear&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { AdaptedEvent } from '../interfaces';</span><span class="s3">\n</span><span class="s1">import CircularBuffer from './CircularBuffer';</span><span class="s3">\n</span><span class="s1">import LeastSquareSolver from './LeastSquareSolver';</span><span class="s3">\n\n</span><span class="s1">export default class VelocityTracker {</span><span class="s3">\n  </span><span class="s1">private assumePointerMoveStoppedMilliseconds = 40;</span><span class="s3">\n  </span><span class="s1">private historySize = 20;</span><span class="s3">\n  </span><span class="s1">private horizonMilliseconds = 300;</span><span class="s3">\n  </span><span class="s1">private minSampleSize = 3;</span><span class="s3">\n\n  </span><span class="s1">private samples: CircularBuffer&lt;AdaptedEvent&gt;;</span><span class="s3">\n\n  </span><span class="s1">constructor() {</span><span class="s3">\n    </span><span class="s1">this.samples = new CircularBuffer&lt;AdaptedEvent&gt;(this.historySize);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public add(event: AdaptedEvent): void {</span><span class="s3">\n    </span><span class="s1">this.samples.push(event);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">/// Returns an estimate of the velocity of the object being tracked by the</span><span class="s3">\n  </span><span class="s1">/// tracker given the current information available to the tracker.</span><span class="s3">\n  </span><span class="s1">///</span><span class="s3">\n  </span><span class="s1">/// Information is added using [addPosition].</span><span class="s3">\n  </span><span class="s1">///</span><span class="s3">\n  </span><span class="s1">/// Returns null if there is no data on which to base an estimate.</span><span class="s3">\n  </span><span class="s1">private getVelocityEstimate(): [number, number] | null {</span><span class="s3">\n    </span><span class="s1">const x = [];</span><span class="s3">\n    </span><span class="s1">const y = [];</span><span class="s3">\n    </span><span class="s1">const w = [];</span><span class="s3">\n    </span><span class="s1">const time = [];</span><span class="s3">\n\n    </span><span class="s1">let sampleCount = 0;</span><span class="s3">\n    </span><span class="s1">let index = this.samples.size - 1;</span><span class="s3">\n    </span><span class="s1">const newestSample = this.samples.get(index);</span><span class="s3">\n    </span><span class="s1">if (!newestSample) {</span><span class="s3">\n      </span><span class="s1">return null;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let previousSample = newestSample;</span><span class="s3">\n\n    </span><span class="s1">// Starting with the most recent PointAtTime sample, iterate backwards while</span><span class="s3">\n    </span><span class="s1">// the samples represent continuous motion.</span><span class="s3">\n    </span><span class="s1">while (sampleCount &lt; this.samples.size) {</span><span class="s3">\n      </span><span class="s1">const sample = this.samples.get(index);</span><span class="s3">\n\n      </span><span class="s1">const age = newestSample.time - sample.time;</span><span class="s3">\n      </span><span class="s1">const delta = Math.abs(sample.time - previousSample.time);</span><span class="s3">\n      </span><span class="s1">previousSample = sample;</span><span class="s3">\n\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">age &gt; this.horizonMilliseconds ||</span><span class="s3">\n        </span><span class="s1">delta &gt; this.assumePointerMoveStoppedMilliseconds</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">break;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">x.push(sample.x);</span><span class="s3">\n      </span><span class="s1">y.push(sample.y);</span><span class="s3">\n      </span><span class="s1">w.push(1);</span><span class="s3">\n      </span><span class="s1">time.push(-age);</span><span class="s3">\n\n      </span><span class="s1">sampleCount++;</span><span class="s3">\n      </span><span class="s1">index--;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (sampleCount &gt;= this.minSampleSize) {</span><span class="s3">\n      </span><span class="s1">const xSolver = new LeastSquareSolver(time, x, w);</span><span class="s3">\n      </span><span class="s1">const xFit = xSolver.solve(2);</span><span class="s3">\n\n      </span><span class="s1">if (xFit !== null) {</span><span class="s3">\n        </span><span class="s1">const ySolver = new LeastSquareSolver(time, y, w);</span><span class="s3">\n        </span><span class="s1">const yFit = ySolver.solve(2);</span><span class="s3">\n\n        </span><span class="s1">if (yFit !== null) {</span><span class="s3">\n          </span><span class="s1">const xVelocity = xFit.coefficients[1] * 1000;</span><span class="s3">\n          </span><span class="s1">const yVelocity = yFit.coefficients[1] * 1000;</span><span class="s3">\n\n          </span><span class="s1">return [xVelocity, yVelocity];</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return null;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public getVelocity(): [number, number] {</span><span class="s3">\n    </span><span class="s1">const estimate = this.getVelocityEstimate();</span><span class="s3">\n    </span><span class="s1">if (estimate !== null) {</span><span class="s3">\n      </span><span class="s1">return estimate;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return [0, 0];</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public reset(): void {</span><span class="s3">\n    </span><span class="s1">this.samples.clear();</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">]}</span></pre>
</body>
</html>