<html>
<head>
<title>GenerateModuleJniH.js.flow</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
GenerateModuleJniH.js.flow</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* Copyright (c) Meta Platforms, Inc. and affiliates.</span>
 <span class="s0">*</span>
 <span class="s0">* This source code is licensed under the MIT license found in the</span>
 <span class="s0">* LICENSE file in the root directory of this source tree.</span>
 <span class="s0">*</span>
 <span class="s0">* @flow strict</span>
 <span class="s0">* @format</span>
 <span class="s0">*/</span>

<span class="s0">'use strict';</span>

<span class="s0">import type {SchemaType} from '../../CodegenSchema';</span>

<span class="s0">type FilesOutput = Map&lt;string, string&gt;;</span>

<span class="s0">const {getModules} = require('./Utils');</span>

<span class="s0">const ModuleClassDeclarationTemplate = ({</span>
  <span class="s0">hasteModuleName,</span>
<span class="s0">}: $ReadOnly&lt;{hasteModuleName: string}&gt;) =&gt; {</span>
  <span class="s0">return `/**</span>
 <span class="s0">* JNI C++ class for module '${hasteModuleName}'</span>
 <span class="s0">*/</span>
<span class="s0">class JSI_EXPORT ${hasteModuleName}SpecJSI : public JavaTurboModule {</span>
<span class="s0">public:</span>
  <span class="s0">${hasteModuleName}SpecJSI(const JavaTurboModule::InitParams &amp;params);</span>
<span class="s0">};</span>
<span class="s0">`;</span>
<span class="s0">};</span>

<span class="s0">const HeaderFileTemplate = ({</span>
  <span class="s0">modules,</span>
  <span class="s0">libraryName,</span>
<span class="s0">}: $ReadOnly&lt;{modules: string, libraryName: string}&gt;) =&gt; {</span>
  <span class="s0">return `</span>
<span class="s0">/**</span>
 <span class="s0">* This code was generated by [react-native-codegen](https://www.npmjs.com/package/react-native-codegen).</span>
 <span class="s0">*</span>
 <span class="s0">* Do not edit this file as changes may cause incorrect behavior and will be lost</span>
 <span class="s0">* once the code is regenerated.</span>
 <span class="s0">*</span>
 <span class="s0">* ${'@'}generated by codegen project: GenerateModuleJniH.js</span>
 <span class="s0">*/</span>

<span class="s0">#pragma once</span>

<span class="s0">#include &lt;ReactCommon/JavaTurboModule.h&gt;</span>
<span class="s0">#include &lt;ReactCommon/TurboModule.h&gt;</span>
<span class="s0">#include &lt;jsi/jsi.h&gt;</span>

<span class="s0">namespace facebook {</span>
<span class="s0">namespace react {</span>

<span class="s0">${modules}</span>

<span class="s0">JSI_EXPORT</span>
<span class="s0">std::shared_ptr&lt;TurboModule&gt; ${libraryName}_ModuleProvider(const std::string &amp;moduleName, const JavaTurboModule::InitParams &amp;params);</span>

<span class="s0">} // namespace react</span>
<span class="s0">} // namespace facebook</span>
<span class="s0">`;</span>
<span class="s0">};</span>

<span class="s0">// Note: this CMakeLists.txt template includes dependencies for both NativeModule and components.</span>
<span class="s0">const CMakeListsTemplate = ({</span>
  <span class="s0">libraryName,</span>
<span class="s0">}: $ReadOnly&lt;{libraryName: string}&gt;) =&gt; {</span>
  <span class="s0">return `# Copyright (c) Meta Platforms, Inc. and affiliates.</span>
<span class="s0">#</span>
<span class="s0"># This source code is licensed under the MIT license found in the</span>
<span class="s0"># LICENSE file in the root directory of this source tree.</span>

<span class="s0">cmake_minimum_required(VERSION 3.13)</span>
<span class="s0">set(CMAKE_VERBOSE_MAKEFILE on)</span>

<span class="s0">file(GLOB react_codegen_SRCS CONFIGURE_DEPENDS *.cpp react/renderer/components/${libraryName}/*.cpp)</span>

<span class="s0">add_library(</span>
  <span class="s0">react_codegen_${libraryName}</span>
  <span class="s0">SHARED</span>
  <span class="s0">\${react_codegen_SRCS}</span>
<span class="s0">)</span>

<span class="s0">target_include_directories(react_codegen_${libraryName} PUBLIC . react/renderer/components/${libraryName})</span>

<span class="s0">target_link_libraries(</span>
  <span class="s0">react_codegen_${libraryName}</span>
  <span class="s0">fbjni</span>
  <span class="s0">folly_runtime</span>
  <span class="s0">glog</span>
  <span class="s0">jsi</span>
  <span class="s0">${libraryName !== 'rncore' ? 'react_codegen_rncore' : ''}</span>
  <span class="s0">react_debug</span>
  <span class="s0">react_nativemodule_core</span>
  <span class="s0">react_render_core</span>
  <span class="s0">react_render_debug</span>
  <span class="s0">react_render_graphics</span>
  <span class="s0">react_render_imagemanager</span>
  <span class="s0">rrc_image</span>
  <span class="s0">rrc_view</span>
  <span class="s0">turbomodulejsijni</span>
  <span class="s0">yoga</span>
<span class="s0">)</span>

<span class="s0">target_compile_options(</span>
  <span class="s0">react_codegen_${libraryName}</span>
  <span class="s0">PRIVATE</span>
  <span class="s0">-DLOG_TAG=\\&quot;ReactNative\\&quot;</span>
  <span class="s0">-fexceptions</span>
  <span class="s0">-frtti</span>
  <span class="s0">-std=c++17</span>
  <span class="s0">-Wall</span>
<span class="s0">)</span>
<span class="s0">`;</span>
<span class="s0">};</span>

<span class="s0">module.exports = {</span>
  <span class="s0">generate(</span>
    <span class="s0">libraryName: string,</span>
    <span class="s0">schema: SchemaType,</span>
    <span class="s0">packageName?: string,</span>
    <span class="s0">assumeNonnull: boolean = false,</span>
  <span class="s0">): FilesOutput {</span>
    <span class="s0">const nativeModules = getModules(schema);</span>
    <span class="s0">const modules = Object.keys(nativeModules)</span>
      <span class="s0">.filter(hasteModuleName =&gt; {</span>
        <span class="s0">const module = nativeModules[hasteModuleName];</span>
        <span class="s0">return !(</span>
          <span class="s0">module.excludedPlatforms != null &amp;&amp;</span>
          <span class="s0">module.excludedPlatforms.includes('android')</span>
        <span class="s0">);</span>
      <span class="s0">})</span>
      <span class="s0">.sort()</span>
      <span class="s0">.map(hasteModuleName =&gt; ModuleClassDeclarationTemplate({hasteModuleName}))</span>
      <span class="s0">.join('\n');</span>

    <span class="s0">const fileName = `${libraryName}.h`;</span>
    <span class="s0">const replacedTemplate = HeaderFileTemplate({</span>
      <span class="s0">modules: modules,</span>
      <span class="s0">libraryName: libraryName.replace(/-/g, '_'),</span>
    <span class="s0">});</span>
    <span class="s0">return new Map([</span>
      <span class="s0">[`jni/${fileName}`, replacedTemplate],</span>
      <span class="s0">['jni/CMakeLists.txt', CMakeListsTemplate({libraryName: libraryName})],</span>
    <span class="s0">]);</span>
  <span class="s0">},</span>
<span class="s0">};</span>
</pre>
</body>
</html>