<html>
<head>
<title>createMessageSocketEndpoint.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #6a8759;}
.s2 { color: #6897bb; font-style: italic;}
.s3 { color: #cc7832; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
createMessageSocketEndpoint.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;PROTOCOL_VERSION&quot;</span><span class="s0">,</span><span class="s1">&quot;parseMessage&quot;</span><span class="s0">,</span><span class="s1">&quot;data&quot;</span><span class="s0">,</span><span class="s1">&quot;binary&quot;</span><span class="s0">,</span><span class="s1">&quot;logger&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;message&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;version&quot;</span><span class="s0">,</span><span class="s1">&quot;e&quot;</span><span class="s0">,</span><span class="s1">&quot;isBroadcast&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;id&quot;</span><span class="s0">,</span><span class="s1">&quot;target&quot;</span><span class="s0">,</span><span class="s1">&quot;isRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;isResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;requestId&quot;</span><span class="s0">,</span><span class="s1">&quot;clientId&quot;</span><span class="s0">,</span><span class="s1">&quot;result&quot;</span><span class="s0">,</span><span class="s1">&quot;createMessageSocketEndpoint&quot;</span><span class="s0">,</span><span class="s1">&quot;wss&quot;</span><span class="s0">,</span><span class="s1">&quot;WebSocketServer&quot;</span><span class="s0">,</span><span class="s1">&quot;noServer&quot;</span><span class="s0">,</span><span class="s1">&quot;clients&quot;</span><span class="s0">,</span><span class="s1">&quot;Map&quot;</span><span class="s0">,</span><span class="s1">&quot;nextClientId&quot;</span><span class="s0">,</span><span class="s1">&quot;getClientWs&quot;</span><span class="s0">,</span><span class="s1">&quot;clientWs&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;handleSendBroadcast&quot;</span><span class="s0">,</span><span class="s1">&quot;broadcasterId&quot;</span><span class="s0">,</span><span class="s1">&quot;forwarded&quot;</span><span class="s0">,</span><span class="s1">&quot;params&quot;</span><span class="s0">,</span><span class="s1">&quot;size&quot;</span><span class="s0">,</span><span class="s1">&quot;warn&quot;</span><span class="s0">,</span><span class="s1">&quot;otherId&quot;</span><span class="s0">,</span><span class="s1">&quot;otherWs&quot;</span><span class="s0">,</span><span class="s1">&quot;send&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;toString&quot;</span><span class="s0">,</span><span class="s1">&quot;on&quot;</span><span class="s0">,</span><span class="s1">&quot;handleCaughtError&quot;</span><span class="s0">,</span><span class="s1">&quot;errorMessage&quot;</span><span class="s0">,</span><span class="s1">&quot;handleServerRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;forEach&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;upgradeReq&quot;</span><span class="s0">,</span><span class="s1">&quot;query&quot;</span><span class="s0">,</span><span class="s1">&quot;forwardRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;forwardResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;onCloseHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;onmessage&quot;</span><span class="s0">,</span><span class="s1">&quot;delete&quot;</span><span class="s0">,</span><span class="s1">&quot;onclose&quot;</span><span class="s0">,</span><span class="s1">&quot;onerror&quot;</span><span class="s0">,</span><span class="s1">&quot;event&quot;</span><span class="s0">,</span><span class="s1">&quot;server&quot;</span><span class="s0">,</span><span class="s1">&quot;broadcast&quot;</span><span class="s0">],</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/websocket/createMessageSocketEndpoint.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;/**</span><span class="s3">\n </span><span class="s1">* Copyright (c) Facebook, Inc. and its affiliates.</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">* This source code is licensed under the MIT license found in the</span><span class="s3">\n </span><span class="s1">* LICENSE file in the root directory of this source tree.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">import url from 'url';</span><span class="s3">\n</span><span class="s1">import {Server as WebSocketServer} from 'ws';</span><span class="s3">\n</span><span class="s1">import {logger} from '@react-native-community/cli-tools';</span><span class="s3">\n\n</span><span class="s1">const PROTOCOL_VERSION = 2;</span><span class="s3">\n\n</span><span class="s1">type IdObject = {</span><span class="s3">\n  </span><span class="s1">requestId: string;</span><span class="s3">\n  </span><span class="s1">clientId: string;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">type Message = {</span><span class="s3">\n  </span><span class="s1">version?: string;</span><span class="s3">\n  </span><span class="s1">id?: IdObject;</span><span class="s3">\n  </span><span class="s1">method?: string;</span><span class="s3">\n  </span><span class="s1">target: string;</span><span class="s3">\n  </span><span class="s1">result?: any;</span><span class="s3">\n  </span><span class="s1">error?: Error;</span><span class="s3">\n  </span><span class="s1">params?: Record&lt;string, any&gt;;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">function parseMessage(data: string, binary: any) {</span><span class="s3">\n  </span><span class="s1">if (binary) {</span><span class="s3">\n    </span><span class="s1">logger.error('Expected text message, got binary!');</span><span class="s3">\n    </span><span class="s1">return undefined;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">const message = JSON.parse(data);</span><span class="s3">\n    </span><span class="s1">if (message.version === PROTOCOL_VERSION) {</span><span class="s3">\n      </span><span class="s1">return message;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">logger.error(</span><span class="s3">\n      </span><span class="s1">`Received message had wrong protocol version: ${message.version}`,</span><span class="s3">\n    </span><span class="s1">);</span><span class="s3">\n  </span><span class="s1">} catch (e) {</span><span class="s3">\n    </span><span class="s1">logger.error(`Failed to parse the message as JSON:</span><span class="s3">\\</span><span class="s1">n${data}`);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return undefined;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function isBroadcast(message: Message) {</span><span class="s3">\n  </span><span class="s1">return (</span><span class="s3">\n    </span><span class="s1">typeof message.method === 'string' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">message.id === undefined &amp;&amp;</span><span class="s3">\n    </span><span class="s1">message.target === undefined</span><span class="s3">\n  </span><span class="s1">);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function isRequest(message: Message) {</span><span class="s3">\n  </span><span class="s1">return (</span><span class="s3">\n    </span><span class="s1">typeof message.method === 'string' &amp;&amp; typeof message.target === 'string'</span><span class="s3">\n  </span><span class="s1">);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function isResponse(message: Message) {</span><span class="s3">\n  </span><span class="s1">return (</span><span class="s3">\n    </span><span class="s1">typeof message.id === 'object' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">typeof message.id.requestId !== 'undefined' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">typeof message.id.clientId === 'string' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">(message.result !== undefined || message.error !== undefined)</span><span class="s3">\n  </span><span class="s1">);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default function createMessageSocketEndpoint(): {</span><span class="s3">\n  </span><span class="s1">server: WebSocketServer;</span><span class="s3">\n  </span><span class="s1">broadcast: (method: string, params?: Record&lt;string, any&gt;) =&gt; void;</span><span class="s3">\n</span><span class="s1">} {</span><span class="s3">\n  </span><span class="s1">const wss = new WebSocketServer({</span><span class="s3">\n    </span><span class="s1">noServer: true,</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n  </span><span class="s1">const clients = new Map();</span><span class="s3">\n  </span><span class="s1">let nextClientId = 0;</span><span class="s3">\n\n  </span><span class="s1">function getClientWs(clientId: string) {</span><span class="s3">\n    </span><span class="s1">const clientWs = clients.get(clientId);</span><span class="s3">\n    </span><span class="s1">if (clientWs === undefined) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">`could not find id </span><span class="s3">\&quot;</span><span class="s1">${clientId}</span><span class="s3">\&quot; </span><span class="s1">while forwarding request`,</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return clientWs;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">function handleSendBroadcast(</span><span class="s3">\n    </span><span class="s1">broadcasterId: string | null,</span><span class="s3">\n    </span><span class="s1">message: Partial&lt;Message&gt;,</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">const forwarded = {</span><span class="s3">\n      </span><span class="s1">version: PROTOCOL_VERSION,</span><span class="s3">\n      </span><span class="s1">method: message.method,</span><span class="s3">\n      </span><span class="s1">params: message.params,</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">if (clients.size === 0) {</span><span class="s3">\n      </span><span class="s1">logger.warn(</span><span class="s3">\n        </span><span class="s1">`No apps connected. Sending </span><span class="s3">\&quot;</span><span class="s1">${message.method}</span><span class="s3">\&quot; </span><span class="s1">to all React Native apps failed. Make sure your app is running in the simulator or on a phone connected via USB.`,</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">for (const [otherId, otherWs] of clients) {</span><span class="s3">\n      </span><span class="s1">if (otherId !== broadcasterId) {</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n          </span><span class="s1">otherWs.send(JSON.stringify(forwarded));</span><span class="s3">\n        </span><span class="s1">} catch (e) {</span><span class="s3">\n          </span><span class="s1">logger.error(</span><span class="s3">\n            </span><span class="s1">`Failed to send broadcast to client: '${otherId}' ` +</span><span class="s3">\n              </span><span class="s1">`due to:</span><span class="s3">\\</span><span class="s1">n ${(e as any).toString()}`,</span><span class="s3">\n          </span><span class="s1">);</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">wss.on('connection', (clientWs) =&gt; {</span><span class="s3">\n    </span><span class="s1">const clientId = `client#${nextClientId++}`;</span><span class="s3">\n\n    </span><span class="s1">function handleCaughtError(message: Message, error: Error) {</span><span class="s3">\n      </span><span class="s1">const errorMessage = {</span><span class="s3">\n        </span><span class="s1">id: message.id,</span><span class="s3">\n        </span><span class="s1">method: message.method,</span><span class="s3">\n        </span><span class="s1">target: message.target,</span><span class="s3">\n        </span><span class="s1">error: message.error === undefined ? 'undefined' : 'defined',</span><span class="s3">\n        </span><span class="s1">params: message.params === undefined ? 'undefined' : 'defined',</span><span class="s3">\n        </span><span class="s1">result: message.result === undefined ? 'undefined' : 'defined',</span><span class="s3">\n      </span><span class="s1">};</span><span class="s3">\n\n      </span><span class="s1">if (message.id === undefined) {</span><span class="s3">\n        </span><span class="s1">logger.error(</span><span class="s3">\n          </span><span class="s1">`Handling message from ${clientId} failed with:</span><span class="s3">\\</span><span class="s1">n${error}</span><span class="s3">\\</span><span class="s1">n` +</span><span class="s3">\n            </span><span class="s1">`message:</span><span class="s3">\\</span><span class="s1">n${JSON.stringify(errorMessage)}`,</span><span class="s3">\n        </span><span class="s1">);</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n          </span><span class="s1">clientWs.send(</span><span class="s3">\n            </span><span class="s1">JSON.stringify({</span><span class="s3">\n              </span><span class="s1">version: PROTOCOL_VERSION,</span><span class="s3">\n              </span><span class="s1">error,</span><span class="s3">\n              </span><span class="s1">id: message.id,</span><span class="s3">\n            </span><span class="s1">}),</span><span class="s3">\n          </span><span class="s1">);</span><span class="s3">\n        </span><span class="s1">} catch (e) {</span><span class="s3">\n          </span><span class="s1">logger.error(</span><span class="s3">\n            </span><span class="s1">`Failed to reply to ${clientId} with error:</span><span class="s3">\\</span><span class="s1">n${error}` +</span><span class="s3">\n              </span><span class="s1">`</span><span class="s3">\\</span><span class="s1">nmessage:</span><span class="s3">\\</span><span class="s1">n${JSON.stringify(errorMessage)}` +</span><span class="s3">\n              </span><span class="s1">`</span><span class="s3">\\</span><span class="s1">ndue to error: ${(e as any).toString()}`,</span><span class="s3">\n          </span><span class="s1">);</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">function handleServerRequest(message: Message) {</span><span class="s3">\n      </span><span class="s1">let result = null;</span><span class="s3">\n      </span><span class="s1">switch (message.method) {</span><span class="s3">\n        </span><span class="s1">case 'getid':</span><span class="s3">\n          </span><span class="s1">result = clientId;</span><span class="s3">\n          </span><span class="s1">break;</span><span class="s3">\n        </span><span class="s1">case 'getpeers':</span><span class="s3">\n          </span><span class="s1">result = {};</span><span class="s3">\n          </span><span class="s1">clients.forEach((otherWs, otherId) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (clientId !== otherId) {</span><span class="s3">\n              </span><span class="s1">result[otherId] = url.parse(otherWs.upgradeReq.url, true).query;</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">});</span><span class="s3">\n          </span><span class="s1">break;</span><span class="s3">\n        </span><span class="s1">default:</span><span class="s3">\n          </span><span class="s1">throw new Error(`unknown method: ${message.method}`);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">clientWs.send(</span><span class="s3">\n        </span><span class="s1">JSON.stringify({</span><span class="s3">\n          </span><span class="s1">version: PROTOCOL_VERSION,</span><span class="s3">\n          </span><span class="s1">result,</span><span class="s3">\n          </span><span class="s1">id: message.id,</span><span class="s3">\n        </span><span class="s1">}),</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">function forwardRequest(message: Message) {</span><span class="s3">\n      </span><span class="s1">getClientWs(message.target).send(</span><span class="s3">\n        </span><span class="s1">JSON.stringify({</span><span class="s3">\n          </span><span class="s1">version: PROTOCOL_VERSION,</span><span class="s3">\n          </span><span class="s1">method: message.method,</span><span class="s3">\n          </span><span class="s1">params: message.params,</span><span class="s3">\n          </span><span class="s1">id:</span><span class="s3">\n            </span><span class="s1">message.id === undefined</span><span class="s3">\n              </span><span class="s1">? undefined</span><span class="s3">\n              </span><span class="s1">: {requestId: message.id, clientId},</span><span class="s3">\n        </span><span class="s1">}),</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">function forwardResponse(message: Message) {</span><span class="s3">\n      </span><span class="s1">if (!message.id) {</span><span class="s3">\n        </span><span class="s1">return;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">getClientWs(message.id.clientId).send(</span><span class="s3">\n        </span><span class="s1">JSON.stringify({</span><span class="s3">\n          </span><span class="s1">version: PROTOCOL_VERSION,</span><span class="s3">\n          </span><span class="s1">result: message.result,</span><span class="s3">\n          </span><span class="s1">error: message.error,</span><span class="s3">\n          </span><span class="s1">id: message.id.requestId,</span><span class="s3">\n        </span><span class="s1">}),</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">clients.set(clientId, clientWs);</span><span class="s3">\n    </span><span class="s1">const onCloseHandler = () =&gt; {</span><span class="s3">\n      </span><span class="s1">clientWs.onmessage = () =&gt; {};</span><span class="s3">\n      </span><span class="s1">clients.delete(clientId);</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">clientWs.onclose = onCloseHandler;</span><span class="s3">\n    </span><span class="s1">clientWs.onerror = onCloseHandler;</span><span class="s3">\n    </span><span class="s1">clientWs.onmessage = (event: any) =&gt; {</span><span class="s3">\n      </span><span class="s1">const message = parseMessage(event.data, event.binary);</span><span class="s3">\n      </span><span class="s1">if (message === undefined) {</span><span class="s3">\n        </span><span class="s1">logger.error('Received message not matching protocol');</span><span class="s3">\n        </span><span class="s1">return;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">if (isBroadcast(message)) {</span><span class="s3">\n          </span><span class="s1">handleSendBroadcast(clientId, message);</span><span class="s3">\n        </span><span class="s1">} else if (isRequest(message)) {</span><span class="s3">\n          </span><span class="s1">if (message.target === 'server') {</span><span class="s3">\n            </span><span class="s1">handleServerRequest(message);</span><span class="s3">\n          </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">forwardRequest(message);</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">} else if (isResponse(message)) {</span><span class="s3">\n          </span><span class="s1">forwardResponse(message);</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n          </span><span class="s1">throw new Error('Invalid message, did not match the protocol');</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">} catch (e) {</span><span class="s3">\n        </span><span class="s1">handleCaughtError(message, (e as any).toString());</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">};</span><span class="s3">\n  </span><span class="s1">});</span><span class="s3">\n\n  </span><span class="s1">return {</span><span class="s3">\n    </span><span class="s1">server: wss,</span><span class="s3">\n    </span><span class="s1">broadcast: (method: string, params?: Record&lt;string, any&gt;) =&gt; {</span><span class="s3">\n      </span><span class="s1">handleSendBroadcast(null, {method, params});</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">}</span></pre>
</body>
</html>