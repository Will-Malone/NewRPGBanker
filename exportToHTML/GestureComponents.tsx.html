<html>
<head>
<title>GestureComponents.tsx</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #9876aa; font-style: italic;}
.s3 { color: #a9b7c6;}
.s4 { color: #6a8759;}
.s5 { color: #ffc66d;}
.s6 { color: #808080;}
.s7 { color: #a9b7c6;}
.s8 { color: #e8bf6a;}
.s9 { color: #bbb529;}
.s10 { color: #d0d0ff;}
.s11 { color: #bbb529;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
GestureComponents.tsx</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s2">* </span><span class="s0">as </span><span class="s3">React </span><span class="s0">from </span><span class="s4">'react'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{</span>
  <span class="s3">PropsWithChildren</span><span class="s1">,</span>
  <span class="s3">ForwardedRef</span><span class="s1">,</span>
  <span class="s3">RefAttributes</span><span class="s1">,</span>
  <span class="s3">ReactElement</span><span class="s1">,</span>
<span class="s1">} </span><span class="s0">from </span><span class="s4">'react'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{</span>
  <span class="s3">ScrollView </span><span class="s0">as </span><span class="s3">RNScrollView</span><span class="s1">,</span>
  <span class="s3">ScrollViewProps </span><span class="s0">as </span><span class="s3">RNScrollViewProps</span><span class="s1">,</span>
  <span class="s3">Switch </span><span class="s0">as </span><span class="s3">RNSwitch</span><span class="s1">,</span>
  <span class="s3">SwitchProps </span><span class="s0">as </span><span class="s3">RNSwitchProps</span><span class="s1">,</span>
  <span class="s3">TextInput </span><span class="s0">as </span><span class="s3">RNTextInput</span><span class="s1">,</span>
  <span class="s3">TextInputProps </span><span class="s0">as </span><span class="s3">RNTextInputProps</span><span class="s1">,</span>
  <span class="s3">DrawerLayoutAndroid </span><span class="s0">as </span><span class="s3">RNDrawerLayoutAndroid</span><span class="s1">,</span>
  <span class="s3">DrawerLayoutAndroidProps </span><span class="s0">as </span><span class="s3">RNDrawerLayoutAndroidProps</span><span class="s1">,</span>
  <span class="s3">FlatList </span><span class="s0">as </span><span class="s3">RNFlatList</span><span class="s1">,</span>
  <span class="s3">FlatListProps </span><span class="s0">as </span><span class="s3">RNFlatListProps</span><span class="s1">,</span>
  <span class="s3">RefreshControl </span><span class="s0">as </span><span class="s3">RNRefreshControl</span><span class="s1">,</span>
<span class="s1">} </span><span class="s0">from </span><span class="s4">'react-native'</span><span class="s1">;</span>

<span class="s0">import </span><span class="s3">createNativeWrapper </span><span class="s0">from </span><span class="s4">'../handlers/createNativeWrapper'</span><span class="s1">;</span>

<span class="s0">import </span><span class="s1">{</span>
  <span class="s3">NativeViewGestureHandlerProps</span><span class="s1">,</span>
  <span class="s3">nativeViewProps</span><span class="s1">,</span>
<span class="s1">} </span><span class="s0">from </span><span class="s4">'../handlers/NativeViewGestureHandler'</span><span class="s1">;</span>

<span class="s0">import </span><span class="s1">{ </span><span class="s3">toArray </span><span class="s1">} </span><span class="s0">from </span><span class="s4">'../utils'</span><span class="s1">;</span>

<span class="s0">export const </span><span class="s1">RefreshControl </span><span class="s0">= </span><span class="s5">createNativeWrapper</span><span class="s1">(</span><span class="s3">RNRefreshControl</span><span class="s1">, {</span>
  <span class="s1">disallowInterruption: </span><span class="s2">true</span><span class="s1">,</span>
  <span class="s1">shouldCancelWhenOutside: </span><span class="s2">false</span><span class="s1">,</span>
<span class="s1">});</span>
<span class="s6">// eslint-disable-next-line @typescript-eslint/no-redeclare</span>
<span class="s0">export type </span><span class="s3">RefreshControl </span><span class="s0">= typeof </span><span class="s3">RefreshControl </span><span class="s0">&amp; </span><span class="s3">RNRefreshControl</span><span class="s1">;</span>

<span class="s0">const </span><span class="s1">GHScrollView </span><span class="s0">= </span><span class="s5">createNativeWrapper</span><span class="s1">&lt;</span><span class="s3">PropsWithChildren</span><span class="s1">&lt;</span><span class="s3">RNScrollViewProps</span><span class="s1">&gt;&gt;(</span>
  <span class="s3">RNScrollView</span><span class="s1">,</span>
  <span class="s1">{</span>
    <span class="s1">disallowInterruption: </span><span class="s2">true</span><span class="s1">,</span>
    <span class="s1">shouldCancelWhenOutside: </span><span class="s2">false</span><span class="s1">,</span>
  <span class="s1">}</span>
<span class="s1">);</span>
<span class="s0">export const </span><span class="s1">ScrollView </span><span class="s0">= </span><span class="s3">React</span><span class="s1">.</span><span class="s3">forwardRef</span><span class="s0">&lt;</span>
  <span class="s3">RNScrollView</span><span class="s1">,</span>
  <span class="s3">RNScrollViewProps </span><span class="s0">&amp; </span><span class="s3">NativeViewGestureHandlerProps</span>
<span class="s0">&gt;</span><span class="s1">((</span><span class="s3">props</span><span class="s1">, </span><span class="s3">ref</span><span class="s1">) </span><span class="s0">=&gt; </span><span class="s1">{</span>
  <span class="s0">const </span><span class="s1">refreshControlGestureRef </span><span class="s0">= </span><span class="s3">React</span><span class="s1">.</span><span class="s5">useRef</span><span class="s1">&lt;</span><span class="s3">RefreshControl</span><span class="s1">&gt;(</span><span class="s2">null</span><span class="s1">);</span>
  <span class="s0">const </span><span class="s1">{ refreshControl, waitFor, </span><span class="s0">...</span><span class="s1">rest } </span><span class="s0">= </span><span class="s3">props</span><span class="s1">;</span>

  <span class="s0">return </span><span class="s1">(</span>
    <span class="s7">&lt;</span><span class="s8">GHScrollView</span>
      <span class="s9">{</span><span class="s0">...</span><span class="s3">rest</span><span class="s9">}</span>
      <span class="s6">// @ts-ignore `ref` exists on `GHScrollView`</span>
      <span class="s10">ref</span><span class="s0">=</span><span class="s9">{</span><span class="s3">ref</span><span class="s9">}</span>
      <span class="s10">waitFor</span><span class="s0">=</span><span class="s9">{[</span><span class="s0">...</span><span class="s5">toArray</span><span class="s9">(</span><span class="s3">waitFor </span><span class="s0">?? </span><span class="s9">[]), </span><span class="s3">refreshControlGestureRef</span><span class="s9">]}</span>
      <span class="s6">// @ts-ignore we don't pass `refreshing` prop as we only want to override the ref</span>
      <span class="s10">refreshControl</span><span class="s0">=</span><span class="s9">{</span>
        <span class="s3">refreshControl</span>
          <span class="s0">? </span><span class="s3">React</span><span class="s9">.</span><span class="s5">cloneElement</span><span class="s9">(</span><span class="s3">refreshControl</span><span class="s9">, {</span>
              <span class="s6">// @ts-ignore for reasons unknown to me, `ref` doesn't exist on the type inferred by TS</span>
              <span class="s9">ref: </span><span class="s3">refreshControlGestureRef</span><span class="s9">,</span>
            <span class="s9">})</span>
          <span class="s0">: </span><span class="s2">undefined</span>
      <span class="s9">}</span>
    <span class="s9">/&gt; 
  ); 
}); 
// backward type compatibility with https://github.com/software-mansion/react-native-gesture-handler/blob/db78d3ca7d48e8ba57482d3fe9b0a15aa79d9932/react-native-gesture-handler.d.ts#L440-L457 
// include methods of wrapped components by creating an intersection type with the RN component instead of duplicating them. 
// eslint-disable-next-line @typescript-eslint/no-redeclare 
export type ScrollView = typeof GHScrollView &amp; RNScrollView; 
</span>
<span class="s9">export const Switch = createNativeWrapper</span><span class="s7">&lt;</span><span class="s8">RNSwitchProps</span><span class="s7">&gt;</span><span class="s9">(RNSwitch, {</span>
  <span class="s3">shouldCancelWhenOutside</span><span class="s9">: </span><span class="s2">false</span><span class="s9">,</span>
  <span class="s3">shouldActivateOnStart</span><span class="s9">: </span><span class="s2">true</span><span class="s9">,</span>
  <span class="s3">disallowInterruption</span><span class="s9">: </span><span class="s2">true</span><span class="s9">,</span>
<span class="s9">}); 
// eslint-disable-next-line @typescript-eslint/no-redeclare 
export type Switch = typeof Switch </span><span class="s11">&amp; </span><span class="s9">RNSwitch; 
</span>
<span class="s9">export const TextInput = createNativeWrapper</span><span class="s7">&lt;</span><span class="s8">RNTextInputProps</span><span class="s7">&gt;</span><span class="s9">(RNTextInput); 
// eslint-disable-next-line @typescript-eslint/no-redeclare 
export type TextInput = typeof TextInput </span><span class="s11">&amp; </span><span class="s9">RNTextInput; 
</span>
<span class="s9">export const DrawerLayoutAndroid = createNativeWrapper&lt; 
  PropsWithChildren</span><span class="s7">&lt;</span><span class="s8">RNDrawerLayoutAndroidProps</span><span class="s7">&gt;</span>
<span class="s9">&gt;(RNDrawerLayoutAndroid, { </span><span class="s3">disallowInterruption</span><span class="s9">: </span><span class="s2">true </span><span class="s9">}); 
// eslint-disable-next-line @typescript-eslint/no-redeclare 
export type DrawerLayoutAndroid = typeof DrawerLayoutAndroid </span><span class="s11">&amp;</span>
  <span class="s9">RNDrawerLayoutAndroid; 
</span>
<span class="s9">export const FlatList = React.forwardRef((props, ref) =&gt; {</span>
  <span class="s3">const refreshControlGestureRef </span><span class="s0">= </span><span class="s3">React</span><span class="s9">.</span><span class="s5">useRef</span><span class="s9">&lt;</span><span class="s3">RefreshControl</span><span class="s9">&gt;(</span><span class="s2">null</span><span class="s9">); 
</span>
  <span class="s3">const </span><span class="s9">{ </span><span class="s3">waitFor</span><span class="s9">, </span><span class="s3">refreshControl</span><span class="s9">, </span><span class="s0">...</span><span class="s3">rest </span><span class="s9">} </span><span class="s0">= </span><span class="s3">props</span><span class="s9">; 
</span>
  <span class="s3">const flatListProps </span><span class="s0">= </span><span class="s9">{}; 
  </span><span class="s3">const scrollViewProps </span><span class="s0">= </span><span class="s9">{}; 
  </span><span class="s5">for </span><span class="s9">(</span><span class="s3">const </span><span class="s9">[</span><span class="s3">propName</span><span class="s9">, </span><span class="s3">value</span><span class="s9">] </span><span class="s0">of </span><span class="s3">Object</span><span class="s9">.</span><span class="s5">entries</span><span class="s9">(</span><span class="s3">rest</span><span class="s9">)) {</span>
    <span class="s6">// https://github.com/microsoft/TypeScript/issues/26255</span>
    <span class="s9">if ((</span><span class="s3">nativeViewProps as </span><span class="s0">readonly </span><span class="s3">string</span><span class="s9">[]).includes(</span><span class="s3">propName</span><span class="s9">)) {</span>
      <span class="s6">// @ts-ignore - this function cannot have generic type so we have to ignore this error</span>
      <span class="s6">// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment</span>
      <span class="s3">scrollViewProps</span><span class="s9">[</span><span class="s3">propName</span><span class="s9">] </span><span class="s0">= </span><span class="s3">value</span><span class="s9">;</span>
    <span class="s9">} else { 
      </span><span class="s6">// @ts-ignore - this function cannot have generic type so we have to ignore this error</span>
      <span class="s6">// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment</span>
      <span class="s9">flatListProps[</span><span class="s3">propName</span><span class="s9">] = value; 
    } 
  } 
</span>
  <span class="s9">return ( 
    </span><span class="s6">// @ts-ignore - this function cannot have generic type so we have to ignore this error</span>
    <span class="s9">&lt;RNFlatList 
      ref={ref} 
      {...flatListProps} 
      renderScrollComponent={(scrollProps) =&gt; ( 
        &lt;ScrollView 
          {...{ 
            ...scrollProps, 
            ...scrollViewProps, 
            waitFor: [</span><span class="s0">...</span><span class="s5">toArray</span><span class="s9">(</span><span class="s3">waitFor </span><span class="s0">?? </span><span class="s9">[]), </span><span class="s3">refreshControlGestureRef</span><span class="s9">],</span>
          <span class="s9">}}</span>
        <span class="s9">/&gt; 
      )} 
      // @ts-ignore we don't pass `refreshing` prop as we only want to override the ref 
      refreshControl={</span>
        <span class="s3">refreshControl</span>
          <span class="s0">? </span><span class="s3">React</span><span class="s9">.</span><span class="s5">cloneElement</span><span class="s9">(</span><span class="s3">refreshControl</span><span class="s9">, {</span>
              <span class="s6">// @ts-ignore for reasons unknown to me, `ref` doesn't exist on the type inferred by TS</span>
              <span class="s9">ref: </span><span class="s3">refreshControlGestureRef</span><span class="s9">,</span>
            <span class="s9">})</span>
          <span class="s0">: </span><span class="s2">undefined</span>
      <span class="s9">}</span>
    <span class="s9">/&gt; 
  ); 
}) as </span><span class="s7">&lt;</span><span class="s8">ItemT </span><span class="s11">= </span><span class="s10">any</span><span class="s7">&gt;</span><span class="s9">( 
  props: PropsWithChildren&lt; 
    RNFlatListProps</span><span class="s7">&lt;</span><span class="s8">ItemT</span><span class="s7">&gt; </span><span class="s11">&amp;</span>
      <span class="s9">RefAttributes</span><span class="s7">&lt;</span><span class="s8">FlatList</span><span class="s9">&lt;</span><span class="s3">ItemT</span><span class="s9">&gt;</span><span class="s7">&gt; </span><span class="s11">&amp;</span>
      <span class="s9">NativeViewGestureHandlerProps 
  &gt;, 
  ref: ForwardedRef</span><span class="s7">&lt;</span><span class="s8">FlatList</span><span class="s9">&lt;</span><span class="s3">ItemT</span><span class="s9">&gt;</span><span class="s7">&gt;</span>
<span class="s9">) =&gt; ReactElement | null; 
// eslint-disable-next-line @typescript-eslint/no-redeclare 
export type FlatList</span><span class="s7">&lt;</span><span class="s8">ItemT </span><span class="s11">= </span><span class="s10">any</span><span class="s7">&gt; </span><span class="s9">= typeof FlatList </span><span class="s11">&amp; </span><span class="s9">RNFlatList</span><span class="s7">&lt;</span><span class="s8">ItemT</span><span class="s7">&gt;</span><span class="s9">; 
</span></pre>
</body>
</html>