<html>
<head>
<title>executeWinCommand.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #6a8759;}
.s2 { color: #6897bb; font-style: italic;}
.s3 { color: #cc7832; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
executeWinCommand.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;runElevated&quot;</span><span class="s0">,</span><span class="s1">&quot;command&quot;</span><span class="s0">,</span><span class="s1">&quot;script&quot;</span><span class="s0">,</span><span class="s1">&quot;elevatedPath&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;tmpdir&quot;</span><span class="s0">,</span><span class="s1">&quot;Math&quot;</span><span class="s0">,</span><span class="s1">&quot;random&quot;</span><span class="s0">,</span><span class="s1">&quot;writeFileSync&quot;</span><span class="s0">,</span><span class="s1">&quot;execa&quot;</span><span class="s0">,</span><span class="s1">&quot;groupArgs&quot;</span><span class="s0">,</span><span class="s1">&quot;args&quot;</span><span class="s0">,</span><span class="s1">&quot;isStringArgument&quot;</span><span class="s0">,</span><span class="s1">&quot;newArgs&quot;</span><span class="s0">,</span><span class="s1">&quot;reduce&quot;</span><span class="s0">,</span><span class="s1">&quot;acum&quot;</span><span class="s0">,</span><span class="s1">&quot;current&quot;</span><span class="s0">,</span><span class="s1">&quot;last&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;endsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;replace&quot;</span><span class="s0">,</span><span class="s1">&quot;executeShellCommand&quot;</span><span class="s0">,</span><span class="s1">&quot;elevated&quot;</span><span class="s0">,</span><span class="s1">&quot;split&quot;</span><span class="s0">,</span><span class="s1">&quot;program&quot;</span><span class="s0">,</span><span class="s1">&quot;shift&quot;</span><span class="s0">,</span><span class="s1">&quot;shell&quot;</span><span class="s0">],</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/tools/windows/executeWinCommand.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import {writeFileSync} from 'fs';</span><span class="s3">\n</span><span class="s1">import {tmpdir} from 'os';</span><span class="s3">\n</span><span class="s1">import {join} from 'path';</span><span class="s3">\n\n</span><span class="s1">import execa from 'execa';</span><span class="s3">\n\n</span><span class="s1">/** Runs a command requestion permission to run elevated. */</span><span class="s3">\n</span><span class="s1">const runElevated = (command: string) =&gt; {</span><span class="s3">\n  </span><span class="s1">// TODO: escape double quotes in args</span><span class="s3">\n  </span><span class="s1">// https://www.winhelponline.com/blog/vbscripts-and-uac-elevation/</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Need to use a couple of intermediary files to make this work as</span><span class="s3">\n   </span><span class="s1">* `ShellExecute` only accepts a command so</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n\n  </span><span class="s1">// prettier-ignore</span><span class="s3">\n  </span><span class="s1">const script =</span><span class="s3">\n</span><span class="s1">`If WScript.Arguments.length = 0 Then</span><span class="s3">\n  </span><span class="s1">Set objShell = CreateObject(</span><span class="s3">\&quot;</span><span class="s1">Shell.Application</span><span class="s3">\&quot;</span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">'Pass a bogus argument, say [ uac]</span><span class="s3">\n  </span><span class="s1">objShell.ShellExecute </span><span class="s3">\&quot;</span><span class="s1">wscript.exe</span><span class="s3">\&quot;</span><span class="s1">, Chr(34) &amp; _</span><span class="s3">\n    </span><span class="s1">WScript.ScriptFullName &amp; Chr(34) &amp; </span><span class="s3">\&quot; </span><span class="s1">uac</span><span class="s3">\&quot;</span><span class="s1">, </span><span class="s3">\&quot;\&quot;</span><span class="s1">, </span><span class="s3">\&quot;</span><span class="s1">runas</span><span class="s3">\&quot;</span><span class="s1">, 1</span><span class="s3">\n</span><span class="s1">Else</span><span class="s3">\n  </span><span class="s1">Dim oShell</span><span class="s3">\n  </span><span class="s1">Set oShell = WScript.CreateObject (</span><span class="s3">\&quot;</span><span class="s1">WSCript.shell</span><span class="s3">\&quot;</span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">oShell.run </span><span class="s3">\&quot;</span><span class="s1">${command}</span><span class="s3">\&quot;\n  </span><span class="s1">Set oShell = Nothing</span><span class="s3">\n</span><span class="s1">End If`;</span><span class="s3">\n\n  </span><span class="s1">const elevatedPath = join(tmpdir(), `elevated-${Math.random()}.vbs`);</span><span class="s3">\n\n  </span><span class="s1">writeFileSync(elevatedPath, script, 'utf-8');</span><span class="s3">\n\n  </span><span class="s1">return execa(elevatedPath);</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Groups all string arguments into a single one. E.g.:</span><span class="s3">\n </span><span class="s1">* ```js</span><span class="s3">\n </span><span class="s1">* ['-m', '</span><span class="s3">\&quot;</span><span class="s1">Upgrade:', 'to', 'latest', 'version</span><span class="s3">\&quot;</span><span class="s1">'] --&gt; ['-m', '</span><span class="s3">\&quot;</span><span class="s1">Upgrade: to latest version</span><span class="s3">\&quot;</span><span class="s1">']`</span><span class="s3">\n </span><span class="s1">* ```</span><span class="s3">\n </span><span class="s1">* @param args The arguments</span><span class="s3">\n </span><span class="s1">* Â© webhint project</span><span class="s3">\n </span><span class="s1">* (https://github.com/webhintio/hint/blob/30b8ba74f122d8b66fc5596d788dd1c7738f2d83/release/lib/utils.ts#L82)</span><span class="s3">\n </span><span class="s1">* License: Apache-2</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">const groupArgs = (args: string[]) =&gt; {</span><span class="s3">\n  </span><span class="s1">let isStringArgument = false;</span><span class="s3">\n  </span><span class="s1">const newArgs = args.reduce((acum: string[], current) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (isStringArgument) {</span><span class="s3">\n      </span><span class="s1">const last = acum[acum.length - 1];</span><span class="s3">\n\n      </span><span class="s1">acum[acum.length - 1] = `${last} ${current}`;</span><span class="s3">\n\n      </span><span class="s1">if (current.endsWith('</span><span class="s3">\&quot;</span><span class="s1">')) {</span><span class="s3">\n        </span><span class="s1">isStringArgument = false;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">return acum;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (current.startsWith('</span><span class="s3">\&quot;</span><span class="s1">')) {</span><span class="s3">\n      </span><span class="s1">/**</span><span class="s3">\n       </span><span class="s1">* Argument is split. I.e.: `['</span><span class="s3">\&quot;</span><span class="s1">part1', 'part2</span><span class="s3">\&quot;</span><span class="s1">'];`</span><span class="s3">\n       </span><span class="s1">*/</span><span class="s3">\n      </span><span class="s1">if (!current.endsWith('</span><span class="s3">\&quot;</span><span class="s1">')) {</span><span class="s3">\n        </span><span class="s1">isStringArgument = true;</span><span class="s3">\n\n        </span><span class="s1">acum.push(current);</span><span class="s3">\n\n        </span><span class="s1">return acum;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">/**</span><span class="s3">\n       </span><span class="s1">* Argument is surrounded by </span><span class="s3">\&quot;\&quot; </span><span class="s1">that need to be removed.</span><span class="s3">\n       </span><span class="s1">* We just remove all the quotes because we don't escape any in our commands</span><span class="s3">\n       </span><span class="s1">*/</span><span class="s3">\n      </span><span class="s1">acum.push(current.replace(/</span><span class="s3">\&quot;</span><span class="s1">/g, ''));</span><span class="s3">\n\n      </span><span class="s1">return acum;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">acum.push(current);</span><span class="s3">\n\n    </span><span class="s1">return acum;</span><span class="s3">\n  </span><span class="s1">}, []);</span><span class="s3">\n\n  </span><span class="s1">return newArgs;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Executes the given `command` on a shell taking care of slicing the parameters</span><span class="s3">\n </span><span class="s1">* if needed.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">const executeShellCommand = (command: string, elevated = false) =&gt; {</span><span class="s3">\n  </span><span class="s1">const args = groupArgs(command.split(' '));</span><span class="s3">\n  </span><span class="s1">const program = args.shift()!;</span><span class="s3">\n\n  </span><span class="s1">if (elevated) {</span><span class="s3">\n    </span><span class="s1">return runElevated(command);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return execa(program, args, {shell: true});</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">export {executeShellCommand as executeCommand};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA0B;AAE1B;AACA,MAAMA,WAAW,GAAIC,OAAe,IAAK;EACvC;EACA;EACA;AACF;AACA;AACA;;EAEE;EACA,MAAMC,MAAM,GACb;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgBD,OAAQ;AACxB;AACA,OAAO;EAEL,MAAME,YAAY,GAAG,IAAAC,YAAI,EAAC,IAAAC,YAAM,GAAE,EAAG,YAAWC,IAAI,CAACC,MAAM,EAAG,MAAK,CAAC;EAEpE,IAAAC,mBAAa,EAACL,YAAY,EAAED,MAAM,EAAE,OAAO,CAAC;EAE5C,OAAO,IAAAO,gBAAK,EAACN,YAAY,CAAC;AAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMO,SAAS,GAAIC,IAAc,IAAK;EACpC,IAAIC,gBAAgB,GAAG,KAAK;EAC5B,MAAMC,OAAO,GAAGF,IAAI,CAACG,MAAM,CAAC,CAACC,IAAc,EAAEC,OAAO,KAAK;IACvD,IAAIJ,gBAAgB,EAAE;MACpB,MAAMK,IAAI,GAAGF,IAAI,CAACA,IAAI,CAACG,MAAM,GAAG,CAAC,CAAC;MAElCH,IAAI,CAACA,IAAI,CAACG,MAAM,GAAG,CAAC,CAAC,GAAI,GAAED,IAAK,IAAGD,OAAQ,EAAC;MAE5C,IAAIA,OAAO,CAACG,QAAQ,CAAC,GAAG,CAAC,EAAE;QACzBP,gBAAgB,GAAG,KAAK;MAC1B;MAEA,OAAOG,IAAI;IACb;IAEA,IAAIC,OAAO,CAACI,UAAU,CAAC,GAAG,CAAC,EAAE;MAC3B;AACN;AACA;MACM,IAAI,CAACJ,OAAO,CAACG,QAAQ,CAAC,GAAG,CAAC,EAAE;QAC1BP,gBAAgB,GAAG,IAAI;QAEvBG,IAAI,CAACM,IAAI,CAACL,OAAO,CAAC;QAElB,OAAOD,IAAI;MACb;;MAEA;AACN;AACA;AACA;MACMA,IAAI,CAACM,IAAI,CAACL,OAAO,CAACM,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;MAEpC,OAAOP,IAAI;IACb;IAEAA,IAAI,CAACM,IAAI,CAACL,OAAO,CAAC;IAElB,OAAOD,IAAI;EACb,CAAC,EAAE,EAAE,CAAC;EAEN,OAAOF,OAAO;AAChB,CAAC;;AAED;AACA;AACA;AACA;AACA,MAAMU,mBAAmB,GAAG,CAACtB,OAAe,EAAEuB,QAAQ,GAAG,KAAK,KAAK;EACjE,MAAMb,IAAI,GAAGD,SAAS,CAACT,OAAO,CAACwB,KAAK,CAAC,GAAG,CAAC,CAAC;EAC1C,MAAMC,OAAO,GAAGf,IAAI,CAACgB,KAAK,EAAG;EAE7B,IAAIH,QAAQ,EAAE;IACZ,OAAOxB,WAAW,CAACC,OAAO,CAAC;EAC7B;EAEA,OAAO,IAAAQ,gBAAK,EAACiB,OAAO,EAAEf,IAAI,EAAE;IAACiB,KAAK,EAAE;EAAI,CAAC,CAAC;AAC5C,CAAC;AAAC&quot;</span><span class="s0">}</span></pre>
</body>
</html>