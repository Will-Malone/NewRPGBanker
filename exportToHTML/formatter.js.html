<html>
<head>
<title>formatter.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #cc7832;}
.s4 { color: #6897bb;}
.s5 { color: #4646f1;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
formatter.js</font>
</center></td></tr></table>
<pre><span class="s0">/** 
 * class HelpFormatter 
 * 
 * Formatter for generating usage messages and argument help strings. Only the 
 * name of this class is considered a public API. All the methods provided by 
 * the class are considered an implementation detail. 
 * 
 * Do not call in your code, use this class only for inherits your own forvatter 
 * 
 * ToDo add [additonal formatters][1] 
 * 
 * [1]:http://docs.python.org/dev/library/argparse.html#formatter-class 
 **/</span>
<span class="s2">'use strict'</span><span class="s1">;</span>

<span class="s3">var </span><span class="s1">sprintf = require(</span><span class="s2">'sprintf-js'</span><span class="s1">).sprintf;</span>

<span class="s0">// Constants</span>
<span class="s3">var </span><span class="s1">c = require(</span><span class="s2">'../const'</span><span class="s1">);</span>

<span class="s3">var </span><span class="s1">$$ = require(</span><span class="s2">'../utils'</span><span class="s1">);</span>


<span class="s0">/*:nodoc:* internal 
 * new Support(parent, heding) 
 * - parent (object): parent section 
 * - heading (string): header string 
 * 
 **/</span>
<span class="s3">function </span><span class="s1">Section(parent, heading) {</span>
  <span class="s3">this</span><span class="s1">._parent = parent;</span>
  <span class="s3">this</span><span class="s1">._heading = heading;</span>
  <span class="s3">this</span><span class="s1">._items = [];</span>
<span class="s1">}</span>

<span class="s0">/*:nodoc:* internal 
 * Section#addItem(callback) -&gt; Void 
 * - callback (array): tuple with function and args 
 * 
 * Add function for single element 
 **/</span>
<span class="s1">Section.prototype.addItem = </span><span class="s3">function </span><span class="s1">(callback) {</span>
  <span class="s3">this</span><span class="s1">._items.push(callback);</span>
<span class="s1">};</span>

<span class="s0">/*:nodoc:* internal 
 * Section#formatHelp(formatter) -&gt; string 
 * - formatter (HelpFormatter): current formatter 
 * 
 * Form help section string 
 * 
 **/</span>
<span class="s1">Section.prototype.formatHelp = </span><span class="s3">function </span><span class="s1">(formatter) {</span>
  <span class="s3">var </span><span class="s1">itemHelp, heading;</span>

  <span class="s0">// format the indented section</span>
  <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">._parent) {</span>
    <span class="s1">formatter._indent();</span>
  <span class="s1">}</span>

  <span class="s1">itemHelp = </span><span class="s3">this</span><span class="s1">._items.map(</span><span class="s3">function </span><span class="s1">(item) {</span>
    <span class="s3">var </span><span class="s1">obj, func, args;</span>

    <span class="s1">obj = formatter;</span>
    <span class="s1">func = item[</span><span class="s4">0</span><span class="s1">];</span>
    <span class="s1">args = item[</span><span class="s4">1</span><span class="s1">];</span>
    <span class="s3">return </span><span class="s1">func.apply(obj, args);</span>
  <span class="s1">});</span>
  <span class="s1">itemHelp = formatter._joinParts(itemHelp);</span>

  <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">._parent) {</span>
    <span class="s1">formatter._dedent();</span>
  <span class="s1">}</span>

  <span class="s0">// return nothing if the section was empty</span>
  <span class="s3">if </span><span class="s1">(!itemHelp) {</span>
    <span class="s3">return </span><span class="s2">''</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s0">// add the heading if the section was non-empty</span>
  <span class="s1">heading = </span><span class="s2">''</span><span class="s1">;</span>
  <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">._heading &amp;&amp; </span><span class="s3">this</span><span class="s1">._heading !== c.SUPPRESS) {</span>
    <span class="s3">var </span><span class="s1">currentIndent = formatter.currentIndent;</span>
    <span class="s1">heading = $$.repeat(</span><span class="s2">' '</span><span class="s1">, currentIndent) + </span><span class="s3">this</span><span class="s1">._heading + </span><span class="s2">':' </span><span class="s1">+ c.EOL;</span>
  <span class="s1">}</span>

  <span class="s0">// join the section-initialize newline, the heading and the help</span>
  <span class="s3">return </span><span class="s1">formatter._joinParts([ c.EOL, heading, itemHelp, c.EOL ]);</span>
<span class="s1">};</span>

<span class="s0">/** 
 * new HelpFormatter(options) 
 * 
 * #### Options: 
 * - `prog`: program name 
 * - `indentIncriment`: indent step, default value 2 
 * - `maxHelpPosition`: max help position, default value = 24 
 * - `width`: line width 
 * 
 **/</span>
<span class="s3">var </span><span class="s1">HelpFormatter = module.exports = </span><span class="s3">function </span><span class="s1">HelpFormatter(options) {</span>
  <span class="s1">options = options || {};</span>

  <span class="s3">this</span><span class="s1">._prog = options.prog;</span>

  <span class="s3">this</span><span class="s1">._maxHelpPosition = options.maxHelpPosition || </span><span class="s4">24</span><span class="s1">;</span>
  <span class="s3">this</span><span class="s1">._width = (options.width || ((process.env.COLUMNS || </span><span class="s4">80</span><span class="s1">) - </span><span class="s4">2</span><span class="s1">));</span>

  <span class="s3">this</span><span class="s1">._currentIndent = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">this</span><span class="s1">._indentIncriment = options.indentIncriment || </span><span class="s4">2</span><span class="s1">;</span>
  <span class="s3">this</span><span class="s1">._level = </span><span class="s4">0</span><span class="s1">;</span>
  <span class="s3">this</span><span class="s1">._actionMaxLength = </span><span class="s4">0</span><span class="s1">;</span>

  <span class="s3">this</span><span class="s1">._rootSection = </span><span class="s3">new </span><span class="s1">Section(</span><span class="s3">null</span><span class="s1">);</span>
  <span class="s3">this</span><span class="s1">._currentSection = </span><span class="s3">this</span><span class="s1">._rootSection;</span>

  <span class="s3">this</span><span class="s1">._whitespaceMatcher = </span><span class="s3">new </span><span class="s1">RegExp(</span><span class="s2">'</span><span class="s5">\\</span><span class="s2">s+'</span><span class="s1">, </span><span class="s2">'g'</span><span class="s1">);</span>
  <span class="s3">this</span><span class="s1">._longBreakMatcher = </span><span class="s3">new </span><span class="s1">RegExp(c.EOL + c.EOL + c.EOL + </span><span class="s2">'+'</span><span class="s1">, </span><span class="s2">'g'</span><span class="s1">);</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._indent = </span><span class="s3">function </span><span class="s1">() {</span>
  <span class="s3">this</span><span class="s1">._currentIndent += </span><span class="s3">this</span><span class="s1">._indentIncriment;</span>
  <span class="s3">this</span><span class="s1">._level += </span><span class="s4">1</span><span class="s1">;</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._dedent = </span><span class="s3">function </span><span class="s1">() {</span>
  <span class="s3">this</span><span class="s1">._currentIndent -= </span><span class="s3">this</span><span class="s1">._indentIncriment;</span>
  <span class="s3">this</span><span class="s1">._level -= </span><span class="s4">1</span><span class="s1">;</span>
  <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">._currentIndent &lt; </span><span class="s4">0</span><span class="s1">) {</span>
    <span class="s3">throw new </span><span class="s1">Error(</span><span class="s2">'Indent decreased below 0.'</span><span class="s1">);</span>
  <span class="s1">}</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._addItem = </span><span class="s3">function </span><span class="s1">(func, args) {</span>
  <span class="s3">this</span><span class="s1">._currentSection.addItem([ func, args ]);</span>
<span class="s1">};</span>

<span class="s0">//</span>
<span class="s0">// Message building methods</span>
<span class="s0">//</span>

<span class="s0">/** 
 * HelpFormatter#startSection(heading) -&gt; Void 
 * - heading (string): header string 
 * 
 * Start new help section 
 * 
 * See alse [code example][1] 
 * 
 * ##### Example 
 * 
 *      formatter.startSection(actionGroup.title); 
 *      formatter.addText(actionGroup.description); 
 *      formatter.addArguments(actionGroup._groupActions); 
 *      formatter.endSection(); 
 * 
 **/</span>
<span class="s1">HelpFormatter.prototype.startSection = </span><span class="s3">function </span><span class="s1">(heading) {</span>
  <span class="s3">this</span><span class="s1">._indent();</span>
  <span class="s3">var </span><span class="s1">section = </span><span class="s3">new </span><span class="s1">Section(</span><span class="s3">this</span><span class="s1">._currentSection, heading);</span>
  <span class="s3">var </span><span class="s1">func = section.formatHelp.bind(section);</span>
  <span class="s3">this</span><span class="s1">._addItem(func, [ </span><span class="s3">this </span><span class="s1">]);</span>
  <span class="s3">this</span><span class="s1">._currentSection = section;</span>
<span class="s1">};</span>

<span class="s0">/** 
 * HelpFormatter#endSection -&gt; Void 
 * 
 * End help section 
 * 
 * ##### Example 
 * 
 *      formatter.startSection(actionGroup.title); 
 *      formatter.addText(actionGroup.description); 
 *      formatter.addArguments(actionGroup._groupActions); 
 *      formatter.endSection(); 
 **/</span>
<span class="s1">HelpFormatter.prototype.endSection = </span><span class="s3">function </span><span class="s1">() {</span>
  <span class="s3">this</span><span class="s1">._currentSection = </span><span class="s3">this</span><span class="s1">._currentSection._parent;</span>
  <span class="s3">this</span><span class="s1">._dedent();</span>
<span class="s1">};</span>

<span class="s0">/** 
 * HelpFormatter#addText(text) -&gt; Void 
 * - text (string): plain text 
 * 
 * Add plain text into current section 
 * 
 * ##### Example 
 * 
 *      formatter.startSection(actionGroup.title); 
 *      formatter.addText(actionGroup.description); 
 *      formatter.addArguments(actionGroup._groupActions); 
 *      formatter.endSection(); 
 * 
 **/</span>
<span class="s1">HelpFormatter.prototype.addText = </span><span class="s3">function </span><span class="s1">(text) {</span>
  <span class="s3">if </span><span class="s1">(text &amp;&amp; text !== c.SUPPRESS) {</span>
    <span class="s3">this</span><span class="s1">._addItem(</span><span class="s3">this</span><span class="s1">._formatText, [ text ]);</span>
  <span class="s1">}</span>
<span class="s1">};</span>

<span class="s0">/** 
 * HelpFormatter#addUsage(usage, actions, groups, prefix) -&gt; Void 
 * - usage (string): usage text 
 * - actions (array): actions list 
 * - groups (array): groups list 
 * - prefix (string): usage prefix 
 * 
 * Add usage data into current section 
 * 
 * ##### Example 
 * 
 *      formatter.addUsage(this.usage, this._actions, []); 
 *      return formatter.formatHelp(); 
 * 
 **/</span>
<span class="s1">HelpFormatter.prototype.addUsage = </span><span class="s3">function </span><span class="s1">(usage, actions, groups, prefix) {</span>
  <span class="s3">if </span><span class="s1">(usage !== c.SUPPRESS) {</span>
    <span class="s3">this</span><span class="s1">._addItem(</span><span class="s3">this</span><span class="s1">._formatUsage, [ usage, actions, groups, prefix ]);</span>
  <span class="s1">}</span>
<span class="s1">};</span>

<span class="s0">/** 
 * HelpFormatter#addArgument(action) -&gt; Void 
 * - action (object): action 
 * 
 * Add argument into current section 
 * 
 * Single variant of [[HelpFormatter#addArguments]] 
 **/</span>
<span class="s1">HelpFormatter.prototype.addArgument = </span><span class="s3">function </span><span class="s1">(action) {</span>
  <span class="s3">if </span><span class="s1">(action.help !== c.SUPPRESS) {</span>
    <span class="s3">var </span><span class="s1">self = </span><span class="s3">this</span><span class="s1">;</span>

    <span class="s0">// find all invocations</span>
    <span class="s3">var </span><span class="s1">invocations = [ </span><span class="s3">this</span><span class="s1">._formatActionInvocation(action) ];</span>
    <span class="s3">var </span><span class="s1">invocationLength = invocations[</span><span class="s4">0</span><span class="s1">].length;</span>

    <span class="s3">var </span><span class="s1">actionLength;</span>

    <span class="s3">if </span><span class="s1">(action._getSubactions) {</span>
      <span class="s3">this</span><span class="s1">._indent();</span>
      <span class="s1">action._getSubactions().forEach(</span><span class="s3">function </span><span class="s1">(subaction) {</span>

        <span class="s3">var </span><span class="s1">invocationNew = self._formatActionInvocation(subaction);</span>
        <span class="s1">invocations.push(invocationNew);</span>
        <span class="s1">invocationLength = Math.max(invocationLength, invocationNew.length);</span>

      <span class="s1">});</span>
      <span class="s3">this</span><span class="s1">._dedent();</span>
    <span class="s1">}</span>

    <span class="s0">// update the maximum item length</span>
    <span class="s1">actionLength = invocationLength + </span><span class="s3">this</span><span class="s1">._currentIndent;</span>
    <span class="s3">this</span><span class="s1">._actionMaxLength = Math.max(</span><span class="s3">this</span><span class="s1">._actionMaxLength, actionLength);</span>

    <span class="s0">// add the item to the list</span>
    <span class="s3">this</span><span class="s1">._addItem(</span><span class="s3">this</span><span class="s1">._formatAction, [ action ]);</span>
  <span class="s1">}</span>
<span class="s1">};</span>

<span class="s0">/** 
 * HelpFormatter#addArguments(actions) -&gt; Void 
 * - actions (array): actions list 
 * 
 * Mass add arguments into current section 
 * 
 * ##### Example 
 * 
 *      formatter.startSection(actionGroup.title); 
 *      formatter.addText(actionGroup.description); 
 *      formatter.addArguments(actionGroup._groupActions); 
 *      formatter.endSection(); 
 * 
 **/</span>
<span class="s1">HelpFormatter.prototype.addArguments = </span><span class="s3">function </span><span class="s1">(actions) {</span>
  <span class="s3">var </span><span class="s1">self = </span><span class="s3">this</span><span class="s1">;</span>
  <span class="s1">actions.forEach(</span><span class="s3">function </span><span class="s1">(action) {</span>
    <span class="s1">self.addArgument(action);</span>
  <span class="s1">});</span>
<span class="s1">};</span>

<span class="s0">//</span>
<span class="s0">// Help-formatting methods</span>
<span class="s0">//</span>

<span class="s0">/** 
 * HelpFormatter#formatHelp -&gt; string 
 * 
 * Format help 
 * 
 * ##### Example 
 * 
 *      formatter.addText(this.epilog); 
 *      return formatter.formatHelp(); 
 * 
 **/</span>
<span class="s1">HelpFormatter.prototype.formatHelp = </span><span class="s3">function </span><span class="s1">() {</span>
  <span class="s3">var </span><span class="s1">help = </span><span class="s3">this</span><span class="s1">._rootSection.formatHelp(</span><span class="s3">this</span><span class="s1">);</span>
  <span class="s3">if </span><span class="s1">(help) {</span>
    <span class="s1">help = help.replace(</span><span class="s3">this</span><span class="s1">._longBreakMatcher, c.EOL + c.EOL);</span>
    <span class="s1">help = $$.trimChars(help, c.EOL) + c.EOL;</span>
  <span class="s1">}</span>
  <span class="s3">return </span><span class="s1">help;</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._joinParts = </span><span class="s3">function </span><span class="s1">(partStrings) {</span>
  <span class="s3">return </span><span class="s1">partStrings.filter(</span><span class="s3">function </span><span class="s1">(part) {</span>
    <span class="s3">return </span><span class="s1">(part &amp;&amp; part !== c.SUPPRESS);</span>
  <span class="s1">}).join(</span><span class="s2">''</span><span class="s1">);</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._formatUsage = </span><span class="s3">function </span><span class="s1">(usage, actions, groups, prefix) {</span>
  <span class="s3">if </span><span class="s1">(!prefix &amp;&amp; </span><span class="s3">typeof </span><span class="s1">prefix !== </span><span class="s2">'string'</span><span class="s1">) {</span>
    <span class="s1">prefix = </span><span class="s2">'usage: '</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s1">actions = actions || [];</span>
  <span class="s1">groups = groups || [];</span>


  <span class="s0">// if usage is specified, use that</span>
  <span class="s3">if </span><span class="s1">(usage) {</span>
    <span class="s1">usage = sprintf(usage, { prog: </span><span class="s3">this</span><span class="s1">._prog });</span>

    <span class="s0">// if no optionals or positionals are available, usage is just prog</span>
  <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!usage &amp;&amp; actions.length === </span><span class="s4">0</span><span class="s1">) {</span>
    <span class="s1">usage = </span><span class="s3">this</span><span class="s1">._prog;</span>

    <span class="s0">// if optionals and positionals are available, calculate usage</span>
  <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!usage) {</span>
    <span class="s3">var </span><span class="s1">prog = </span><span class="s3">this</span><span class="s1">._prog;</span>
    <span class="s3">var </span><span class="s1">optionals = [];</span>
    <span class="s3">var </span><span class="s1">positionals = [];</span>
    <span class="s3">var </span><span class="s1">actionUsage;</span>
    <span class="s3">var </span><span class="s1">textWidth;</span>

    <span class="s0">// split optionals from positionals</span>
    <span class="s1">actions.forEach(</span><span class="s3">function </span><span class="s1">(action) {</span>
      <span class="s3">if </span><span class="s1">(action.isOptional()) {</span>
        <span class="s1">optionals.push(action);</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s1">positionals.push(action);</span>
      <span class="s1">}</span>
    <span class="s1">});</span>

    <span class="s0">// build full usage string</span>
    <span class="s1">actionUsage = </span><span class="s3">this</span><span class="s1">._formatActionsUsage([].concat(optionals, positionals), groups);</span>
    <span class="s1">usage = [ prog, actionUsage ].join(</span><span class="s2">' '</span><span class="s1">);</span>

    <span class="s0">// wrap the usage parts if it's too long</span>
    <span class="s1">textWidth = </span><span class="s3">this</span><span class="s1">._width - </span><span class="s3">this</span><span class="s1">._currentIndent;</span>
    <span class="s3">if </span><span class="s1">((prefix.length + usage.length) &gt; textWidth) {</span>

      <span class="s0">// break usage into wrappable parts</span>
      <span class="s3">var </span><span class="s1">regexpPart = </span><span class="s3">new </span><span class="s1">RegExp(</span><span class="s2">'</span><span class="s5">\\</span><span class="s2">(.*?</span><span class="s5">\\</span><span class="s2">)+|</span><span class="s5">\\</span><span class="s2">[.*?</span><span class="s5">\\</span><span class="s2">]+|</span><span class="s5">\\</span><span class="s2">S+'</span><span class="s1">, </span><span class="s2">'g'</span><span class="s1">);</span>
      <span class="s3">var </span><span class="s1">optionalUsage = </span><span class="s3">this</span><span class="s1">._formatActionsUsage(optionals, groups);</span>
      <span class="s3">var </span><span class="s1">positionalUsage = </span><span class="s3">this</span><span class="s1">._formatActionsUsage(positionals, groups);</span>


      <span class="s3">var </span><span class="s1">optionalParts = optionalUsage.match(regexpPart);</span>
      <span class="s3">var </span><span class="s1">positionalParts = positionalUsage.match(regexpPart) || [];</span>

      <span class="s3">if </span><span class="s1">(optionalParts.join(</span><span class="s2">' '</span><span class="s1">) !== optionalUsage) {</span>
        <span class="s3">throw new </span><span class="s1">Error(</span><span class="s2">'assert &quot;optionalParts.join(</span><span class="s5">\' \'</span><span class="s2">) === optionalUsage&quot;'</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">if </span><span class="s1">(positionalParts.join(</span><span class="s2">' '</span><span class="s1">) !== positionalUsage) {</span>
        <span class="s3">throw new </span><span class="s1">Error(</span><span class="s2">'assert &quot;positionalParts.join(</span><span class="s5">\' \'</span><span class="s2">) === positionalUsage&quot;'</span><span class="s1">);</span>
      <span class="s1">}</span>

      <span class="s0">// helper for wrapping lines</span>
      <span class="s0">/*eslint-disable func-style*/ // node 0.10 compat</span>
      <span class="s3">var </span><span class="s1">_getLines = </span><span class="s3">function </span><span class="s1">(parts, indent, prefix) {</span>
        <span class="s3">var </span><span class="s1">lines = [];</span>
        <span class="s3">var </span><span class="s1">line = [];</span>

        <span class="s3">var </span><span class="s1">lineLength = prefix ? prefix.length - </span><span class="s4">1 </span><span class="s1">: indent.length - </span><span class="s4">1</span><span class="s1">;</span>

        <span class="s1">parts.forEach(</span><span class="s3">function </span><span class="s1">(part) {</span>
          <span class="s3">if </span><span class="s1">(lineLength + </span><span class="s4">1 </span><span class="s1">+ part.length &gt; textWidth) {</span>
            <span class="s1">lines.push(indent + line.join(</span><span class="s2">' '</span><span class="s1">));</span>
            <span class="s1">line = [];</span>
            <span class="s1">lineLength = indent.length - </span><span class="s4">1</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s1">line.push(part);</span>
          <span class="s1">lineLength += part.length + </span><span class="s4">1</span><span class="s1">;</span>
        <span class="s1">});</span>

        <span class="s3">if </span><span class="s1">(line) {</span>
          <span class="s1">lines.push(indent + line.join(</span><span class="s2">' '</span><span class="s1">));</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(prefix) {</span>
          <span class="s1">lines[</span><span class="s4">0</span><span class="s1">] = lines[</span><span class="s4">0</span><span class="s1">].substr(indent.length);</span>
        <span class="s1">}</span>
        <span class="s3">return </span><span class="s1">lines;</span>
      <span class="s1">};</span>

      <span class="s3">var </span><span class="s1">lines, indent, parts;</span>
      <span class="s0">// if prog is short, follow it with optionals or positionals</span>
      <span class="s3">if </span><span class="s1">(prefix.length + prog.length &lt;= </span><span class="s4">0.75 </span><span class="s1">* textWidth) {</span>
        <span class="s1">indent = $$.repeat(</span><span class="s2">' '</span><span class="s1">, (prefix.length + prog.length + </span><span class="s4">1</span><span class="s1">));</span>
        <span class="s3">if </span><span class="s1">(optionalParts) {</span>
          <span class="s1">lines = [].concat(</span>
            <span class="s1">_getLines([ prog ].concat(optionalParts), indent, prefix),</span>
            <span class="s1">_getLines(positionalParts, indent)</span>
          <span class="s1">);</span>
        <span class="s1">} </span><span class="s3">else if </span><span class="s1">(positionalParts) {</span>
          <span class="s1">lines = _getLines([ prog ].concat(positionalParts), indent, prefix);</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
          <span class="s1">lines = [ prog ];</span>
        <span class="s1">}</span>

        <span class="s0">// if prog is long, put it on its own line</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s1">indent = $$.repeat(</span><span class="s2">' '</span><span class="s1">, prefix.length);</span>
        <span class="s1">parts = optionalParts.concat(positionalParts);</span>
        <span class="s1">lines = _getLines(parts, indent);</span>
        <span class="s3">if </span><span class="s1">(lines.length &gt; </span><span class="s4">1</span><span class="s1">) {</span>
          <span class="s1">lines = [].concat(</span>
            <span class="s1">_getLines(optionalParts, indent),</span>
            <span class="s1">_getLines(positionalParts, indent)</span>
          <span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s1">lines = [ prog ].concat(lines);</span>
      <span class="s1">}</span>
      <span class="s0">// join lines into usage</span>
      <span class="s1">usage = lines.join(c.EOL);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s0">// prefix with 'usage:'</span>
  <span class="s3">return </span><span class="s1">prefix + usage + c.EOL + c.EOL;</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._formatActionsUsage = </span><span class="s3">function </span><span class="s1">(actions, groups) {</span>
  <span class="s0">// find group indices and identify actions in groups</span>
  <span class="s3">var </span><span class="s1">groupActions = [];</span>
  <span class="s3">var </span><span class="s1">inserts = [];</span>
  <span class="s3">var </span><span class="s1">self = </span><span class="s3">this</span><span class="s1">;</span>

  <span class="s1">groups.forEach(</span><span class="s3">function </span><span class="s1">(group) {</span>
    <span class="s3">var </span><span class="s1">end;</span>
    <span class="s3">var </span><span class="s1">i;</span>

    <span class="s3">var </span><span class="s1">start = actions.indexOf(group._groupActions[</span><span class="s4">0</span><span class="s1">]);</span>
    <span class="s3">if </span><span class="s1">(start &gt;= </span><span class="s4">0</span><span class="s1">) {</span>
      <span class="s1">end = start + group._groupActions.length;</span>

      <span class="s0">//if (actions.slice(start, end) === group._groupActions) {</span>
      <span class="s3">if </span><span class="s1">($$.arrayEqual(actions.slice(start, end), group._groupActions)) {</span>
        <span class="s1">group._groupActions.forEach(</span><span class="s3">function </span><span class="s1">(action) {</span>
          <span class="s1">groupActions.push(action);</span>
        <span class="s1">});</span>

        <span class="s3">if </span><span class="s1">(!group.required) {</span>
          <span class="s3">if </span><span class="s1">(inserts[start]) {</span>
            <span class="s1">inserts[start] += </span><span class="s2">' ['</span><span class="s1">;</span>
          <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s1">inserts[start] = </span><span class="s2">'['</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s1">inserts[end] = </span><span class="s2">']'</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
          <span class="s3">if </span><span class="s1">(inserts[start]) {</span>
            <span class="s1">inserts[start] += </span><span class="s2">' ('</span><span class="s1">;</span>
          <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
            <span class="s1">inserts[start] = </span><span class="s2">'('</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s1">inserts[end] = </span><span class="s2">')'</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">for </span><span class="s1">(i = start + </span><span class="s4">1</span><span class="s1">; i &lt; end; i += </span><span class="s4">1</span><span class="s1">) {</span>
          <span class="s1">inserts[i] = </span><span class="s2">'|'</span><span class="s1">;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">});</span>

  <span class="s0">// collect all actions format strings</span>
  <span class="s3">var </span><span class="s1">parts = [];</span>

  <span class="s1">actions.forEach(</span><span class="s3">function </span><span class="s1">(action, actionIndex) {</span>
    <span class="s3">var </span><span class="s1">part;</span>
    <span class="s3">var </span><span class="s1">optionString;</span>
    <span class="s3">var </span><span class="s1">argsDefault;</span>
    <span class="s3">var </span><span class="s1">argsString;</span>

    <span class="s0">// suppressed arguments are marked with None</span>
    <span class="s0">// remove | separators for suppressed arguments</span>
    <span class="s3">if </span><span class="s1">(action.help === c.SUPPRESS) {</span>
      <span class="s1">parts.push(</span><span class="s3">null</span><span class="s1">);</span>
      <span class="s3">if </span><span class="s1">(inserts[actionIndex] === </span><span class="s2">'|'</span><span class="s1">) {</span>
        <span class="s1">inserts.splice(actionIndex, actionIndex);</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(inserts[actionIndex + </span><span class="s4">1</span><span class="s1">] === </span><span class="s2">'|'</span><span class="s1">) {</span>
        <span class="s1">inserts.splice(actionIndex + </span><span class="s4">1</span><span class="s1">, actionIndex + </span><span class="s4">1</span><span class="s1">);</span>
      <span class="s1">}</span>

      <span class="s0">// produce all arg strings</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!action.isOptional()) {</span>
      <span class="s1">part = self._formatArgs(action, action.dest);</span>

      <span class="s0">// if it's in a group, strip the outer []</span>
      <span class="s3">if </span><span class="s1">(groupActions.indexOf(action) &gt;= </span><span class="s4">0</span><span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(part[</span><span class="s4">0</span><span class="s1">] === </span><span class="s2">'[' </span><span class="s1">&amp;&amp; part[part.length - </span><span class="s4">1</span><span class="s1">] === </span><span class="s2">']'</span><span class="s1">) {</span>
          <span class="s1">part = part.slice(</span><span class="s4">1</span><span class="s1">, -</span><span class="s4">1</span><span class="s1">);</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s0">// add the action string to the list</span>
      <span class="s1">parts.push(part);</span>

    <span class="s0">// produce the first way to invoke the option in brackets</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s1">optionString = action.optionStrings[</span><span class="s4">0</span><span class="s1">];</span>

      <span class="s0">// if the Optional doesn't take a value, format is: -s or --long</span>
      <span class="s3">if </span><span class="s1">(action.nargs === </span><span class="s4">0</span><span class="s1">) {</span>
        <span class="s1">part = </span><span class="s2">'' </span><span class="s1">+ optionString;</span>

      <span class="s0">// if the Optional takes a value, format is: -s ARGS or --long ARGS</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s1">argsDefault = action.dest.toUpperCase();</span>
        <span class="s1">argsString = self._formatArgs(action, argsDefault);</span>
        <span class="s1">part = optionString + </span><span class="s2">' ' </span><span class="s1">+ argsString;</span>
      <span class="s1">}</span>
      <span class="s0">// make it look optional if it's not required or in a group</span>
      <span class="s3">if </span><span class="s1">(!action.required &amp;&amp; groupActions.indexOf(action) &lt; </span><span class="s4">0</span><span class="s1">) {</span>
        <span class="s1">part = </span><span class="s2">'[' </span><span class="s1">+ part + </span><span class="s2">']'</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s0">// add the action string to the list</span>
      <span class="s1">parts.push(part);</span>
    <span class="s1">}</span>
  <span class="s1">});</span>

  <span class="s0">// insert things at the necessary indices</span>
  <span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s1">i = inserts.length - </span><span class="s4">1</span><span class="s1">; i &gt;= </span><span class="s4">0</span><span class="s1">; --i) {</span>
    <span class="s3">if </span><span class="s1">(inserts[i] !== </span><span class="s3">null</span><span class="s1">) {</span>
      <span class="s1">parts.splice(i, </span><span class="s4">0</span><span class="s1">, inserts[i]);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s0">// join all the action items with spaces</span>
  <span class="s3">var </span><span class="s1">text = parts.filter(</span><span class="s3">function </span><span class="s1">(part) {</span>
    <span class="s3">return </span><span class="s1">!!part;</span>
  <span class="s1">}).join(</span><span class="s2">' '</span><span class="s1">);</span>

  <span class="s0">// clean up separators for mutually exclusive groups</span>
  <span class="s1">text = text.replace(/([\[(]) /g, </span><span class="s2">'$1'</span><span class="s1">); </span><span class="s0">// remove spaces</span>
  <span class="s1">text = text.replace(/ ([\])])/g, </span><span class="s2">'$1'</span><span class="s1">);</span>
  <span class="s1">text = text.replace(/\[ *\]/g, </span><span class="s2">''</span><span class="s1">); </span><span class="s0">// remove empty groups</span>
  <span class="s1">text = text.replace(/\( *\)/g, </span><span class="s2">''</span><span class="s1">);</span>
  <span class="s1">text = text.replace(/\(([^|]*)\)/g, </span><span class="s2">'$1'</span><span class="s1">); </span><span class="s0">// remove () from single action groups</span>

  <span class="s1">text = text.trim();</span>

  <span class="s0">// return the text</span>
  <span class="s3">return </span><span class="s1">text;</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._formatText = </span><span class="s3">function </span><span class="s1">(text) {</span>
  <span class="s1">text = sprintf(text, { prog: </span><span class="s3">this</span><span class="s1">._prog });</span>
  <span class="s3">var </span><span class="s1">textWidth = </span><span class="s3">this</span><span class="s1">._width - </span><span class="s3">this</span><span class="s1">._currentIndent;</span>
  <span class="s3">var </span><span class="s1">indentIncriment = $$.repeat(</span><span class="s2">' '</span><span class="s1">, </span><span class="s3">this</span><span class="s1">._currentIndent);</span>
  <span class="s3">return this</span><span class="s1">._fillText(text, textWidth, indentIncriment) + c.EOL + c.EOL;</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._formatAction = </span><span class="s3">function </span><span class="s1">(action) {</span>
  <span class="s3">var </span><span class="s1">self = </span><span class="s3">this</span><span class="s1">;</span>

  <span class="s3">var </span><span class="s1">helpText;</span>
  <span class="s3">var </span><span class="s1">helpLines;</span>
  <span class="s3">var </span><span class="s1">parts;</span>
  <span class="s3">var </span><span class="s1">indentFirst;</span>

  <span class="s0">// determine the required width and the entry label</span>
  <span class="s3">var </span><span class="s1">helpPosition = Math.min(</span><span class="s3">this</span><span class="s1">._actionMaxLength + </span><span class="s4">2</span><span class="s1">, </span><span class="s3">this</span><span class="s1">._maxHelpPosition);</span>
  <span class="s3">var </span><span class="s1">helpWidth = </span><span class="s3">this</span><span class="s1">._width - helpPosition;</span>
  <span class="s3">var </span><span class="s1">actionWidth = helpPosition - </span><span class="s3">this</span><span class="s1">._currentIndent - </span><span class="s4">2</span><span class="s1">;</span>
  <span class="s3">var </span><span class="s1">actionHeader = </span><span class="s3">this</span><span class="s1">._formatActionInvocation(action);</span>

  <span class="s0">// no help; start on same line and add a final newline</span>
  <span class="s3">if </span><span class="s1">(!action.help) {</span>
    <span class="s1">actionHeader = $$.repeat(</span><span class="s2">' '</span><span class="s1">, </span><span class="s3">this</span><span class="s1">._currentIndent) + actionHeader + c.EOL;</span>

  <span class="s0">// short action name; start on the same line and pad two spaces</span>
  <span class="s1">} </span><span class="s3">else if </span><span class="s1">(actionHeader.length &lt;= actionWidth) {</span>
    <span class="s1">actionHeader = $$.repeat(</span><span class="s2">' '</span><span class="s1">, </span><span class="s3">this</span><span class="s1">._currentIndent) +</span>
        <span class="s1">actionHeader +</span>
        <span class="s2">'  ' </span><span class="s1">+</span>
        <span class="s1">$$.repeat(</span><span class="s2">' '</span><span class="s1">, actionWidth - actionHeader.length);</span>
    <span class="s1">indentFirst = </span><span class="s4">0</span><span class="s1">;</span>

  <span class="s0">// long action name; start on the next line</span>
  <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
    <span class="s1">actionHeader = $$.repeat(</span><span class="s2">' '</span><span class="s1">, </span><span class="s3">this</span><span class="s1">._currentIndent) + actionHeader + c.EOL;</span>
    <span class="s1">indentFirst = helpPosition;</span>
  <span class="s1">}</span>

  <span class="s0">// collect the pieces of the action help</span>
  <span class="s1">parts = [ actionHeader ];</span>

  <span class="s0">// if there was help for the action, add lines of help text</span>
  <span class="s3">if </span><span class="s1">(action.help) {</span>
    <span class="s1">helpText = </span><span class="s3">this</span><span class="s1">._expandHelp(action);</span>
    <span class="s1">helpLines = </span><span class="s3">this</span><span class="s1">._splitLines(helpText, helpWidth);</span>
    <span class="s1">parts.push($$.repeat(</span><span class="s2">' '</span><span class="s1">, indentFirst) + helpLines[</span><span class="s4">0</span><span class="s1">] + c.EOL);</span>
    <span class="s1">helpLines.slice(</span><span class="s4">1</span><span class="s1">).forEach(</span><span class="s3">function </span><span class="s1">(line) {</span>
      <span class="s1">parts.push($$.repeat(</span><span class="s2">' '</span><span class="s1">, helpPosition) + line + c.EOL);</span>
    <span class="s1">});</span>

  <span class="s0">// or add a newline if the description doesn't end with one</span>
  <span class="s1">} </span><span class="s3">else if </span><span class="s1">(actionHeader.charAt(actionHeader.length - </span><span class="s4">1</span><span class="s1">) !== c.EOL) {</span>
    <span class="s1">parts.push(c.EOL);</span>
  <span class="s1">}</span>
  <span class="s0">// if there are any sub-actions, add their help as well</span>
  <span class="s3">if </span><span class="s1">(action._getSubactions) {</span>
    <span class="s3">this</span><span class="s1">._indent();</span>
    <span class="s1">action._getSubactions().forEach(</span><span class="s3">function </span><span class="s1">(subaction) {</span>
      <span class="s1">parts.push(self._formatAction(subaction));</span>
    <span class="s1">});</span>
    <span class="s3">this</span><span class="s1">._dedent();</span>
  <span class="s1">}</span>
  <span class="s0">// return a single string</span>
  <span class="s3">return this</span><span class="s1">._joinParts(parts);</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._formatActionInvocation = </span><span class="s3">function </span><span class="s1">(action) {</span>
  <span class="s3">if </span><span class="s1">(!action.isOptional()) {</span>
    <span class="s3">var </span><span class="s1">format_func = </span><span class="s3">this</span><span class="s1">._metavarFormatter(action, action.dest);</span>
    <span class="s3">var </span><span class="s1">metavars = format_func(</span><span class="s4">1</span><span class="s1">);</span>
    <span class="s3">return </span><span class="s1">metavars[</span><span class="s4">0</span><span class="s1">];</span>
  <span class="s1">}</span>

  <span class="s3">var </span><span class="s1">parts = [];</span>
  <span class="s3">var </span><span class="s1">argsDefault;</span>
  <span class="s3">var </span><span class="s1">argsString;</span>

  <span class="s0">// if the Optional doesn't take a value, format is: -s, --long</span>
  <span class="s3">if </span><span class="s1">(action.nargs === </span><span class="s4">0</span><span class="s1">) {</span>
    <span class="s1">parts = parts.concat(action.optionStrings);</span>

  <span class="s0">// if the Optional takes a value, format is: -s ARGS, --long ARGS</span>
  <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
    <span class="s1">argsDefault = action.dest.toUpperCase();</span>
    <span class="s1">argsString = </span><span class="s3">this</span><span class="s1">._formatArgs(action, argsDefault);</span>
    <span class="s1">action.optionStrings.forEach(</span><span class="s3">function </span><span class="s1">(optionString) {</span>
      <span class="s1">parts.push(optionString + </span><span class="s2">' ' </span><span class="s1">+ argsString);</span>
    <span class="s1">});</span>
  <span class="s1">}</span>
  <span class="s3">return </span><span class="s1">parts.join(</span><span class="s2">', '</span><span class="s1">);</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._metavarFormatter = </span><span class="s3">function </span><span class="s1">(action, metavarDefault) {</span>
  <span class="s3">var </span><span class="s1">result;</span>

  <span class="s3">if </span><span class="s1">(action.metavar || action.metavar === </span><span class="s2">''</span><span class="s1">) {</span>
    <span class="s1">result = action.metavar;</span>
  <span class="s1">} </span><span class="s3">else if </span><span class="s1">(action.choices) {</span>
    <span class="s3">var </span><span class="s1">choices = action.choices;</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s1">choices === </span><span class="s2">'string'</span><span class="s1">) {</span>
      <span class="s1">choices = choices.split(</span><span class="s2">''</span><span class="s1">).join(</span><span class="s2">', '</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(Array.isArray(choices)) {</span>
      <span class="s1">choices = choices.join(</span><span class="s2">','</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s1">choices = Object.keys(choices).join(</span><span class="s2">','</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s1">result = </span><span class="s2">'{' </span><span class="s1">+ choices + </span><span class="s2">'}'</span><span class="s1">;</span>
  <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
    <span class="s1">result = metavarDefault;</span>
  <span class="s1">}</span>

  <span class="s3">return function </span><span class="s1">(size) {</span>
    <span class="s3">if </span><span class="s1">(Array.isArray(result)) {</span>
      <span class="s3">return </span><span class="s1">result;</span>
    <span class="s1">}</span>

    <span class="s3">var </span><span class="s1">metavars = [];</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s1">i = </span><span class="s4">0</span><span class="s1">; i &lt; size; i += </span><span class="s4">1</span><span class="s1">) {</span>
      <span class="s1">metavars.push(result);</span>
    <span class="s1">}</span>
    <span class="s3">return </span><span class="s1">metavars;</span>
  <span class="s1">};</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._formatArgs = </span><span class="s3">function </span><span class="s1">(action, metavarDefault) {</span>
  <span class="s3">var </span><span class="s1">result;</span>
  <span class="s3">var </span><span class="s1">metavars;</span>

  <span class="s3">var </span><span class="s1">buildMetavar = </span><span class="s3">this</span><span class="s1">._metavarFormatter(action, metavarDefault);</span>

  <span class="s3">switch </span><span class="s1">(action.nargs) {</span>
    <span class="s0">/*eslint-disable no-undefined*/</span>
    <span class="s3">case </span><span class="s1">undefined:</span>
    <span class="s3">case null</span><span class="s1">:</span>
      <span class="s1">metavars = buildMetavar(</span><span class="s4">1</span><span class="s1">);</span>
      <span class="s1">result = </span><span class="s2">'' </span><span class="s1">+ metavars[</span><span class="s4">0</span><span class="s1">];</span>
      <span class="s3">break</span><span class="s1">;</span>
    <span class="s3">case </span><span class="s1">c.OPTIONAL:</span>
      <span class="s1">metavars = buildMetavar(</span><span class="s4">1</span><span class="s1">);</span>
      <span class="s1">result = </span><span class="s2">'[' </span><span class="s1">+ metavars[</span><span class="s4">0</span><span class="s1">] + </span><span class="s2">']'</span><span class="s1">;</span>
      <span class="s3">break</span><span class="s1">;</span>
    <span class="s3">case </span><span class="s1">c.ZERO_OR_MORE:</span>
      <span class="s1">metavars = buildMetavar(</span><span class="s4">2</span><span class="s1">);</span>
      <span class="s1">result = </span><span class="s2">'[' </span><span class="s1">+ metavars[</span><span class="s4">0</span><span class="s1">] + </span><span class="s2">' [' </span><span class="s1">+ metavars[</span><span class="s4">1</span><span class="s1">] + </span><span class="s2">' ...]]'</span><span class="s1">;</span>
      <span class="s3">break</span><span class="s1">;</span>
    <span class="s3">case </span><span class="s1">c.ONE_OR_MORE:</span>
      <span class="s1">metavars = buildMetavar(</span><span class="s4">2</span><span class="s1">);</span>
      <span class="s1">result = </span><span class="s2">'' </span><span class="s1">+ metavars[</span><span class="s4">0</span><span class="s1">] + </span><span class="s2">' [' </span><span class="s1">+ metavars[</span><span class="s4">1</span><span class="s1">] + </span><span class="s2">' ...]'</span><span class="s1">;</span>
      <span class="s3">break</span><span class="s1">;</span>
    <span class="s3">case </span><span class="s1">c.REMAINDER:</span>
      <span class="s1">result = </span><span class="s2">'...'</span><span class="s1">;</span>
      <span class="s3">break</span><span class="s1">;</span>
    <span class="s3">case </span><span class="s1">c.PARSER:</span>
      <span class="s1">metavars = buildMetavar(</span><span class="s4">1</span><span class="s1">);</span>
      <span class="s1">result = metavars[</span><span class="s4">0</span><span class="s1">] + </span><span class="s2">' ...'</span><span class="s1">;</span>
      <span class="s3">break</span><span class="s1">;</span>
    <span class="s3">default</span><span class="s1">:</span>
      <span class="s1">metavars = buildMetavar(action.nargs);</span>
      <span class="s1">result = metavars.join(</span><span class="s2">' '</span><span class="s1">);</span>
  <span class="s1">}</span>
  <span class="s3">return </span><span class="s1">result;</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._expandHelp = </span><span class="s3">function </span><span class="s1">(action) {</span>
  <span class="s3">var </span><span class="s1">params = { prog: </span><span class="s3">this</span><span class="s1">._prog };</span>

  <span class="s1">Object.keys(action).forEach(</span><span class="s3">function </span><span class="s1">(actionProperty) {</span>
    <span class="s3">var </span><span class="s1">actionValue = action[actionProperty];</span>

    <span class="s3">if </span><span class="s1">(actionValue !== c.SUPPRESS) {</span>
      <span class="s1">params[actionProperty] = actionValue;</span>
    <span class="s1">}</span>
  <span class="s1">});</span>

  <span class="s3">if </span><span class="s1">(params.choices) {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s1">params.choices === </span><span class="s2">'string'</span><span class="s1">) {</span>
      <span class="s1">params.choices = params.choices.split(</span><span class="s2">''</span><span class="s1">).join(</span><span class="s2">', '</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(Array.isArray(params.choices)) {</span>
      <span class="s1">params.choices = params.choices.join(</span><span class="s2">', '</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s1">params.choices = Object.keys(params.choices).join(</span><span class="s2">', '</span><span class="s1">);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s3">return </span><span class="s1">sprintf(</span><span class="s3">this</span><span class="s1">._getHelpString(action), params);</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._splitLines = </span><span class="s3">function </span><span class="s1">(text, width) {</span>
  <span class="s3">var </span><span class="s1">lines = [];</span>
  <span class="s3">var </span><span class="s1">delimiters = [ </span><span class="s2">' '</span><span class="s1">, </span><span class="s2">'.'</span><span class="s1">, </span><span class="s2">','</span><span class="s1">, </span><span class="s2">'!'</span><span class="s1">, </span><span class="s2">'?' </span><span class="s1">];</span>
  <span class="s3">var </span><span class="s1">re = </span><span class="s3">new </span><span class="s1">RegExp(</span><span class="s2">'[' </span><span class="s1">+ delimiters.join(</span><span class="s2">''</span><span class="s1">) + </span><span class="s2">'][^' </span><span class="s1">+ delimiters.join(</span><span class="s2">''</span><span class="s1">) + </span><span class="s2">']*$'</span><span class="s1">);</span>

  <span class="s1">text = text.replace(/[\n\|\t]/g, </span><span class="s2">' '</span><span class="s1">);</span>

  <span class="s1">text = text.trim();</span>
  <span class="s1">text = text.replace(</span><span class="s3">this</span><span class="s1">._whitespaceMatcher, </span><span class="s2">' '</span><span class="s1">);</span>

  <span class="s0">// Wraps the single paragraph in text (a string) so every line</span>
  <span class="s0">// is at most width characters long.</span>
  <span class="s1">text.split(c.EOL).forEach(</span><span class="s3">function </span><span class="s1">(line) {</span>
    <span class="s3">if </span><span class="s1">(width &gt;= line.length) {</span>
      <span class="s1">lines.push(line);</span>
      <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">var </span><span class="s1">wrapStart = </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">var </span><span class="s1">wrapEnd = width;</span>
    <span class="s3">var </span><span class="s1">delimiterIndex = </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">while </span><span class="s1">(wrapEnd &lt;= line.length) {</span>
      <span class="s3">if </span><span class="s1">(wrapEnd !== line.length &amp;&amp; delimiters.indexOf(line[wrapEnd] &lt; -</span><span class="s4">1</span><span class="s1">)) {</span>
        <span class="s1">delimiterIndex = (re.exec(line.substring(wrapStart, wrapEnd)) || {}).index;</span>
        <span class="s1">wrapEnd = wrapStart + delimiterIndex + </span><span class="s4">1</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s1">lines.push(line.substring(wrapStart, wrapEnd));</span>
      <span class="s1">wrapStart = wrapEnd;</span>
      <span class="s1">wrapEnd += width;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(wrapStart &lt; line.length) {</span>
      <span class="s1">lines.push(line.substring(wrapStart, wrapEnd));</span>
    <span class="s1">}</span>
  <span class="s1">});</span>

  <span class="s3">return </span><span class="s1">lines;</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._fillText = </span><span class="s3">function </span><span class="s1">(text, width, indent) {</span>
  <span class="s3">var </span><span class="s1">lines = </span><span class="s3">this</span><span class="s1">._splitLines(text, width);</span>
  <span class="s1">lines = lines.map(</span><span class="s3">function </span><span class="s1">(line) {</span>
    <span class="s3">return </span><span class="s1">indent + line;</span>
  <span class="s1">});</span>
  <span class="s3">return </span><span class="s1">lines.join(c.EOL);</span>
<span class="s1">};</span>

<span class="s1">HelpFormatter.prototype._getHelpString = </span><span class="s3">function </span><span class="s1">(action) {</span>
  <span class="s3">return </span><span class="s1">action.help;</span>
<span class="s1">};</span>
</pre>
</body>
</html>