<html>
<head>
<title>downloadProfile.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #6a8759;}
.s2 { color: #6897bb; font-style: italic;}
.s3 { color: #cc7832; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
downloadProfile.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;getLatestFile&quot;</span><span class="s0">,</span><span class="s1">&quot;packageNameWithSuffix&quot;</span><span class="s0">,</span><span class="s1">&quot;file&quot;</span><span class="s0">,</span><span class="s1">&quot;execSync&quot;</span><span class="s0">,</span><span class="s1">&quot;toString&quot;</span><span class="s0">,</span><span class="s1">&quot;trim&quot;</span><span class="s0">,</span><span class="s1">&quot;e&quot;</span><span class="s0">,</span><span class="s1">&quot;execSyncWithLog&quot;</span><span class="s0">,</span><span class="s1">&quot;command&quot;</span><span class="s0">,</span><span class="s1">&quot;logger&quot;</span><span class="s0">,</span><span class="s1">&quot;debug&quot;</span><span class="s0">,</span><span class="s1">&quot;downloadProfile&quot;</span><span class="s0">,</span><span class="s1">&quot;ctx&quot;</span><span class="s0">,</span><span class="s1">&quot;dstPath&quot;</span><span class="s0">,</span><span class="s1">&quot;filename&quot;</span><span class="s0">,</span><span class="s1">&quot;sourcemapPath&quot;</span><span class="s0">,</span><span class="s1">&quot;raw&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldGenerateSourcemap&quot;</span><span class="s0">,</span><span class="s1">&quot;port&quot;</span><span class="s0">,</span><span class="s1">&quot;appId&quot;</span><span class="s0">,</span><span class="s1">&quot;appIdSuffix&quot;</span><span class="s0">,</span><span class="s1">&quot;androidProject&quot;</span><span class="s0">,</span><span class="s1">&quot;getAndroidProject&quot;</span><span class="s0">,</span><span class="s1">&quot;packageName&quot;</span><span class="s0">,</span><span class="s1">&quot;filter&quot;</span><span class="s0">,</span><span class="s1">&quot;Boolean&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;CLIError&quot;</span><span class="s0">,</span><span class="s1">&quot;info&quot;</span><span class="s0">,</span><span class="s1">&quot;root&quot;</span><span class="s0">,</span><span class="s1">&quot;success&quot;</span><span class="s0">,</span><span class="s1">&quot;osTmpDir&quot;</span><span class="s0">,</span><span class="s1">&quot;os&quot;</span><span class="s0">,</span><span class="s1">&quot;tmpdir&quot;</span><span class="s0">,</span><span class="s1">&quot;tempFilePath&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;generateSourcemap&quot;</span><span class="s0">,</span><span class="s1">&quot;findSourcemap&quot;</span><span class="s0">,</span><span class="s1">&quot;warn&quot;</span><span class="s0">,</span><span class="s1">&quot;events&quot;</span><span class="s0">,</span><span class="s1">&quot;transformer&quot;</span><span class="s0">,</span><span class="s1">&quot;transformedFilePath&quot;</span><span class="s0">,</span><span class="s1">&quot;basename&quot;</span><span class="s0">,</span><span class="s1">&quot;fs&quot;</span><span class="s0">,</span><span class="s1">&quot;writeFileSync&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">],</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/profileHermes/downloadProfile.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import {Config} from '@react-native-community/cli-types';</span><span class="s3">\n</span><span class="s1">import {execSync} from 'child_process';</span><span class="s3">\n</span><span class="s1">import {logger, CLIError} from '@react-native-community/cli-tools';</span><span class="s3">\n</span><span class="s1">import fs from 'fs';</span><span class="s3">\n</span><span class="s1">import path from 'path';</span><span class="s3">\n</span><span class="s1">import os from 'os';</span><span class="s3">\n</span><span class="s1">import transformer from 'hermes-profile-transformer';</span><span class="s3">\n</span><span class="s1">import {findSourcemap, generateSourcemap} from './sourcemapUtils';</span><span class="s3">\n</span><span class="s1">import {getAndroidProject} from '@react-native-community/cli-platform-android';</span><span class="s3">\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Get the last modified hermes profile</span><span class="s3">\n </span><span class="s1">* @param packageNameWithSuffix</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function getLatestFile(packageNameWithSuffix: string): string {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">const file = execSync(`adb shell run-as ${packageNameWithSuffix} ls cache/ -tp | grep -v /$ | grep -E '.cpuprofile' | head -1</span><span class="s3">\n        </span><span class="s1">`);</span><span class="s3">\n    </span><span class="s1">return file.toString().trim();</span><span class="s3">\n  </span><span class="s1">} catch (e) {</span><span class="s3">\n    </span><span class="s1">throw e;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function execSyncWithLog(command: string) {</span><span class="s3">\n  </span><span class="s1">logger.debug(`${command}`);</span><span class="s3">\n  </span><span class="s1">return execSync(command);</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Pull and convert a Hermes tracing profile to Chrome tracing profile</span><span class="s3">\n </span><span class="s1">* @param ctx</span><span class="s3">\n </span><span class="s1">* @param dstPath</span><span class="s3">\n </span><span class="s1">* @param fileName</span><span class="s3">\n </span><span class="s1">* @param sourceMapPath</span><span class="s3">\n </span><span class="s1">* @param raw</span><span class="s3">\n </span><span class="s1">* @param generateSourceMap</span><span class="s3">\n </span><span class="s1">* @param appId</span><span class="s3">\n </span><span class="s1">* @param appIdSuffix</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export async function downloadProfile(</span><span class="s3">\n  </span><span class="s1">ctx: Config,</span><span class="s3">\n  </span><span class="s1">dstPath: string,</span><span class="s3">\n  </span><span class="s1">filename?: string,</span><span class="s3">\n  </span><span class="s1">sourcemapPath?: string,</span><span class="s3">\n  </span><span class="s1">raw?: boolean,</span><span class="s3">\n  </span><span class="s1">shouldGenerateSourcemap?: boolean,</span><span class="s3">\n  </span><span class="s1">port?: string,</span><span class="s3">\n  </span><span class="s1">appId?: string,</span><span class="s3">\n  </span><span class="s1">appIdSuffix?: string,</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">const androidProject = getAndroidProject(ctx);</span><span class="s3">\n    </span><span class="s1">const packageNameWithSuffix = [</span><span class="s3">\n      </span><span class="s1">appId || androidProject.packageName,</span><span class="s3">\n      </span><span class="s1">appIdSuffix,</span><span class="s3">\n    </span><span class="s1">]</span><span class="s3">\n      </span><span class="s1">.filter(Boolean)</span><span class="s3">\n      </span><span class="s1">.join('.');</span><span class="s3">\n\n    </span><span class="s1">// If file name is not specified, pull the latest file from device</span><span class="s3">\n    </span><span class="s1">const file = filename || getLatestFile(packageNameWithSuffix);</span><span class="s3">\n    </span><span class="s1">if (!file) {</span><span class="s3">\n      </span><span class="s1">throw new CLIError(</span><span class="s3">\n        </span><span class="s1">'There is no file in the cache/ directory. Did you record a profile from the developer menu?',</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">logger.info(`File to be pulled: ${file}`);</span><span class="s3">\n\n    </span><span class="s1">// If destination path is not specified, pull to the current directory</span><span class="s3">\n    </span><span class="s1">dstPath = dstPath || ctx.root;</span><span class="s3">\n\n    </span><span class="s1">logger.debug('Internal commands run to pull the file:');</span><span class="s3">\n\n    </span><span class="s1">// If --raw, pull the hermes profile to dstPath</span><span class="s3">\n    </span><span class="s1">if (raw) {</span><span class="s3">\n      </span><span class="s1">execSyncWithLog(</span><span class="s3">\n        </span><span class="s1">`adb shell run-as ${packageNameWithSuffix} cat cache/${file} &gt; ${dstPath}/${file}`,</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n      </span><span class="s1">logger.success(`Successfully pulled the file to ${dstPath}/${file}`);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Else: transform the profile to Chrome format and pull it to dstPath</span><span class="s3">\n    </span><span class="s1">else {</span><span class="s3">\n      </span><span class="s1">const osTmpDir = os.tmpdir();</span><span class="s3">\n      </span><span class="s1">const tempFilePath = path.join(osTmpDir, file);</span><span class="s3">\n\n      </span><span class="s1">execSyncWithLog(</span><span class="s3">\n        </span><span class="s1">`adb shell run-as ${packageNameWithSuffix} cat cache/${file} &gt; ${tempFilePath}`,</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n      </span><span class="s1">// If path to source map is not given</span><span class="s3">\n      </span><span class="s1">if (!sourcemapPath) {</span><span class="s3">\n        </span><span class="s1">// Get or generate the source map</span><span class="s3">\n        </span><span class="s1">if (shouldGenerateSourcemap) {</span><span class="s3">\n          </span><span class="s1">sourcemapPath = await generateSourcemap(port);</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n          </span><span class="s1">sourcemapPath = await findSourcemap(ctx, port);</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// Run without source map</span><span class="s3">\n        </span><span class="s1">if (!sourcemapPath) {</span><span class="s3">\n          </span><span class="s1">logger.warn(</span><span class="s3">\n            </span><span class="s1">'Cannot find source maps, running the transformer without it',</span><span class="s3">\n          </span><span class="s1">);</span><span class="s3">\n          </span><span class="s1">logger.info(</span><span class="s3">\n            </span><span class="s1">'Instructions on how to get source maps: set `bundleInDebug: true` in your app/build.gradle file, inside the `project.ext.react` map.',</span><span class="s3">\n          </span><span class="s1">);</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Run transformer tool to convert from Hermes to Chrome format</span><span class="s3">\n      </span><span class="s1">const events = await transformer(</span><span class="s3">\n        </span><span class="s1">tempFilePath,</span><span class="s3">\n        </span><span class="s1">sourcemapPath,</span><span class="s3">\n        </span><span class="s1">'index.bundle',</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n\n      </span><span class="s1">const transformedFilePath = `${dstPath}/${path.basename(</span><span class="s3">\n        </span><span class="s1">file,</span><span class="s3">\n        </span><span class="s1">'.cpuprofile',</span><span class="s3">\n      </span><span class="s1">)}-converted.json`;</span><span class="s3">\n      </span><span class="s1">fs.writeFileSync(</span><span class="s3">\n        </span><span class="s1">transformedFilePath,</span><span class="s3">\n        </span><span class="s1">JSON.stringify(events, undefined, 4),</span><span class="s3">\n        </span><span class="s1">'utf-8',</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n      </span><span class="s1">logger.success(</span><span class="s3">\n        </span><span class="s1">`Successfully converted to Chrome tracing format and pulled the file to ${transformedFilePath}`,</span><span class="s3">\n      </span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} catch (e) {</span><span class="s3">\n    </span><span class="s1">throw e;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">}</span></pre>
</body>
</html>