<html>
<head>
<title>codegen_utils-test.rb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #ffc66d;}
.s5 { color: #a9b7c6;}
.s6 { color: #9876aa; font-style: italic;}
.s7 { color: #6897bb; font-style: italic;}
.s8 { color: #cc7832; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
codegen_utils-test.rb</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright (c) Meta Platforms, Inc. and affiliates.</span>
<span class="s0">#</span>
<span class="s0"># This source code is licensed under the MIT license found in the</span>
<span class="s0"># LICENSE file in the root directory of this source tree.</span>

<span class="s2">require </span><span class="s3">&quot;test/unit&quot;</span>
<span class="s2">require </span><span class="s3">&quot;json&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;../codegen_utils.rb&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;./test_utils/FileMock.rb&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;./test_utils/DirMock.rb&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;./test_utils/PodMock.rb&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;./test_utils/PathnameMock.rb&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;./test_utils/FinderMock.rb&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;./test_utils/CodegenUtilsMock.rb&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;./test_utils/CodegenScriptPhaseExtractorMock.rb&quot;</span>
<span class="s2">require_relative </span><span class="s3">&quot;./test_utils/FileUtilsMock.rb&quot;</span>

<span class="s0"># mocking the min_ios_version_supported function</span>
<span class="s0"># as it is not possible to require the original react_native_pod</span>
<span class="s0"># without incurring in circular deps</span>
<span class="s0"># TODO: move `min_ios_version_supported` to utils.rb</span>
<span class="s2">def </span><span class="s4">min_ios_version_supported</span>
    <span class="s2">return </span><span class="s3">'12.4'</span>
<span class="s2">end</span>

<span class="s2">class </span><span class="s5">CodegenUtilsTests </span><span class="s2">&lt; </span><span class="s5">Test::Unit::TestCase</span>
    <span class="s6">:base_path</span>

    <span class="s2">def </span><span class="s4">setup</span>
        <span class="s1">CodegenUtils.set_react_codegen_discovery_done(</span><span class="s6">false</span><span class="s1">)</span>
        <span class="s1">CodegenUtils.set_react_codegen_podspec_generated(</span><span class="s6">false</span><span class="s1">)</span>
        <span class="s1">Pod::Config.reset()</span>
        <span class="s5">@base_path </span><span class="s2">= </span><span class="s3">&quot;~/app/ios&quot;</span>
        <span class="s1">Pathname.pwd!(</span><span class="s5">@base_path</span><span class="s1">)</span>
        <span class="s1">Pod::Config.instance.installation_root.relative_path_from </span><span class="s2">= </span><span class="s5">@base_path</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">teardown</span>
        <span class="s1">FileUtils::FileUtilsStorage.reset()</span>
        <span class="s1">Finder.reset()</span>
        <span class="s1">Pathname.reset()</span>
        <span class="s1">Pod::UI.reset()</span>
        <span class="s1">Pod::Executable.reset()</span>
        <span class="s1">FileMock.reset()</span>
        <span class="s1">DirMock.reset()</span>
    <span class="s2">end</span>

    <span class="s0"># ================================== #</span>
    <span class="s0"># Test - GenerateReactCodegenPodspec #</span>
    <span class="s0"># ================================== #</span>

    <span class="s2">def </span><span class="s4">testGenerateReactCodegenPodspec_whenItHasBeenAlreadyGenerated_doesNothing</span>
        <span class="s0"># Arrange</span>
        <span class="s1">spec </span><span class="s2">= </span><span class="s1">{ </span><span class="s6">:name </span><span class="s1">=&gt; </span><span class="s3">&quot;Test Podspec&quot; </span><span class="s1">}</span>
        <span class="s1">codegen_output_dir </span><span class="s2">= </span><span class="s3">&quot;build&quot;</span>
        <span class="s1">CodegenUtils.set_react_codegen_podspec_generated(</span><span class="s6">true</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().generate_react_codegen_podspec!(spec, codegen_output_dir, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(Pod::UI.collected_messages, [</span><span class="s3">&quot;[Codegen] Skipping React-Codegen podspec generation.&quot;</span><span class="s1">])</span>
        <span class="s1">assert_equal(Pathname.pwd_invocation_count, </span><span class="s7">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(Pod::Executable.executed_commands, [])</span>
        <span class="s1">assert_equal(Pod::Config.instance.installation_root.relative_path_from_invocation_count, </span><span class="s7">0</span><span class="s1">)</span>
        <span class="s1">assert_true(CodegenUtils.react_codegen_podspec_generated)</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testGenerateReactCodegenPodspec_whenItHasNotBeenAlreadyGenerated_generatesIt</span>
        <span class="s0"># Arrange</span>
        <span class="s1">spec </span><span class="s2">= </span><span class="s1">{ </span><span class="s6">:name </span><span class="s1">=&gt; </span><span class="s3">&quot;Test Podspec&quot; </span><span class="s1">}</span>
        <span class="s1">codegen_output_dir </span><span class="s2">= </span><span class="s3">&quot;build&quot;</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().generate_react_codegen_podspec!(spec, codegen_output_dir, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(Pathname.pwd_invocation_count, </span><span class="s7">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(Pod::Config.instance.installation_root.relative_path_from_invocation_count, </span><span class="s7">1</span><span class="s1">)</span>
        <span class="s1">assert_equal(Pod::Executable.executed_commands, [{ </span><span class="s3">&quot;command&quot; </span><span class="s1">=&gt; </span><span class="s3">'mkdir'</span><span class="s1">, </span><span class="s3">&quot;arguments&quot; </span><span class="s1">=&gt; [</span><span class="s3">&quot;-p&quot;</span><span class="s1">, </span><span class="s3">&quot;~/app/ios/build&quot;</span><span class="s1">]}])</span>
        <span class="s1">assert_equal(Pod::UI.collected_messages, [</span><span class="s3">&quot;[Codegen] Generating ~/app/ios/build/React-Codegen.podspec.json&quot;</span><span class="s1">])</span>
        <span class="s1">assert_equal(FileMock.open_files_with_mode[</span><span class="s3">&quot;~/app/ios/build/React-Codegen.podspec.json&quot;</span><span class="s1">], </span><span class="s3">'w'</span><span class="s1">)</span>
        <span class="s1">assert_equal(FileMock.open_files[</span><span class="s7">0</span><span class="s1">].collected_write, [</span><span class="s3">'{&quot;name&quot;:&quot;Test Podspec&quot;}'</span><span class="s1">])</span>
        <span class="s1">assert_equal(FileMock.open_files[</span><span class="s7">0</span><span class="s1">].fsync_invocation_count, </span><span class="s7">1</span><span class="s1">)</span>

        <span class="s1">assert_true(CodegenUtils.react_codegen_podspec_generated)</span>
    <span class="s2">end</span>

    <span class="s0"># ========================== #</span>
    <span class="s0"># Test - GetReactCodegenSpec #</span>
    <span class="s0"># ========================== #</span>

    <span class="s2">def </span><span class="s4">testGetReactCodegenSpec_whenFabricDisabledAndNoScriptPhases_generatesAPodspec</span>
        <span class="s0"># Arrange</span>
        <span class="s1">FileMock.files_to_read(</span><span class="s3">'package.json' </span><span class="s1">=&gt; </span><span class="s3">'{ &quot;version&quot;: &quot;99.98.97&quot;}'</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">podspec </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_react_codegen_spec(</span>
            <span class="s3">'package.json'</span><span class="s1">,</span>
            <span class="s6">:fabric_enabled </span><span class="s1">=&gt; </span><span class="s6">false</span><span class="s1">,</span>
            <span class="s6">:hermes_enabled </span><span class="s1">=&gt; </span><span class="s6">true</span><span class="s1">,</span>
            <span class="s6">:script_phases </span><span class="s1">=&gt; </span><span class="s6">nil</span><span class="s1">,</span>
            <span class="s6">:file_manager </span><span class="s1">=&gt; </span><span class="s5">FileMock</span>
        <span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(podspec, get_podspec_no_fabric_no_script())</span>
        <span class="s1">assert_equal(Pod::UI.collected_messages, [])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testGetReactCodegenSpec_whenFabricEnabledAndScriptPhases_generatesAPodspec</span>
        <span class="s0"># Arrange</span>
        <span class="s1">FileMock.files_to_read(</span><span class="s3">'package.json' </span><span class="s1">=&gt; </span><span class="s3">'{ &quot;version&quot;: &quot;99.98.97&quot;}'</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">podspec </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_react_codegen_spec(</span>
            <span class="s3">'package.json'</span><span class="s1">,</span>
            <span class="s6">:fabric_enabled </span><span class="s1">=&gt; </span><span class="s6">true</span><span class="s1">,</span>
            <span class="s6">:hermes_enabled </span><span class="s1">=&gt; </span><span class="s6">true</span><span class="s1">,</span>
            <span class="s6">:script_phases </span><span class="s1">=&gt; </span><span class="s3">&quot;echo Test Script Phase&quot;</span><span class="s1">,</span>
            <span class="s6">:file_manager </span><span class="s1">=&gt; </span><span class="s5">FileMock</span>
        <span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(podspec, get_podspec_fabric_and_script_phases(</span><span class="s3">&quot;echo Test Script Phase&quot;</span><span class="s1">))</span>
        <span class="s1">assert_equal(Pod::UI.collected_messages, [</span><span class="s3">&quot;[Codegen] Adding script_phases to React-Codegen.&quot;</span><span class="s1">])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testGetReactCodegenSpec_whenUseFrameworksAndNewArch_generatesAPodspec</span>
        <span class="s0"># Arrange</span>
        <span class="s5">ENV</span><span class="s1">[</span><span class="s3">&quot;USE_FRAMEWORKS&quot;</span><span class="s1">] </span><span class="s2">= </span><span class="s3">&quot;static&quot;</span>
        <span class="s1">FileMock.files_to_read(</span><span class="s3">'package.json' </span><span class="s1">=&gt; </span><span class="s3">'{ &quot;version&quot;: &quot;99.98.97&quot;}'</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">podspec </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_react_codegen_spec(</span>
            <span class="s3">'package.json'</span><span class="s1">,</span>
            <span class="s6">:fabric_enabled </span><span class="s1">=&gt; </span><span class="s6">true</span><span class="s1">,</span>
            <span class="s6">:hermes_enabled </span><span class="s1">=&gt; </span><span class="s6">true</span><span class="s1">,</span>
            <span class="s6">:script_phases </span><span class="s1">=&gt; </span><span class="s6">nil</span><span class="s1">,</span>
            <span class="s6">:file_manager </span><span class="s1">=&gt; </span><span class="s5">FileMock</span>
        <span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(podspec, get_podspec_when_use_frameworks())</span>
        <span class="s1">assert_equal(Pod::UI.collected_messages, [])</span>
    <span class="s2">end</span>

    <span class="s0"># =============================== #</span>
    <span class="s0"># Test - GetCodegenConfigFromFile #</span>
    <span class="s0"># =============================== #</span>

    <span class="s2">def </span><span class="s4">testGetCodegenConfigFromFile_whenFileDoesNotExists_returnEmpty</span>
        <span class="s0"># Arrange</span>

        <span class="s0"># Act</span>
        <span class="s1">codegen </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_codegen_config_from_file(</span><span class="s3">'package.json'</span><span class="s1">, </span><span class="s3">'codegenConfig'</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(codegen, {})</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testGetCodegenConfigFromFile_whenFileExistsButHasNoKey_returnEmpty</span>
        <span class="s0"># Arrange</span>
        <span class="s1">FileMock.mocked_existing_files([</span><span class="s3">'package.json'</span><span class="s1">])</span>
        <span class="s1">FileMock.files_to_read(</span><span class="s3">'package.json' </span><span class="s1">=&gt; </span><span class="s3">'{ &quot;codegenConfig&quot;: {}}'</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">codegen </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_codegen_config_from_file(</span><span class="s3">'package.json'</span><span class="s1">, </span><span class="s3">'codegen'</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(codegen, {})</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testGetCodegenConfigFromFile_whenFileExistsAndHasKey_returnObject</span>
        <span class="s0"># Arrange</span>
        <span class="s1">FileMock.mocked_existing_files([</span><span class="s3">'package.json'</span><span class="s1">])</span>
        <span class="s1">FileMock.files_to_read(</span><span class="s3">'package.json' </span><span class="s1">=&gt; </span><span class="s3">'{ &quot;codegenConfig&quot;: {&quot;name&quot;: &quot;MySpec&quot;}}'</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">codegen </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_codegen_config_from_file(</span><span class="s3">'package.json'</span><span class="s1">, </span><span class="s3">'codegenConfig'</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock </span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(codegen, { </span><span class="s3">&quot;name&quot; </span><span class="s1">=&gt; </span><span class="s3">&quot;MySpec&quot;</span><span class="s1">})</span>
    <span class="s2">end</span>

    <span class="s0"># ======================= #</span>
    <span class="s0"># Test - GetListOfJSSpecs #</span>
    <span class="s0"># ======================= #</span>
    <span class="s2">def </span><span class="s4">testGetListOfJSSpecs_whenUsesLibraries_returnAListOfFiles</span>
        <span class="s0"># Arrange</span>
        <span class="s1">app_codegen_config </span><span class="s2">= </span><span class="s1">{</span>
            <span class="s3">'libraries' </span><span class="s1">=&gt; [</span>
                <span class="s1">{</span>
                    <span class="s3">'name' </span><span class="s1">=&gt; </span><span class="s3">'First Lib'</span><span class="s1">,</span>
                    <span class="s3">'jsSrcsDir' </span><span class="s1">=&gt; </span><span class="s3">'./firstlib/js'</span>
                <span class="s1">},</span>
                <span class="s1">{</span>
                    <span class="s3">'name' </span><span class="s1">=&gt; </span><span class="s3">'Second Lib'</span><span class="s1">,</span>
                    <span class="s3">'jsSrcsDir' </span><span class="s1">=&gt; </span><span class="s3">'./secondlib/js'</span>
                <span class="s1">},</span>
            <span class="s1">]</span>
        <span class="s1">}</span>
        <span class="s1">app_path </span><span class="s2">= </span><span class="s3">&quot;~/MyApp/&quot;</span>
        <span class="s1">Finder.set_files_for_paths({</span>
            <span class="s3">'~/MyApp/./firstlib/js' </span><span class="s1">=&gt; [</span><span class="s3">&quot;MyFabricComponent1NativeComponent.js&quot;</span><span class="s1">, </span><span class="s3">&quot;MyFabricComponent2NativeComponent.js&quot;</span><span class="s1">],</span>
            <span class="s3">'~/MyApp/./secondlib/js' </span><span class="s1">=&gt; [</span><span class="s3">&quot;NativeModule1.js&quot;</span><span class="s1">, </span><span class="s3">&quot;NativeModule2.js&quot;</span><span class="s1">],</span>
        <span class="s1">})</span>

        <span class="s0"># Act</span>
        <span class="s1">files </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_list_of_js_specs(app_codegen_config, app_path, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns , [</span><span class="s3">&quot;[Deprecated] You are using the old `libraries` array to list all your codegen.</span><span class="s8">\\</span><span class="s3">nThis method will be removed in the future.</span><span class="s8">\\</span><span class="s3">nUpdate your `package.json` with a single object.&quot;</span><span class="s1">])</span>
        <span class="s1">assert_equal(Finder.captured_paths, [</span><span class="s3">'~/MyApp/./firstlib/js'</span><span class="s1">, </span><span class="s3">'~/MyApp/./secondlib/js'</span><span class="s1">])</span>
        <span class="s1">assert_equal(files, [</span>
            <span class="s3">&quot;${PODS_ROOT}/../MyFabricComponent1NativeComponent.js&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;${PODS_ROOT}/../MyFabricComponent2NativeComponent.js&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;${PODS_ROOT}/../NativeModule1.js&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;${PODS_ROOT}/../NativeModule2.js&quot;</span><span class="s1">,</span>
        <span class="s1">])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testGetListOfJSSpecs_whenDoesNotUsesLibraries_returnAListOfFiles</span>
        <span class="s0"># Arrange</span>
        <span class="s1">app_codegen_config </span><span class="s2">= </span><span class="s1">{</span>
                <span class="s3">'name' </span><span class="s1">=&gt; </span><span class="s3">'First Lib'</span><span class="s1">,</span>
                <span class="s3">'jsSrcsDir' </span><span class="s1">=&gt; </span><span class="s3">'./js'</span>
            <span class="s1">}</span>

        <span class="s1">app_path </span><span class="s2">= </span><span class="s3">&quot;~/MyApp/&quot;</span>
        <span class="s1">Finder.set_files_for_paths({</span>
            <span class="s3">'~/MyApp/./js' </span><span class="s1">=&gt; [</span><span class="s3">&quot;MyFabricComponent1NativeComponent.js&quot;</span><span class="s1">, </span><span class="s3">&quot;NativeModule1.js&quot;</span><span class="s1">],</span>
        <span class="s1">})</span>

        <span class="s0"># Act</span>
        <span class="s1">files </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_list_of_js_specs(app_codegen_config, app_path, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns , [])</span>
        <span class="s1">assert_equal(Finder.captured_paths, [</span><span class="s3">'~/MyApp/./js'</span><span class="s1">])</span>
        <span class="s1">assert_equal(files, [</span>
            <span class="s3">&quot;${PODS_ROOT}/../MyFabricComponent1NativeComponent.js&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;${PODS_ROOT}/../NativeModule1.js&quot;</span><span class="s1">,</span>
        <span class="s1">])</span>
    <span class="s2">end</span>

    <span class="s0"># ================================== #</span>
    <span class="s0"># Test - GetReactCodegenScriptPhases #</span>
    <span class="s0"># ================================== #</span>

    <span class="s2">def </span><span class="s4">testGetReactCodegenScriptPhases_whenAppPathNotDefined_abort</span>
        <span class="s0"># Arrange</span>

        <span class="s0"># Act</span>
        <span class="s1">assert_raises() {</span>
            <span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_react_codegen_script_phases(</span><span class="s6">nil</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>
        <span class="s1">}</span>
        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns, [</span><span class="s3">&quot;[Codegen] error: app_path is required to use codegen discovery.&quot;</span><span class="s1">])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testGetReactCodegenScriptPhases_returnTheScriptObject</span>
        <span class="s0"># Arrange</span>
        <span class="s1">app_path </span><span class="s2">= </span><span class="s3">&quot;~/MyApp&quot;</span>
        <span class="s1">input_files </span><span class="s2">= </span><span class="s1">[</span><span class="s3">&quot;${PODS_ROOT}/../MyFabricComponent1NativeComponent.js&quot;</span><span class="s1">, </span><span class="s3">&quot;${PODS_ROOT}/../NativeModule1.js&quot;</span><span class="s1">]</span>
        <span class="s1">computed_script </span><span class="s2">= </span><span class="s3">&quot;echo ScriptPhases&quot;</span>
        <span class="s1">codegen_config </span><span class="s2">= </span><span class="s1">{ </span><span class="s3">&quot;name&quot; </span><span class="s1">=&gt; </span><span class="s3">&quot;MyCodegenModule&quot;</span><span class="s1">, </span><span class="s3">&quot;jsSrcsDir&quot; </span><span class="s1">=&gt; </span><span class="s3">&quot;./js&quot;</span><span class="s1">}</span>
        <span class="s1">codegen_utils_mock </span><span class="s2">= </span><span class="s1">CodegenUtilsMock.</span><span class="s2">new</span><span class="s1">(</span><span class="s6">:js_spec_list </span><span class="s1">=&gt; input_files, </span><span class="s6">:codegen_config </span><span class="s1">=&gt; codegen_config)</span>
        <span class="s1">script_phase_extractor_mock </span><span class="s2">= </span><span class="s1">CodegenScriptPhaseExtractorMock.</span><span class="s2">new</span><span class="s1">(computed_script)</span>

        <span class="s0"># Act</span>

        <span class="s1">scripts </span><span class="s2">= </span><span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().get_react_codegen_script_phases(</span>
            <span class="s1">app_path,</span>
            <span class="s6">:codegen_utils </span><span class="s1">=&gt; codegen_utils_mock,</span>
            <span class="s6">:script_phase_extractor </span><span class="s1">=&gt; script_phase_extractor_mock,</span>
            <span class="s6">:file_manager </span><span class="s1">=&gt; </span><span class="s5">FileMock</span>
        <span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(codegen_utils_mock.get_codegen_config_from_file_params, [{</span>
            <span class="s3">&quot;config_key&quot; </span><span class="s1">=&gt; </span><span class="s3">&quot;codegenConfig&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;config_path&quot; </span><span class="s1">=&gt; </span><span class="s3">&quot;~/MyApp/package.json&quot;</span>
        <span class="s1">}])</span>
        <span class="s1">assert_equal(codegen_utils_mock.get_list_of_js_specs_params, [{</span>
            <span class="s3">&quot;app_codegen_config&quot; </span><span class="s1">=&gt; {</span><span class="s3">&quot;jsSrcsDir&quot;</span><span class="s1">=&gt;</span><span class="s3">&quot;./js&quot;</span><span class="s1">, </span><span class="s3">&quot;name&quot;</span><span class="s1">=&gt;</span><span class="s3">&quot;MyCodegenModule&quot;</span><span class="s1">},</span>
            <span class="s3">&quot;app_path&quot; </span><span class="s1">=&gt; </span><span class="s3">&quot;~/MyApp&quot;</span>
        <span class="s1">}])</span>
        <span class="s1">assert_equal(script_phase_extractor_mock.extract_script_phase_params, [{</span>
            <span class="s6">fabric_enabled: false</span><span class="s1">,</span>
            <span class="s6">react_native_path: </span><span class="s3">&quot;../node_modules/react-native&quot;</span><span class="s1">,</span>
            <span class="s6">relative_app_root: </span><span class="s3">&quot;~/MyApp&quot;</span><span class="s1">,</span>
            <span class="s6">relative_config_file_dir: </span><span class="s3">&quot;&quot;</span>
        <span class="s1">}])</span>
        <span class="s1">assert_equal(scripts, {</span>
            <span class="s3">'name'</span><span class="s1">: </span><span class="s3">'Generate Specs'</span><span class="s1">,</span>
            <span class="s3">'execution_position'</span><span class="s1">: </span><span class="s6">:before_compile</span><span class="s1">,</span>
            <span class="s3">'input_files' </span><span class="s1">=&gt; input_files,</span>
            <span class="s3">'show_env_vars_in_log'</span><span class="s1">: </span><span class="s6">true</span><span class="s1">,</span>
            <span class="s3">'output_files'</span><span class="s1">: [</span><span class="s3">&quot;${DERIVED_FILE_DIR}/react-codegen.log&quot;</span><span class="s1">],</span>
            <span class="s3">'script'</span><span class="s1">: computed_script 
        })</span>
    <span class="s2">end</span>

    <span class="s0"># ================================ #</span>
    <span class="s0"># Test - UseReactCodegenDiscovery! #</span>
    <span class="s0"># ================================ #</span>

    <span class="s2">def </span><span class="s4">testUseReactCodegenDiscovery_whenCodegenDisabled_doNothing</span>
        <span class="s0"># Arrange</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().use_react_native_codegen_discovery!(</span><span class="s6">true</span><span class="s1">, </span><span class="s6">nil</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_false(CodegenUtils.react_codegen_discovery_done())</span>
        <span class="s1">assert_equal(Pod::UI.collected_messages, [])</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns, [])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testUseReactCodegenDiscovery_whenDiscoveryDone_doNothing</span>
        <span class="s0"># Arrange</span>
        <span class="s1">CodegenUtils.set_react_codegen_discovery_done(</span><span class="s6">true</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().use_react_native_codegen_discovery!(</span><span class="s6">false</span><span class="s1">, </span><span class="s6">nil</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_true(CodegenUtils.react_codegen_discovery_done())</span>
        <span class="s1">assert_equal(Pod::UI.collected_messages, [</span><span class="s3">&quot;[Codegen] Skipping use_react_native_codegen_discovery.&quot;</span><span class="s1">])</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns, [])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testUseReactCodegenDiscovery_whenAppPathUndefined_abort</span>
        <span class="s0"># Arrange</span>

        <span class="s0"># Act</span>
        <span class="s1">assert_raises(){</span>
            <span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().use_react_native_codegen_discovery!(</span><span class="s6">false</span><span class="s1">, </span><span class="s6">nil</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>
        <span class="s1">}</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_false(CodegenUtils.react_codegen_discovery_done())</span>
        <span class="s1">assert_equal(Pod::UI.collected_messages, [])</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns, [</span>
            <span class="s3">'[Codegen] Error: app_path is required for use_react_native_codegen_discovery.'</span><span class="s1">,</span>
            <span class="s3">'[Codegen] If you are calling use_react_native_codegen_discovery! in your Podfile, please remove the call and pass `app_path` and/or `config_file_dir` to `use_react_native!`.'</span>
        <span class="s1">])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testUseReactCodegenDiscovery_whenParametersAreGood_executeCodegen</span>
        <span class="s0"># Arrange</span>
        <span class="s1">app_path </span><span class="s2">= </span><span class="s3">&quot;~/app&quot;</span>
        <span class="s1">computed_script </span><span class="s2">= </span><span class="s3">&quot;echo TestScript&quot;</span>
        <span class="s1">codegen_spec </span><span class="s2">= </span><span class="s1">{</span><span class="s3">&quot;name&quot; </span><span class="s1">=&gt; </span><span class="s3">&quot;React-Codegen&quot;</span><span class="s1">}</span>

        <span class="s1">codegen_utils_mock </span><span class="s2">= </span><span class="s1">CodegenUtilsMock.</span><span class="s2">new</span><span class="s1">(</span>
            <span class="s6">:react_codegen_script_phases </span><span class="s1">=&gt; computed_script,</span>
            <span class="s6">:react_codegen_spec </span><span class="s1">=&gt; codegen_spec 
        )</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.</span><span class="s2">new</span><span class="s1">().use_react_native_codegen_discovery!(</span>
            <span class="s6">false</span><span class="s1">,</span>
            <span class="s1">app_path,</span>
            <span class="s6">:codegen_utils </span><span class="s1">=&gt; codegen_utils_mock,</span>
            <span class="s6">:file_manager </span><span class="s1">=&gt; </span><span class="s5">FileMock</span>
        <span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_true(CodegenUtils.react_codegen_discovery_done())</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns, [</span>
            <span class="s3">'[Codegen] warn: using experimental new codegen integration'</span>
        <span class="s1">])</span>
        <span class="s1">assert_equal(codegen_utils_mock.get_react_codegen_script_phases_params,  [{</span>
            <span class="s6">:app_path </span><span class="s1">=&gt; app_path,</span>
            <span class="s6">:config_file_dir </span><span class="s1">=&gt; </span><span class="s3">&quot;&quot;</span><span class="s1">,</span>
            <span class="s6">:config_key </span><span class="s1">=&gt; </span><span class="s3">&quot;codegenConfig&quot;</span><span class="s1">,</span>
            <span class="s6">:fabric_enabled </span><span class="s1">=&gt; </span><span class="s6">false</span><span class="s1">,</span>
            <span class="s6">:react_native_path </span><span class="s1">=&gt; </span><span class="s3">&quot;../node_modules/react-native&quot;</span><span class="s1">}</span>
        <span class="s1">])</span>
        <span class="s1">assert_equal(codegen_utils_mock.get_react_codegen_spec_params,  [{</span>
            <span class="s6">:fabric_enabled </span><span class="s1">=&gt; </span><span class="s6">false</span><span class="s1">,</span>
            <span class="s6">:folly_version</span><span class="s1">=&gt;</span><span class="s3">&quot;2021.07.22.00&quot;</span><span class="s1">,</span>
            <span class="s6">:package_json_file </span><span class="s1">=&gt; </span><span class="s3">&quot;#{app_path}/ios/../node_modules/react-native/package.json&quot;</span><span class="s1">,</span>
            <span class="s6">:script_phases </span><span class="s1">=&gt; </span><span class="s3">&quot;echo TestScript&quot;</span>
        <span class="s1">}])</span>
        <span class="s1">assert_equal(codegen_utils_mock.generate_react_codegen_spec_params,  [{</span>
            <span class="s6">:codegen_output_dir</span><span class="s1">=&gt;</span><span class="s3">&quot;build/generated/ios&quot;</span><span class="s1">,</span>
            <span class="s6">:react_codegen_spec</span><span class="s1">=&gt;{</span><span class="s3">&quot;name&quot;</span><span class="s1">=&gt;</span><span class="s3">&quot;React-Codegen&quot;</span><span class="s1">}</span>
        <span class="s1">}])</span>
        <span class="s1">assert_equal(Pod::Executable.executed_commands, [</span>
            <span class="s1">{</span>
                <span class="s3">&quot;command&quot; </span><span class="s1">=&gt; </span><span class="s3">&quot;node&quot;</span><span class="s1">,</span>
                <span class="s3">&quot;arguments&quot;</span><span class="s1">=&gt; [</span><span class="s3">&quot;~/app/ios/../node_modules/react-native/scripts/generate-codegen-artifacts.js&quot;</span><span class="s1">,</span>
                    <span class="s3">&quot;-p&quot;</span><span class="s1">, </span><span class="s3">&quot;~/app&quot;</span><span class="s1">,</span>
                    <span class="s3">&quot;-o&quot;</span><span class="s1">, Pod::Config.instance.installation_root,</span>
                    <span class="s3">&quot;-e&quot;</span><span class="s1">, </span><span class="s3">&quot;false&quot;</span><span class="s1">,</span>
                    <span class="s3">&quot;-c&quot;</span><span class="s1">, </span><span class="s3">&quot;&quot;</span><span class="s1">]</span>
            <span class="s1">}</span>
        <span class="s1">])</span>
    <span class="s2">end</span>

    <span class="s0"># ============================= #</span>
    <span class="s0"># Test - CleanUpCodegenFolder #</span>
    <span class="s0"># ============================= #</span>

    <span class="s2">def </span><span class="s4">testCleanUpCodegenFolder_whenCleanupDone_doNothing</span>
        <span class="s0"># Arrange</span>
        <span class="s1">CodegenUtils.set_cleanup_done(</span><span class="s6">true</span><span class="s1">)</span>
        <span class="s1">codegen_dir </span><span class="s2">= </span><span class="s3">&quot;build/generated/ios&quot;</span>
        <span class="s1">ios_folder </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s1">rn_path </span><span class="s2">= </span><span class="s3">'../node_modules/react-native'</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.clean_up_build_folder(rn_path, </span><span class="s5">@base_path</span><span class="s1">, ios_folder, codegen_dir, </span><span class="s6">dir_manager: </span><span class="s5">DirMock</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(FileUtils::FileUtilsStorage.rmrf_invocation_count, </span><span class="s7">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(FileUtils::FileUtilsStorage.rmrf_paths, [])</span>
        <span class="s1">assert_equal(CodegenUtils.cleanup_done(), </span><span class="s6">true</span><span class="s1">)</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testCleanUpCodegenFolder_whenFolderDoesNotExists_markAsCleanupDone</span>
        <span class="s0"># Arrange</span>
        <span class="s1">CodegenUtils.set_cleanup_done(</span><span class="s6">false</span><span class="s1">)</span>
        <span class="s1">codegen_dir </span><span class="s2">= </span><span class="s3">&quot;build/generated/ios&quot;</span>
        <span class="s1">ios_folder </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s1">rn_path </span><span class="s2">= </span><span class="s3">'../node_modules/react-native'</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.clean_up_build_folder(rn_path, </span><span class="s5">@base_path</span><span class="s1">, ios_folder, codegen_dir, </span><span class="s6">dir_manager: </span><span class="s5">DirMock</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(FileUtils::FileUtilsStorage.rmrf_invocation_count, </span><span class="s7">0</span><span class="s1">)</span>
        <span class="s1">assert_equal(FileUtils::FileUtilsStorage.rmrf_paths, [])</span>
        <span class="s1">assert_equal(DirMock.glob_invocation, [])</span>
        <span class="s1">assert_equal(CodegenUtils.cleanup_done(), </span><span class="s6">true</span><span class="s1">)</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">testCleanUpCodegenFolder_whenFolderExists_deleteItAndSetCleanupDone</span>
        <span class="s0"># Arrange</span>
        <span class="s1">CodegenUtils.set_cleanup_done(</span><span class="s6">false</span><span class="s1">)</span>
        <span class="s1">codegen_dir </span><span class="s2">= </span><span class="s3">&quot;build/generated/ios&quot;</span>
        <span class="s1">ios_folder </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s1">codegen_path </span><span class="s2">= </span><span class="s3">&quot;#{</span><span class="s5">@base_path</span><span class="s3">}/./#{codegen_dir}&quot;</span>
        <span class="s1">globs </span><span class="s2">= </span><span class="s1">[</span>
            <span class="s3">&quot;/MyModuleSpecs/MyModule.h&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;#{codegen_path}/MyModuleSpecs/MyModule.mm&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;#{codegen_path}/react/components/MyComponent/ShadowNode.h&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;#{codegen_path}/react/components/MyComponent/ShadowNode.mm&quot;</span><span class="s1">,</span>
        <span class="s1">]</span>
        <span class="s1">rn_path </span><span class="s2">= </span><span class="s3">'../node_modules/react-native'</span>

        <span class="s1">DirMock.mocked_existing_dirs(codegen_path)</span>
        <span class="s1">DirMock.mocked_existing_globs(globs, </span><span class="s3">&quot;#{codegen_path}/*&quot;</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.clean_up_build_folder(rn_path, </span><span class="s5">@base_path</span><span class="s1">, ios_folder, codegen_dir, </span><span class="s6">dir_manager: </span><span class="s5">DirMock</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(DirMock.exist_invocation_params, [codegen_path, codegen_path])</span>
        <span class="s1">assert_equal(DirMock.glob_invocation, [</span><span class="s3">&quot;#{codegen_path}/*&quot;</span><span class="s1">, </span><span class="s3">&quot;#{codegen_path}/*&quot;</span><span class="s1">])</span>
        <span class="s1">assert_equal(FileUtils::FileUtilsStorage.rmrf_invocation_count, </span><span class="s7">3</span><span class="s1">)</span>
        <span class="s1">assert_equal(FileUtils::FileUtilsStorage.rmrf_paths, [</span>
            <span class="s1">globs,</span>
            <span class="s3">&quot;#{rn_path}/React/Fabric/RCTThirdPartyFabricComponentsProvider.h&quot;</span><span class="s1">,</span>
            <span class="s3">&quot;#{rn_path}/React/Fabric/RCTThirdPartyFabricComponentsProvider.mm&quot;</span><span class="s1">,</span>
        <span class="s1">])</span>
        <span class="s1">assert_equal(CodegenUtils.cleanup_done(), </span><span class="s6">true</span><span class="s1">)</span>
    <span class="s2">end</span>

    <span class="s0"># ===================================== #</span>
    <span class="s0"># Test - Assert Codegen Folder Is Empty #</span>
    <span class="s0"># ===================================== #</span>

    <span class="s2">def </span><span class="s4">test_assertCodegenFolderIsEmpty_whenItDoesNotExists_doesNotAbort</span>
        <span class="s0"># Arrange</span>
        <span class="s1">codegen_dir </span><span class="s2">= </span><span class="s3">&quot;build/generated/ios&quot;</span>
        <span class="s1">codegen_path </span><span class="s2">= </span><span class="s3">&quot;#{</span><span class="s5">@base_path</span><span class="s3">}/./#{codegen_dir}&quot;</span>
        <span class="s1">ios_folder </span><span class="s2">= </span><span class="s3">'.'</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.assert_codegen_folder_is_empty(</span><span class="s5">@base_path</span><span class="s1">, ios_folder, codegen_dir, </span><span class="s6">dir_manager: </span><span class="s5">DirMock</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns, [])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">test_assertCodegenFolderIsEmpty_whenItExistsAndIsEmpty_doesNotAbort</span>
        <span class="s0"># Arrange</span>
        <span class="s1">codegen_dir </span><span class="s2">= </span><span class="s3">&quot;build/generated/ios&quot;</span>
        <span class="s1">codegen_path </span><span class="s2">= </span><span class="s3">&quot;#{</span><span class="s5">@base_path</span><span class="s3">}/./#{codegen_dir}&quot;</span>
        <span class="s1">ios_folder </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s1">DirMock.mocked_existing_dirs(codegen_path)</span>
        <span class="s1">DirMock.mocked_existing_globs([], </span><span class="s3">&quot;#{codegen_path}/*&quot;</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">CodegenUtils.assert_codegen_folder_is_empty(</span><span class="s5">@base_path</span><span class="s1">, ios_folder, codegen_dir, </span><span class="s6">dir_manager: </span><span class="s5">DirMock</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns, [])</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">test_assertCodegenFolderIsEmpty_whenItIsNotEmpty_itAborts</span>
        <span class="s0"># Arrange</span>
        <span class="s1">codegen_dir </span><span class="s2">= </span><span class="s3">&quot;build/generated/ios&quot;</span>
        <span class="s1">codegen_path </span><span class="s2">= </span><span class="s3">&quot;#{</span><span class="s5">@base_path</span><span class="s3">}/./#{codegen_dir}&quot;</span>
        <span class="s1">ios_folder </span><span class="s2">= </span><span class="s3">'.'</span>
        <span class="s1">DirMock.mocked_existing_dirs(codegen_path)</span>
        <span class="s1">DirMock.mocked_existing_globs([</span><span class="s3">&quot;#{codegen_path}/MyModuleSpecs/MyModule.mm&quot;</span><span class="s1">,], </span><span class="s3">&quot;#{codegen_path}/*&quot;</span><span class="s1">)</span>

        <span class="s0"># Act</span>
        <span class="s1">assert_raises() {</span>
            <span class="s1">CodegenUtils.assert_codegen_folder_is_empty(</span><span class="s5">@base_path</span><span class="s1">, ios_folder, codegen_dir, </span><span class="s6">dir_manager: </span><span class="s5">DirMock</span><span class="s1">, </span><span class="s6">file_manager: </span><span class="s5">FileMock</span><span class="s1">)</span>
        <span class="s1">}</span>

        <span class="s0"># Assert</span>
        <span class="s1">assert_equal(Pod::UI.collected_warns, [</span>
            <span class="s3">&quot;Unable to remove the content of ~/app/ios/./build/generated/ios folder. Please run rm -rf ~/app/ios/./build/generated/ios and try again.&quot;</span>
        <span class="s1">])</span>
    <span class="s2">end</span>

    <span class="s2">private</span>

    <span class="s2">def </span><span class="s4">get_podspec_no_fabric_no_script</span>
        <span class="s1">spec </span><span class="s2">= </span><span class="s1">{</span>
          <span class="s3">'name' </span><span class="s1">=&gt; </span><span class="s3">&quot;React-Codegen&quot;</span><span class="s1">,</span>
          <span class="s3">'version' </span><span class="s1">=&gt; </span><span class="s3">&quot;99.98.97&quot;</span><span class="s1">,</span>
          <span class="s3">'summary' </span><span class="s1">=&gt; </span><span class="s3">'Temp pod for generated files for React Native'</span><span class="s1">,</span>
          <span class="s3">'homepage' </span><span class="s1">=&gt; </span><span class="s3">'https://facebook.com/'</span><span class="s1">,</span>
          <span class="s3">'license' </span><span class="s1">=&gt; </span><span class="s3">'Unlicense'</span><span class="s1">,</span>
          <span class="s3">'authors' </span><span class="s1">=&gt; </span><span class="s3">'Facebook'</span><span class="s1">,</span>
          <span class="s3">'compiler_flags'  </span><span class="s1">=&gt; </span><span class="s3">&quot;-DFOLLY_NO_CONFIG -DFOLLY_MOBILE=1 -DFOLLY_USE_LIBCPP=1 -Wno-comma -Wno-shorten-64-to-32 -Wno-documentation -Wno-nullability-completeness -std=c++17&quot;</span><span class="s1">,</span>
          <span class="s3">'source' </span><span class="s1">=&gt; { </span><span class="s6">:git </span><span class="s1">=&gt; </span><span class="s3">'' </span><span class="s1">},</span>
          <span class="s3">'header_mappings_dir' </span><span class="s1">=&gt; </span><span class="s3">'./'</span><span class="s1">,</span>
          <span class="s3">'platforms' </span><span class="s1">=&gt; {</span>
            <span class="s3">'ios' </span><span class="s1">=&gt; </span><span class="s3">'12.4'</span><span class="s1">,</span>
          <span class="s1">},</span>
          <span class="s3">'source_files' </span><span class="s1">=&gt; </span><span class="s3">&quot;**/*.{h,mm,cpp}&quot;</span><span class="s1">,</span>
          <span class="s3">'pod_target_xcconfig' </span><span class="s1">=&gt; {</span>
            <span class="s3">&quot;FRAMEWORK_SEARCH_PATHS&quot; </span><span class="s1">=&gt; [],</span>
            <span class="s3">&quot;HEADER_SEARCH_PATHS&quot; </span><span class="s1">=&gt;</span>
            <span class="s1">[</span>
              <span class="s3">&quot;</span><span class="s8">\&quot;</span><span class="s3">$(PODS_ROOT)/boost</span><span class="s8">\&quot;</span><span class="s3">&quot;</span><span class="s1">,</span>
              <span class="s3">&quot;</span><span class="s8">\&quot;</span><span class="s3">$(PODS_ROOT)/RCT-Folly</span><span class="s8">\&quot;</span><span class="s3">&quot;</span><span class="s1">,</span>
              <span class="s3">&quot;</span><span class="s8">\&quot;</span><span class="s3">${PODS_ROOT}/Headers/Public/React-Codegen/react/renderer/components</span><span class="s8">\&quot;</span><span class="s3">&quot;</span><span class="s1">,</span>
              <span class="s3">&quot;</span><span class="s8">\&quot;</span><span class="s3">$(PODS_ROOT)/Headers/Private/React-Fabric</span><span class="s8">\&quot;</span><span class="s3">&quot;</span><span class="s1">,</span>
              <span class="s3">&quot;</span><span class="s8">\&quot;</span><span class="s3">$(PODS_ROOT)/Headers/Private/React-RCTFabric</span><span class="s8">\&quot;</span><span class="s3">&quot;</span><span class="s1">,</span>
            <span class="s1">].join(</span><span class="s3">' '</span><span class="s1">)</span>
          <span class="s1">},</span>
          <span class="s3">'dependencies'</span><span class="s1">: {</span>
            <span class="s3">&quot;DoubleConversion&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;FBReactNativeSpec&quot;</span><span class="s1">:  [],</span>
            <span class="s3">&quot;RCT-Folly&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;RCTRequired&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;RCTTypeSafety&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;React-Core&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;React-jsi&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;React-jsiexecutor&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;React-rncore&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;ReactCommon/turbomodule/bridging&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;ReactCommon/turbomodule/core&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;hermes-engine&quot;</span><span class="s1">: [],</span>
            <span class="s3">&quot;glog&quot;</span><span class="s1">: [],</span>
            <span class="s3">'React-NativeModulesApple'</span><span class="s1">: [],</span>
          <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s2">end</span>

    <span class="s2">def </span><span class="s4">get_podspec_fabric_and_script_phases</span><span class="s1">(</span><span class="s5">script_phases</span><span class="s1">)</span>
        <span class="s1">specs </span><span class="s2">= </span><span class="s1">get_podspec_no_fabric_no_script()</span>

        <span class="s1">specs[</span><span class="s6">:dependencies</span><span class="s1">].merge!({</span>
            <span class="s3">'React-graphics'</span><span class="s1">: [],</span>
            <span class="s3">'React-rncore'</span><span class="s1">:  [],</span>
            <span class="s3">'React-Fabric'</span><span class="s1">: [],</span>
            <span class="s3">'React-utils'</span><span class="s1">: [],</span>
            <span class="s3">'React-debug'</span><span class="s1">: [],</span>
        <span class="s1">})</span>

        <span class="s1">specs[</span><span class="s6">:'script_phases'</span><span class="s1">] </span><span class="s2">= </span><span class="s1">script_phases 
</span>
        <span class="s2">return </span><span class="s1">specs 
    </span><span class="s2">end</span>

    <span class="s2">def </span><span class="s4">get_podspec_when_use_frameworks</span>
        <span class="s1">specs </span><span class="s2">= </span><span class="s1">get_podspec_no_fabric_no_script()</span>

        <span class="s1">specs[</span><span class="s3">&quot;pod_target_xcconfig&quot;</span><span class="s1">][</span><span class="s3">&quot;FRAMEWORK_SEARCH_PATHS&quot;</span><span class="s1">].concat([])</span>
        <span class="s1">specs[</span><span class="s3">&quot;pod_target_xcconfig&quot;</span><span class="s1">][</span><span class="s3">&quot;HEADER_SEARCH_PATHS&quot;</span><span class="s1">].concat(</span><span class="s3">&quot; </span><span class="s8">\&quot;</span><span class="s3">$(PODS_ROOT)/DoubleConversion</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_TARGET_SRCROOT)</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/React-Fabric/React_Fabric.framework/Headers</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/React-graphics/React_graphics.framework/Headers</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/React-graphics/React_graphics.framework/Headers/react/renderer/graphics/platform/ios</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/ReactCommon/ReactCommon.framework/Headers</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/ReactCommon/ReactCommon.framework/Headers/react/nativemodule/core</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/React-NativeModulesApple/React_NativeModulesApple.framework/Headers</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/React-RCTFabric/RCTFabric.framework/Headers</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/React-debug/React_debug.framework/Headers</span><span class="s8">\&quot; \&quot;</span><span class="s3">$(PODS_CONFIGURATION_BUILD_DIR)/React-utils/React_utils.framework/Headers</span><span class="s8">\&quot;</span><span class="s3">&quot;</span><span class="s1">)</span>

        <span class="s1">specs[</span><span class="s6">:dependencies</span><span class="s1">].merge!({</span>
            <span class="s3">'React-graphics'</span><span class="s1">: [],</span>
            <span class="s3">'React-Fabric'</span><span class="s1">: [],</span>
            <span class="s3">'React-utils'</span><span class="s1">: [],</span>
            <span class="s3">'React-debug'</span><span class="s1">: [],</span>
        <span class="s1">})</span>

        <span class="s2">return </span><span class="s1">specs 
    </span><span class="s2">end</span>
<span class="s2">end</span>
</pre>
</body>
</html>