<html>
<head>
<title>BaseViewManager.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #629755; font-style: italic;}
.s4 { color: #629755; font-weight: bold; font-style: italic;}
.s5 { color: #6897bb;}
.s6 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
BaseViewManager.java</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 * Copyright (c) Meta Platforms, Inc. and affiliates. 
 * 
 * This source code is licensed under the MIT license found in the 
 * LICENSE file in the root directory of this source tree. 
 */</span>

<span class="s2">package </span><span class="s1">com.facebook.react.uimanager</span><span class="s2">;</span>

<span class="s2">import </span><span class="s1">android.graphics.Color</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.os.Build</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.text.TextUtils</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.view.View</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.view.ViewParent</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">android.view.accessibility.AccessibilityEvent</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">androidx.annotation.NonNull</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">androidx.annotation.Nullable</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">androidx.core.view.ViewCompat</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.common.logging.FLog</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.R</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.Dynamic</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReadableArray</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReadableMap</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReadableMapKeySetIterator</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.bridge.ReadableType</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.common.MapBuilder</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.common.ReactConstants</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.ReactAccessibilityDelegate.AccessibilityRole</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.annotations.ReactProp</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.events.PointerEventHelper</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">com.facebook.react.uimanager.util.ReactFindViewUtil</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.util.ArrayList</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.util.HashMap</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.util.List</span><span class="s2">;</span>
<span class="s2">import </span><span class="s1">java.util.Map</span><span class="s2">;</span>

<span class="s3">/**</span>
 <span class="s3">* Base class that should be suitable for the majority of subclasses of {</span><span class="s4">@link </span><span class="s3">ViewManager}. It</span>
 <span class="s3">* provides support for base view properties such as backgroundColor, opacity, etc.</span>
 <span class="s3">*/</span>
<span class="s2">public abstract class </span><span class="s1">BaseViewManager&lt;T </span><span class="s2">extends </span><span class="s1">View</span><span class="s2">, </span><span class="s1">C </span><span class="s2">extends </span><span class="s1">LayoutShadowNode&gt;</span>
    <span class="s2">extends </span><span class="s1">ViewManager&lt;T</span><span class="s2">, </span><span class="s1">C&gt; </span><span class="s2">implements </span><span class="s1">BaseViewManagerInterface&lt;T&gt; {</span>

  <span class="s2">private static final int </span><span class="s1">PERSPECTIVE_ARRAY_INVERTED_CAMERA_DISTANCE_INDEX = </span><span class="s5">2</span><span class="s2">;</span>
  <span class="s2">private static final float </span><span class="s1">CAMERA_DISTANCE_NORMALIZATION_MULTIPLIER = (</span><span class="s2">float</span><span class="s1">) Math.sqrt(</span><span class="s5">5</span><span class="s1">)</span><span class="s2">;</span>

  <span class="s2">private static </span><span class="s1">MatrixMathHelper.MatrixDecompositionContext sMatrixDecompositionContext =</span>
      <span class="s2">new </span><span class="s1">MatrixMathHelper.MatrixDecompositionContext()</span><span class="s2">;</span>
  <span class="s2">private static double</span><span class="s1">[] sTransformDecompositionArray = </span><span class="s2">new double</span><span class="s1">[</span><span class="s5">16</span><span class="s1">]</span><span class="s2">;</span>

  <span class="s2">public static final </span><span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Integer&gt; sStateDescription = </span><span class="s2">new </span><span class="s1">HashMap&lt;&gt;()</span><span class="s2">;</span>

  <span class="s2">static </span><span class="s1">{</span>
    <span class="s1">sStateDescription.put(</span><span class="s6">&quot;busy&quot;</span><span class="s2">, </span><span class="s1">R.string.state_busy_description)</span><span class="s2">;</span>
    <span class="s1">sStateDescription.put(</span><span class="s6">&quot;expanded&quot;</span><span class="s2">, </span><span class="s1">R.string.state_expanded_description)</span><span class="s2">;</span>
    <span class="s1">sStateDescription.put(</span><span class="s6">&quot;collapsed&quot;</span><span class="s2">, </span><span class="s1">R.string.state_collapsed_description)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s0">// State definition constants -- must match the definition in</span>
  <span class="s0">// ViewAccessibility.js. These only include states for which there</span>
  <span class="s0">// is no native support in android.</span>

  <span class="s2">private static final </span><span class="s1">String STATE_CHECKED = </span><span class="s6">&quot;checked&quot;</span><span class="s2">; </span><span class="s0">// Special case for mixed state checkboxes</span>
  <span class="s2">private static final </span><span class="s1">String STATE_BUSY = </span><span class="s6">&quot;busy&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String STATE_EXPANDED = </span><span class="s6">&quot;expanded&quot;</span><span class="s2">;</span>
  <span class="s2">private static final </span><span class="s1">String STATE_MIXED = </span><span class="s6">&quot;mixed&quot;</span><span class="s2">;</span>

  <span class="s1">@Override</span>
  <span class="s2">protected </span><span class="s1">T prepareToRecycleView(@NonNull ThemedReactContext reactContext</span><span class="s2">, </span><span class="s1">T view) {</span>
    <span class="s0">// Reset tags</span>
    <span class="s1">view.setTag(</span><span class="s2">null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.pointer_events</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.react_test_id</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.view_tag_native_id</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.labelled_by</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.accessibility_label</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.accessibility_hint</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.accessibility_role</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.accessibility_state</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.accessibility_actions</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.accessibility_value</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.accessibility_state_expanded</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>

    <span class="s0">// This indirectly calls (and resets):</span>
    <span class="s0">// setTranslationX</span>
    <span class="s0">// setTranslationY</span>
    <span class="s0">// setRotation</span>
    <span class="s0">// setRotationX</span>
    <span class="s0">// setRotationY</span>
    <span class="s0">// setScaleX</span>
    <span class="s0">// setScaleY</span>
    <span class="s0">// setCameraDistance</span>
    <span class="s1">setTransform(view</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>

    <span class="s0">// RenderNode params not covered by setTransform above</span>
    <span class="s1">view.resetPivot()</span><span class="s2">;</span>
    <span class="s1">view.setTop(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setBottom(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setLeft(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setRight(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setElevation(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setAnimationMatrix(</span><span class="s2">null</span><span class="s1">)</span><span class="s2">;</span>

    <span class="s0">// setShadowColor</span>
    <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) {</span>
      <span class="s1">view.setOutlineAmbientShadowColor(Color.BLACK)</span><span class="s2">;</span>
      <span class="s1">view.setOutlineSpotShadowColor(Color.BLACK)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s0">// Focus IDs</span>
    <span class="s0">// Also see in AOSP source:</span>
    <span class="s0">// https://android.googlesource.com/platform/frameworks/base/+/a175a5b/core/java/android/view/View.java#4493</span>
    <span class="s1">view.setNextFocusDownId(View.NO_ID)</span><span class="s2">;</span>
    <span class="s1">view.setNextFocusForwardId(View.NO_ID)</span><span class="s2">;</span>
    <span class="s1">view.setNextFocusRightId(View.NO_ID)</span><span class="s2">;</span>
    <span class="s1">view.setNextFocusUpId(View.NO_ID)</span><span class="s2">;</span>

    <span class="s0">// This is possibly subject to change and overridable per-platform, but these</span>
    <span class="s0">// are the default view flags in View.java:</span>
    <span class="s0">// https://android.googlesource.com/platform/frameworks/base/+/a175a5b/core/java/android/view/View.java#2712</span>
    <span class="s0">// `mViewFlags = SOUND_EFFECTS_ENABLED | HAPTIC_FEEDBACK_ENABLED | LAYOUT_DIRECTION_INHERIT`</span>
    <span class="s0">// Therefore we set the following options as such:</span>
    <span class="s1">view.setFocusable(</span><span class="s2">false</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setFocusableInTouchMode(</span><span class="s2">false</span><span class="s1">)</span><span class="s2">;</span>

    <span class="s0">// https://android.googlesource.com/platform/frameworks/base/+/refs/tags/android-mainline-12.0.0_r96/core/java/android/view/View.java#5491</span>
    <span class="s1">view.setElevation(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>

    <span class="s0">// Predictably, alpha defaults to 1:</span>
    <span class="s0">// https://android.googlesource.com/platform/frameworks/base/+/a175a5b/core/java/android/view/View.java#2186</span>
    <span class="s0">// This accounts for resetting mBackfaceOpacity and mBackfaceVisibility</span>
    <span class="s1">view.setAlpha(</span><span class="s5">1</span><span class="s1">)</span><span class="s2">;</span>

    <span class="s0">// setPadding is a noop for most View types, but it is not for Text</span>
    <span class="s1">setPadding(view</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>

    <span class="s0">// Other stuff</span>
    <span class="s1">view.setForeground(</span><span class="s2">null</span><span class="s1">)</span><span class="s2">;</span>

    <span class="s2">return </span><span class="s1">view</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(</span>
      <span class="s1">name = ViewProps.BACKGROUND_COLOR</span><span class="s2">,</span>
      <span class="s1">defaultInt = Color.TRANSPARENT</span><span class="s2">,</span>
      <span class="s1">customType = </span><span class="s6">&quot;Color&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setBackgroundColor(@NonNull T view</span><span class="s2">, int </span><span class="s1">backgroundColor) {</span>
    <span class="s1">view.setBackgroundColor(backgroundColor)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.TRANSFORM)</span>
  <span class="s2">public void </span><span class="s1">setTransform(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable ReadableArray matrix) {</span>
    <span class="s2">if </span><span class="s1">(matrix == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s1">resetTransformProperty(view)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">setTransformProperty(view</span><span class="s2">, </span><span class="s1">matrix)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.OPACITY</span><span class="s2">, </span><span class="s1">defaultFloat = </span><span class="s5">1.f</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setOpacity(@NonNull T view</span><span class="s2">, float </span><span class="s1">opacity) {</span>
    <span class="s1">view.setAlpha(opacity)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ELEVATION)</span>
  <span class="s2">public void </span><span class="s1">setElevation(@NonNull T view</span><span class="s2">, float </span><span class="s1">elevation) {</span>
    <span class="s1">ViewCompat.setElevation(view</span><span class="s2">, </span><span class="s1">PixelUtil.toPixelFromDIP(elevation))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.SHADOW_COLOR</span><span class="s2">, </span><span class="s1">defaultInt = Color.BLACK</span><span class="s2">, </span><span class="s1">customType = </span><span class="s6">&quot;Color&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setShadowColor(@NonNull T view</span><span class="s2">, int </span><span class="s1">shadowColor) {</span>
    <span class="s2">if </span><span class="s1">(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) {</span>
      <span class="s1">view.setOutlineAmbientShadowColor(shadowColor)</span><span class="s2">;</span>
      <span class="s1">view.setOutlineSpotShadowColor(shadowColor)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.Z_INDEX)</span>
  <span class="s2">public void </span><span class="s1">setZIndex(@NonNull T view</span><span class="s2">, float </span><span class="s1">zIndex) {</span>
    <span class="s2">int </span><span class="s1">integerZIndex = Math.round(zIndex)</span><span class="s2">;</span>
    <span class="s1">ViewGroupManager.setViewZIndex(view</span><span class="s2">, </span><span class="s1">integerZIndex)</span><span class="s2">;</span>
    <span class="s1">ViewParent parent = view.getParent()</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(parent </span><span class="s2">instanceof </span><span class="s1">ReactZIndexedViewGroup) {</span>
      <span class="s1">((ReactZIndexedViewGroup) parent).updateDrawingOrder()</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.RENDER_TO_HARDWARE_TEXTURE)</span>
  <span class="s2">public void </span><span class="s1">setRenderToHardwareTexture(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">useHWTexture) {</span>
    <span class="s1">view.setLayerType(useHWTexture ? View.LAYER_TYPE_HARDWARE : View.LAYER_TYPE_NONE</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.TEST_ID)</span>
  <span class="s2">public void </span><span class="s1">setTestId(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable String testId) {</span>
    <span class="s1">view.setTag(R.id.react_test_id</span><span class="s2">, </span><span class="s1">testId)</span><span class="s2">;</span>

    <span class="s0">// temporarily set the tag and keyed tags to avoid end to end test regressions</span>
    <span class="s1">view.setTag(testId)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.NATIVE_ID)</span>
  <span class="s2">public void </span><span class="s1">setNativeId(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable String nativeId) {</span>
    <span class="s1">view.setTag(R.id.view_tag_native_id</span><span class="s2">, </span><span class="s1">nativeId)</span><span class="s2">;</span>
    <span class="s1">ReactFindViewUtil.notifyViewRendered(view)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_LABELLED_BY)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityLabelledBy(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable Dynamic nativeId) {</span>
    <span class="s2">if </span><span class="s1">(nativeId.isNull()) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(nativeId.getType() == ReadableType.String) {</span>
      <span class="s1">view.setTag(R.id.labelled_by</span><span class="s2">, </span><span class="s1">nativeId.asString())</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(nativeId.getType() == ReadableType.Array) {</span>
      <span class="s0">// On Android, this takes a single View as labeledBy. If an array is specified, set the first</span>
      <span class="s0">// element in the tag.</span>
      <span class="s1">view.setTag(R.id.labelled_by</span><span class="s2">, </span><span class="s1">nativeId.asArray().getString(</span><span class="s5">0</span><span class="s1">))</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_LABEL)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityLabel(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable String accessibilityLabel) {</span>
    <span class="s1">view.setTag(R.id.accessibility_label</span><span class="s2">, </span><span class="s1">accessibilityLabel)</span><span class="s2">;</span>
    <span class="s1">updateViewContentDescription(view)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_HINT)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityHint(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable String accessibilityHint) {</span>
    <span class="s1">view.setTag(R.id.accessibility_hint</span><span class="s2">, </span><span class="s1">accessibilityHint)</span><span class="s2">;</span>
    <span class="s1">updateViewContentDescription(view)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_ROLE)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityRole(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable String accessibilityRole) {</span>
    <span class="s2">if </span><span class="s1">(accessibilityRole == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>
    <span class="s1">view.setTag(R.id.accessibility_role</span><span class="s2">, </span><span class="s1">AccessibilityRole.fromValue(accessibilityRole))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_COLLECTION)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityCollection(</span>
      <span class="s1">@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable ReadableMap accessibilityCollection) {</span>
    <span class="s1">view.setTag(R.id.accessibility_collection</span><span class="s2">, </span><span class="s1">accessibilityCollection)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_COLLECTION_ITEM)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityCollectionItem(</span>
      <span class="s1">@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable ReadableMap accessibilityCollectionItem) {</span>
    <span class="s1">view.setTag(R.id.accessibility_collection_item</span><span class="s2">, </span><span class="s1">accessibilityCollectionItem)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_STATE)</span>
  <span class="s2">public void </span><span class="s1">setViewState(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable ReadableMap accessibilityState) {</span>
    <span class="s2">if </span><span class="s1">(accessibilityState == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(accessibilityState.hasKey(</span><span class="s6">&quot;expanded&quot;</span><span class="s1">)) {</span>
      <span class="s1">view.setTag(R.id.accessibility_state_expanded</span><span class="s2">, </span><span class="s1">accessibilityState.getBoolean(</span><span class="s6">&quot;expanded&quot;</span><span class="s1">))</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(accessibilityState.hasKey(</span><span class="s6">&quot;selected&quot;</span><span class="s1">)) {</span>
      <span class="s2">boolean </span><span class="s1">prevSelected = view.isSelected()</span><span class="s2">;</span>
      <span class="s2">boolean </span><span class="s1">nextSelected = accessibilityState.getBoolean(</span><span class="s6">&quot;selected&quot;</span><span class="s1">)</span><span class="s2">;</span>
      <span class="s1">view.setSelected(nextSelected)</span><span class="s2">;</span>

      <span class="s0">// For some reason, Android does not announce &quot;unselected&quot; when state changes.</span>
      <span class="s0">// This is inconsistent with other platforms, but also with the &quot;checked&quot; state.</span>
      <span class="s0">// So manually announce this.</span>
      <span class="s2">if </span><span class="s1">(view.isAccessibilityFocused() &amp;&amp; prevSelected &amp;&amp; !nextSelected) {</span>
        <span class="s1">view.announceForAccessibility(</span>
            <span class="s1">view.getContext().getString(R.string.state_unselected_description))</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setSelected(</span><span class="s2">false</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s1">view.setTag(R.id.accessibility_state</span><span class="s2">, </span><span class="s1">accessibilityState)</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(accessibilityState.hasKey(</span><span class="s6">&quot;disabled&quot;</span><span class="s1">) &amp;&amp; !accessibilityState.getBoolean(</span><span class="s6">&quot;disabled&quot;</span><span class="s1">)) {</span>
      <span class="s1">view.setEnabled(</span><span class="s2">true</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">}</span>

    <span class="s0">// For states which don't have corresponding methods in</span>
    <span class="s0">// AccessibilityNodeInfo, update the view's content description</span>
    <span class="s0">// here</span>

    <span class="s2">final </span><span class="s1">ReadableMapKeySetIterator i = accessibilityState.keySetIterator()</span><span class="s2">;</span>
    <span class="s2">while </span><span class="s1">(i.hasNextKey()) {</span>
      <span class="s2">final </span><span class="s1">String state = i.nextKey()</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(state.equals(STATE_BUSY)</span>
          <span class="s1">|| state.equals(STATE_EXPANDED)</span>
          <span class="s1">|| (state.equals(STATE_CHECKED)</span>
              <span class="s1">&amp;&amp; accessibilityState.getType(STATE_CHECKED) == ReadableType.String)) {</span>
        <span class="s1">updateViewContentDescription(view)</span><span class="s2">;</span>
        <span class="s2">break;</span>
      <span class="s1">} </span><span class="s2">else if </span><span class="s1">(view.isAccessibilityFocused()) {</span>
        <span class="s0">// Internally Talkback ONLY uses TYPE_VIEW_CLICKED for &quot;checked&quot; and</span>
        <span class="s0">// &quot;selected&quot; announcements. Send a click event to make sure Talkback</span>
        <span class="s0">// get notified for the state changes that don't happen upon users' click.</span>
        <span class="s0">// For the state changes that happens immediately, Talkback will skip</span>
        <span class="s0">// the duplicated click event.</span>
        <span class="s1">view.sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_CLICKED)</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">private void </span><span class="s1">updateViewContentDescription(@NonNull T view) {</span>
    <span class="s2">final </span><span class="s1">String accessibilityLabel = (String) view.getTag(R.id.accessibility_label)</span><span class="s2">;</span>
    <span class="s2">final </span><span class="s1">ReadableMap accessibilityState = (ReadableMap) view.getTag(R.id.accessibility_state)</span><span class="s2">;</span>
    <span class="s2">final </span><span class="s1">List&lt;String&gt; contentDescription = </span><span class="s2">new </span><span class="s1">ArrayList&lt;&gt;()</span><span class="s2">;</span>
    <span class="s2">final </span><span class="s1">ReadableMap accessibilityValue = (ReadableMap) view.getTag(R.id.accessibility_value)</span><span class="s2">;</span>
    <span class="s2">if </span><span class="s1">(accessibilityLabel != </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s1">contentDescription.add(accessibilityLabel)</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(accessibilityState != </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">final </span><span class="s1">ReadableMapKeySetIterator i = accessibilityState.keySetIterator()</span><span class="s2">;</span>
      <span class="s2">while </span><span class="s1">(i.hasNextKey()) {</span>
        <span class="s2">final </span><span class="s1">String state = i.nextKey()</span><span class="s2">;</span>
        <span class="s2">final </span><span class="s1">Dynamic value = accessibilityState.getDynamic(state)</span><span class="s2">;</span>
        <span class="s2">if </span><span class="s1">(state.equals(STATE_CHECKED)</span>
            <span class="s1">&amp;&amp; value.getType() == ReadableType.String</span>
            <span class="s1">&amp;&amp; value.asString().equals(STATE_MIXED)) {</span>
          <span class="s1">contentDescription.add(view.getContext().getString(R.string.state_mixed_description))</span><span class="s2">;</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(state.equals(STATE_BUSY)</span>
            <span class="s1">&amp;&amp; value.getType() == ReadableType.Boolean</span>
            <span class="s1">&amp;&amp; value.asBoolean()) {</span>
          <span class="s1">contentDescription.add(view.getContext().getString(R.string.state_busy_description))</span><span class="s2">;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(accessibilityValue != </span><span class="s2">null </span><span class="s1">&amp;&amp; accessibilityValue.hasKey(</span><span class="s6">&quot;text&quot;</span><span class="s1">)) {</span>
      <span class="s2">final </span><span class="s1">Dynamic text = accessibilityValue.getDynamic(</span><span class="s6">&quot;text&quot;</span><span class="s1">)</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(text != </span><span class="s2">null </span><span class="s1">&amp;&amp; text.getType() == ReadableType.String) {</span>
        <span class="s1">contentDescription.add(text.asString())</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(contentDescription.size() &gt; </span><span class="s5">0</span><span class="s1">) {</span>
      <span class="s1">view.setContentDescription(TextUtils.join(</span><span class="s6">&quot;, &quot;</span><span class="s2">, </span><span class="s1">contentDescription))</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_ACTIONS)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityActions(T view</span><span class="s2">, </span><span class="s1">ReadableArray accessibilityActions) {</span>
    <span class="s2">if </span><span class="s1">(accessibilityActions == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s2">return;</span>
    <span class="s1">}</span>

    <span class="s1">view.setTag(R.id.accessibility_actions</span><span class="s2">, </span><span class="s1">accessibilityActions)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_VALUE)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityValue(T view</span><span class="s2">, </span><span class="s1">ReadableMap accessibilityValue) {</span>
    <span class="s2">if </span><span class="s1">(accessibilityValue == </span><span class="s2">null</span><span class="s1">) {</span>
      <span class="s1">view.setTag(R.id.accessibility_value</span><span class="s2">, null</span><span class="s1">)</span><span class="s2">;</span>
      <span class="s1">view.setContentDescription(</span><span class="s2">null</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s1">view.setTag(R.id.accessibility_value</span><span class="s2">, </span><span class="s1">accessibilityValue)</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(accessibilityValue.hasKey(</span><span class="s6">&quot;text&quot;</span><span class="s1">)) {</span>
        <span class="s1">updateViewContentDescription(view)</span><span class="s2">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.IMPORTANT_FOR_ACCESSIBILITY)</span>
  <span class="s2">public void </span><span class="s1">setImportantForAccessibility(</span>
      <span class="s1">@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable String importantForAccessibility) {</span>
    <span class="s2">if </span><span class="s1">(importantForAccessibility == </span><span class="s2">null </span><span class="s1">|| importantForAccessibility.equals(</span><span class="s6">&quot;auto&quot;</span><span class="s1">)) {</span>
      <span class="s1">ViewCompat.setImportantForAccessibility(view</span><span class="s2">, </span><span class="s1">ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_AUTO)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(importantForAccessibility.equals(</span><span class="s6">&quot;yes&quot;</span><span class="s1">)) {</span>
      <span class="s1">ViewCompat.setImportantForAccessibility(view</span><span class="s2">, </span><span class="s1">ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_YES)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(importantForAccessibility.equals(</span><span class="s6">&quot;no&quot;</span><span class="s1">)) {</span>
      <span class="s1">ViewCompat.setImportantForAccessibility(view</span><span class="s2">, </span><span class="s1">ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(importantForAccessibility.equals(</span><span class="s6">&quot;no-hide-descendants&quot;</span><span class="s1">)) {</span>
      <span class="s1">ViewCompat.setImportantForAccessibility(</span>
          <span class="s1">view</span><span class="s2">, </span><span class="s1">ViewCompat.IMPORTANT_FOR_ACCESSIBILITY_NO_HIDE_DESCENDANTS)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@Deprecated</span>
  <span class="s1">@ReactProp(name = ViewProps.ROTATION)</span>
  <span class="s2">public void </span><span class="s1">setRotation(@NonNull T view</span><span class="s2">, float </span><span class="s1">rotation) {</span>
    <span class="s1">view.setRotation(rotation)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@Deprecated</span>
  <span class="s1">@ReactProp(name = ViewProps.SCALE_X</span><span class="s2">, </span><span class="s1">defaultFloat = </span><span class="s5">1f</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setScaleX(@NonNull T view</span><span class="s2">, float </span><span class="s1">scaleX) {</span>
    <span class="s1">view.setScaleX(scaleX)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@Deprecated</span>
  <span class="s1">@ReactProp(name = ViewProps.SCALE_Y</span><span class="s2">, </span><span class="s1">defaultFloat = </span><span class="s5">1f</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setScaleY(@NonNull T view</span><span class="s2">, float </span><span class="s1">scaleY) {</span>
    <span class="s1">view.setScaleY(scaleY)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@Deprecated</span>
  <span class="s1">@ReactProp(name = ViewProps.TRANSLATE_X</span><span class="s2">, </span><span class="s1">defaultFloat = </span><span class="s5">0f</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setTranslateX(@NonNull T view</span><span class="s2">, float </span><span class="s1">translateX) {</span>
    <span class="s1">view.setTranslationX(PixelUtil.toPixelFromDIP(translateX))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@Deprecated</span>
  <span class="s1">@ReactProp(name = ViewProps.TRANSLATE_Y</span><span class="s2">, </span><span class="s1">defaultFloat = </span><span class="s5">0f</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setTranslateY(@NonNull T view</span><span class="s2">, float </span><span class="s1">translateY) {</span>
    <span class="s1">view.setTranslationY(PixelUtil.toPixelFromDIP(translateY))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s1">@ReactProp(name = ViewProps.ACCESSIBILITY_LIVE_REGION)</span>
  <span class="s2">public void </span><span class="s1">setAccessibilityLiveRegion(@NonNull T view</span><span class="s2">, </span><span class="s1">@Nullable String liveRegion) {</span>
    <span class="s2">if </span><span class="s1">(liveRegion == </span><span class="s2">null </span><span class="s1">|| liveRegion.equals(</span><span class="s6">&quot;none&quot;</span><span class="s1">)) {</span>
      <span class="s1">ViewCompat.setAccessibilityLiveRegion(view</span><span class="s2">, </span><span class="s1">ViewCompat.ACCESSIBILITY_LIVE_REGION_NONE)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(liveRegion.equals(</span><span class="s6">&quot;polite&quot;</span><span class="s1">)) {</span>
      <span class="s1">ViewCompat.setAccessibilityLiveRegion(view</span><span class="s2">, </span><span class="s1">ViewCompat.ACCESSIBILITY_LIVE_REGION_POLITE)</span><span class="s2">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(liveRegion.equals(</span><span class="s6">&quot;assertive&quot;</span><span class="s1">)) {</span>
      <span class="s1">ViewCompat.setAccessibilityLiveRegion(view</span><span class="s2">, </span><span class="s1">ViewCompat.ACCESSIBILITY_LIVE_REGION_ASSERTIVE)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">private static void </span><span class="s1">setTransformProperty(@NonNull View view</span><span class="s2">, </span><span class="s1">ReadableArray transforms) {</span>
    <span class="s1">sMatrixDecompositionContext.reset()</span><span class="s2">;</span>
    <span class="s1">TransformHelper.processTransform(transforms</span><span class="s2">, </span><span class="s1">sTransformDecompositionArray)</span><span class="s2">;</span>
    <span class="s1">MatrixMathHelper.decomposeMatrix(sTransformDecompositionArray</span><span class="s2">, </span><span class="s1">sMatrixDecompositionContext)</span><span class="s2">;</span>
    <span class="s1">view.setTranslationX(</span>
        <span class="s1">PixelUtil.toPixelFromDIP(</span>
            <span class="s1">sanitizeFloatPropertyValue((</span><span class="s2">float</span><span class="s1">) sMatrixDecompositionContext.translation[</span><span class="s5">0</span><span class="s1">])))</span><span class="s2">;</span>
    <span class="s1">view.setTranslationY(</span>
        <span class="s1">PixelUtil.toPixelFromDIP(</span>
            <span class="s1">sanitizeFloatPropertyValue((</span><span class="s2">float</span><span class="s1">) sMatrixDecompositionContext.translation[</span><span class="s5">1</span><span class="s1">])))</span><span class="s2">;</span>
    <span class="s1">view.setRotation(</span>
        <span class="s1">sanitizeFloatPropertyValue((</span><span class="s2">float</span><span class="s1">) sMatrixDecompositionContext.rotationDegrees[</span><span class="s5">2</span><span class="s1">]))</span><span class="s2">;</span>
    <span class="s1">view.setRotationX(</span>
        <span class="s1">sanitizeFloatPropertyValue((</span><span class="s2">float</span><span class="s1">) sMatrixDecompositionContext.rotationDegrees[</span><span class="s5">0</span><span class="s1">]))</span><span class="s2">;</span>
    <span class="s1">view.setRotationY(</span>
        <span class="s1">sanitizeFloatPropertyValue((</span><span class="s2">float</span><span class="s1">) sMatrixDecompositionContext.rotationDegrees[</span><span class="s5">1</span><span class="s1">]))</span><span class="s2">;</span>
    <span class="s1">view.setScaleX(sanitizeFloatPropertyValue((</span><span class="s2">float</span><span class="s1">) sMatrixDecompositionContext.scale[</span><span class="s5">0</span><span class="s1">]))</span><span class="s2">;</span>
    <span class="s1">view.setScaleY(sanitizeFloatPropertyValue((</span><span class="s2">float</span><span class="s1">) sMatrixDecompositionContext.scale[</span><span class="s5">1</span><span class="s1">]))</span><span class="s2">;</span>

    <span class="s2">double</span><span class="s1">[] perspectiveArray = sMatrixDecompositionContext.perspective</span><span class="s2">;</span>

    <span class="s2">if </span><span class="s1">(perspectiveArray.length &gt; PERSPECTIVE_ARRAY_INVERTED_CAMERA_DISTANCE_INDEX) {</span>
      <span class="s2">float </span><span class="s1">invertedCameraDistance =</span>
          <span class="s1">(</span><span class="s2">float</span><span class="s1">) perspectiveArray[PERSPECTIVE_ARRAY_INVERTED_CAMERA_DISTANCE_INDEX]</span><span class="s2">;</span>
      <span class="s2">if </span><span class="s1">(invertedCameraDistance == </span><span class="s5">0</span><span class="s1">) {</span>
        <span class="s0">// Default camera distance, before scale multiplier (1280)</span>
        <span class="s1">invertedCameraDistance = </span><span class="s5">0.00078125f</span><span class="s2">;</span>
      <span class="s1">}</span>
      <span class="s2">float </span><span class="s1">cameraDistance = -</span><span class="s5">1 </span><span class="s1">/ invertedCameraDistance</span><span class="s2">;</span>
      <span class="s2">float </span><span class="s1">scale = DisplayMetricsHolder.getScreenDisplayMetrics().density</span><span class="s2">;</span>

      <span class="s0">// The following converts the matrix's perspective to a camera distance</span>
      <span class="s0">// such that the camera perspective looks the same on Android and iOS.</span>
      <span class="s0">// The native Android implementation removed the screen density from the</span>
      <span class="s0">// calculation, so squaring and a normalization value of</span>
      <span class="s0">// sqrt(5) produces an exact replica with iOS.</span>
      <span class="s0">// For more information, see https://github.com/facebook/react-native/pull/18302</span>
      <span class="s2">float </span><span class="s1">normalizedCameraDistance =</span>
          <span class="s1">sanitizeFloatPropertyValue(</span>
              <span class="s1">scale * scale * cameraDistance * CAMERA_DISTANCE_NORMALIZATION_MULTIPLIER)</span><span class="s2">;</span>
      <span class="s1">view.setCameraDistance(normalizedCameraDistance)</span><span class="s2">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s3">/**</span>
   <span class="s3">* Prior to Android P things like setScaleX() allowed passing float values that were bogus such as</span>
   <span class="s3">* Float.NaN. If the app is targeting Android P or later then passing these values will result in</span>
   <span class="s3">* an exception being thrown. Since JS might still send Float.NaN, we want to keep the code</span>
   <span class="s3">* backward compatible and continue using the fallback value if an invalid float is passed.</span>
   <span class="s3">*/</span>
  <span class="s2">private static float </span><span class="s1">sanitizeFloatPropertyValue(</span><span class="s2">float </span><span class="s1">value) {</span>
    <span class="s2">if </span><span class="s1">(value &gt;= -Float.MAX_VALUE &amp;&amp; value &lt;= Float.MAX_VALUE) {</span>
      <span class="s2">return </span><span class="s1">value</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(value &lt; -Float.MAX_VALUE || value == Float.NEGATIVE_INFINITY) {</span>
      <span class="s2">return </span><span class="s1">-Float.MAX_VALUE</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(value &gt; Float.MAX_VALUE || value == Float.POSITIVE_INFINITY) {</span>
      <span class="s2">return </span><span class="s1">Float.MAX_VALUE</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(Float.isNaN(value)) {</span>
      <span class="s2">return </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s1">}</span>
    <span class="s0">// Shouldn't be possible to reach this point.</span>
    <span class="s2">throw new </span><span class="s1">IllegalStateException(</span><span class="s6">&quot;Invalid float property value: &quot; </span><span class="s1">+ value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private static void </span><span class="s1">resetTransformProperty(@NonNull View view) {</span>
    <span class="s1">view.setTranslationX(PixelUtil.toPixelFromDIP(</span><span class="s5">0</span><span class="s1">))</span><span class="s2">;</span>
    <span class="s1">view.setTranslationY(PixelUtil.toPixelFromDIP(</span><span class="s5">0</span><span class="s1">))</span><span class="s2">;</span>
    <span class="s1">view.setRotation(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setRotationX(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setRotationY(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setScaleX(</span><span class="s5">1</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setScaleY(</span><span class="s5">1</span><span class="s1">)</span><span class="s2">;</span>
    <span class="s1">view.setCameraDistance(</span><span class="s5">0</span><span class="s1">)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private void </span><span class="s1">updateViewAccessibility(@NonNull T view) {</span>
    <span class="s1">ReactAccessibilityDelegate.setDelegate(</span>
        <span class="s1">view</span><span class="s2">, </span><span class="s1">view.isFocusable()</span><span class="s2">, </span><span class="s1">view.getImportantForAccessibility())</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">protected void </span><span class="s1">onAfterUpdateTransaction(@NonNull T view) {</span>
    <span class="s2">super</span><span class="s1">.onAfterUpdateTransaction(view)</span><span class="s2">;</span>
    <span class="s1">updateViewAccessibility(view)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">@Nullable Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; getExportedCustomBubblingEventTypeConstants() {</span>
    <span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; baseEventTypeConstants = </span><span class="s2">super</span><span class="s1">.getExportedCustomDirectEventTypeConstants()</span><span class="s2">;</span>
    <span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; eventTypeConstants =</span>
        <span class="s1">baseEventTypeConstants == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">new </span><span class="s1">HashMap&lt;String</span><span class="s2">, </span><span class="s1">Object&gt;() : baseEventTypeConstants</span><span class="s2">;</span>
    <span class="s1">eventTypeConstants.putAll(</span>
        <span class="s1">MapBuilder.&lt;String</span><span class="s2">, </span><span class="s1">Object&gt;builder()</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topPointerCancel&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s6">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span>
                        <span class="s6">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerCancel&quot;</span><span class="s2">, </span><span class="s6">&quot;captured&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerCancelCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topPointerDown&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s6">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s6">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerDown&quot;</span><span class="s2">, </span><span class="s6">&quot;captured&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerDownCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topPointerEnter&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s6">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span>
                        <span class="s6">&quot;bubbled&quot;</span><span class="s2">,</span>
                        <span class="s6">&quot;onPointerEnter&quot;</span><span class="s2">,</span>
                        <span class="s6">&quot;captured&quot;</span><span class="s2">,</span>
                        <span class="s6">&quot;onPointerEnterCapture&quot;</span><span class="s2">,</span>
                        <span class="s6">&quot;skipBubbling&quot;</span><span class="s2">,</span>
                        <span class="s2">true</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topPointerLeave&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s6">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span>
                        <span class="s6">&quot;bubbled&quot;</span><span class="s2">,</span>
                        <span class="s6">&quot;onPointerLeave&quot;</span><span class="s2">,</span>
                        <span class="s6">&quot;captured&quot;</span><span class="s2">,</span>
                        <span class="s6">&quot;onPointerLeaveCapture&quot;</span><span class="s2">,</span>
                        <span class="s6">&quot;skipBubbling&quot;</span><span class="s2">,</span>
                        <span class="s2">true</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topPointerMove&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s6">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s6">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerMove&quot;</span><span class="s2">, </span><span class="s6">&quot;captured&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerMoveCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topPointerUp&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s6">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s6">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerUp&quot;</span><span class="s2">, </span><span class="s6">&quot;captured&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerUpCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topPointerOut&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s6">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s6">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerOut&quot;</span><span class="s2">, </span><span class="s6">&quot;captured&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerOutCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topPointerOver&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span>
                    <span class="s6">&quot;phasedRegistrationNames&quot;</span><span class="s2">,</span>
                    <span class="s1">MapBuilder.of(</span><span class="s6">&quot;bubbled&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerOver&quot;</span><span class="s2">, </span><span class="s6">&quot;captured&quot;</span><span class="s2">, </span><span class="s6">&quot;onPointerOverCapture&quot;</span><span class="s1">)))</span>
            <span class="s1">.build())</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">eventTypeConstants</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public </span><span class="s1">@Nullable Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; getExportedCustomDirectEventTypeConstants() {</span>
    <span class="s1">@Nullable</span>
    <span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; baseEventTypeConstants = </span><span class="s2">super</span><span class="s1">.getExportedCustomDirectEventTypeConstants()</span><span class="s2">;</span>
    <span class="s1">Map&lt;String</span><span class="s2">, </span><span class="s1">Object&gt; eventTypeConstants =</span>
        <span class="s1">baseEventTypeConstants == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">new </span><span class="s1">HashMap&lt;String</span><span class="s2">, </span><span class="s1">Object&gt;() : baseEventTypeConstants</span><span class="s2">;</span>
    <span class="s1">eventTypeConstants.putAll(</span>
        <span class="s1">MapBuilder.&lt;String</span><span class="s2">, </span><span class="s1">Object&gt;builder()</span>
            <span class="s1">.put(</span>
                <span class="s6">&quot;topAccessibilityAction&quot;</span><span class="s2">,</span>
                <span class="s1">MapBuilder.of(</span><span class="s6">&quot;registrationName&quot;</span><span class="s2">, </span><span class="s6">&quot;onAccessibilityAction&quot;</span><span class="s1">))</span>
            <span class="s1">.build())</span><span class="s2">;</span>
    <span class="s2">return </span><span class="s1">eventTypeConstants</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">setBorderRadius(T view</span><span class="s2">, float </span><span class="s1">borderRadius) {</span>
    <span class="s1">logUnsupportedPropertyWarning(ViewProps.BORDER_RADIUS)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">setBorderBottomLeftRadius(T view</span><span class="s2">, float </span><span class="s1">borderRadius) {</span>
    <span class="s1">logUnsupportedPropertyWarning(ViewProps.BORDER_BOTTOM_LEFT_RADIUS)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">setBorderBottomRightRadius(T view</span><span class="s2">, float </span><span class="s1">borderRadius) {</span>
    <span class="s1">logUnsupportedPropertyWarning(ViewProps.BORDER_BOTTOM_RIGHT_RADIUS)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">setBorderTopLeftRadius(T view</span><span class="s2">, float </span><span class="s1">borderRadius) {</span>
    <span class="s1">logUnsupportedPropertyWarning(ViewProps.BORDER_TOP_LEFT_RADIUS)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@Override</span>
  <span class="s2">public void </span><span class="s1">setBorderTopRightRadius(T view</span><span class="s2">, float </span><span class="s1">borderRadius) {</span>
    <span class="s1">logUnsupportedPropertyWarning(ViewProps.BORDER_TOP_RIGHT_RADIUS)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private void </span><span class="s1">logUnsupportedPropertyWarning(String propName) {</span>
    <span class="s1">FLog.w(ReactConstants.TAG</span><span class="s2">, </span><span class="s6">&quot;%s doesn't support property '%s'&quot;</span><span class="s2">, </span><span class="s1">getName()</span><span class="s2">, </span><span class="s1">propName)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s2">private static void </span><span class="s1">setPointerEventsFlag(</span>
      <span class="s1">@NonNull View view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT event</span><span class="s2">, boolean </span><span class="s1">isListening) {</span>
    <span class="s1">Integer tag = (Integer) view.getTag(R.id.pointer_events)</span><span class="s2">;</span>
    <span class="s2">int </span><span class="s1">currentValue = tag != </span><span class="s2">null </span><span class="s1">? tag.intValue() : </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s2">int </span><span class="s1">flag = </span><span class="s5">1 </span><span class="s1">&lt;&lt; event.ordinal()</span><span class="s2">;</span>
    <span class="s1">view.setTag(R.id.pointer_events</span><span class="s2">, </span><span class="s1">isListening ? (currentValue | flag) : (currentValue &amp; ~flag))</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s0">/* Experimental W3C Pointer events start */</span>
  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerEnter&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerEnter(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.ENTER</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerEnterCapture&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerEnterCapture(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.ENTER_CAPTURE</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerOver&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerOver(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.OVER</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerOverCapture&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerOverCapture(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.OVER_CAPTURE</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerOut&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerOut(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.OUT</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerOutCapture&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerOutCapture(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.OUT_CAPTURE</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerLeave&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerLeave(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.LEAVE</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerLeaveCapture&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerLeaveCapture(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.LEAVE_CAPTURE</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerMove&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerMove(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.MOVE</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onPointerMoveCapture&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setPointerMoveCapture(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s1">setPointerEventsFlag(view</span><span class="s2">, </span><span class="s1">PointerEventHelper.EVENT.MOVE_CAPTURE</span><span class="s2">, </span><span class="s1">value)</span><span class="s2">;</span>
  <span class="s1">}</span>

  <span class="s0">/* Experimental W3C Pointer events end */</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onMoveShouldSetResponder&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setMoveShouldSetResponder(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onMoveShouldSetResponderCapture&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setMoveShouldSetResponderCapture(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onStartShouldSetResponder&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setStartShouldSetResponder(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onStartShouldSetResponderCapture&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setStartShouldSetResponderCapture(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onResponderGrant&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setResponderGrant(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onResponderReject&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setResponderReject(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onResponderStart&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setResponderStart(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onResponderEnd&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setResponderEnd(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onResponderRelease&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setResponderRelease(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onResponderMove&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setResponderMove(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onResponderTerminate&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setResponderTerminate(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onResponderTerminationRequest&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setResponderTerminationRequest(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onShouldBlockNativeResponder&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setShouldBlockNativeResponder(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onTouchStart&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setTouchStart(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onTouchMove&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setTouchMove(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onTouchEnd&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setTouchEnd(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>

  <span class="s1">@ReactProp(name = </span><span class="s6">&quot;onTouchCancel&quot;</span><span class="s1">)</span>
  <span class="s2">public void </span><span class="s1">setTouchCancel(@NonNull T view</span><span class="s2">, boolean </span><span class="s1">value) {</span>
    <span class="s0">// no-op, handled by JSResponder</span>
  <span class="s1">}</span>
<span class="s1">}</span>
</pre>
</body>
</html>