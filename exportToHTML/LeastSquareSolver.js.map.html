<html>
<head>
<title>LeastSquareSolver.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #6a8759;}
.s2 { color: #6897bb; font-style: italic;}
.s3 { color: #cc7832; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
LeastSquareSolver.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;LeastSquareSolver.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;Vector&quot;</span><span class="s0">,</span><span class="s1">&quot;constructor&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;offset&quot;</span><span class="s0">,</span><span class="s1">&quot;elements&quot;</span><span class="s0">,</span><span class="s1">&quot;Array&quot;</span><span class="s0">,</span><span class="s1">&quot;fromVOL&quot;</span><span class="s0">,</span><span class="s1">&quot;values&quot;</span><span class="s0">,</span><span class="s1">&quot;result&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;index&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">,</span><span class="s1">&quot;dot&quot;</span><span class="s0">,</span><span class="s1">&quot;other&quot;</span><span class="s0">,</span><span class="s1">&quot;i&quot;</span><span class="s0">,</span><span class="s1">&quot;norm&quot;</span><span class="s0">,</span><span class="s1">&quot;Math&quot;</span><span class="s0">,</span><span class="s1">&quot;sqrt&quot;</span><span class="s0">,</span><span class="s1">&quot;Matrix&quot;</span><span class="s0">,</span><span class="s1">&quot;rows&quot;</span><span class="s0">,</span><span class="s1">&quot;columns&quot;</span><span class="s0">,</span><span class="s1">&quot;row&quot;</span><span class="s0">,</span><span class="s1">&quot;column&quot;</span><span class="s0">,</span><span class="s1">&quot;getRow&quot;</span><span class="s0">,</span><span class="s1">&quot;PolynomialFit&quot;</span><span class="s0">,</span><span class="s1">&quot;degree&quot;</span><span class="s0">,</span><span class="s1">&quot;coefficients&quot;</span><span class="s0">,</span><span class="s1">&quot;precisionErrorTolerance&quot;</span><span class="s0">,</span><span class="s1">&quot;LeastSquareSolver&quot;</span><span class="s0">,</span><span class="s1">&quot;x&quot;</span><span class="s0">,</span><span class="s1">&quot;y&quot;</span><span class="s0">,</span><span class="s1">&quot;w&quot;</span><span class="s0">,</span><span class="s1">&quot;solve&quot;</span><span class="s0">,</span><span class="s1">&quot;m&quot;</span><span class="s0">,</span><span class="s1">&quot;n&quot;</span><span class="s0">,</span><span class="s1">&quot;a&quot;</span><span class="s0">,</span><span class="s1">&quot;h&quot;</span><span class="s0">,</span><span class="s1">&quot;q&quot;</span><span class="s0">,</span><span class="s1">&quot;r&quot;</span><span class="s0">,</span><span class="s1">&quot;j&quot;</span><span class="s0">,</span><span class="s1">&quot;inverseNorm&quot;</span><span class="s0">,</span><span class="s1">&quot;wy&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;// Implementation taken from Flutter's LeastSquareSolver</span><span class="s3">\n</span><span class="s1">// https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/gestures/lsq_solver.dart</span><span class="s3">\n\n</span><span class="s1">class Vector {</span><span class="s3">\n  </span><span class="s1">private offset: number;</span><span class="s3">\n  </span><span class="s1">private length: number;</span><span class="s3">\n  </span><span class="s1">private elements: number[];</span><span class="s3">\n\n  </span><span class="s1">constructor(length: number) {</span><span class="s3">\n    </span><span class="s1">this.offset = 0;</span><span class="s3">\n    </span><span class="s1">this.length = length;</span><span class="s3">\n    </span><span class="s1">this.elements = new Array&lt;number&gt;(length);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public static fromVOL(</span><span class="s3">\n    </span><span class="s1">values: number[],</span><span class="s3">\n    </span><span class="s1">offset: number,</span><span class="s3">\n    </span><span class="s1">length: number</span><span class="s3">\n  </span><span class="s1">): Vector {</span><span class="s3">\n    </span><span class="s1">const result = new Vector(0);</span><span class="s3">\n\n    </span><span class="s1">result.offset = offset;</span><span class="s3">\n    </span><span class="s1">result.length = length;</span><span class="s3">\n    </span><span class="s1">result.elements = values;</span><span class="s3">\n\n    </span><span class="s1">return result;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public get(index: number): number {</span><span class="s3">\n    </span><span class="s1">return this.elements[this.offset + index];</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public set(index: number, value: number): void {</span><span class="s3">\n    </span><span class="s1">this.elements[this.offset + index] = value;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public dot(other: Vector): number {</span><span class="s3">\n    </span><span class="s1">let result = 0;</span><span class="s3">\n    </span><span class="s1">for (let i = 0; i &lt; this.length; i++) {</span><span class="s3">\n      </span><span class="s1">result += this.get(i) * other.get(i);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return result;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public norm() {</span><span class="s3">\n    </span><span class="s1">return Math.sqrt(this.dot(this));</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">class Matrix {</span><span class="s3">\n  </span><span class="s1">private columns: number;</span><span class="s3">\n  </span><span class="s1">private elements: number[];</span><span class="s3">\n\n  </span><span class="s1">constructor(rows: number, columns: number) {</span><span class="s3">\n    </span><span class="s1">this.columns = columns;</span><span class="s3">\n    </span><span class="s1">this.elements = new Array&lt;number&gt;(rows * columns);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public get(row: number, column: number): number {</span><span class="s3">\n    </span><span class="s1">return this.elements[row * this.columns + column];</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public set(row: number, column: number, value: number): void {</span><span class="s3">\n    </span><span class="s1">this.elements[row * this.columns + column] = value;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public getRow(row: number): Vector {</span><span class="s3">\n    </span><span class="s1">return Vector.fromVOL(this.elements, row * this.columns, this.columns);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/// An nth degree polynomial fit to a dataset.</span><span class="s3">\n</span><span class="s1">class PolynomialFit {</span><span class="s3">\n  </span><span class="s1">/// The polynomial coefficients of the fit.</span><span class="s3">\n  </span><span class="s1">///</span><span class="s3">\n  </span><span class="s1">/// For each `i`, the element `coefficients[i]` is the coefficient of</span><span class="s3">\n  </span><span class="s1">/// the `i`-th power of the variable.</span><span class="s3">\n  </span><span class="s1">public coefficients: number[];</span><span class="s3">\n\n  </span><span class="s1">/// Creates a polynomial fit of the given degree.</span><span class="s3">\n  </span><span class="s1">///</span><span class="s3">\n  </span><span class="s1">/// There are n + 1 coefficients in a fit of degree n.</span><span class="s3">\n  </span><span class="s1">constructor(degree: number) {</span><span class="s3">\n    </span><span class="s1">this.coefficients = new Array&lt;number&gt;(degree + 1);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const precisionErrorTolerance = 1e-10;</span><span class="s3">\n\n</span><span class="s1">/// Uses the least-squares algorithm to fit a polynomial to a set of data.</span><span class="s3">\n</span><span class="s1">export default class LeastSquareSolver {</span><span class="s3">\n  </span><span class="s1">/// The x-coordinates of each data point.</span><span class="s3">\n  </span><span class="s1">private x: number[];</span><span class="s3">\n  </span><span class="s1">/// The y-coordinates of each data point.</span><span class="s3">\n  </span><span class="s1">private y: number[];</span><span class="s3">\n  </span><span class="s1">/// The weight to use for each data point.</span><span class="s3">\n  </span><span class="s1">private w: number[];</span><span class="s3">\n\n  </span><span class="s1">/// Creates a least-squares solver.</span><span class="s3">\n  </span><span class="s1">///</span><span class="s3">\n  </span><span class="s1">/// The [x], [y], and [w] arguments must not be null.</span><span class="s3">\n  </span><span class="s1">constructor(x: number[], y: number[], w: number[]) {</span><span class="s3">\n    </span><span class="s1">this.x = x;</span><span class="s3">\n    </span><span class="s1">this.y = y;</span><span class="s3">\n    </span><span class="s1">this.w = w;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">/// Fits a polynomial of the given degree to the data points.</span><span class="s3">\n  </span><span class="s1">///</span><span class="s3">\n  </span><span class="s1">/// When there is not enough data to fit a curve null is returned.</span><span class="s3">\n  </span><span class="s1">public solve(degree: number): PolynomialFit | null {</span><span class="s3">\n    </span><span class="s1">if (degree &gt; this.x.length) {</span><span class="s3">\n      </span><span class="s1">// Not enough data to fit a curve.</span><span class="s3">\n      </span><span class="s1">return null;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const result = new PolynomialFit(degree);</span><span class="s3">\n\n    </span><span class="s1">// Shorthands for the purpose of notation equivalence to original C++ code.</span><span class="s3">\n    </span><span class="s1">const m = this.x.length;</span><span class="s3">\n    </span><span class="s1">const n = degree + 1;</span><span class="s3">\n\n    </span><span class="s1">// Expand the X vector to a matrix A, pre-multiplied by the weights.</span><span class="s3">\n    </span><span class="s1">const a = new Matrix(n, m);</span><span class="s3">\n    </span><span class="s1">for (let h = 0; h &lt; m; h++) {</span><span class="s3">\n      </span><span class="s1">a.set(0, h, this.w[h]);</span><span class="s3">\n\n      </span><span class="s1">for (let i = 1; i &lt; n; i++) {</span><span class="s3">\n        </span><span class="s1">a.set(i, h, a.get(i - 1, h) * this.x[h]);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Apply the Gram-Schmidt process to A to obtain its QR decomposition.</span><span class="s3">\n\n    </span><span class="s1">// Orthonormal basis, column-major ordVectorer.</span><span class="s3">\n    </span><span class="s1">const q = new Matrix(n, m);</span><span class="s3">\n    </span><span class="s1">// Upper triangular matrix, row-major order.</span><span class="s3">\n    </span><span class="s1">const r = new Matrix(n, m);</span><span class="s3">\n\n    </span><span class="s1">for (let j = 0; j &lt; n; j += 1) {</span><span class="s3">\n      </span><span class="s1">for (let h = 0; h &lt; m; h += 1) {</span><span class="s3">\n        </span><span class="s1">q.set(j, h, a.get(j, h));</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">for (let i = 0; i &lt; j; i += 1) {</span><span class="s3">\n        </span><span class="s1">const dot = q.getRow(j).dot(q.getRow(i));</span><span class="s3">\n        </span><span class="s1">for (let h = 0; h &lt; m; h += 1) {</span><span class="s3">\n          </span><span class="s1">q.set(j, h, q.get(j, h) - dot * q.get(i, h));</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const norm = q.getRow(j).norm();</span><span class="s3">\n      </span><span class="s1">if (norm &lt; precisionErrorTolerance) {</span><span class="s3">\n        </span><span class="s1">// Vectors are linearly dependent or zero so no solution.</span><span class="s3">\n        </span><span class="s1">return null;</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const inverseNorm = 1.0 / norm;</span><span class="s3">\n      </span><span class="s1">for (let h = 0; h &lt; m; h += 1) {</span><span class="s3">\n        </span><span class="s1">q.set(j, h, q.get(j, h) * inverseNorm);</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">for (let i = 0; i &lt; n; i += 1) {</span><span class="s3">\n        </span><span class="s1">r.set(j, i, i &lt; j ? 0.0 : q.getRow(j).dot(a.getRow(i)));</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Solve R B = Qt W Y to find B. This is easy because R is upper triangular.</span><span class="s3">\n    </span><span class="s1">// We just work from bottom-right to top-left calculating B's coefficients.</span><span class="s3">\n    </span><span class="s1">const wy = new Vector(m);</span><span class="s3">\n    </span><span class="s1">for (let h = 0; h &lt; m; h += 1) {</span><span class="s3">\n      </span><span class="s1">wy.set(h, this.y[h] * this.w[h]);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">for (let i = n - 1; i &gt;= 0; i -= 1) {</span><span class="s3">\n      </span><span class="s1">result.coefficients[i] = q.getRow(i).dot(wy);</span><span class="s3">\n      </span><span class="s1">for (let j = n - 1; j &gt; i; j -= 1) {</span><span class="s3">\n        </span><span class="s1">result.coefficients[i] -= r.get(i, j) * result.coefficients[j];</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">result.coefficients[i] /= r.get(i, i);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return result;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">]}</span></pre>
</body>
</html>