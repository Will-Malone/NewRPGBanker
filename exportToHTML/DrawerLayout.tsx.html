<html>
<head>
<title>DrawerLayout.tsx</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #9876aa; font-style: italic;}
.s4 { color: #a9b7c6;}
.s5 { color: #6a8759;}
.s6 { color: #6897bb; font-style: italic;}
.s7 { color: #ffc66d;}
.s8 { color: #a9b7c6;}
.s9 { color: #e8bf6a;}
.s10 { color: #bbb529;}
.s11 { color: #d0d0ff;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
DrawerLayout.tsx</font>
</center></td></tr></table>
<pre><span class="s0">// This component is based on RN's DrawerLayoutAndroid API</span>
<span class="s0">//</span>
<span class="s0">// It perhaps deserves to be put in a separate repo, but since it relies on</span>
<span class="s0">// react-native-gesture-handler library which isn't very popular at the moment I</span>
<span class="s0">// decided to keep it here for the time being. It will allow us to move faster</span>
<span class="s0">// and fix issues that may arise in gesture handler library that could be found</span>
<span class="s0">// when using the drawer component</span>

<span class="s2">import </span><span class="s3">* </span><span class="s2">as </span><span class="s4">React </span><span class="s2">from </span><span class="s5">'react'</span><span class="s1">;</span>
<span class="s2">import </span><span class="s1">{ </span><span class="s4">Component </span><span class="s1">} </span><span class="s2">from </span><span class="s5">'react'</span><span class="s1">;</span>
<span class="s2">import </span><span class="s4">invariant </span><span class="s2">from </span><span class="s5">'invariant'</span><span class="s1">;</span>
<span class="s2">import </span><span class="s1">{</span>
  <span class="s4">Animated</span><span class="s1">,</span>
  <span class="s4">StyleSheet</span><span class="s1">,</span>
  <span class="s4">View</span><span class="s1">,</span>
  <span class="s4">Keyboard</span><span class="s1">,</span>
  <span class="s4">StatusBar</span><span class="s1">,</span>
  <span class="s4">I18nManager</span><span class="s1">,</span>
  <span class="s4">StatusBarAnimation</span><span class="s1">,</span>
  <span class="s4">StyleProp</span><span class="s1">,</span>
  <span class="s4">ViewStyle</span><span class="s1">,</span>
  <span class="s4">LayoutChangeEvent</span><span class="s1">,</span>
  <span class="s4">NativeSyntheticEvent</span><span class="s1">,</span>
<span class="s1">} </span><span class="s2">from </span><span class="s5">'react-native'</span><span class="s1">;</span>

<span class="s2">import </span><span class="s1">{</span>
  <span class="s4">GestureEvent</span><span class="s1">,</span>
  <span class="s4">HandlerStateChangeEvent</span><span class="s1">,</span>
  <span class="s4">UserSelect</span><span class="s1">,</span>
<span class="s1">} </span><span class="s2">from </span><span class="s5">'../handlers/gestureHandlerCommon'</span><span class="s1">;</span>
<span class="s2">import </span><span class="s1">{</span>
  <span class="s4">PanGestureHandler</span><span class="s1">,</span>
  <span class="s4">PanGestureHandlerEventPayload</span><span class="s1">,</span>
<span class="s1">} </span><span class="s2">from </span><span class="s5">'../handlers/PanGestureHandler'</span><span class="s1">;</span>
<span class="s2">import </span><span class="s1">{</span>
  <span class="s4">TapGestureHandler</span><span class="s1">,</span>
  <span class="s4">TapGestureHandlerEventPayload</span><span class="s1">,</span>
<span class="s1">} </span><span class="s2">from </span><span class="s5">'../handlers/TapGestureHandler'</span><span class="s1">;</span>
<span class="s2">import </span><span class="s1">{ </span><span class="s4">State </span><span class="s1">} </span><span class="s2">from </span><span class="s5">'../State'</span><span class="s1">;</span>

<span class="s2">const </span><span class="s1">DRAG_TOSS </span><span class="s2">= </span><span class="s6">0.05</span><span class="s1">;</span>

<span class="s2">const </span><span class="s1">IDLE</span><span class="s2">: </span><span class="s4">DrawerState </span><span class="s2">= </span><span class="s5">'Idle'</span><span class="s1">;</span>
<span class="s2">const </span><span class="s1">DRAGGING</span><span class="s2">: </span><span class="s4">DrawerState </span><span class="s2">= </span><span class="s5">'Dragging'</span><span class="s1">;</span>
<span class="s2">const </span><span class="s1">SETTLING</span><span class="s2">: </span><span class="s4">DrawerState </span><span class="s2">= </span><span class="s5">'Settling'</span><span class="s1">;</span>

<span class="s2">export type </span><span class="s4">DrawerPosition </span><span class="s2">= </span><span class="s5">'left' </span><span class="s2">| </span><span class="s5">'right'</span><span class="s1">;</span>

<span class="s2">export type </span><span class="s4">DrawerState </span><span class="s2">= </span><span class="s5">'Idle' </span><span class="s2">| </span><span class="s5">'Dragging' </span><span class="s2">| </span><span class="s5">'Settling'</span><span class="s1">;</span>

<span class="s2">export type </span><span class="s4">DrawerType </span><span class="s2">= </span><span class="s5">'front' </span><span class="s2">| </span><span class="s5">'back' </span><span class="s2">| </span><span class="s5">'slide'</span><span class="s1">;</span>

<span class="s2">export type </span><span class="s4">DrawerLockMode </span><span class="s2">= </span><span class="s5">'unlocked' </span><span class="s2">| </span><span class="s5">'locked-closed' </span><span class="s2">| </span><span class="s5">'locked-open'</span><span class="s1">;</span>

<span class="s2">export type </span><span class="s4">DrawerKeyboardDismissMode </span><span class="s2">= </span><span class="s5">'none' </span><span class="s2">| </span><span class="s5">'on-drag'</span><span class="s1">;</span>

<span class="s0">// Animated.AnimatedInterpolation has been converted to a generic type</span>
<span class="s0">// in @types/react-native 0.70. This way we can maintain compatibility</span>
<span class="s0">// with all versions of @types/react-native`</span>
<span class="s2">type </span><span class="s4">AnimatedInterpolation </span><span class="s2">= </span><span class="s4">ReturnType</span><span class="s1">&lt;</span><span class="s4">Animated</span><span class="s1">.</span><span class="s4">Value</span><span class="s1">[</span><span class="s5">'interpolate'</span><span class="s1">]&gt;;</span>
<span class="s2">export interface </span><span class="s4">DrawerLayoutProps </span><span class="s1">{</span>
  <span class="s0">/**</span>
   <span class="s0">* This attribute is present in the standard implementation already and is one 
   * of the required params. Gesture handler version of DrawerLayout make it 
   * possible for the function passed as `renderNavigationView` to take an 
   * Animated value as a parameter that indicates the progress of drawer 
   * opening/closing animation (progress value is 0 when closed and 1 when 
   * opened). This can be used by the drawer component to animated its children 
   * while the drawer is opening or closing. 
   */</span>
  <span class="s1">renderNavigationView</span><span class="s2">: </span><span class="s1">(</span>
    <span class="s4">progressAnimatedValue</span><span class="s2">: </span><span class="s4">Animated</span><span class="s1">.</span><span class="s4">Value</span>
  <span class="s1">) </span><span class="s2">=&gt; </span><span class="s4">React</span><span class="s1">.</span><span class="s4">ReactNode</span><span class="s1">; 
</span>
  <span class="s1">drawerPosition</span><span class="s2">?: </span><span class="s4">DrawerPosition</span><span class="s1">;</span>

  <span class="s1">drawerWidth</span><span class="s2">?: </span><span class="s4">number</span><span class="s1">;</span>

  <span class="s1">drawerBackgroundColor</span><span class="s2">?: </span><span class="s4">string</span><span class="s1">;</span>

  <span class="s1">drawerLockMode</span><span class="s2">?: </span><span class="s4">DrawerLockMode</span><span class="s1">;</span>

  <span class="s1">keyboardDismissMode</span><span class="s2">?: </span><span class="s4">DrawerKeyboardDismissMode</span><span class="s1">;</span>

  <span class="s0">/**</span>
   <span class="s0">* Called when the drawer is closed. 
   */</span>
  <span class="s1">onDrawerClose</span><span class="s2">?: </span><span class="s1">() </span><span class="s2">=&gt; </span><span class="s4">void</span><span class="s1">;</span>

  <span class="s0">/**</span>
   <span class="s0">* Called when the drawer is opened. 
   */</span>
  <span class="s1">onDrawerOpen</span><span class="s2">?: </span><span class="s1">() </span><span class="s2">=&gt; </span><span class="s4">void</span><span class="s1">;</span>

  <span class="s0">/**</span>
   <span class="s0">* Called when the status of the drawer changes. 
   */</span>
  <span class="s1">onDrawerStateChanged</span><span class="s2">?: </span><span class="s1">(</span>
    <span class="s4">newState</span><span class="s2">: </span><span class="s4">DrawerState</span><span class="s1">,</span>
    <span class="s4">drawerWillShow</span><span class="s2">: </span><span class="s4">boolean</span>
  <span class="s1">) </span><span class="s2">=&gt; </span><span class="s4">void</span><span class="s1">;</span>
  <span class="s1">useNativeAnimations</span><span class="s2">?: </span><span class="s4">boolean</span><span class="s1">;</span>

  <span class="s1">drawerType</span><span class="s2">?: </span><span class="s4">DrawerType</span><span class="s1">;</span>

  <span class="s0">/**</span>
   <span class="s0">* Defines how far from the edge of the content view the gesture should 
   * activate. 
   */</span>
  <span class="s1">edgeWidth</span><span class="s2">?: </span><span class="s4">number</span><span class="s1">;</span>

  <span class="s1">minSwipeDistance</span><span class="s2">?: </span><span class="s4">number</span><span class="s1">;</span>

  <span class="s0">/**</span>
   <span class="s0">* When set to true Drawer component will use 
   * </span><span class="s4">{</span><span class="s2">@link </span><span class="s4">https://reactnative.dev/docs/statusbar StatusBar} </span><span class="s0">API to hide the OS 
   * status bar whenever the drawer is pulled or when its in an &quot;open&quot; state. 
   */</span>
  <span class="s1">hideStatusBar</span><span class="s2">?: </span><span class="s4">boolean</span><span class="s1">;</span>

  <span class="s0">/**</span>
   <span class="s0">* </span><span class="s2">@default </span><span class="s4">'slide'</span>
   <span class="s0">* 
   * Can be used when hideStatusBar is set to true and will select the animation 
   * used for hiding/showing the status bar. See 
   * </span><span class="s4">{</span><span class="s2">@link </span><span class="s4">https://reactnative.dev/docs/statusbar StatusBar} </span><span class="s0">documentation for 
   * more details 
   */</span>
  <span class="s1">statusBarAnimation</span><span class="s2">?: </span><span class="s4">StatusBarAnimation</span><span class="s1">;</span>

  <span class="s0">/**</span>
   <span class="s0">* </span><span class="s2">@default </span><span class="s4">black</span>
   <span class="s0">* 
   * Color of a semi-transparent overlay to be displayed on top of the content 
   * view when drawer gets open. A solid color should be used as the opacity is 
   * added by the Drawer itself and the opacity of the overlay is animated (from 
   * 0% to 70%). 
   */</span>
  <span class="s1">overlayColor</span><span class="s2">?: </span><span class="s4">string</span><span class="s1">;</span>

  <span class="s1">contentContainerStyle</span><span class="s2">?: </span><span class="s4">StyleProp</span><span class="s1">&lt;</span><span class="s4">ViewStyle</span><span class="s1">&gt;;</span>

  <span class="s1">drawerContainerStyle</span><span class="s2">?: </span><span class="s4">StyleProp</span><span class="s1">&lt;</span><span class="s4">ViewStyle</span><span class="s1">&gt;;</span>

  <span class="s0">/**</span>
   <span class="s0">* Enables two-finger gestures on supported devices, for example iPads with 
   * trackpads. If not enabled the gesture will require click + drag, with 
   * `enableTrackpadTwoFingerGesture` swiping with two fingers will also trigger 
   * the gesture. 
   */</span>
  <span class="s1">enableTrackpadTwoFingerGesture</span><span class="s2">?: </span><span class="s4">boolean</span><span class="s1">;</span>

  <span class="s1">onDrawerSlide</span><span class="s2">?: </span><span class="s1">(</span><span class="s4">position</span><span class="s2">: </span><span class="s4">number</span><span class="s1">) </span><span class="s2">=&gt; </span><span class="s4">void</span><span class="s1">;</span>

  <span class="s1">onGestureRef</span><span class="s2">?: </span><span class="s1">(</span><span class="s4">ref</span><span class="s2">: </span><span class="s4">PanGestureHandler</span><span class="s1">) </span><span class="s2">=&gt; </span><span class="s4">void</span><span class="s1">;</span>

  <span class="s0">// implicit `children` prop has been removed in @types/react^18.0.0</span>
  <span class="s1">children</span><span class="s2">?:</span>
    <span class="s2">| </span><span class="s4">React</span><span class="s1">.</span><span class="s4">ReactNode</span>
    <span class="s2">| </span><span class="s1">((</span><span class="s4">openValue</span><span class="s2">?: </span><span class="s4">AnimatedInterpolation</span><span class="s1">) </span><span class="s2">=&gt; </span><span class="s4">React</span><span class="s1">.</span><span class="s4">ReactNode</span><span class="s1">);</span>

  <span class="s0">/**</span>
   <span class="s0">* </span><span class="s2">@default </span><span class="s4">'none'</span>
   <span class="s0">* Defines which userSelect property should be used. 
   * Values: 'none'|'text'|'auto' 
   */</span>
  <span class="s1">userSelect</span><span class="s2">?: </span><span class="s4">UserSelect</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s2">export type </span><span class="s4">DrawerLayoutState </span><span class="s2">= </span><span class="s1">{</span>
  <span class="s1">dragX</span><span class="s2">: </span><span class="s4">Animated</span><span class="s1">.</span><span class="s4">Value</span><span class="s1">;</span>
  <span class="s1">touchX</span><span class="s2">: </span><span class="s4">Animated</span><span class="s1">.</span><span class="s4">Value</span><span class="s1">;</span>
  <span class="s1">drawerTranslation</span><span class="s2">: </span><span class="s4">Animated</span><span class="s1">.</span><span class="s4">Value</span><span class="s1">;</span>
  <span class="s1">containerWidth</span><span class="s2">: </span><span class="s4">number</span><span class="s1">;</span>
  <span class="s1">drawerState</span><span class="s2">: </span><span class="s4">DrawerState</span><span class="s1">;</span>
  <span class="s1">drawerOpened</span><span class="s2">: </span><span class="s4">boolean</span><span class="s1">;</span>
<span class="s1">};</span>

<span class="s2">export type </span><span class="s4">DrawerMovementOption </span><span class="s2">= </span><span class="s1">{</span>
  <span class="s1">velocity</span><span class="s2">?: </span><span class="s4">number</span><span class="s1">;</span>
  <span class="s1">speed</span><span class="s2">?: </span><span class="s4">number</span><span class="s1">;</span>
<span class="s1">};</span>
<span class="s2">export default class </span><span class="s4">DrawerLayout </span><span class="s2">extends </span><span class="s4">Component</span><span class="s1">&lt;</span>
  <span class="s4">DrawerLayoutProps</span><span class="s1">,</span>
  <span class="s4">DrawerLayoutState</span>
<span class="s1">&gt; {</span>
  <span class="s2">static </span><span class="s1">defaultProps </span><span class="s2">= </span><span class="s1">{</span>
    <span class="s1">drawerWidth: </span><span class="s6">200</span><span class="s1">,</span>
    <span class="s1">drawerPosition: </span><span class="s5">'left'</span><span class="s1">,</span>
    <span class="s1">useNativeAnimations: </span><span class="s3">true</span><span class="s1">,</span>
    <span class="s1">drawerType: </span><span class="s5">'front'</span><span class="s1">,</span>
    <span class="s1">edgeWidth: </span><span class="s6">20</span><span class="s1">,</span>
    <span class="s1">minSwipeDistance: </span><span class="s6">3</span><span class="s1">,</span>
    <span class="s1">overlayColor: </span><span class="s5">'rgba(0, 0, 0, 0.7)'</span><span class="s1">,</span>
    <span class="s1">drawerLockMode: </span><span class="s5">'unlocked'</span><span class="s1">,</span>
    <span class="s1">enableTrackpadTwoFingerGesture: </span><span class="s3">false</span><span class="s1">,</span>
  <span class="s1">};</span>

  <span class="s2">constructor</span><span class="s1">(</span><span class="s4">props</span><span class="s2">: </span><span class="s4">DrawerLayoutProps</span><span class="s1">) {</span>
    <span class="s4">super</span><span class="s1">(</span><span class="s4">props</span><span class="s1">);</span>

    <span class="s2">const </span><span class="s1">dragX </span><span class="s2">= new </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s6">0</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">touchX </span><span class="s2">= new </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s6">0</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">drawerTranslation </span><span class="s2">= new </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s6">0</span><span class="s1">);</span>

    <span class="s4">this</span><span class="s1">.</span><span class="s4">state </span><span class="s2">= </span><span class="s1">{</span>
      <span class="s4">dragX</span><span class="s1">,</span>
      <span class="s4">touchX</span><span class="s1">,</span>
      <span class="s4">drawerTranslation</span><span class="s1">,</span>
      <span class="s1">containerWidth: </span><span class="s6">0</span><span class="s1">,</span>
      <span class="s1">drawerState: </span><span class="s4">IDLE</span><span class="s1">,</span>
      <span class="s1">drawerOpened: </span><span class="s3">false</span><span class="s1">,</span>
    <span class="s1">};</span>

    <span class="s4">this</span><span class="s1">.</span><span class="s7">updateAnimatedEvent</span><span class="s1">(</span><span class="s4">props</span><span class="s1">, </span><span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">);</span>
  <span class="s1">}</span>

  <span class="s1">shouldComponentUpdate(</span><span class="s4">props</span><span class="s2">: </span><span class="s4">DrawerLayoutProps</span><span class="s1">, </span><span class="s4">state</span><span class="s2">: </span><span class="s4">DrawerLayoutState</span><span class="s1">) {</span>
    <span class="s2">if </span><span class="s1">(</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerPosition </span><span class="s2">!== </span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerPosition </span><span class="s2">||</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerWidth </span><span class="s2">!== </span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerWidth </span><span class="s2">||</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerType </span><span class="s2">!== </span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerType </span><span class="s2">||</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">containerWidth </span><span class="s2">!== </span><span class="s4">state</span><span class="s1">.</span><span class="s4">containerWidth</span>
    <span class="s1">) {</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s7">updateAnimatedEvent</span><span class="s1">(</span><span class="s4">props</span><span class="s1">, </span><span class="s4">state</span><span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s2">return </span><span class="s3">true</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">private </span><span class="s1">openValue</span><span class="s2">?: </span><span class="s4">AnimatedInterpolation</span><span class="s1">;</span>
  <span class="s2">private </span><span class="s1">onGestureEvent</span><span class="s2">?: </span><span class="s1">(</span>
    <span class="s4">event</span><span class="s2">: </span><span class="s4">GestureEvent</span><span class="s1">&lt;</span><span class="s4">PanGestureHandlerEventPayload</span><span class="s1">&gt;</span>
  <span class="s1">) </span><span class="s2">=&gt; </span><span class="s4">void</span><span class="s1">;</span>
  <span class="s2">private </span><span class="s1">accessibilityIsModalView </span><span class="s2">= </span><span class="s4">React</span><span class="s1">.</span><span class="s7">createRef</span><span class="s1">&lt;</span><span class="s4">View</span><span class="s1">&gt;();</span>
  <span class="s2">private </span><span class="s1">pointerEventsView </span><span class="s2">= </span><span class="s4">React</span><span class="s1">.</span><span class="s7">createRef</span><span class="s1">&lt;</span><span class="s4">View</span><span class="s1">&gt;();</span>
  <span class="s2">private </span><span class="s1">panGestureHandler </span><span class="s2">= </span><span class="s4">React</span><span class="s1">.</span><span class="s7">createRef</span><span class="s1">&lt;</span><span class="s4">PanGestureHandler </span><span class="s2">| </span><span class="s4">null</span><span class="s1">&gt;();</span>
  <span class="s2">private </span><span class="s1">drawerShown </span><span class="s2">= </span><span class="s3">false</span><span class="s1">;</span>

  <span class="s2">static </span><span class="s1">positions </span><span class="s2">= </span><span class="s1">{</span>
    <span class="s1">Left: </span><span class="s5">'left'</span><span class="s1">,</span>
    <span class="s1">Right: </span><span class="s5">'right'</span><span class="s1">,</span>
  <span class="s1">};</span>

  <span class="s2">private </span><span class="s1">updateAnimatedEvent </span><span class="s2">= </span><span class="s1">(</span>
    <span class="s4">props</span><span class="s2">: </span><span class="s4">DrawerLayoutProps</span><span class="s1">,</span>
    <span class="s4">state</span><span class="s2">: </span><span class="s4">DrawerLayoutState</span>
  <span class="s1">) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s0">// Event definition is based on</span>
    <span class="s2">const </span><span class="s1">{ drawerPosition, drawerWidth, drawerType } </span><span class="s2">= </span><span class="s4">props</span><span class="s1">;</span>
    <span class="s2">const </span><span class="s1">{</span>
      <span class="s4">dragX</span><span class="s1">: dragXValue,</span>
      <span class="s4">touchX</span><span class="s1">: touchXValue,</span>
      <span class="s1">drawerTranslation,</span>
      <span class="s1">containerWidth,</span>
    <span class="s1">} </span><span class="s2">= </span><span class="s4">state</span><span class="s1">;</span>

    <span class="s2">let </span><span class="s1">dragX </span><span class="s2">= </span><span class="s4">dragXValue</span><span class="s1">;</span>
    <span class="s2">let </span><span class="s1">touchX </span><span class="s2">= </span><span class="s4">touchXValue</span><span class="s1">;</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s4">drawerPosition </span><span class="s2">!== </span><span class="s5">'left'</span><span class="s1">) {</span>
      <span class="s0">// Most of the code is written in a way to handle left-side drawer. In</span>
      <span class="s0">// order to handle right-side drawer the only thing we need to do is to</span>
      <span class="s0">// reverse events coming from gesture handler in a way they emulate</span>
      <span class="s0">// left-side drawer gestures. E.g. dragX is simply -dragX, and touchX is</span>
      <span class="s0">// calulcated by subtracing real touchX from the width of the container</span>
      <span class="s0">// (such that when touch happens at the right edge the value is simply 0)</span>
      <span class="s4">dragX </span><span class="s2">= </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">multiply</span><span class="s1">(</span>
        <span class="s2">new </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s2">-</span><span class="s6">1</span><span class="s1">),</span>
        <span class="s4">dragXValue</span>
      <span class="s1">) </span><span class="s2">as </span><span class="s4">Animated</span><span class="s1">.</span><span class="s4">Value</span><span class="s1">; </span><span class="s0">// TODO(TS): (for all &quot;as&quot; in this file) make sure we can map this</span>
      <span class="s4">touchX </span><span class="s2">= </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">add</span><span class="s1">(</span>
        <span class="s2">new </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s4">containerWidth</span><span class="s1">),</span>
        <span class="s4">Animated</span><span class="s1">.</span><span class="s7">multiply</span><span class="s1">(</span><span class="s2">new </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s2">-</span><span class="s6">1</span><span class="s1">), </span><span class="s4">touchXValue</span><span class="s1">)</span>
      <span class="s1">) </span><span class="s2">as </span><span class="s4">Animated</span><span class="s1">.</span><span class="s4">Value</span><span class="s1">; </span><span class="s0">// TODO(TS): make sure we can map this;</span>
      <span class="s4">touchXValue</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span><span class="s4">containerWidth</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s4">touchXValue</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span><span class="s6">0</span><span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s0">// While closing the drawer when user starts gesture outside of its area (in greyed</span>
    <span class="s0">// out part of the window), we want the drawer to follow only once finger reaches the</span>
    <span class="s0">// edge of the drawer.</span>
    <span class="s0">// E.g. on the diagram below drawer is illustrate by X signs and the greyed out area by</span>
    <span class="s0">// dots. The touch gesture starts at '*' and moves left, touch path is indicated by</span>
    <span class="s0">// an arrow pointing left</span>
    <span class="s0">// 1) +---------------+ 2) +---------------+ 3) +---------------+ 4) +---------------+</span>
    <span class="s0">//    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXX|.........|</span>
    <span class="s0">//    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXX|.........|</span>
    <span class="s0">//    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXX|.........|</span>
    <span class="s0">//    |XXXXXXXX|......|    |XXXXXXXX|.&lt;-*..|    |XXXXXXXX|&lt;--*..|    |XXXXX|&lt;-----*..|</span>
    <span class="s0">//    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXX|.........|</span>
    <span class="s0">//    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXX|.........|</span>
    <span class="s0">//    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXXXXX|......|    |XXXXX|.........|</span>
    <span class="s0">//    +---------------+    +---------------+    +---------------+    +---------------+</span>
    <span class="s0">//</span>
    <span class="s0">// For the above to work properly we define animated value that will keep</span>
    <span class="s0">// start position of the gesture. Then we use that value to calculate how</span>
    <span class="s0">// much we need to subtract from the dragX. If the gesture started on the</span>
    <span class="s0">// greyed out area we take the distance from the edge of the drawer to the</span>
    <span class="s0">// start position. Otherwise we don't subtract at all and the drawer be</span>
    <span class="s0">// pulled back as soon as you start the pan.</span>
    <span class="s0">//</span>
    <span class="s0">// This is used only when drawerType is &quot;front&quot;</span>
    <span class="s0">//</span>
    <span class="s2">let </span><span class="s1">translationX </span><span class="s2">= </span><span class="s4">dragX</span><span class="s1">;</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s4">drawerType </span><span class="s2">=== </span><span class="s5">'front'</span><span class="s1">) {</span>
      <span class="s2">const </span><span class="s1">startPositionX </span><span class="s2">= </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">add</span><span class="s1">(</span>
        <span class="s4">touchX</span><span class="s1">,</span>
        <span class="s4">Animated</span><span class="s1">.</span><span class="s7">multiply</span><span class="s1">(</span><span class="s2">new </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s2">-</span><span class="s6">1</span><span class="s1">), </span><span class="s4">dragX</span><span class="s1">)</span>
      <span class="s1">);</span>

      <span class="s2">const </span><span class="s1">dragOffsetFromOnStartPosition </span><span class="s2">= </span><span class="s4">startPositionX</span><span class="s1">.</span><span class="s7">interpolate</span><span class="s1">({</span>
        <span class="s1">inputRange: [</span><span class="s4">drawerWidth</span><span class="s2">! - </span><span class="s6">1</span><span class="s1">, </span><span class="s4">drawerWidth</span><span class="s2">!</span><span class="s1">, </span><span class="s4">drawerWidth</span><span class="s2">! + </span><span class="s6">1</span><span class="s1">],</span>
        <span class="s1">outputRange: [</span><span class="s6">0</span><span class="s1">, </span><span class="s6">0</span><span class="s1">, </span><span class="s6">1</span><span class="s1">],</span>
      <span class="s1">});</span>
      <span class="s4">translationX </span><span class="s2">= </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">add</span><span class="s1">(</span>
        <span class="s4">dragX</span><span class="s1">,</span>
        <span class="s4">dragOffsetFromOnStartPosition</span>
      <span class="s1">) </span><span class="s2">as </span><span class="s4">Animated</span><span class="s1">.</span><span class="s4">Value</span><span class="s1">; </span><span class="s0">// TODO: as above</span>
    <span class="s1">}</span>

    <span class="s4">this</span><span class="s1">.</span><span class="s4">openValue </span><span class="s2">= </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">add</span><span class="s1">(</span><span class="s4">translationX</span><span class="s1">, </span><span class="s4">drawerTranslation</span><span class="s1">).</span><span class="s7">interpolate</span><span class="s1">({</span>
      <span class="s1">inputRange: [</span><span class="s6">0</span><span class="s1">, </span><span class="s4">drawerWidth</span><span class="s2">!</span><span class="s1">],</span>
      <span class="s1">outputRange: [</span><span class="s6">0</span><span class="s1">, </span><span class="s6">1</span><span class="s1">],</span>
      <span class="s1">extrapolate: </span><span class="s5">'clamp'</span><span class="s1">,</span>
    <span class="s1">});</span>

    <span class="s2">const </span><span class="s1">gestureOptions</span><span class="s2">: </span><span class="s1">{</span>
      <span class="s1">useNativeDriver</span><span class="s2">: </span><span class="s4">boolean</span><span class="s1">;</span>
      <span class="s0">// TODO: make sure it is correct</span>
      <span class="s1">listener</span><span class="s2">?: </span><span class="s1">(</span>
        <span class="s4">ev</span><span class="s2">: </span><span class="s4">NativeSyntheticEvent</span><span class="s1">&lt;</span><span class="s4">PanGestureHandlerEventPayload</span><span class="s1">&gt;</span>
      <span class="s1">) </span><span class="s2">=&gt; </span><span class="s4">void</span><span class="s1">; 
    } = { 
      useNativeDriver</span><span class="s2">: </span><span class="s4">props</span><span class="s1">.</span><span class="s4">useNativeAnimations</span><span class="s1">!,</span>
    <span class="s1">};</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">onDrawerSlide</span><span class="s1">) {</span>
      <span class="s4">gestureOptions</span><span class="s1">.</span><span class="s7">listener </span><span class="s2">= </span><span class="s1">(</span><span class="s4">ev</span><span class="s1">) </span><span class="s2">=&gt; </span><span class="s1">{</span>
        <span class="s2">const </span><span class="s1">translationX </span><span class="s2">= </span><span class="s4">Math</span><span class="s1">.</span><span class="s7">floor</span><span class="s1">(</span><span class="s4">Math</span><span class="s1">.</span><span class="s7">abs</span><span class="s1">(</span><span class="s4">ev</span><span class="s1">.</span><span class="s4">nativeEvent</span><span class="s1">.</span><span class="s4">translationX</span><span class="s1">));</span>
        <span class="s2">const </span><span class="s1">position </span><span class="s2">= </span><span class="s4">translationX </span><span class="s2">/ </span><span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">containerWidth</span><span class="s1">;</span>

        <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s7">onDrawerSlide</span><span class="s1">?.(</span><span class="s4">position</span><span class="s1">);</span>
      <span class="s1">};</span>
    <span class="s1">}</span>

    <span class="s4">this</span><span class="s1">.</span><span class="s4">onGestureEvent </span><span class="s2">= </span><span class="s4">Animated</span><span class="s1">.</span><span class="s7">event</span><span class="s1">(</span>
      <span class="s1">[{ nativeEvent: { translationX: </span><span class="s4">dragXValue</span><span class="s1">, x: </span><span class="s4">touchXValue </span><span class="s1">} }],</span>
      <span class="s4">gestureOptions</span>
    <span class="s1">);</span>
  <span class="s1">}; 
</span>
  <span class="s2">private </span><span class="s1">handleContainerLayout </span><span class="s2">= </span><span class="s1">({ </span><span class="s4">nativeEvent </span><span class="s1">}</span><span class="s2">: </span><span class="s4">LayoutChangeEvent</span><span class="s1">) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s7">setState</span><span class="s1">({ containerWidth: </span><span class="s4">nativeEvent</span><span class="s1">.</span><span class="s4">layout</span><span class="s1">.</span><span class="s4">width </span><span class="s1">});</span>
  <span class="s1">};</span>

  <span class="s2">private </span><span class="s1">emitStateChanged </span><span class="s2">= </span><span class="s1">(</span>
    <span class="s4">newState</span><span class="s2">: </span><span class="s4">DrawerState</span><span class="s1">,</span>
    <span class="s4">drawerWillShow</span><span class="s2">: </span><span class="s4">boolean</span>
  <span class="s1">) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s7">onDrawerStateChanged</span><span class="s1">?.(</span><span class="s4">newState</span><span class="s1">, </span><span class="s4">drawerWillShow</span><span class="s1">);</span>
  <span class="s1">}; 
</span>
  <span class="s2">private </span><span class="s1">openingHandlerStateChange </span><span class="s2">= </span><span class="s1">({</span>
    <span class="s4">nativeEvent</span><span class="s1">,</span>
  <span class="s1">}</span><span class="s2">: </span><span class="s4">HandlerStateChangeEvent</span><span class="s1">&lt;</span><span class="s4">PanGestureHandlerEventPayload</span><span class="s1">&gt;) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s4">nativeEvent</span><span class="s1">.</span><span class="s4">oldState </span><span class="s2">=== </span><span class="s4">State</span><span class="s1">.</span><span class="s4">ACTIVE</span><span class="s1">) {</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s7">handleRelease</span><span class="s1">({ </span><span class="s4">nativeEvent </span><span class="s1">});</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">nativeEvent</span><span class="s1">.</span><span class="s4">state </span><span class="s2">=== </span><span class="s4">State</span><span class="s1">.</span><span class="s4">ACTIVE</span><span class="s1">) {</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s7">emitStateChanged</span><span class="s1">(</span><span class="s4">DRAGGING</span><span class="s1">, </span><span class="s3">false</span><span class="s1">);</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s7">setState</span><span class="s1">({ drawerState: </span><span class="s4">DRAGGING </span><span class="s1">});</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">keyboardDismissMode </span><span class="s2">=== </span><span class="s5">'on-drag'</span><span class="s1">) {</span>
        <span class="s4">Keyboard</span><span class="s1">.</span><span class="s7">dismiss</span><span class="s1">();</span>
      <span class="s1">}</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">hideStatusBar</span><span class="s1">) {</span>
        <span class="s4">StatusBar</span><span class="s1">.</span><span class="s7">setHidden</span><span class="s1">(</span><span class="s3">true</span><span class="s1">, </span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">statusBarAnimation </span><span class="s2">|| </span><span class="s5">'slide'</span><span class="s1">);</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">};</span>

  <span class="s2">private </span><span class="s1">onTapHandlerStateChange </span><span class="s2">= </span><span class="s1">({</span>
    <span class="s4">nativeEvent</span><span class="s1">,</span>
  <span class="s1">}</span><span class="s2">: </span><span class="s4">HandlerStateChangeEvent</span><span class="s1">&lt;</span><span class="s4">TapGestureHandlerEventPayload</span><span class="s1">&gt;) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s2">if </span><span class="s1">(</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">drawerShown </span><span class="s2">&amp;&amp;</span>
      <span class="s4">nativeEvent</span><span class="s1">.</span><span class="s4">oldState </span><span class="s2">=== </span><span class="s4">State</span><span class="s1">.</span><span class="s4">ACTIVE </span><span class="s2">&amp;&amp;</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerLockMode </span><span class="s2">!== </span><span class="s5">'locked-open'</span>
    <span class="s1">) {</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s7">closeDrawer</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">};</span>

  <span class="s2">private </span><span class="s1">handleRelease </span><span class="s2">= </span><span class="s1">({</span>
    <span class="s4">nativeEvent</span><span class="s1">,</span>
  <span class="s1">}</span><span class="s2">: </span><span class="s4">HandlerStateChangeEvent</span><span class="s1">&lt;</span><span class="s4">PanGestureHandlerEventPayload</span><span class="s1">&gt;) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s2">const </span><span class="s1">{ drawerWidth, drawerPosition, drawerType } </span><span class="s2">= </span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">;</span>
    <span class="s2">const </span><span class="s1">{ containerWidth } </span><span class="s2">= </span><span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">;</span>
    <span class="s2">let </span><span class="s1">{ </span><span class="s4">translationX</span><span class="s1">: dragX, velocityX, </span><span class="s4">x</span><span class="s1">: touchX } </span><span class="s2">= </span><span class="s4">nativeEvent</span><span class="s1">;</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s4">drawerPosition </span><span class="s2">!== </span><span class="s5">'left'</span><span class="s1">) {</span>
      <span class="s0">// See description in _updateAnimatedEvent about why events are flipped</span>
      <span class="s0">// for right-side drawer</span>
      <span class="s4">dragX </span><span class="s2">= -</span><span class="s4">dragX</span><span class="s1">;</span>
      <span class="s4">touchX </span><span class="s2">= </span><span class="s4">containerWidth </span><span class="s2">- </span><span class="s4">touchX</span><span class="s1">;</span>
      <span class="s4">velocityX </span><span class="s2">= -</span><span class="s4">velocityX</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s2">const </span><span class="s1">gestureStartX </span><span class="s2">= </span><span class="s4">touchX </span><span class="s2">- </span><span class="s4">dragX</span><span class="s1">;</span>
    <span class="s2">let </span><span class="s1">dragOffsetBasedOnStart </span><span class="s2">= </span><span class="s6">0</span><span class="s1">;</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s4">drawerType </span><span class="s2">=== </span><span class="s5">'front'</span><span class="s1">) {</span>
      <span class="s4">dragOffsetBasedOnStart </span><span class="s2">=</span>
        <span class="s4">gestureStartX </span><span class="s2">&gt; </span><span class="s4">drawerWidth</span><span class="s2">! ? </span><span class="s4">gestureStartX </span><span class="s2">- </span><span class="s4">drawerWidth</span><span class="s2">! : </span><span class="s6">0</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s2">const </span><span class="s1">startOffsetX </span><span class="s2">=</span>
      <span class="s4">dragX </span><span class="s2">+ </span><span class="s4">dragOffsetBasedOnStart </span><span class="s2">+ </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">drawerShown </span><span class="s2">? </span><span class="s4">drawerWidth</span><span class="s2">! : </span><span class="s6">0</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">projOffsetX </span><span class="s2">= </span><span class="s4">startOffsetX </span><span class="s2">+ </span><span class="s4">DRAG_TOSS </span><span class="s2">* </span><span class="s4">velocityX</span><span class="s1">;</span>

    <span class="s2">const </span><span class="s1">shouldOpen </span><span class="s2">= </span><span class="s4">projOffsetX </span><span class="s2">&gt; </span><span class="s4">drawerWidth</span><span class="s2">! / </span><span class="s6">2</span><span class="s1">;</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s4">shouldOpen</span><span class="s1">) {</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s7">animateDrawer</span><span class="s1">(</span><span class="s4">startOffsetX</span><span class="s1">, </span><span class="s4">drawerWidth</span><span class="s2">!</span><span class="s1">, </span><span class="s4">velocityX</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s7">animateDrawer</span><span class="s1">(</span><span class="s4">startOffsetX</span><span class="s1">, </span><span class="s6">0</span><span class="s1">, </span><span class="s4">velocityX</span><span class="s1">);</span>
    <span class="s1">}</span>
  <span class="s1">};</span>

  <span class="s2">private </span><span class="s1">updateShowing </span><span class="s2">= </span><span class="s1">(</span><span class="s4">showing</span><span class="s2">: </span><span class="s4">boolean</span><span class="s1">) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s4">drawerShown </span><span class="s2">= </span><span class="s4">showing</span><span class="s1">;</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s4">accessibilityIsModalView</span><span class="s1">.</span><span class="s4">current</span><span class="s1">?.</span><span class="s7">setNativeProps</span><span class="s1">({</span>
      <span class="s1">accessibilityViewIsModal: </span><span class="s4">showing</span><span class="s1">,</span>
    <span class="s1">});</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s4">pointerEventsView</span><span class="s1">.</span><span class="s4">current</span><span class="s1">?.</span><span class="s7">setNativeProps</span><span class="s1">({</span>
      <span class="s1">pointerEvents: </span><span class="s4">showing </span><span class="s2">? </span><span class="s5">'auto' </span><span class="s2">: </span><span class="s5">'none'</span><span class="s1">,</span>
    <span class="s1">});</span>
    <span class="s2">const </span><span class="s1">{ drawerPosition, minSwipeDistance, edgeWidth } </span><span class="s2">= </span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">;</span>
    <span class="s2">const </span><span class="s1">fromLeft </span><span class="s2">= </span><span class="s4">drawerPosition </span><span class="s2">=== </span><span class="s5">'left'</span><span class="s1">;</span>
    <span class="s0">// gestureOrientation is 1 if the expected gesture is from left to right and</span>
    <span class="s0">// -1 otherwise e.g. when drawer is on the left and is closed we expect left</span>
    <span class="s0">// to right gesture, thus orientation will be 1.</span>
    <span class="s2">const </span><span class="s1">gestureOrientation </span><span class="s2">=</span>
      <span class="s1">(</span><span class="s4">fromLeft </span><span class="s2">? </span><span class="s6">1 </span><span class="s2">: -</span><span class="s6">1</span><span class="s1">) </span><span class="s2">* </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">drawerShown </span><span class="s2">? -</span><span class="s6">1 </span><span class="s2">: </span><span class="s6">1</span><span class="s1">);</span>
    <span class="s0">// When drawer is closed we want the hitSlop to be horizontally shorter than</span>
    <span class="s0">// the container size by the value of SLOP. This will make it only activate</span>
    <span class="s0">// when gesture happens not further than SLOP away from the edge</span>
    <span class="s2">const </span><span class="s1">hitSlop </span><span class="s2">= </span><span class="s4">fromLeft</span>
      <span class="s2">? </span><span class="s1">{ left: </span><span class="s6">0</span><span class="s1">, width: </span><span class="s4">showing </span><span class="s2">? </span><span class="s3">undefined </span><span class="s2">: </span><span class="s4">edgeWidth </span><span class="s1">}</span>
      <span class="s2">: </span><span class="s1">{ right: </span><span class="s6">0</span><span class="s1">, width: </span><span class="s4">showing </span><span class="s2">? </span><span class="s3">undefined </span><span class="s2">: </span><span class="s4">edgeWidth </span><span class="s1">};</span>
    <span class="s0">// @ts-ignore internal API, maybe could be fixed in handler types</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s4">panGestureHandler</span><span class="s1">.</span><span class="s4">current</span><span class="s1">?.</span><span class="s7">setNativeProps</span><span class="s1">({</span>
      <span class="s4">hitSlop</span><span class="s1">,</span>
      <span class="s1">activeOffsetX: </span><span class="s4">gestureOrientation </span><span class="s2">* </span><span class="s4">minSwipeDistance</span><span class="s2">!</span><span class="s1">,</span>
    <span class="s1">});</span>
  <span class="s1">};</span>

  <span class="s2">private </span><span class="s1">animateDrawer </span><span class="s2">= </span><span class="s1">(</span>
    <span class="s4">fromValue</span><span class="s2">: </span><span class="s4">number </span><span class="s2">| </span><span class="s4">null </span><span class="s2">| </span><span class="s4">undefined</span><span class="s1">,</span>
    <span class="s4">toValue</span><span class="s2">: </span><span class="s4">number</span><span class="s1">,</span>
    <span class="s4">velocity</span><span class="s2">: </span><span class="s4">number</span><span class="s1">,</span>
    <span class="s4">speed</span><span class="s2">?: </span><span class="s4">number</span>
  <span class="s1">) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">dragX</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span><span class="s6">0</span><span class="s1">);</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">touchX</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerPosition </span><span class="s2">=== </span><span class="s5">'left' </span><span class="s2">? </span><span class="s6">0 </span><span class="s2">: </span><span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">containerWidth</span>
    <span class="s1">);</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s4">fromValue </span><span class="s2">!= </span><span class="s3">null</span><span class="s1">) {</span>
      <span class="s2">let </span><span class="s1">nextFramePosition </span><span class="s2">= </span><span class="s4">fromValue</span><span class="s1">;</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">useNativeAnimations</span><span class="s1">) {</span>
        <span class="s0">// When using native driver, we predict the next position of the</span>
        <span class="s0">// animation because it takes one frame of a roundtrip to pass RELEASE</span>
        <span class="s0">// event from native driver to JS before we can start animating. Without</span>
        <span class="s0">// it, it is more noticable that the frame is dropped.</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s4">fromValue </span><span class="s2">&lt; </span><span class="s4">toValue </span><span class="s2">&amp;&amp; </span><span class="s4">velocity </span><span class="s2">&gt; </span><span class="s6">0</span><span class="s1">) {</span>
          <span class="s4">nextFramePosition </span><span class="s2">= </span><span class="s4">Math</span><span class="s1">.</span><span class="s7">min</span><span class="s1">(</span><span class="s4">fromValue </span><span class="s2">+ </span><span class="s4">velocity </span><span class="s2">/ </span><span class="s6">60.0</span><span class="s1">, </span><span class="s4">toValue</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s4">fromValue </span><span class="s2">&gt; </span><span class="s4">toValue </span><span class="s2">&amp;&amp; </span><span class="s4">velocity </span><span class="s2">&lt; </span><span class="s6">0</span><span class="s1">) {</span>
          <span class="s4">nextFramePosition </span><span class="s2">= </span><span class="s4">Math</span><span class="s1">.</span><span class="s7">max</span><span class="s1">(</span><span class="s4">fromValue </span><span class="s2">+ </span><span class="s4">velocity </span><span class="s2">/ </span><span class="s6">60.0</span><span class="s1">, </span><span class="s4">toValue</span><span class="s1">);</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">drawerTranslation</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span><span class="s4">nextFramePosition</span><span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s2">const </span><span class="s1">willShow </span><span class="s2">= </span><span class="s4">toValue </span><span class="s2">!== </span><span class="s6">0</span><span class="s1">;</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s7">updateShowing</span><span class="s1">(</span><span class="s4">willShow</span><span class="s1">);</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s7">emitStateChanged</span><span class="s1">(</span><span class="s4">SETTLING</span><span class="s1">, </span><span class="s4">willShow</span><span class="s1">);</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s7">setState</span><span class="s1">({ drawerState: </span><span class="s4">SETTLING </span><span class="s1">});</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">hideStatusBar</span><span class="s1">) {</span>
      <span class="s4">StatusBar</span><span class="s1">.</span><span class="s7">setHidden</span><span class="s1">(</span><span class="s4">willShow</span><span class="s1">, </span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">statusBarAnimation </span><span class="s2">|| </span><span class="s5">'slide'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s4">Animated</span><span class="s1">.</span><span class="s7">spring</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">drawerTranslation</span><span class="s1">, {</span>
      <span class="s4">velocity</span><span class="s1">,</span>
      <span class="s1">bounciness: </span><span class="s6">0</span><span class="s1">,</span>
      <span class="s4">toValue</span><span class="s1">,</span>
      <span class="s1">useNativeDriver: </span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">useNativeAnimations</span><span class="s2">!</span><span class="s1">,</span>
      <span class="s1">speed: </span><span class="s4">speed </span><span class="s2">?? </span><span class="s3">undefined</span><span class="s1">,</span>
    <span class="s1">}).</span><span class="s7">start</span><span class="s1">(({ </span><span class="s4">finished </span><span class="s1">}) </span><span class="s2">=&gt; </span><span class="s1">{</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s4">finished</span><span class="s1">) {</span>
        <span class="s4">this</span><span class="s1">.</span><span class="s7">emitStateChanged</span><span class="s1">(</span><span class="s4">IDLE</span><span class="s1">, </span><span class="s4">willShow</span><span class="s1">);</span>
        <span class="s4">this</span><span class="s1">.</span><span class="s7">setState</span><span class="s1">({ drawerOpened: </span><span class="s4">willShow </span><span class="s1">});</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">drawerState </span><span class="s2">!== </span><span class="s4">DRAGGING</span><span class="s1">) {</span>
          <span class="s0">// it's possilbe that user started drag while the drawer</span>
          <span class="s0">// was settling, don't override state in this case</span>
          <span class="s4">this</span><span class="s1">.</span><span class="s7">setState</span><span class="s1">({ drawerState: </span><span class="s4">IDLE </span><span class="s1">});</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s4">willShow</span><span class="s1">) {</span>
          <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s7">onDrawerOpen</span><span class="s1">?.();</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
          <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s7">onDrawerClose</span><span class="s1">?.();</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">});</span>
  <span class="s1">}; 
</span>
  <span class="s1">openDrawer </span><span class="s2">= </span><span class="s1">(</span><span class="s4">options</span><span class="s2">: </span><span class="s4">DrawerMovementOption </span><span class="s2">= </span><span class="s1">{}) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s7">animateDrawer</span><span class="s1">(</span>
      <span class="s0">// TODO: decide if it should be null or undefined is the proper value</span>
      <span class="s3">undefined</span><span class="s1">,</span>
      <span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">drawerWidth</span><span class="s2">!</span><span class="s1">,</span>
      <span class="s4">options</span><span class="s1">.</span><span class="s4">velocity </span><span class="s2">? </span><span class="s4">options</span><span class="s1">.</span><span class="s4">velocity </span><span class="s2">: </span><span class="s6">0</span><span class="s1">,</span>
      <span class="s4">options</span><span class="s1">.</span><span class="s4">speed</span>
    <span class="s1">);</span>

    <span class="s0">// We need to force the update, otherwise the overlay is not rerendered and</span>
    <span class="s0">// it would not be clickable</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s7">forceUpdate</span><span class="s1">();</span>
  <span class="s1">};</span>

  <span class="s1">closeDrawer </span><span class="s2">= </span><span class="s1">(</span><span class="s4">options</span><span class="s2">: </span><span class="s4">DrawerMovementOption </span><span class="s2">= </span><span class="s1">{}) </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s0">// TODO: decide if it should be null or undefined is the proper value</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s7">animateDrawer</span><span class="s1">(</span>
      <span class="s3">undefined</span><span class="s1">,</span>
      <span class="s6">0</span><span class="s1">,</span>
      <span class="s4">options</span><span class="s1">.</span><span class="s4">velocity </span><span class="s2">? </span><span class="s4">options</span><span class="s1">.</span><span class="s4">velocity </span><span class="s2">: </span><span class="s6">0</span><span class="s1">,</span>
      <span class="s4">options</span><span class="s1">.</span><span class="s4">speed</span>
    <span class="s1">);</span>

    <span class="s0">// We need to force the update, otherwise the overlay is not rerendered and</span>
    <span class="s0">// it would be still clickable</span>
    <span class="s4">this</span><span class="s1">.</span><span class="s7">forceUpdate</span><span class="s1">();</span>
  <span class="s1">};</span>

  <span class="s2">private </span><span class="s1">renderOverlay </span><span class="s2">= </span><span class="s1">() </span><span class="s2">=&gt; </span><span class="s1">{</span>
    <span class="s0">/* Overlay styles */</span>
    <span class="s7">invariant</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">openValue</span><span class="s1">, </span><span class="s5">'should be set'</span><span class="s1">);</span>
    <span class="s2">let </span><span class="s1">overlayOpacity;</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">drawerState </span><span class="s2">!== </span><span class="s4">IDLE</span><span class="s1">) {</span>
      <span class="s4">overlayOpacity </span><span class="s2">= </span><span class="s4">this</span><span class="s1">.</span><span class="s4">openValue</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s4">overlayOpacity </span><span class="s2">= </span><span class="s4">this</span><span class="s1">.</span><span class="s4">state</span><span class="s1">.</span><span class="s4">drawerOpened </span><span class="s2">? </span><span class="s6">1 </span><span class="s2">: </span><span class="s6">0</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s2">const </span><span class="s1">dynamicOverlayStyles </span><span class="s2">= </span><span class="s1">{</span>
      <span class="s1">opacity: </span><span class="s4">overlayOpacity</span><span class="s1">,</span>
      <span class="s1">backgroundColor: </span><span class="s4">this</span><span class="s1">.</span><span class="s4">props</span><span class="s1">.</span><span class="s4">overlayColor</span><span class="s1">,</span>
    <span class="s1">};</span>

    <span class="s2">return </span><span class="s1">(</span>
      <span class="s8">&lt;</span><span class="s9">TapGestureHandler </span><span class="s11">onHandlerStateChange</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">onTapHandlerStateChange</span><span class="s10">}</span><span class="s8">&gt;</span>
        <span class="s8">&lt;</span><span class="s9">Animated.View</span>
          <span class="s11">pointerEvents</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">drawerShown </span><span class="s2">? </span><span class="s5">'auto' </span><span class="s2">: </span><span class="s5">'none'</span><span class="s10">}</span>
          <span class="s11">ref</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">pointerEventsView</span><span class="s10">}</span>
          <span class="s11">style</span><span class="s2">=</span><span class="s10">{[</span><span class="s4">styles</span><span class="s10">.</span><span class="s4">overlay</span><span class="s10">, </span><span class="s4">dynamicOverlayStyles</span><span class="s10">]}</span>
        <span class="s10">/&gt; 
      </span><span class="s8">&lt;/</span><span class="s9">TapGestureHandler</span><span class="s8">&gt;</span>
    <span class="s10">); 
  }; 
</span>
  <span class="s10">private renderDrawer = () =&gt; {</span>
    <span class="s4">const </span><span class="s10">{</span>
      <span class="s4">drawerBackgroundColor</span><span class="s10">,</span>
      <span class="s4">drawerWidth</span><span class="s10">,</span>
      <span class="s4">drawerPosition</span><span class="s10">,</span>
      <span class="s4">drawerType</span><span class="s10">,</span>
      <span class="s4">drawerContainerStyle</span><span class="s10">,</span>
      <span class="s4">contentContainerStyle</span><span class="s10">,</span>
    <span class="s10">} </span><span class="s2">= </span><span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">; 
</span>
    <span class="s4">const fromLeft </span><span class="s2">= </span><span class="s4">drawerPosition </span><span class="s2">=== </span><span class="s5">'left'</span><span class="s10">; 
    </span><span class="s4">const drawerSlide </span><span class="s2">= </span><span class="s4">drawerType </span><span class="s2">!== </span><span class="s5">'back'</span><span class="s10">; 
    </span><span class="s4">const containerSlide </span><span class="s2">= </span><span class="s4">drawerType </span><span class="s2">!== </span><span class="s5">'front'</span><span class="s10">; 
</span>
    <span class="s0">// we rely on row and row-reverse flex directions to position the drawer</span>
    <span class="s0">// properly. Apparently for RTL these are flipped which requires us to use</span>
    <span class="s0">// the opposite setting for the drawer to appear from left or right</span>
    <span class="s0">// according to the drawerPosition prop</span>
    <span class="s4">const reverseContentDirection </span><span class="s2">= </span><span class="s4">I18nManager</span><span class="s10">.</span><span class="s4">isRTL </span><span class="s2">? </span><span class="s4">fromLeft </span><span class="s2">: !</span><span class="s4">fromLeft</span><span class="s10">; 
</span>
    <span class="s4">const dynamicDrawerStyles </span><span class="s2">= </span><span class="s10">{</span>
      <span class="s10">backgroundColor: </span><span class="s4">drawerBackgroundColor</span><span class="s10">,</span>
      <span class="s10">width: </span><span class="s4">drawerWidth</span><span class="s10">,</span>
    <span class="s10">}; 
    </span><span class="s4">const openValue </span><span class="s2">= </span><span class="s4">this</span><span class="s10">.</span><span class="s4">openValue</span><span class="s10">; 
    </span><span class="s7">invariant</span><span class="s10">(</span><span class="s4">openValue</span><span class="s10">, </span><span class="s5">'should be set'</span><span class="s10">); 
</span>
    <span class="s4">let containerStyles</span><span class="s10">; 
    </span><span class="s7">if </span><span class="s10">(</span><span class="s4">containerSlide</span><span class="s10">) {</span>
      <span class="s10">const </span><span class="s4">containerTranslateX </span><span class="s2">= </span><span class="s4">openValue</span><span class="s10">.</span><span class="s7">interpolate</span><span class="s10">({</span>
        <span class="s10">inputRange: [</span><span class="s6">0</span><span class="s10">, </span><span class="s6">1</span><span class="s10">],</span>
        <span class="s10">outputRange: </span><span class="s4">fromLeft </span><span class="s2">? </span><span class="s10">[</span><span class="s6">0</span><span class="s10">, </span><span class="s4">drawerWidth</span><span class="s2">!</span><span class="s10">] </span><span class="s2">: </span><span class="s10">[</span><span class="s6">0</span><span class="s10">, </span><span class="s2">-</span><span class="s4">drawerWidth</span><span class="s2">!</span><span class="s10">],</span>
        <span class="s10">extrapolate: </span><span class="s5">'clamp'</span><span class="s10">,</span>
      <span class="s10">});</span>
      <span class="s4">containerStyles </span><span class="s2">= </span><span class="s10">{</span>
        <span class="s10">transform: [{ translateX: </span><span class="s4">containerTranslateX </span><span class="s10">}],</span>
      <span class="s10">};</span>
    <span class="s10">}</span>

    <span class="s4">let drawerTranslateX</span><span class="s10">: </span><span class="s4">number </span><span class="s2">| </span><span class="s4">AnimatedInterpolation </span><span class="s2">= </span><span class="s6">0</span><span class="s10">; 
    </span><span class="s7">if </span><span class="s10">(</span><span class="s4">drawerSlide</span><span class="s10">) {</span>
      <span class="s10">const </span><span class="s4">closedDrawerOffset </span><span class="s2">= </span><span class="s4">fromLeft </span><span class="s2">? -</span><span class="s4">drawerWidth</span><span class="s2">! : </span><span class="s4">drawerWidth</span><span class="s2">!</span><span class="s10">;</span>
      <span class="s10">if (this.state.drawerState !== </span><span class="s4">IDLE</span><span class="s10">) {</span>
        <span class="s4">drawerTranslateX </span><span class="s2">= </span><span class="s4">openValue</span><span class="s10">.</span><span class="s7">interpolate</span><span class="s10">({</span>
          <span class="s10">inputRange: [</span><span class="s6">0</span><span class="s10">, </span><span class="s6">1</span><span class="s10">],</span>
          <span class="s10">outputRange: [</span><span class="s4">closedDrawerOffset</span><span class="s10">, </span><span class="s6">0</span><span class="s10">],</span>
          <span class="s10">extrapolate: </span><span class="s5">'clamp'</span><span class="s10">,</span>
        <span class="s10">});</span>
      <span class="s10">} else { 
        </span><span class="s4">drawerTranslateX </span><span class="s2">= </span><span class="s4">this</span><span class="s10">.</span><span class="s4">state</span><span class="s10">.</span><span class="s4">drawerOpened </span><span class="s2">? </span><span class="s6">0 </span><span class="s2">: </span><span class="s4">closedDrawerOffset</span><span class="s10">;</span>
      <span class="s10">}</span>
    <span class="s10">}</span>
    <span class="s10">const drawerStyles: {</span>
      <span class="s4">transform</span><span class="s10">: { translateX: </span><span class="s4">number </span><span class="s2">| </span><span class="s4">AnimatedInterpolation </span><span class="s10">}[]; 
      </span><span class="s4">flexDirection</span><span class="s10">: </span><span class="s5">'row-reverse' </span><span class="s2">| </span><span class="s5">'row'</span><span class="s10">; 
    } = {</span>
      <span class="s4">transform</span><span class="s10">: [{ translateX: </span><span class="s4">drawerTranslateX </span><span class="s10">}],</span>
      <span class="s4">flexDirection</span><span class="s10">: </span><span class="s4">reverseContentDirection </span><span class="s2">? </span><span class="s5">'row-reverse' </span><span class="s2">: </span><span class="s5">'row'</span><span class="s10">,</span>
    <span class="s10">}; 
</span>
    <span class="s10">return ( 
      </span><span class="s8">&lt;</span><span class="s9">Animated.View </span><span class="s11">style</span><span class="s2">=</span><span class="s10">{</span><span class="s4">styles</span><span class="s10">.</span><span class="s4">main</span><span class="s10">} </span><span class="s11">onLayout</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">handleContainerLayout</span><span class="s10">}</span><span class="s8">&gt;</span>
        <span class="s8">&lt;</span><span class="s9">Animated.View</span>
          <span class="s11">style</span><span class="s2">=</span><span class="s10">{[</span>
            <span class="s4">drawerType </span><span class="s2">=== </span><span class="s5">'front'</span>
              <span class="s2">? </span><span class="s4">styles</span><span class="s10">.</span><span class="s4">containerOnBack</span>
              <span class="s2">: </span><span class="s4">styles</span><span class="s10">.</span><span class="s4">containerInFront</span><span class="s10">,</span>
            <span class="s4">containerStyles</span><span class="s10">,</span>
            <span class="s4">contentContainerStyle</span><span class="s10">,</span>
          <span class="s10">]}</span>
          <span class="s11">importantForAccessibility</span><span class="s2">=</span><span class="s10">{</span>
            <span class="s4">this</span><span class="s10">.</span><span class="s4">drawerShown </span><span class="s2">? </span><span class="s5">'no-hide-descendants' </span><span class="s2">: </span><span class="s5">'yes'</span>
          <span class="s10">}</span><span class="s8">&gt;</span>
          <span class="s10">{</span><span class="s2">typeof </span><span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">.</span><span class="s4">children </span><span class="s2">=== </span><span class="s5">'function'</span>
            <span class="s2">? </span><span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">.</span><span class="s7">children</span><span class="s10">(</span><span class="s4">this</span><span class="s10">.</span><span class="s4">openValue</span><span class="s10">)</span>
            <span class="s2">: </span><span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">.</span><span class="s4">children</span><span class="s10">}</span>
          <span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s7">renderOverlay</span><span class="s10">()}</span>
        <span class="s8">&lt;/</span><span class="s9">Animated.View</span><span class="s8">&gt;</span>
        <span class="s8">&lt;</span><span class="s9">Animated.View</span>
          <span class="s11">pointerEvents</span><span class="s2">=</span><span class="s5">&quot;box-none&quot;</span>
          <span class="s11">ref</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">accessibilityIsModalView</span><span class="s10">}</span>
          <span class="s11">accessibilityViewIsModal</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">drawerShown</span><span class="s10">}</span>
          <span class="s11">style</span><span class="s2">=</span><span class="s10">{[</span><span class="s4">styles</span><span class="s10">.</span><span class="s4">drawerContainer</span><span class="s10">, </span><span class="s4">drawerStyles</span><span class="s10">, </span><span class="s4">drawerContainerStyle</span><span class="s10">]}</span><span class="s8">&gt;</span>
          <span class="s8">&lt;</span><span class="s9">View </span><span class="s11">style</span><span class="s2">=</span><span class="s10">{</span><span class="s4">dynamicDrawerStyles</span><span class="s10">}</span><span class="s8">&gt;</span>
            <span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">.</span><span class="s7">renderNavigationView</span><span class="s10">(</span><span class="s4">this</span><span class="s10">.</span><span class="s4">openValue </span><span class="s2">as </span><span class="s4">Animated</span><span class="s10">.</span><span class="s4">Value</span><span class="s10">)}</span>
          <span class="s8">&lt;/</span><span class="s9">View</span><span class="s8">&gt;</span>
        <span class="s8">&lt;/</span><span class="s9">Animated.View</span><span class="s8">&gt;</span>
      <span class="s8">&lt;/</span><span class="s9">Animated.View</span><span class="s8">&gt;</span>
    <span class="s10">); 
  }; 
</span>
  <span class="s10">private setPanGestureRef = (ref: PanGestureHandler) =&gt; {</span>
    <span class="s0">// TODO(TS): make sure it is OK taken from</span>
    <span class="s0">// https://github.com/DefinitelyTyped/DefinitelyTyped/issues/31065#issuecomment-596081842</span>
    <span class="s10">(</span>
      <span class="s4">this</span><span class="s10">.</span><span class="s4">panGestureHandler </span><span class="s2">as </span><span class="s4">React</span><span class="s10">.</span><span class="s4">MutableRefObject</span><span class="s10">&lt;</span><span class="s4">PanGestureHandler</span><span class="s10">&gt;</span>
    <span class="s10">).</span><span class="s4">current </span><span class="s2">= </span><span class="s4">ref</span><span class="s10">; 
    </span><span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">.</span><span class="s7">onGestureRef</span><span class="s10">?.(</span><span class="s4">ref</span><span class="s10">); 
  }; 
</span>
  <span class="s10">render() {</span>
    <span class="s4">const </span><span class="s10">{ </span><span class="s4">drawerPosition</span><span class="s10">, </span><span class="s4">drawerLockMode</span><span class="s10">, </span><span class="s4">edgeWidth</span><span class="s10">, </span><span class="s4">minSwipeDistance </span><span class="s10">} </span><span class="s2">=</span>
      <span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">; 
</span>
    <span class="s4">const fromLeft </span><span class="s2">= </span><span class="s4">drawerPosition </span><span class="s2">=== </span><span class="s5">'left'</span><span class="s10">; 
</span>
    <span class="s0">// gestureOrientation is 1 if the expected gesture is from left to right and</span>
    <span class="s0">// -1 otherwise e.g. when drawer is on the left and is closed we expect left</span>
    <span class="s0">// to right gesture, thus orientation will be 1.</span>
    <span class="s4">const gestureOrientation </span><span class="s2">=</span>
      <span class="s10">(</span><span class="s4">fromLeft </span><span class="s2">? </span><span class="s6">1 </span><span class="s2">: -</span><span class="s6">1</span><span class="s10">) </span><span class="s2">* </span><span class="s10">(</span><span class="s4">this</span><span class="s10">.</span><span class="s4">drawerShown </span><span class="s2">? -</span><span class="s6">1 </span><span class="s2">: </span><span class="s6">1</span><span class="s10">); 
</span>
    <span class="s0">// When drawer is closed we want the hitSlop to be horizontally shorter than</span>
    <span class="s0">// the container size by the value of SLOP. This will make it only activate</span>
    <span class="s0">// when gesture happens not further than SLOP away from the edge</span>
    <span class="s4">const hitSlop </span><span class="s2">= </span><span class="s4">fromLeft</span>
      <span class="s2">? </span><span class="s10">{ left: </span><span class="s6">0</span><span class="s10">, width: </span><span class="s4">this</span><span class="s10">.</span><span class="s4">drawerShown </span><span class="s2">? </span><span class="s3">undefined </span><span class="s2">: </span><span class="s4">edgeWidth </span><span class="s10">}</span>
      <span class="s2">: </span><span class="s10">{ right: </span><span class="s6">0</span><span class="s10">, width: </span><span class="s4">this</span><span class="s10">.</span><span class="s4">drawerShown </span><span class="s2">? </span><span class="s3">undefined </span><span class="s2">: </span><span class="s4">edgeWidth </span><span class="s10">}; 
</span>
    <span class="s7">return </span><span class="s10">(</span>
      <span class="s8">&lt;</span><span class="s9">PanGestureHandler</span>
        <span class="s0">// @ts-ignore could be fixed in handler types</span>
        <span class="s11">userSelect</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">.</span><span class="s4">userSelect</span><span class="s10">}</span>
        <span class="s11">ref</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">setPanGestureRef</span><span class="s10">}</span>
        <span class="s11">hitSlop</span><span class="s2">=</span><span class="s10">{</span><span class="s4">hitSlop</span><span class="s10">}</span>
        <span class="s11">activeOffsetX</span><span class="s2">=</span><span class="s10">{</span><span class="s4">gestureOrientation </span><span class="s2">* </span><span class="s4">minSwipeDistance</span><span class="s2">!</span><span class="s10">}</span>
        <span class="s11">failOffsetY</span><span class="s2">=</span><span class="s10">{[</span><span class="s2">-</span><span class="s6">15</span><span class="s10">, </span><span class="s6">15</span><span class="s10">]}</span>
        <span class="s11">onGestureEvent</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">onGestureEvent</span><span class="s10">}</span>
        <span class="s11">onHandlerStateChange</span><span class="s2">=</span><span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s4">openingHandlerStateChange</span><span class="s10">}</span>
        <span class="s11">enableTrackpadTwoFingerGesture</span><span class="s2">=</span><span class="s10">{</span>
          <span class="s4">this</span><span class="s10">.</span><span class="s4">props</span><span class="s10">.</span><span class="s4">enableTrackpadTwoFingerGesture</span>
        <span class="s10">}</span>
        <span class="s11">enabled</span><span class="s2">=</span><span class="s10">{</span>
          <span class="s4">drawerLockMode </span><span class="s2">!== </span><span class="s5">'locked-closed' </span><span class="s2">&amp;&amp; </span><span class="s4">drawerLockMode </span><span class="s2">!== </span><span class="s5">'locked-open'</span>
        <span class="s10">}</span><span class="s8">&gt;</span>
        <span class="s10">{</span><span class="s4">this</span><span class="s10">.</span><span class="s7">renderDrawer</span><span class="s10">()}</span>
      <span class="s8">&lt;/</span><span class="s9">PanGestureHandler</span><span class="s8">&gt;</span>
    <span class="s10">); 
  }</span>
<span class="s10">} 
</span>
<span class="s10">const styles = StyleSheet.create({</span>
  <span class="s4">drawerContainer</span><span class="s10">: {</span>
    <span class="s2">...</span><span class="s4">StyleSheet</span><span class="s10">.</span><span class="s4">absoluteFillObject</span><span class="s10">,</span>
    <span class="s10">zIndex: </span><span class="s6">1001</span><span class="s10">,</span>
    <span class="s10">flexDirection: </span><span class="s5">'row'</span><span class="s10">,</span>
  <span class="s10">},</span>
  <span class="s4">containerInFront</span><span class="s10">: {</span>
    <span class="s2">...</span><span class="s4">StyleSheet</span><span class="s10">.</span><span class="s4">absoluteFillObject</span><span class="s10">,</span>
    <span class="s10">zIndex: </span><span class="s6">1002</span><span class="s10">,</span>
  <span class="s10">},</span>
  <span class="s4">containerOnBack</span><span class="s10">: {</span>
    <span class="s2">...</span><span class="s4">StyleSheet</span><span class="s10">.</span><span class="s4">absoluteFillObject</span><span class="s10">,</span>
  <span class="s10">},</span>
  <span class="s4">main</span><span class="s10">: {</span>
    <span class="s10">flex: </span><span class="s6">1</span><span class="s10">,</span>
    <span class="s10">zIndex: </span><span class="s6">0</span><span class="s10">,</span>
    <span class="s10">overflow: </span><span class="s5">'hidden'</span><span class="s10">,</span>
  <span class="s10">},</span>
  <span class="s4">overlay</span><span class="s10">: {</span>
    <span class="s2">...</span><span class="s4">StyleSheet</span><span class="s10">.</span><span class="s4">absoluteFillObject</span><span class="s10">,</span>
    <span class="s10">zIndex: </span><span class="s6">1000</span><span class="s10">,</span>
  <span class="s10">},</span>
<span class="s10">}); 
</span></pre>
</body>
</html>