<html>
<head>
<title>clean.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6a8759;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
clean.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>

<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span>
  <span class="s1">value: </span><span class="s2">true</span>
<span class="s1">});</span>
<span class="s1">exports.clean = clean;</span>
<span class="s1">exports.</span><span class="s2">default </span><span class="s1">= </span><span class="s2">void </span><span class="s3">0</span><span class="s1">;</span>
<span class="s2">function </span><span class="s1">_cliTools() {</span>
  <span class="s1">const data = require(</span><span class="s0">&quot;@react-native-community/cli-tools&quot;</span><span class="s1">);</span>
  <span class="s1">_cliTools = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">return </span><span class="s1">data;</span>
  <span class="s1">};</span>
  <span class="s2">return </span><span class="s1">data;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_chalk() {</span>
  <span class="s1">const data = _interopRequireDefault(require(</span><span class="s0">&quot;chalk&quot;</span><span class="s1">));</span>
  <span class="s1">_chalk = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">return </span><span class="s1">data;</span>
  <span class="s1">};</span>
  <span class="s2">return </span><span class="s1">data;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_execa() {</span>
  <span class="s1">const data = _interopRequireDefault(require(</span><span class="s0">&quot;execa&quot;</span><span class="s1">));</span>
  <span class="s1">_execa = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">return </span><span class="s1">data;</span>
  <span class="s1">};</span>
  <span class="s2">return </span><span class="s1">data;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_fs() {</span>
  <span class="s1">const data = require(</span><span class="s0">&quot;fs&quot;</span><span class="s1">);</span>
  <span class="s1">_fs = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">return </span><span class="s1">data;</span>
  <span class="s1">};</span>
  <span class="s2">return </span><span class="s1">data;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_os() {</span>
  <span class="s1">const data = _interopRequireDefault(require(</span><span class="s0">&quot;os&quot;</span><span class="s1">));</span>
  <span class="s1">_os = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">return </span><span class="s1">data;</span>
  <span class="s1">};</span>
  <span class="s2">return </span><span class="s1">data;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_path() {</span>
  <span class="s1">const data = _interopRequireDefault(require(</span><span class="s0">&quot;path&quot;</span><span class="s1">));</span>
  <span class="s1">_path = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">return </span><span class="s1">data;</span>
  <span class="s1">};</span>
  <span class="s2">return </span><span class="s1">data;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_prompts() {</span>
  <span class="s1">const data = _interopRequireDefault(require(</span><span class="s0">&quot;prompts&quot;</span><span class="s1">));</span>
  <span class="s1">_prompts = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">return </span><span class="s1">data;</span>
  <span class="s1">};</span>
  <span class="s2">return </span><span class="s1">data;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_util() {</span>
  <span class="s1">const data = require(</span><span class="s0">&quot;util&quot;</span><span class="s1">);</span>
  <span class="s1">_util = </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s2">return </span><span class="s1">data;</span>
  <span class="s1">};</span>
  <span class="s2">return </span><span class="s1">data;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_interopRequireDefault(obj) { </span><span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : { </span><span class="s2">default</span><span class="s1">: obj }; }</span>
<span class="s1">const DEFAULT_GROUPS = [</span><span class="s0">'metro'</span><span class="s1">, </span><span class="s0">'watchman'</span><span class="s1">];</span>
<span class="s1">const rmdirAsync = (</span><span class="s3">0</span><span class="s1">, _util().promisify)(_fs().rmdir);</span>
<span class="s2">function </span><span class="s1">cleanDir(directory) {</span>
  <span class="s2">if </span><span class="s1">(!(</span><span class="s3">0</span><span class="s1">, _fs().existsSync)(directory)) {</span>
    <span class="s2">return </span><span class="s1">Promise.resolve();</span>
  <span class="s1">}</span>
  <span class="s2">return </span><span class="s1">rmdirAsync(directory, {</span>
    <span class="s1">maxRetries: </span><span class="s3">3</span><span class="s1">,</span>
    <span class="s1">recursive: </span><span class="s2">true</span>
  <span class="s1">});</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">findPath(startPath, files) {</span>
  <span class="s4">// TODO: Find project files via `@react-native-community/cli`</span>
  <span class="s2">for </span><span class="s1">(const file of files) {</span>
    <span class="s1">const filename = _path().</span><span class="s2">default</span><span class="s1">.resolve(startPath, file);</span>
    <span class="s2">if </span><span class="s1">((</span><span class="s3">0</span><span class="s1">, _fs().existsSync)(filename)) {</span>
      <span class="s2">return </span><span class="s1">filename;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s2">return </span><span class="s1">undefined;</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">promptForCaches(groups) {</span>
  <span class="s1">const {</span>
    <span class="s1">caches</span>
  <span class="s1">} = await (</span><span class="s3">0</span><span class="s1">, _prompts().</span><span class="s2">default</span><span class="s1">)({</span>
    <span class="s1">type: </span><span class="s0">'multiselect'</span><span class="s1">,</span>
    <span class="s1">name: </span><span class="s0">'caches'</span><span class="s1">,</span>
    <span class="s1">message: </span><span class="s0">'Select all caches to clean'</span><span class="s1">,</span>
    <span class="s1">choices: Object.entries(groups).map(([cmd, group]) =&gt; ({</span>
      <span class="s1">title: `${cmd} ${_chalk().</span><span class="s2">default</span><span class="s1">.dim(`(${group.description})`)}`,</span>
      <span class="s1">value: cmd,</span>
      <span class="s1">selected: DEFAULT_GROUPS.includes(cmd)</span>
    <span class="s1">})),</span>
    <span class="s1">min: </span><span class="s3">1</span>
  <span class="s1">});</span>
  <span class="s2">return </span><span class="s1">caches;</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">clean(_argv, _config, cleanOptions) {</span>
  <span class="s1">const {</span>
    <span class="s1">include,</span>
    <span class="s1">projectRoot,</span>
    <span class="s1">verifyCache</span>
  <span class="s1">} = cleanOptions;</span>
  <span class="s2">if </span><span class="s1">(!(</span><span class="s3">0</span><span class="s1">, _fs().existsSync)(projectRoot)) {</span>
    <span class="s2">throw new </span><span class="s1">Error(`Invalid path provided! ${projectRoot}`);</span>
  <span class="s1">}</span>
  <span class="s1">const COMMANDS = {</span>
    <span class="s1">android: {</span>
      <span class="s1">description: </span><span class="s0">'Android build caches, e.g. Gradle'</span><span class="s1">,</span>
      <span class="s1">tasks: [{</span>
        <span class="s1">label: </span><span class="s0">'Clean Gradle cache'</span><span class="s1">,</span>
        <span class="s1">action: async () =&gt; {</span>
          <span class="s1">const candidates = _os().</span><span class="s2">default</span><span class="s1">.platform() === </span><span class="s0">'win32' </span><span class="s1">? [</span><span class="s0">'android/gradlew.bat'</span><span class="s1">, </span><span class="s0">'gradlew.bat'</span><span class="s1">] : [</span><span class="s0">'android/gradlew'</span><span class="s1">, </span><span class="s0">'gradlew'</span><span class="s1">];</span>
          <span class="s1">const gradlew = findPath(projectRoot, candidates);</span>
          <span class="s2">if </span><span class="s1">(gradlew) {</span>
            <span class="s1">const script = _path().</span><span class="s2">default</span><span class="s1">.basename(gradlew);</span>
            <span class="s1">await (</span><span class="s3">0</span><span class="s1">, _execa().</span><span class="s2">default</span><span class="s1">)(_os().</span><span class="s2">default</span><span class="s1">.platform() === </span><span class="s0">'win32' </span><span class="s1">? script : `./${script}`, [</span><span class="s0">'clean'</span><span class="s1">], {</span>
              <span class="s1">cwd: _path().</span><span class="s2">default</span><span class="s1">.dirname(gradlew)</span>
            <span class="s1">});</span>
          <span class="s1">}</span>
        <span class="s1">}</span>
      <span class="s1">}]</span>
    <span class="s1">},</span>
    <span class="s1">...(_os().</span><span class="s2">default</span><span class="s1">.platform() === </span><span class="s0">'darwin' </span><span class="s1">? {</span>
      <span class="s1">cocoapods: {</span>
        <span class="s1">description: </span><span class="s0">'CocoaPods cache'</span><span class="s1">,</span>
        <span class="s1">tasks: [{</span>
          <span class="s1">label: </span><span class="s0">'Clean CocoaPods pod cache'</span><span class="s1">,</span>
          <span class="s1">action: async () =&gt; {</span>
            <span class="s1">await (</span><span class="s3">0</span><span class="s1">, _execa().</span><span class="s2">default</span><span class="s1">)(</span><span class="s0">'pod'</span><span class="s1">, [</span><span class="s0">'cache'</span><span class="s1">, </span><span class="s0">'clean'</span><span class="s1">, </span><span class="s0">'--all'</span><span class="s1">], {</span>
              <span class="s1">cwd: projectRoot</span>
            <span class="s1">});</span>
          <span class="s1">}</span>
        <span class="s1">}, {</span>
          <span class="s1">label: </span><span class="s0">'Remove installed CocoaPods'</span><span class="s1">,</span>
          <span class="s1">action: () =&gt; cleanDir(</span><span class="s0">'ios/Pods'</span><span class="s1">)</span>
        <span class="s1">}, {</span>
          <span class="s1">label: </span><span class="s0">'Remove CocoaPods spec cache'</span><span class="s1">,</span>
          <span class="s1">action: () =&gt; cleanDir(</span><span class="s0">'~/.cocoapods'</span><span class="s1">)</span>
        <span class="s1">}]</span>
      <span class="s1">}</span>
    <span class="s1">} : undefined),</span>
    <span class="s1">metro: {</span>
      <span class="s1">description: </span><span class="s0">'Metro, haste-map caches'</span><span class="s1">,</span>
      <span class="s1">tasks: [{</span>
        <span class="s1">label: </span><span class="s0">'Clean Metro cache'</span><span class="s1">,</span>
        <span class="s1">action: () =&gt; cleanDir(`${_os().</span><span class="s2">default</span><span class="s1">.tmpdir()}/metro-*`)</span>
      <span class="s1">}, {</span>
        <span class="s1">label: </span><span class="s0">'Clean Haste cache'</span><span class="s1">,</span>
        <span class="s1">action: () =&gt; cleanDir(`${_os().</span><span class="s2">default</span><span class="s1">.tmpdir()}/haste-map-*`)</span>
      <span class="s1">}, {</span>
        <span class="s1">label: </span><span class="s0">'Clean React Native cache'</span><span class="s1">,</span>
        <span class="s1">action: () =&gt; cleanDir(`${_os().</span><span class="s2">default</span><span class="s1">.tmpdir()}/react-*`)</span>
      <span class="s1">}]</span>
    <span class="s1">},</span>
    <span class="s1">npm: {</span>
      <span class="s1">description: </span><span class="s0">'`node_modules` folder in the current package, and optionally verify npm cache'</span><span class="s1">,</span>
      <span class="s1">tasks: [{</span>
        <span class="s1">label: </span><span class="s0">'Remove node_modules'</span><span class="s1">,</span>
        <span class="s1">action: () =&gt; cleanDir(`${projectRoot}/node_modules`)</span>
      <span class="s1">}, ...(verifyCache ? [{</span>
        <span class="s1">label: </span><span class="s0">'Verify npm cache'</span><span class="s1">,</span>
        <span class="s1">action: async () =&gt; {</span>
          <span class="s1">await (</span><span class="s3">0</span><span class="s1">, _execa().</span><span class="s2">default</span><span class="s1">)(</span><span class="s0">'npm'</span><span class="s1">, [</span><span class="s0">'cache'</span><span class="s1">, </span><span class="s0">'verify'</span><span class="s1">], {</span>
            <span class="s1">cwd: projectRoot</span>
          <span class="s1">});</span>
        <span class="s1">}</span>
      <span class="s1">}] : [])]</span>
    <span class="s1">},</span>
    <span class="s1">watchman: {</span>
      <span class="s1">description: </span><span class="s0">'Stop Watchman and delete its cache'</span><span class="s1">,</span>
      <span class="s1">tasks: [{</span>
        <span class="s1">label: </span><span class="s0">'Stop Watchman'</span><span class="s1">,</span>
        <span class="s1">action: async () =&gt; {</span>
          <span class="s1">await (</span><span class="s3">0</span><span class="s1">, _execa().</span><span class="s2">default</span><span class="s1">)(_os().</span><span class="s2">default</span><span class="s1">.platform() === </span><span class="s0">'win32' </span><span class="s1">? </span><span class="s0">'tskill' </span><span class="s1">: </span><span class="s0">'killall'</span><span class="s1">, [</span><span class="s0">'watchman'</span><span class="s1">], {</span>
            <span class="s1">cwd: projectRoot</span>
          <span class="s1">});</span>
        <span class="s1">}</span>
      <span class="s1">}, {</span>
        <span class="s1">label: </span><span class="s0">'Delete Watchman cache'</span><span class="s1">,</span>
        <span class="s1">action: async () =&gt; {</span>
          <span class="s1">await (</span><span class="s3">0</span><span class="s1">, _execa().</span><span class="s2">default</span><span class="s1">)(</span><span class="s0">'watchman'</span><span class="s1">, [</span><span class="s0">'watch-del-all'</span><span class="s1">], {</span>
            <span class="s1">cwd: projectRoot</span>
          <span class="s1">});</span>
        <span class="s1">}</span>
      <span class="s1">}]</span>
    <span class="s1">},</span>
    <span class="s1">yarn: {</span>
      <span class="s1">description: </span><span class="s0">'Yarn cache'</span><span class="s1">,</span>
      <span class="s1">tasks: [{</span>
        <span class="s1">label: </span><span class="s0">'Clean Yarn cache'</span><span class="s1">,</span>
        <span class="s1">action: async () =&gt; {</span>
          <span class="s1">await (</span><span class="s3">0</span><span class="s1">, _execa().</span><span class="s2">default</span><span class="s1">)(</span><span class="s0">'yarn'</span><span class="s1">, [</span><span class="s0">'cache'</span><span class="s1">, </span><span class="s0">'clean'</span><span class="s1">], {</span>
            <span class="s1">cwd: projectRoot</span>
          <span class="s1">});</span>
        <span class="s1">}</span>
      <span class="s1">}]</span>
    <span class="s1">}</span>
  <span class="s1">};</span>
  <span class="s1">const groups = include ? include.split(</span><span class="s0">','</span><span class="s1">) : await promptForCaches(COMMANDS);</span>
  <span class="s2">if </span><span class="s1">(!groups || groups.length === </span><span class="s3">0</span><span class="s1">) {</span>
    <span class="s2">return</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s1">const spinner = (</span><span class="s3">0</span><span class="s1">, _cliTools().getLoader)();</span>
  <span class="s2">for </span><span class="s1">(const group of groups) {</span>
    <span class="s1">const commands = COMMANDS[group];</span>
    <span class="s2">if </span><span class="s1">(!commands) {</span>
      <span class="s1">spinner.warn(`Unknown group: ${group}`);</span>
      <span class="s2">continue</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">for </span><span class="s1">(const {</span>
      <span class="s1">action,</span>
      <span class="s1">label</span>
    <span class="s1">} of commands.tasks) {</span>
      <span class="s1">spinner.start(label);</span>
      <span class="s1">await action().then(() =&gt; {</span>
        <span class="s1">spinner.succeed();</span>
      <span class="s1">}).</span><span class="s2">catch</span><span class="s1">(e =&gt; {</span>
        <span class="s1">spinner.fail(`${label} » ${e}`);</span>
      <span class="s1">});</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
<span class="s1">}</span>
<span class="s2">var </span><span class="s1">_default = {</span>
  <span class="s1">func: clean,</span>
  <span class="s1">name: </span><span class="s0">'clean'</span><span class="s1">,</span>
  <span class="s1">description: </span><span class="s0">'Cleans your project by removing React Native related caches and modules.'</span><span class="s1">,</span>
  <span class="s1">options: [{</span>
    <span class="s1">name: </span><span class="s0">'--include &lt;string&gt;'</span><span class="s1">,</span>
    <span class="s1">description: </span><span class="s0">'Comma-separated flag of caches to clear e.g. `npm,yarn`. If omitted, an interactive prompt will appear.'</span>
  <span class="s1">}, {</span>
    <span class="s1">name: </span><span class="s0">'--project-root &lt;string&gt;'</span><span class="s1">,</span>
    <span class="s1">description: </span><span class="s0">'Root path to your React Native project. When not specified, defaults to current working directory.'</span><span class="s1">,</span>
    <span class="s2">default</span><span class="s1">: process.cwd()</span>
  <span class="s1">}, {</span>
    <span class="s1">name: </span><span class="s0">'--verify-cache'</span><span class="s1">,</span>
    <span class="s1">description: </span><span class="s0">'Whether to verify the cache. Currently only applies to npm cache.'</span><span class="s1">,</span>
    <span class="s2">default</span><span class="s1">: </span><span class="s2">false</span>
  <span class="s1">}]</span>
<span class="s1">};</span>
<span class="s1">exports.</span><span class="s2">default </span><span class="s1">= _default;</span>

<span class="s4">//# sourceMappingURL=clean.ts.map</span></pre>
</body>
</html>