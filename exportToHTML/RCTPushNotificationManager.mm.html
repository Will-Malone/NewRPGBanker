<html>
<head>
<title>RCTPushNotificationManager.mm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #bbb529;}
.s3 { color: #6a8759;}
.s4 { color: #cc7832;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
RCTPushNotificationManager.mm</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 * Copyright (c) Meta Platforms, Inc. and affiliates. 
 * 
 * This source code is licensed under the MIT license found in the 
 * LICENSE file in the root directory of this source tree. 
 */</span>

<span class="s2">#import </span><span class="s3">&lt;React/RCTPushNotificationManager.h&gt;</span>

<span class="s2">#import </span><span class="s3">&lt;UserNotifications/UserNotifications.h&gt;</span>

<span class="s2">#import </span><span class="s3">&lt;FBReactNativeSpec/FBReactNativeSpec.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTBridge.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTConvert.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTUtils.h&gt;</span>

<span class="s2">#import </span><span class="s3">&quot;RCTPushNotificationPlugins.h&quot;</span>

<span class="s1">NSString *</span><span class="s4">const </span><span class="s1">RCTRemoteNotificationReceived = </span><span class="s4">@</span><span class="s3">&quot;RemoteNotificationReceived&quot;</span><span class="s4">;</span>

<span class="s4">static </span><span class="s1">NSString *</span><span class="s4">const </span><span class="s1">kLocalNotificationReceived = </span><span class="s4">@</span><span class="s3">&quot;LocalNotificationReceived&quot;</span><span class="s4">;</span>
<span class="s4">static </span><span class="s1">NSString *</span><span class="s4">const </span><span class="s1">kRemoteNotificationsRegistered = </span><span class="s4">@</span><span class="s3">&quot;RemoteNotificationsRegistered&quot;</span><span class="s4">;</span>
<span class="s4">static </span><span class="s1">NSString *</span><span class="s4">const </span><span class="s1">kRemoteNotificationRegistrationFailed = </span><span class="s4">@</span><span class="s3">&quot;RemoteNotificationRegistrationFailed&quot;</span><span class="s4">;</span>

<span class="s4">static </span><span class="s1">NSString *</span><span class="s4">const </span><span class="s1">kErrorUnableToRequestPermissions = </span><span class="s4">@</span><span class="s3">&quot;E_UNABLE_TO_REQUEST_PERMISSIONS&quot;</span><span class="s4">;</span>

<span class="s2">#if </span><span class="s1">!TARGET_OS_UIKITFORMAC</span>
<span class="s4">@implementation </span><span class="s1">RCTConvert (NSCalendarUnit)</span>

<span class="s1">RCT_ENUM_CONVERTER(</span>
    <span class="s1">NSCalendarUnit</span><span class="s4">,</span>
    <span class="s1">(</span><span class="s4">@</span><span class="s1">{</span>
      <span class="s4">@</span><span class="s3">&quot;year&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(NSCalendarUnitYear)</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;month&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(NSCalendarUnitMonth)</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;week&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(NSCalendarUnitWeekOfYear)</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;day&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(NSCalendarUnitDay)</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;hour&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(NSCalendarUnitHour)</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;minute&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(NSCalendarUnitMinute)</span>
    <span class="s1">})</span><span class="s4">,</span>
    <span class="s5">0</span><span class="s4">,</span>
    <span class="s1">integerValue)</span>

<span class="s4">@end</span>

<span class="s4">@interface </span><span class="s1">RCTPushNotificationManager () &lt;NativePushNotificationManagerIOSSpec&gt;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong) NSMutableDictionary *remoteNotificationCallbacks</span><span class="s4">;</span>
<span class="s4">@end</span>

<span class="s4">@implementation </span><span class="s1">RCTConvert (UILocalNotification)</span>

<span class="s1">+ (UILocalNotification *)UILocalNotification:(id)json</span>
<span class="s1">{</span>
  <span class="s1">NSDictionary&lt;NSString *</span><span class="s4">, </span><span class="s1">id&gt; *details = [self NSDictionary:json]</span><span class="s4">;</span>
  <span class="s1">BOOL isSilent = [RCTConvert BOOL:details[</span><span class="s4">@</span><span class="s3">&quot;isSilent&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s1">UILocalNotification *notification = [UILocalNotification </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">notification.alertTitle = [RCTConvert NSString:details[</span><span class="s4">@</span><span class="s3">&quot;alertTitle&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s1">notification.fireDate = [RCTConvert NSDate:details[</span><span class="s4">@</span><span class="s3">&quot;fireDate&quot;</span><span class="s1">]] ?: [NSDate date]</span><span class="s4">;</span>
  <span class="s1">notification.alertBody = [RCTConvert NSString:details[</span><span class="s4">@</span><span class="s3">&quot;alertBody&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s1">notification.alertAction = [RCTConvert NSString:details[</span><span class="s4">@</span><span class="s3">&quot;alertAction&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s1">notification.userInfo = [RCTConvert NSDictionary:details[</span><span class="s4">@</span><span class="s3">&quot;userInfo&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s1">notification.category = [RCTConvert NSString:details[</span><span class="s4">@</span><span class="s3">&quot;category&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s1">notification.repeatInterval = [RCTConvert NSCalendarUnit:details[</span><span class="s4">@</span><span class="s3">&quot;repeatInterval&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(details[</span><span class="s4">@</span><span class="s3">&quot;applicationIconBadgeNumber&quot;</span><span class="s1">]) {</span>
    <span class="s1">notification.applicationIconBadgeNumber = [RCTConvert NSInteger:details[</span><span class="s4">@</span><span class="s3">&quot;applicationIconBadgeNumber&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(!isSilent) {</span>
    <span class="s1">notification.soundName = [RCTConvert NSString:details[</span><span class="s4">@</span><span class="s3">&quot;soundName&quot;</span><span class="s1">]] ?: UILocalNotificationDefaultSoundName</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">return </span><span class="s1">notification</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_ENUM_CONVERTER(</span>
    <span class="s1">UIBackgroundFetchResult</span><span class="s4">,</span>
    <span class="s1">(</span><span class="s4">@</span><span class="s1">{</span>
      <span class="s4">@</span><span class="s3">&quot;UIBackgroundFetchResultNewData&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(UIBackgroundFetchResultNewData)</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;UIBackgroundFetchResultNoData&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(UIBackgroundFetchResultNoData)</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;UIBackgroundFetchResultFailed&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(UIBackgroundFetchResultFailed)</span><span class="s4">,</span>
    <span class="s1">})</span><span class="s4">,</span>
    <span class="s1">UIBackgroundFetchResultNoData</span><span class="s4">,</span>
    <span class="s1">integerValue)</span>

<span class="s4">@end</span>
<span class="s2">#else</span>
<span class="s4">@interface </span><span class="s1">RCTPushNotificationManager () &lt;NativePushNotificationManagerIOSSpec&gt;</span>
<span class="s4">@end</span>
<span class="s2">#endif </span><span class="s0">// TARGET_OS_UIKITFORMAC</span>

<span class="s4">@implementation </span><span class="s1">RCTPushNotificationManager</span>

<span class="s2">#if </span><span class="s1">!TARGET_OS_UIKITFORMAC</span>

<span class="s4">static </span><span class="s1">NSDictionary *RCTFormatLocalNotification(UILocalNotification *notification)</span>
<span class="s1">{</span>
  <span class="s1">NSMutableDictionary *formattedLocalNotification = [NSMutableDictionary dictionary]</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(notification.fireDate) {</span>
    <span class="s1">NSDateFormatter *formatter = [NSDateFormatter </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">[formatter setDateFormat:</span><span class="s4">@</span><span class="s3">&quot;yyyy-MM-dd'T'HH:mm:ss.SSSZZZZZ&quot;</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">NSString *fireDateString = [formatter stringFromDate:notification.fireDate]</span><span class="s4">;</span>
    <span class="s1">formattedLocalNotification[</span><span class="s4">@</span><span class="s3">&quot;fireDate&quot;</span><span class="s1">] = fireDateString</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s1">formattedLocalNotification[</span><span class="s4">@</span><span class="s3">&quot;alertAction&quot;</span><span class="s1">] = RCTNullIfNil(notification.alertAction)</span><span class="s4">;</span>
  <span class="s1">formattedLocalNotification[</span><span class="s4">@</span><span class="s3">&quot;alertBody&quot;</span><span class="s1">] = RCTNullIfNil(notification.alertBody)</span><span class="s4">;</span>
  <span class="s1">formattedLocalNotification[</span><span class="s4">@</span><span class="s3">&quot;applicationIconBadgeNumber&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">(notification.applicationIconBadgeNumber)</span><span class="s4">;</span>
  <span class="s1">formattedLocalNotification[</span><span class="s4">@</span><span class="s3">&quot;category&quot;</span><span class="s1">] = RCTNullIfNil(notification.category)</span><span class="s4">;</span>
  <span class="s1">formattedLocalNotification[</span><span class="s4">@</span><span class="s3">&quot;soundName&quot;</span><span class="s1">] = RCTNullIfNil(notification.soundName)</span><span class="s4">;</span>
  <span class="s1">formattedLocalNotification[</span><span class="s4">@</span><span class="s3">&quot;userInfo&quot;</span><span class="s1">] = RCTNullIfNil(RCTJSONClean(notification.userInfo))</span><span class="s4">;</span>
  <span class="s1">formattedLocalNotification[</span><span class="s4">@</span><span class="s3">&quot;remote&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">NO</span><span class="s4">;</span>
  <span class="s4">return </span><span class="s1">formattedLocalNotification</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">static </span><span class="s1">NSDictionary *RCTFormatUNNotification(UNNotification *notification)</span>
<span class="s1">{</span>
  <span class="s1">NSMutableDictionary *formattedNotification = [NSMutableDictionary dictionary]</span><span class="s4">;</span>
  <span class="s1">UNNotificationContent *content = notification.request.content</span><span class="s4">;</span>

  <span class="s1">formattedNotification[</span><span class="s4">@</span><span class="s3">&quot;identifier&quot;</span><span class="s1">] = notification.request.identifier</span><span class="s4">;</span>

  <span class="s4">if </span><span class="s1">(notification.date) {</span>
    <span class="s1">NSDateFormatter *formatter = [NSDateFormatter </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">[formatter setDateFormat:</span><span class="s4">@</span><span class="s3">&quot;yyyy-MM-dd'T'HH:mm:ss.SSSZZZZZ&quot;</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">NSString *dateString = [formatter stringFromDate:notification.date]</span><span class="s4">;</span>
    <span class="s1">formattedNotification[</span><span class="s4">@</span><span class="s3">&quot;date&quot;</span><span class="s1">] = dateString</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s1">formattedNotification[</span><span class="s4">@</span><span class="s3">&quot;title&quot;</span><span class="s1">] = RCTNullIfNil(content.title)</span><span class="s4">;</span>
  <span class="s1">formattedNotification[</span><span class="s4">@</span><span class="s3">&quot;body&quot;</span><span class="s1">] = RCTNullIfNil(content.body)</span><span class="s4">;</span>
  <span class="s1">formattedNotification[</span><span class="s4">@</span><span class="s3">&quot;category&quot;</span><span class="s1">] = RCTNullIfNil(content.categoryIdentifier)</span><span class="s4">;</span>
  <span class="s1">formattedNotification[</span><span class="s4">@</span><span class="s3">&quot;thread-id&quot;</span><span class="s1">] = RCTNullIfNil(content.threadIdentifier)</span><span class="s4">;</span>
  <span class="s1">formattedNotification[</span><span class="s4">@</span><span class="s3">&quot;userInfo&quot;</span><span class="s1">] = RCTNullIfNil(RCTJSONClean(content.userInfo))</span><span class="s4">;</span>

  <span class="s4">return </span><span class="s1">formattedNotification</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#endif </span><span class="s0">// TARGET_OS_UIKITFORMAC</span>

<span class="s1">RCT_EXPORT_MODULE()</span>

<span class="s1">- (dispatch_queue_t)methodQueue</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s1">dispatch_get_main_queue()</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#if </span><span class="s1">!TARGET_OS_UIKITFORMAC</span>
<span class="s1">- (</span><span class="s4">void</span><span class="s1">)startObserving</span>
<span class="s1">{</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] addObserver:self</span>
                                           <span class="s4">selector</span><span class="s1">:</span><span class="s4">@selector</span><span class="s1">(handleLocalNotificationReceived:)</span>
                                               <span class="s1">name:kLocalNotificationReceived</span>
                                             <span class="s1">object:nil]</span><span class="s4">;</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] addObserver:self</span>
                                           <span class="s4">selector</span><span class="s1">:</span><span class="s4">@selector</span><span class="s1">(handleRemoteNotificationReceived:)</span>
                                               <span class="s1">name:RCTRemoteNotificationReceived</span>
                                             <span class="s1">object:nil]</span><span class="s4">;</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] addObserver:self</span>
                                           <span class="s4">selector</span><span class="s1">:</span><span class="s4">@selector</span><span class="s1">(handleRemoteNotificationsRegistered:)</span>
                                               <span class="s1">name:kRemoteNotificationsRegistered</span>
                                             <span class="s1">object:nil]</span><span class="s4">;</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] addObserver:self</span>
                                           <span class="s4">selector</span><span class="s1">:</span><span class="s4">@selector</span><span class="s1">(handleRemoteNotificationRegistrationError:)</span>
                                               <span class="s1">name:kRemoteNotificationRegistrationFailed</span>
                                             <span class="s1">object:nil]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)stopObserving</span>
<span class="s1">{</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] removeObserver:self]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (NSArray&lt;NSString *&gt; *)supportedEvents</span>
<span class="s1">{</span>
  <span class="s4">return @</span><span class="s1">[</span>
    <span class="s4">@</span><span class="s3">&quot;localNotificationReceived&quot;</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;remoteNotificationReceived&quot;</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;remoteNotificationsRegistered&quot;</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;remoteNotificationRegistrationError&quot;</span>
  <span class="s1">]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">+ (</span><span class="s4">void</span><span class="s1">)didRegisterUserNotificationSettings:(__unused UIUserNotificationSettings *)notificationSettings</span>
<span class="s1">{</span>
<span class="s1">}</span>

<span class="s1">+ (</span><span class="s4">void</span><span class="s1">)didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken</span>
<span class="s1">{</span>
  <span class="s1">NSMutableString *hexString = [NSMutableString string]</span><span class="s4">;</span>
  <span class="s1">NSUInteger deviceTokenLength = deviceToken.length</span><span class="s4">;</span>
  <span class="s4">const unsigned char </span><span class="s1">*bytes = </span><span class="s4">reinterpret_cast</span><span class="s1">&lt;</span><span class="s4">const unsigned char </span><span class="s1">*&gt;(deviceToken.bytes)</span><span class="s4">;</span>
  <span class="s4">for </span><span class="s1">(NSUInteger i = </span><span class="s5">0</span><span class="s4">; </span><span class="s1">i &lt; deviceTokenLength</span><span class="s4">; </span><span class="s1">i++) {</span>
    <span class="s1">[hexString appendFormat:</span><span class="s4">@</span><span class="s3">&quot;%02x&quot;</span><span class="s4">, </span><span class="s1">bytes[i]]</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] postNotificationName:kRemoteNotificationsRegistered</span>
                                                      <span class="s1">object:self</span>
                                                    <span class="s1">userInfo:</span><span class="s4">@</span><span class="s1">{</span><span class="s4">@</span><span class="s3">&quot;deviceToken&quot; </span><span class="s1">: [hexString copy]}]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">+ (</span><span class="s4">void</span><span class="s1">)didFailToRegisterForRemoteNotificationsWithError:(NSError *)error</span>
<span class="s1">{</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] postNotificationName:kRemoteNotificationRegistrationFailed</span>
                                                      <span class="s1">object:self</span>
                                                    <span class="s1">userInfo:</span><span class="s4">@</span><span class="s1">{</span><span class="s4">@</span><span class="s3">&quot;error&quot; </span><span class="s1">: error}]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">+ (</span><span class="s4">void</span><span class="s1">)didReceiveRemoteNotification:(NSDictionary *)notification</span>
<span class="s1">{</span>
  <span class="s1">NSDictionary *userInfo = </span><span class="s4">@</span><span class="s1">{</span><span class="s4">@</span><span class="s3">&quot;notification&quot; </span><span class="s1">: notification}</span><span class="s4">;</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] postNotificationName:RCTRemoteNotificationReceived</span>
                                                      <span class="s1">object:self</span>
                                                    <span class="s1">userInfo:userInfo]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">+ (</span><span class="s4">void</span><span class="s1">)didReceiveRemoteNotification:(NSDictionary *)notification</span>
              <span class="s1">fetchCompletionHandler:(RCTRemoteNotificationCallback)completionHandler</span>
<span class="s1">{</span>
  <span class="s1">NSDictionary *userInfo = </span><span class="s4">@</span><span class="s1">{</span><span class="s4">@</span><span class="s3">&quot;notification&quot; </span><span class="s1">: notification</span><span class="s4">, @</span><span class="s3">&quot;completionHandler&quot; </span><span class="s1">: completionHandler}</span><span class="s4">;</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] postNotificationName:RCTRemoteNotificationReceived</span>
                                                      <span class="s1">object:self</span>
                                                    <span class="s1">userInfo:userInfo]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">+ (</span><span class="s4">void</span><span class="s1">)didReceiveLocalNotification:(UILocalNotification *)notification</span>
<span class="s1">{</span>
  <span class="s1">[[NSNotificationCenter defaultCenter] postNotificationName:kLocalNotificationReceived</span>
                                                      <span class="s1">object:self</span>
                                                    <span class="s1">userInfo:RCTFormatLocalNotification(notification)]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)handleLocalNotificationReceived:(NSNotification *)notification</span>
<span class="s1">{</span>
  <span class="s1">[self sendEventWithName:</span><span class="s4">@</span><span class="s3">&quot;localNotificationReceived&quot; </span><span class="s1">body:notification.userInfo]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)handleRemoteNotificationReceived:(NSNotification *)notification</span>
<span class="s1">{</span>
  <span class="s1">NSMutableDictionary *remoteNotification =</span>
      <span class="s1">[NSMutableDictionary dictionaryWithDictionary:notification.userInfo[</span><span class="s4">@</span><span class="s3">&quot;notification&quot;</span><span class="s1">]]</span><span class="s4">;</span>
  <span class="s1">RCTRemoteNotificationCallback completionHandler = notification.userInfo[</span><span class="s4">@</span><span class="s3">&quot;completionHandler&quot;</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">NSString *notificationId = [[NSUUID UUID] UUIDString]</span><span class="s4">;</span>
  <span class="s1">remoteNotification[</span><span class="s4">@</span><span class="s3">&quot;notificationId&quot;</span><span class="s1">] = notificationId</span><span class="s4">;</span>
  <span class="s1">remoteNotification[</span><span class="s4">@</span><span class="s3">&quot;remote&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">YES</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(completionHandler) {</span>
    <span class="s4">if </span><span class="s1">(!self.remoteNotificationCallbacks) {</span>
      <span class="s0">// Lazy initialization</span>
      <span class="s1">self.remoteNotificationCallbacks = [NSMutableDictionary dictionary]</span><span class="s4">;</span>
    <span class="s1">}</span>
    <span class="s1">self.remoteNotificationCallbacks[notificationId] = completionHandler</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s1">[self sendEventWithName:</span><span class="s4">@</span><span class="s3">&quot;remoteNotificationReceived&quot; </span><span class="s1">body:remoteNotification]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)handleRemoteNotificationsRegistered:(NSNotification *)notification</span>
<span class="s1">{</span>
  <span class="s1">[self sendEventWithName:</span><span class="s4">@</span><span class="s3">&quot;remoteNotificationsRegistered&quot; </span><span class="s1">body:notification.userInfo]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)handleRemoteNotificationRegistrationError:(NSNotification *)notification</span>
<span class="s1">{</span>
  <span class="s1">NSError *error = notification.userInfo[</span><span class="s4">@</span><span class="s3">&quot;error&quot;</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">NSDictionary *errorDetails = </span><span class="s4">@</span><span class="s1">{</span>
    <span class="s4">@</span><span class="s3">&quot;message&quot; </span><span class="s1">: error.localizedDescription</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;code&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(error.code)</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;details&quot; </span><span class="s1">: error.userInfo</span><span class="s4">,</span>
  <span class="s1">}</span><span class="s4">;</span>
  <span class="s1">[self sendEventWithName:</span><span class="s4">@</span><span class="s3">&quot;remoteNotificationRegistrationError&quot; </span><span class="s1">body:errorDetails]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(onFinishRemoteNotification : (NSString *)notificationId fetchResult : (NSString *)fetchResult)</span>
<span class="s1">{</span>
  <span class="s1">UIBackgroundFetchResult result = [RCTConvert UIBackgroundFetchResult:fetchResult]</span><span class="s4">;</span>
  <span class="s1">RCTRemoteNotificationCallback completionHandler = self.remoteNotificationCallbacks[notificationId]</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(!completionHandler) {</span>
    <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;There is no completion handler with notification id: %@&quot;</span><span class="s4">, </span><span class="s1">notificationId)</span><span class="s4">;</span>
    <span class="s4">return;</span>
  <span class="s1">}</span>
  <span class="s1">completionHandler(result)</span><span class="s4">;</span>
  <span class="s1">[self.remoteNotificationCallbacks removeObjectForKey:notificationId]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s0">/** 
 * Update the application icon badge number on the home screen 
 */</span>
<span class="s1">RCT_EXPORT_METHOD(setApplicationIconBadgeNumber : (</span><span class="s4">double</span><span class="s1">)number)</span>
<span class="s1">{</span>
  <span class="s1">RCTSharedApplication().applicationIconBadgeNumber = number</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s0">/** 
 * Get the current application icon badge number on the home screen 
 */</span>
<span class="s1">RCT_EXPORT_METHOD(getApplicationIconBadgeNumber : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">callback(</span><span class="s4">@</span><span class="s1">[ </span><span class="s4">@</span><span class="s1">(RCTSharedApplication().applicationIconBadgeNumber) ])</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(requestPermissions</span>
                  <span class="s1">: (JS::NativePushNotificationManagerIOS::SpecRequestPermissionsPermission &amp;)permissions resolve</span>
                  <span class="s1">: (RCTPromiseResolveBlock)resolve reject</span>
                  <span class="s1">: (RCTPromiseRejectBlock)reject)</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(RCTRunningInAppExtension()) {</span>
    <span class="s1">reject(</span>
        <span class="s1">kErrorUnableToRequestPermissions</span><span class="s4">,</span>
        <span class="s1">nil</span><span class="s4">,</span>
        <span class="s1">RCTErrorWithMessage(</span><span class="s4">@</span><span class="s3">&quot;Requesting push notifications is currently unavailable in an app extension&quot;</span><span class="s1">))</span><span class="s4">;</span>
    <span class="s4">return;</span>
  <span class="s1">}</span>

  <span class="s0">// Add a listener to make sure that startObserving has been called</span>
  <span class="s1">[self addListener:</span><span class="s4">@</span><span class="s3">&quot;remoteNotificationsRegistered&quot;</span><span class="s1">]</span><span class="s4">;</span>

  <span class="s1">UIUserNotificationType types = UIUserNotificationTypeNone</span><span class="s4">;</span>

  <span class="s4">if </span><span class="s1">(permissions.alert()) {</span>
    <span class="s1">types |= UIUserNotificationTypeAlert</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(permissions.badge()) {</span>
    <span class="s1">types |= UIUserNotificationTypeBadge</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(permissions.sound()) {</span>
    <span class="s1">types |= UIUserNotificationTypeSound</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s1">[UNUserNotificationCenter.currentNotificationCenter</span>
      <span class="s1">requestAuthorizationWithOptions:types</span>
                    <span class="s1">completionHandler:^(BOOL granted</span><span class="s4">, </span><span class="s1">NSError *</span><span class="s4">_Nullable </span><span class="s1">error) {</span>
                      <span class="s4">if </span><span class="s1">(error != NULL) {</span>
                        <span class="s1">reject(</span><span class="s4">@</span><span class="s3">&quot;-1&quot;</span><span class="s4">, @</span><span class="s3">&quot;Error - Push authorization request failed.&quot;</span><span class="s4">, </span><span class="s1">error)</span><span class="s4">;</span>
                      <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
                        <span class="s1">dispatch_async(dispatch_get_main_queue()</span><span class="s4">, </span><span class="s1">^{</span>
                          <span class="s1">[RCTSharedApplication() registerForRemoteNotifications]</span><span class="s4">;</span>
                          <span class="s1">[UNUserNotificationCenter.currentNotificationCenter</span>
                              <span class="s1">getNotificationSettingsWithCompletionHandler:^(</span>
                                  <span class="s1">UNNotificationSettings *</span><span class="s4">_Nonnull </span><span class="s1">settings) {</span>
                                <span class="s1">resolve(RCTPromiseResolveValueForUNNotificationSettings(settings))</span><span class="s4">;</span>
                              <span class="s1">}]</span><span class="s4">;</span>
                        <span class="s1">})</span><span class="s4">;</span>
                      <span class="s1">}</span>
                    <span class="s1">}]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(abandonPermissions)</span>
<span class="s1">{</span>
  <span class="s1">[RCTSharedApplication() unregisterForRemoteNotifications]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(checkPermissions : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(RCTRunningInAppExtension()) {</span>
    <span class="s1">callback(</span><span class="s4">@</span><span class="s1">[ RCTSettingsDictForUNNotificationSettings(NO</span><span class="s4">, </span><span class="s1">NO</span><span class="s4">, </span><span class="s1">NO</span><span class="s4">, </span><span class="s1">NO</span><span class="s4">, </span><span class="s1">NO</span><span class="s4">, </span><span class="s1">NO</span><span class="s4">, </span><span class="s1">UNAuthorizationStatusNotDetermined) ])</span><span class="s4">;</span>
    <span class="s4">return;</span>
  <span class="s1">}</span>

  <span class="s1">[UNUserNotificationCenter.currentNotificationCenter</span>
      <span class="s1">getNotificationSettingsWithCompletionHandler:^(UNNotificationSettings *</span><span class="s4">_Nonnull </span><span class="s1">settings) {</span>
        <span class="s1">callback(</span><span class="s4">@</span><span class="s1">[ RCTPromiseResolveValueForUNNotificationSettings(settings) ])</span><span class="s4">;</span>
      <span class="s1">}]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">static inline </span><span class="s1">NSDictionary *RCTPromiseResolveValueForUNNotificationSettings(UNNotificationSettings *</span><span class="s4">_Nonnull </span><span class="s1">settings)</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s1">RCTSettingsDictForUNNotificationSettings(</span>
      <span class="s1">settings.alertSetting == UNNotificationSettingEnabled</span><span class="s4">,</span>
      <span class="s1">settings.badgeSetting == UNNotificationSettingEnabled</span><span class="s4">,</span>
      <span class="s1">settings.soundSetting == UNNotificationSettingEnabled</span><span class="s4">,</span>
      <span class="s1">settings.criticalAlertSetting == UNNotificationSettingEnabled</span><span class="s4">,</span>
      <span class="s1">settings.lockScreenSetting == UNNotificationSettingEnabled</span><span class="s4">,</span>
      <span class="s1">settings.notificationCenterSetting == UNNotificationSettingEnabled</span><span class="s4">,</span>
      <span class="s1">settings.authorizationStatus)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">static inline </span><span class="s1">NSDictionary *RCTSettingsDictForUNNotificationSettings(</span>
    <span class="s1">BOOL alert</span><span class="s4">,</span>
    <span class="s1">BOOL badge</span><span class="s4">,</span>
    <span class="s1">BOOL sound</span><span class="s4">,</span>
    <span class="s1">BOOL critical</span><span class="s4">,</span>
    <span class="s1">BOOL lockScreen</span><span class="s4">,</span>
    <span class="s1">BOOL notificationCenter</span><span class="s4">,</span>
    <span class="s1">UNAuthorizationStatus authorizationStatus)</span>
<span class="s1">{</span>
  <span class="s4">return @</span><span class="s1">{</span>
    <span class="s4">@</span><span class="s3">&quot;alert&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(alert)</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;badge&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(badge)</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;sound&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(sound)</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;critical&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(critical)</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;lockScreen&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(lockScreen)</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;notificationCenter&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(notificationCenter)</span><span class="s4">,</span>
    <span class="s4">@</span><span class="s3">&quot;authorizationStatus&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s1">(authorizationStatus)</span>
  <span class="s1">}</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(presentLocalNotification : (JS::NativePushNotificationManagerIOS::Notification &amp;)notification)</span>
<span class="s1">{</span>
  <span class="s1">NSMutableDictionary *notificationDict = [NSMutableDictionary </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;alertTitle&quot;</span><span class="s1">] = notification.alertTitle()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;alertBody&quot;</span><span class="s1">] = notification.alertBody()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;alertAction&quot;</span><span class="s1">] = notification.alertAction()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;userInfo&quot;</span><span class="s1">] = notification.userInfo()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;category&quot;</span><span class="s1">] = notification.category()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;repeatInterval&quot;</span><span class="s1">] = notification.repeatInterval()</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(notification.fireDate()) {</span>
    <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;fireDate&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">(*notification.fireDate())</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(notification.applicationIconBadgeNumber()) {</span>
    <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;applicationIconBadgeNumber&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">(*notification.applicationIconBadgeNumber())</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(notification.isSilent()) {</span>
    <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;isSilent&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">(*notification.isSilent())</span><span class="s4">;</span>
    <span class="s4">if </span><span class="s1">([notificationDict[</span><span class="s4">@</span><span class="s3">&quot;isSilent&quot;</span><span class="s1">] isEqualToNumber:</span><span class="s4">@</span><span class="s1">(NO)]) {</span>
      <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;soundName&quot;</span><span class="s1">] = notification.soundName()</span><span class="s4">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s1">[RCTSharedApplication() presentLocalNotificationNow:[RCTConvert UILocalNotification:notificationDict]]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(scheduleLocalNotification : (JS::NativePushNotificationManagerIOS::Notification &amp;)notification)</span>
<span class="s1">{</span>
  <span class="s1">NSMutableDictionary *notificationDict = [NSMutableDictionary </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;alertTitle&quot;</span><span class="s1">] = notification.alertTitle()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;alertBody&quot;</span><span class="s1">] = notification.alertBody()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;alertAction&quot;</span><span class="s1">] = notification.alertAction()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;userInfo&quot;</span><span class="s1">] = notification.userInfo()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;category&quot;</span><span class="s1">] = notification.category()</span><span class="s4">;</span>
  <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;repeatInterval&quot;</span><span class="s1">] = notification.repeatInterval()</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(notification.fireDate()) {</span>
    <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;fireDate&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">(*notification.fireDate())</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(notification.applicationIconBadgeNumber()) {</span>
    <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;applicationIconBadgeNumber&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">(*notification.applicationIconBadgeNumber())</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">if </span><span class="s1">(notification.isSilent()) {</span>
    <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;isSilent&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">(*notification.isSilent())</span><span class="s4">;</span>
    <span class="s4">if </span><span class="s1">([notificationDict[</span><span class="s4">@</span><span class="s3">&quot;isSilent&quot;</span><span class="s1">] isEqualToNumber:</span><span class="s4">@</span><span class="s1">(NO)]) {</span>
      <span class="s1">notificationDict[</span><span class="s4">@</span><span class="s3">&quot;soundName&quot;</span><span class="s1">] = notification.soundName()</span><span class="s4">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s1">[RCTSharedApplication() scheduleLocalNotification:[RCTConvert UILocalNotification:notificationDict]]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(cancelAllLocalNotifications)</span>
<span class="s1">{</span>
  <span class="s1">[RCTSharedApplication() cancelAllLocalNotifications]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(cancelLocalNotifications : (NSDictionary&lt;NSString *</span><span class="s4">, </span><span class="s1">id&gt; *)userInfo)</span>
<span class="s1">{</span>
  <span class="s4">for </span><span class="s1">(UILocalNotification *notification in RCTSharedApplication().scheduledLocalNotifications) {</span>
    <span class="s1">__block BOOL matchesAll = YES</span><span class="s4">;</span>
    <span class="s1">NSDictionary&lt;NSString *</span><span class="s4">, </span><span class="s1">id&gt; *notificationInfo = notification.userInfo</span><span class="s4">;</span>
    <span class="s0">// Note: we do this with a loop instead of just `isEqualToDictionary:`</span>
    <span class="s0">// because we only require that all specified userInfo values match the</span>
    <span class="s0">// notificationInfo values - notificationInfo may contain additional values</span>
    <span class="s0">// which we don't care about.</span>
    <span class="s1">[userInfo enumerateKeysAndObjectsUsingBlock:^(NSString *key</span><span class="s4">, </span><span class="s1">id obj</span><span class="s4">, </span><span class="s1">BOOL *stop) {</span>
      <span class="s4">if </span><span class="s1">(![notificationInfo[key] isEqual:obj]) {</span>
        <span class="s1">matchesAll = NO</span><span class="s4">;</span>
        <span class="s1">*stop = YES</span><span class="s4">;</span>
      <span class="s1">}</span>
    <span class="s1">}]</span><span class="s4">;</span>
    <span class="s4">if </span><span class="s1">(matchesAll) {</span>
      <span class="s1">[RCTSharedApplication() cancelLocalNotification:notification]</span><span class="s4">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getInitialNotification</span>
                  <span class="s1">: (RCTPromiseResolveBlock)resolve reject</span>
                  <span class="s1">: (__unused RCTPromiseRejectBlock)reject)</span>
<span class="s1">{</span>
  <span class="s1">NSMutableDictionary&lt;NSString *</span><span class="s4">, </span><span class="s1">id&gt; *initialNotification =</span>
      <span class="s1">[self.bridge.launchOptions[UIApplicationLaunchOptionsRemoteNotificationKey] mutableCopy]</span><span class="s4">;</span>

  <span class="s1">UILocalNotification *initialLocalNotification =</span>
      <span class="s1">self.bridge.launchOptions[UIApplicationLaunchOptionsLocalNotificationKey]</span><span class="s4">;</span>

  <span class="s4">if </span><span class="s1">(initialNotification) {</span>
    <span class="s1">initialNotification[</span><span class="s4">@</span><span class="s3">&quot;remote&quot;</span><span class="s1">] = </span><span class="s4">@</span><span class="s1">YES</span><span class="s4">;</span>
    <span class="s1">resolve(initialNotification)</span><span class="s4">;</span>
  <span class="s1">} </span><span class="s4">else if </span><span class="s1">(initialLocalNotification) {</span>
    <span class="s1">resolve(RCTFormatLocalNotification(initialLocalNotification))</span><span class="s4">;</span>
  <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
    <span class="s1">resolve((id)kCFNull)</span><span class="s4">;</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getScheduledLocalNotifications : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">NSArray&lt;UILocalNotification *&gt; *scheduledLocalNotifications = RCTSharedApplication().scheduledLocalNotifications</span><span class="s4">;</span>
  <span class="s1">NSMutableArray&lt;NSDictionary *&gt; *formattedScheduledLocalNotifications = [NSMutableArray </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s4">for </span><span class="s1">(UILocalNotification *notification in scheduledLocalNotifications) {</span>
    <span class="s1">[formattedScheduledLocalNotifications addObject:RCTFormatLocalNotification(notification)]</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s1">callback(</span><span class="s4">@</span><span class="s1">[ formattedScheduledLocalNotifications ])</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(removeAllDeliveredNotifications)</span>
<span class="s1">{</span>
  <span class="s1">UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter]</span><span class="s4">;</span>
  <span class="s1">[center removeAllDeliveredNotifications]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(removeDeliveredNotifications : (NSArray&lt;NSString *&gt; *)identifiers)</span>
<span class="s1">{</span>
  <span class="s1">UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter]</span><span class="s4">;</span>
  <span class="s1">[center removeDeliveredNotificationsWithIdentifiers:identifiers]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getDeliveredNotifications : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter]</span><span class="s4">;</span>
  <span class="s1">[center getDeliveredNotificationsWithCompletionHandler:^(NSArray&lt;UNNotification *&gt; *</span><span class="s4">_Nonnull </span><span class="s1">notifications) {</span>
    <span class="s1">NSMutableArray&lt;NSDictionary *&gt; *formattedNotifications = [NSMutableArray </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>

    <span class="s4">for </span><span class="s1">(UNNotification *notification in notifications) {</span>
      <span class="s1">[formattedNotifications addObject:RCTFormatUNNotification(notification)]</span><span class="s4">;</span>
    <span class="s1">}</span>
    <span class="s1">callback(</span><span class="s4">@</span><span class="s1">[ formattedNotifications ])</span><span class="s4">;</span>
  <span class="s1">}]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getAuthorizationStatus : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter]</span><span class="s4">;</span>
  <span class="s1">[center getNotificationSettingsWithCompletionHandler:^(UNNotificationSettings *</span><span class="s4">_Nonnull </span><span class="s1">settings) {</span>
    <span class="s1">callback(</span><span class="s4">@</span><span class="s1">[ </span><span class="s4">@</span><span class="s1">(settings.authorizationStatus) ])</span><span class="s4">;</span>
  <span class="s1">}]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#else </span><span class="s0">// TARGET_OS_UIKITFORMAC</span>

<span class="s1">RCT_EXPORT_METHOD(onFinishRemoteNotification : (NSString *)notificationId fetchResult : (NSString *)fetchResult)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(setApplicationIconBadgeNumber : (</span><span class="s4">double</span><span class="s1">)number)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getApplicationIconBadgeNumber : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(requestPermissions</span>
                  <span class="s1">: (JS::NativePushNotificationManagerIOS::SpecRequestPermissionsPermission &amp;)permissions resolve</span>
                  <span class="s1">: (RCTPromiseResolveBlock)resolve reject</span>
                  <span class="s1">: (RCTPromiseRejectBlock)reject)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(abandonPermissions)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(checkPermissions : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(presentLocalNotification : (JS::NativePushNotificationManagerIOS::Notification &amp;)notification)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(scheduleLocalNotification : (JS::NativePushNotificationManagerIOS::Notification &amp;)notification)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(cancelAllLocalNotifications)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(cancelLocalNotifications : (NSDictionary&lt;NSString *</span><span class="s4">, </span><span class="s1">id&gt; *)userInfo)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getInitialNotification</span>
                  <span class="s1">: (RCTPromiseResolveBlock)resolve reject</span>
                  <span class="s1">: (__unused RCTPromiseRejectBlock)reject)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getScheduledLocalNotifications : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(removeAllDeliveredNotifications)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(removeDeliveredNotifications : (NSArray&lt;NSString *&gt; *)identifiers)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getDeliveredNotifications : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">RCT_EXPORT_METHOD(getAuthorizationStatus : (RCTResponseSenderBlock)callback)</span>
<span class="s1">{</span>
  <span class="s1">RCTLogError(</span><span class="s4">@</span><span class="s3">&quot;Not implemented: %@&quot;</span><span class="s4">, </span><span class="s1">NSStringFromSelector(_cmd))</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (NSArray&lt;NSString *&gt; *)supportedEvents</span>
<span class="s1">{</span>
  <span class="s4">return @</span><span class="s1">[]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#endif </span><span class="s0">// TARGET_OS_UIKITFORMAC</span>

<span class="s1">- (std::shared_ptr&lt;facebook::react::TurboModule&gt;)getTurboModule:</span>
    <span class="s1">(</span><span class="s4">const </span><span class="s1">facebook::react::ObjCTurboModule::InitParams &amp;)params</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s1">std::make_shared&lt;facebook::react::NativePushNotificationManagerIOSSpecJSI&gt;(params)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">@end</span>

<span class="s1">Class RCTPushNotificationManagerCls(</span><span class="s4">void</span><span class="s1">)</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s1">RCTPushNotificationManager.</span><span class="s4">class;</span>
<span class="s1">}</span>
</pre>
</body>
</html>