<html>
<head>
<title>Card.tsx</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #a9b7c6;}
.s3 { color: #6a8759;}
.s4 { color: #9876aa; font-style: italic;}
.s5 { color: #6897bb; font-style: italic;}
.s6 { color: #808080;}
.s7 { color: #ffc66d;}
.s8 { color: #a9b7c6;}
.s9 { color: #e8bf6a;}
.s10 { color: #bbb529;}
.s11 { color: #d0d0ff;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Card.tsx</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s2">Color </span><span class="s0">from </span><span class="s3">'color'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s4">* </span><span class="s0">as </span><span class="s2">React </span><span class="s0">from </span><span class="s3">'react'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{</span>
  <span class="s2">Animated</span><span class="s1">,</span>
  <span class="s2">InteractionManager</span><span class="s1">,</span>
  <span class="s2">Platform</span><span class="s1">,</span>
  <span class="s2">StyleProp</span><span class="s1">,</span>
  <span class="s2">StyleSheet</span><span class="s1">,</span>
  <span class="s2">View</span><span class="s1">,</span>
  <span class="s2">ViewProps</span><span class="s1">,</span>
  <span class="s2">ViewStyle</span><span class="s1">,</span>
<span class="s1">} </span><span class="s0">from </span><span class="s3">'react-native'</span><span class="s1">;</span>
<span class="s0">import type </span><span class="s1">{ </span><span class="s2">EdgeInsets </span><span class="s1">} </span><span class="s0">from </span><span class="s3">'react-native-safe-area-context'</span><span class="s1">;</span>

<span class="s0">import </span><span class="s1">{ </span><span class="s2">forModalPresentationIOS </span><span class="s1">} </span><span class="s0">from </span><span class="s3">'../../TransitionConfigs/CardStyleInterpolators'</span><span class="s1">;</span>
<span class="s0">import type </span><span class="s1">{</span>
  <span class="s2">GestureDirection</span><span class="s1">,</span>
  <span class="s2">Layout</span><span class="s1">,</span>
  <span class="s2">StackCardInterpolationProps</span><span class="s1">,</span>
  <span class="s2">StackCardStyleInterpolator</span><span class="s1">,</span>
  <span class="s2">TransitionSpec</span><span class="s1">,</span>
<span class="s1">} </span><span class="s0">from </span><span class="s3">'../../types'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s2">CardAnimationContext </span><span class="s0">from </span><span class="s3">'../../utils/CardAnimationContext'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s2">getDistanceForDirection </span><span class="s0">from </span><span class="s3">'../../utils/getDistanceForDirection'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s2">getInvertedMultiplier </span><span class="s0">from </span><span class="s3">'../../utils/getInvertedMultiplier'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s2">memoize </span><span class="s0">from </span><span class="s3">'../../utils/memoize'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{</span>
  <span class="s2">GestureState</span><span class="s1">,</span>
  <span class="s2">PanGestureHandler</span><span class="s1">,</span>
  <span class="s2">PanGestureHandlerGestureEvent</span><span class="s1">,</span>
<span class="s1">} </span><span class="s0">from </span><span class="s3">'../GestureHandler'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s2">ModalStatusBarManager </span><span class="s0">from </span><span class="s3">'../ModalStatusBarManager'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s2">CardSheet</span><span class="s1">, { </span><span class="s2">CardSheetRef </span><span class="s1">} </span><span class="s0">from </span><span class="s3">'./CardSheet'</span><span class="s1">;</span>

<span class="s0">type </span><span class="s2">Props </span><span class="s0">= </span><span class="s2">ViewProps </span><span class="s0">&amp; </span><span class="s1">{</span>
  <span class="s1">interpolationIndex</span><span class="s0">: </span><span class="s2">number</span><span class="s1">;</span>
  <span class="s1">closing</span><span class="s0">: </span><span class="s2">boolean</span><span class="s1">;</span>
  <span class="s1">next</span><span class="s0">?: </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">AnimatedInterpolation</span><span class="s1">&lt;</span><span class="s2">number</span><span class="s1">&gt;;</span>
  <span class="s1">current</span><span class="s0">: </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">AnimatedInterpolation</span><span class="s1">&lt;</span><span class="s2">number</span><span class="s1">&gt;;</span>
  <span class="s1">gesture</span><span class="s0">: </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">Value</span><span class="s1">;</span>
  <span class="s1">layout</span><span class="s0">: </span><span class="s2">Layout</span><span class="s1">;</span>
  <span class="s1">insets</span><span class="s0">: </span><span class="s2">EdgeInsets</span><span class="s1">;</span>
  <span class="s1">headerDarkContent</span><span class="s0">: </span><span class="s2">boolean </span><span class="s0">| </span><span class="s2">undefined</span><span class="s1">;</span>
  <span class="s1">pageOverflowEnabled</span><span class="s0">: </span><span class="s2">boolean</span><span class="s1">;</span>
  <span class="s1">gestureDirection</span><span class="s0">: </span><span class="s2">GestureDirection</span><span class="s1">;</span>
  <span class="s1">onOpen</span><span class="s0">: </span><span class="s1">() </span><span class="s0">=&gt; </span><span class="s2">void</span><span class="s1">;</span>
  <span class="s1">onClose</span><span class="s0">: </span><span class="s1">() </span><span class="s0">=&gt; </span><span class="s2">void</span><span class="s1">;</span>
  <span class="s1">onTransition</span><span class="s0">: </span><span class="s1">(</span><span class="s2">props</span><span class="s0">: </span><span class="s1">{ closing</span><span class="s0">: </span><span class="s2">boolean</span><span class="s1">; gesture</span><span class="s0">: </span><span class="s2">boolean </span><span class="s1">}) </span><span class="s0">=&gt; </span><span class="s2">void</span><span class="s1">;</span>
  <span class="s1">onGestureBegin</span><span class="s0">: </span><span class="s1">() </span><span class="s0">=&gt; </span><span class="s2">void</span><span class="s1">;</span>
  <span class="s1">onGestureCanceled</span><span class="s0">: </span><span class="s1">() </span><span class="s0">=&gt; </span><span class="s2">void</span><span class="s1">;</span>
  <span class="s1">onGestureEnd</span><span class="s0">: </span><span class="s1">() </span><span class="s0">=&gt; </span><span class="s2">void</span><span class="s1">;</span>
  <span class="s1">children</span><span class="s0">: </span><span class="s2">React</span><span class="s1">.</span><span class="s2">ReactNode</span><span class="s1">;</span>
  <span class="s1">overlay</span><span class="s0">: </span><span class="s1">(</span><span class="s2">props</span><span class="s0">: </span><span class="s1">{</span>
    <span class="s1">style</span><span class="s0">: </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">WithAnimatedValue</span><span class="s1">&lt;</span><span class="s2">StyleProp</span><span class="s1">&lt;</span><span class="s2">ViewStyle</span><span class="s1">&gt;&gt;;</span>
  <span class="s1">}) </span><span class="s0">=&gt; </span><span class="s2">React</span><span class="s1">.</span><span class="s2">ReactNode</span><span class="s1">;</span>
  <span class="s1">overlayEnabled</span><span class="s0">: </span><span class="s2">boolean</span><span class="s1">;</span>
  <span class="s1">shadowEnabled</span><span class="s0">: </span><span class="s2">boolean</span><span class="s1">;</span>
  <span class="s1">gestureEnabled</span><span class="s0">: </span><span class="s2">boolean</span><span class="s1">;</span>
  <span class="s1">gestureResponseDistance</span><span class="s0">?: </span><span class="s2">number</span><span class="s1">;</span>
  <span class="s1">gestureVelocityImpact</span><span class="s0">: </span><span class="s2">number</span><span class="s1">;</span>
  <span class="s1">transitionSpec</span><span class="s0">: </span><span class="s1">{</span>
    <span class="s1">open</span><span class="s0">: </span><span class="s2">TransitionSpec</span><span class="s1">;</span>
    <span class="s1">close</span><span class="s0">: </span><span class="s2">TransitionSpec</span><span class="s1">;</span>
  <span class="s1">};</span>
  <span class="s1">styleInterpolator</span><span class="s0">: </span><span class="s2">StackCardStyleInterpolator</span><span class="s1">;</span>
  <span class="s1">containerStyle</span><span class="s0">?: </span><span class="s2">StyleProp</span><span class="s1">&lt;</span><span class="s2">ViewStyle</span><span class="s1">&gt;;</span>
  <span class="s1">contentStyle</span><span class="s0">?: </span><span class="s2">StyleProp</span><span class="s1">&lt;</span><span class="s2">ViewStyle</span><span class="s1">&gt;;</span>
<span class="s1">};</span>

<span class="s0">const </span><span class="s1">GESTURE_VELOCITY_IMPACT </span><span class="s0">= </span><span class="s5">0.3</span><span class="s1">;</span>

<span class="s0">const </span><span class="s1">TRUE </span><span class="s0">= </span><span class="s5">1</span><span class="s1">;</span>
<span class="s0">const </span><span class="s1">FALSE </span><span class="s0">= </span><span class="s5">0</span><span class="s1">;</span>

<span class="s6">/**</span>
 <span class="s6">* The distance of touch start from the edge of the screen where the gesture will be recognized 
 */</span>
<span class="s0">const </span><span class="s1">GESTURE_RESPONSE_DISTANCE_HORIZONTAL </span><span class="s0">= </span><span class="s5">50</span><span class="s1">;</span>
<span class="s0">const </span><span class="s1">GESTURE_RESPONSE_DISTANCE_VERTICAL </span><span class="s0">= </span><span class="s5">135</span><span class="s1">;</span>

<span class="s0">const </span><span class="s1">useNativeDriver </span><span class="s0">= </span><span class="s2">Platform</span><span class="s1">.</span><span class="s2">OS </span><span class="s0">!== </span><span class="s3">'web'</span><span class="s1">;</span>

<span class="s0">const </span><span class="s1">hasOpacityStyle </span><span class="s0">= </span><span class="s1">(</span><span class="s2">style</span><span class="s0">: </span><span class="s2">any</span><span class="s1">) </span><span class="s0">=&gt; </span><span class="s1">{</span>
  <span class="s0">if </span><span class="s1">(</span><span class="s2">style</span><span class="s1">) {</span>
    <span class="s0">const </span><span class="s1">flattenedStyle </span><span class="s0">= </span><span class="s2">StyleSheet</span><span class="s1">.</span><span class="s7">flatten</span><span class="s1">(</span><span class="s2">style</span><span class="s1">);</span>
    <span class="s0">return </span><span class="s2">flattenedStyle</span><span class="s1">.</span><span class="s2">opacity </span><span class="s0">!= </span><span class="s4">null</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s0">return </span><span class="s4">false</span><span class="s1">;</span>
<span class="s1">};</span>

<span class="s0">export default class </span><span class="s2">Card </span><span class="s0">extends </span><span class="s2">React</span><span class="s1">.</span><span class="s2">Component</span><span class="s1">&lt;</span><span class="s2">Props</span><span class="s1">&gt; {</span>
  <span class="s0">static </span><span class="s1">defaultProps </span><span class="s0">= </span><span class="s1">{</span>
    <span class="s1">shadowEnabled: </span><span class="s4">false</span><span class="s1">,</span>
    <span class="s1">gestureEnabled: </span><span class="s4">true</span><span class="s1">,</span>
    <span class="s1">gestureVelocityImpact: </span><span class="s2">GESTURE_VELOCITY_IMPACT</span><span class="s1">,</span>
    <span class="s7">overlay</span><span class="s1">: ({</span>
      <span class="s2">style</span><span class="s1">,</span>
    <span class="s1">}</span><span class="s0">: </span><span class="s1">{</span>
      <span class="s1">style</span><span class="s0">: </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">WithAnimatedValue</span><span class="s1">&lt;</span><span class="s2">StyleProp</span><span class="s1">&lt;</span><span class="s2">ViewStyle</span><span class="s1">&gt;&gt;;</span>
    <span class="s1">}) =&gt; 
      </span><span class="s2">style </span><span class="s0">? </span><span class="s1">(</span>
        <span class="s8">&lt;</span><span class="s9">Animated.View </span><span class="s11">pointerEvents</span><span class="s0">=</span><span class="s3">&quot;none&quot; </span><span class="s11">style</span><span class="s0">=</span><span class="s10">{[</span><span class="s2">styles</span><span class="s10">.</span><span class="s2">overlay</span><span class="s10">, </span><span class="s2">style</span><span class="s10">]} </span><span class="s8">/&gt;</span>
      <span class="s1">) </span><span class="s0">: </span><span class="s4">null</span><span class="s1">,</span>
  <span class="s1">}; 
</span>
  <span class="s7">componentDidMount</span><span class="s1">() {</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s2">animate</span><span class="s1">({ </span><span class="s2">closing</span><span class="s1">: </span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">closing </span><span class="s1">}); 
    </span><span class="s2">this</span><span class="s1">.</span><span class="s2">isCurrentlyMounted </span><span class="s0">= </span><span class="s4">true</span><span class="s1">; 
  }</span>

  <span class="s7">componentDidUpdate</span><span class="s1">(</span><span class="s2">prevProps</span><span class="s1">: </span><span class="s2">Props</span><span class="s1">) {</span>
    <span class="s2">const </span><span class="s1">{ </span><span class="s2">layout</span><span class="s1">, </span><span class="s2">gestureDirection</span><span class="s1">, </span><span class="s2">closing </span><span class="s1">} </span><span class="s0">= </span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">; 
    </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">width</span><span class="s1">, </span><span class="s2">height </span><span class="s1">} </span><span class="s0">= </span><span class="s2">layout</span><span class="s1">; 
</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">width </span><span class="s1">!== </span><span class="s2">prevProps</span><span class="s1">.</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">width</span><span class="s1">) {</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">width</span><span class="s1">.</span><span class="s2">setValue</span><span class="s1">(</span><span class="s2">width</span><span class="s1">); 
    }</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s2">height </span><span class="s1">!== </span><span class="s2">prevProps</span><span class="s1">.</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">height</span><span class="s1">) {</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">height</span><span class="s1">.</span><span class="s2">setValue</span><span class="s1">(</span><span class="s2">height</span><span class="s1">); 
    }</span>

    <span class="s2">if </span><span class="s1">(</span><span class="s2">gestureDirection </span><span class="s1">!== </span><span class="s2">prevProps</span><span class="s1">.</span><span class="s2">gestureDirection</span><span class="s1">) {</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s2">inverted</span><span class="s1">.</span><span class="s2">setValue</span><span class="s1">(</span><span class="s2">getInvertedMultiplier</span><span class="s1">(</span><span class="s2">gestureDirection</span><span class="s1">)); 
    }</span>

    <span class="s2">const toValue </span><span class="s0">= </span><span class="s2">this</span><span class="s1">.</span><span class="s7">getAnimateToValue</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">); 
</span>
    <span class="s2">if </span><span class="s1">( 
      </span><span class="s2">this</span><span class="s1">.</span><span class="s2">getAnimateToValue</span><span class="s1">(</span><span class="s2">prevProps</span><span class="s1">) !== </span><span class="s2">toValue </span><span class="s1">|| 
      </span><span class="s2">this</span><span class="s1">.</span><span class="s2">lastToValue </span><span class="s1">!== </span><span class="s2">toValue</span>
    <span class="s1">) {</span>
      <span class="s6">// We need to trigger the animation when route was closed</span>
      <span class="s6">// Thr route might have been closed by a `POP` action or by a gesture</span>
      <span class="s6">// When route was closed due to a gesture, the animation would've happened already</span>
      <span class="s6">// It's still important to trigger the animation so that `onClose` is called</span>
      <span class="s6">// If `onClose` is not called, cleanup step won't be performed for gestures</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s2">animate</span><span class="s1">({ </span><span class="s2">closing </span><span class="s1">}); 
    }</span>
  <span class="s1">}</span>

  <span class="s7">componentWillUnmount</span><span class="s1">() {</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">gesture</span><span class="s1">.</span><span class="s2">stopAnimation</span><span class="s1">(); 
    </span><span class="s2">this</span><span class="s1">.</span><span class="s2">isCurrentlyMounted </span><span class="s0">= </span><span class="s4">false</span><span class="s1">; 
    </span><span class="s2">this</span><span class="s1">.</span><span class="s2">handleEndInteraction</span><span class="s1">(); 
  }</span>

  <span class="s2">private isCurrentlyMounted </span><span class="s0">= </span><span class="s4">false</span><span class="s1">; 
</span>
  <span class="s2">private isClosing </span><span class="s0">= new </span><span class="s2">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s2">FALSE</span><span class="s1">); 
</span>
  <span class="s2">private inverted </span><span class="s0">= new </span><span class="s2">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span>
    <span class="s7">getInvertedMultiplier</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">gestureDirection</span><span class="s1">)</span>
  <span class="s1">); 
</span>
  <span class="s2">private layout </span><span class="s0">= </span><span class="s1">{</span>
    <span class="s1">width: </span><span class="s0">new </span><span class="s2">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">width</span><span class="s1">),</span>
    <span class="s1">height: </span><span class="s0">new </span><span class="s2">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">height</span><span class="s1">),</span>
  <span class="s1">}; 
</span>
  <span class="s2">private isSwiping </span><span class="s0">= new </span><span class="s2">Animated</span><span class="s1">.</span><span class="s7">Value</span><span class="s1">(</span><span class="s2">FALSE</span><span class="s1">); 
</span>
  <span class="s0">private </span><span class="s2">interactionHandle</span><span class="s0">: </span><span class="s2">number </span><span class="s0">| </span><span class="s2">undefined</span><span class="s1">; 
</span>
  <span class="s0">private </span><span class="s2">pendingGestureCallback</span><span class="s0">: </span><span class="s2">number </span><span class="s0">| </span><span class="s2">undefined</span><span class="s1">; 
</span>
  <span class="s0">private </span><span class="s2">lastToValue</span><span class="s0">: </span><span class="s2">number </span><span class="s0">| </span><span class="s2">undefined</span><span class="s1">; 
</span>
  <span class="s0">private </span><span class="s7">animate </span><span class="s0">= </span><span class="s1">({</span>
    <span class="s2">closing</span><span class="s1">,</span>
    <span class="s2">velocity</span><span class="s1">,</span>
  <span class="s1">}</span><span class="s0">: </span><span class="s1">{</span>
    <span class="s1">closing</span><span class="s0">: </span><span class="s2">boolean</span><span class="s1">;</span>
    <span class="s1">velocity</span><span class="s0">?: </span><span class="s2">number</span><span class="s1">;</span>
  <span class="s1">}) =&gt; { 
    </span><span class="s2">const </span><span class="s1">{ </span><span class="s2">gesture</span><span class="s1">, </span><span class="s2">transitionSpec</span><span class="s1">, </span><span class="s2">onOpen</span><span class="s1">, </span><span class="s2">onClose</span><span class="s1">, </span><span class="s2">onTransition </span><span class="s1">} </span><span class="s0">=</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">; 
</span>
    <span class="s2">const toValue </span><span class="s0">= </span><span class="s2">this</span><span class="s1">.</span><span class="s7">getAnimateToValue</span><span class="s1">({</span>
      <span class="s0">...</span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span>
      <span class="s2">closing</span><span class="s1">,</span>
    <span class="s1">}); 
</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s2">lastToValue </span><span class="s0">= </span><span class="s2">toValue</span><span class="s1">; 
</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s2">isClosing</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span><span class="s2">closing </span><span class="s0">? </span><span class="s2">TRUE </span><span class="s0">: </span><span class="s2">FALSE</span><span class="s1">); 
</span>
    <span class="s2">const spec </span><span class="s0">= </span><span class="s2">closing </span><span class="s0">? </span><span class="s2">transitionSpec</span><span class="s1">.</span><span class="s2">close </span><span class="s0">: </span><span class="s2">transitionSpec</span><span class="s1">.</span><span class="s2">open</span><span class="s1">; 
</span>
    <span class="s2">const animation </span><span class="s0">=</span>
      <span class="s2">spec</span><span class="s1">.</span><span class="s2">animation </span><span class="s0">=== </span><span class="s3">'spring' </span><span class="s0">? </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">spring </span><span class="s0">: </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">timing</span><span class="s1">; 
</span>
    <span class="s2">this</span><span class="s1">.</span><span class="s7">setPointerEventsEnabled</span><span class="s1">(</span><span class="s0">!</span><span class="s2">closing</span><span class="s1">); 
    </span><span class="s2">this</span><span class="s1">.</span><span class="s7">handleStartInteraction</span><span class="s1">(); 
</span>
    <span class="s7">clearTimeout</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">pendingGestureCallback</span><span class="s1">); 
</span>
    <span class="s7">onTransition</span><span class="s1">?.({ </span><span class="s2">closing</span><span class="s1">, gesture: </span><span class="s2">velocity </span><span class="s0">!== </span><span class="s4">undefined </span><span class="s1">}); 
    </span><span class="s7">animation</span><span class="s1">(</span><span class="s2">gesture</span><span class="s1">, {</span>
      <span class="s0">...</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">config</span><span class="s1">,</span>
      <span class="s2">velocity</span><span class="s1">,</span>
      <span class="s2">toValue</span><span class="s1">,</span>
      <span class="s2">useNativeDriver</span><span class="s1">,</span>
      <span class="s1">isInteraction: </span><span class="s4">false</span><span class="s1">,</span>
    <span class="s1">}).</span><span class="s7">start</span><span class="s1">(({ </span><span class="s2">finished </span><span class="s1">}) </span><span class="s0">=&gt; </span><span class="s1">{</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s7">handleEndInteraction</span><span class="s1">();</span>

      <span class="s7">clearTimeout</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">pendingGestureCallback</span><span class="s1">);</span>

      <span class="s0">if </span><span class="s1">(</span><span class="s2">finished</span><span class="s1">) {</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s2">closing</span><span class="s1">) {</span>
          <span class="s7">onClose</span><span class="s1">();</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
          <span class="s7">onOpen</span><span class="s1">();</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">isCurrentlyMounted</span><span class="s1">) {</span>
          <span class="s6">// Make sure to re-open screen if it wasn't removed</span>
          <span class="s2">this</span><span class="s1">.</span><span class="s7">forceUpdate</span><span class="s1">();</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">}); 
  }; 
</span>
  <span class="s0">private </span><span class="s7">getAnimateToValue </span><span class="s0">= </span><span class="s1">({</span>
    <span class="s2">closing</span><span class="s1">,</span>
    <span class="s2">layout</span><span class="s1">,</span>
    <span class="s2">gestureDirection</span><span class="s1">,</span>
  <span class="s1">}</span><span class="s0">: </span><span class="s1">{</span>
    <span class="s1">closing</span><span class="s0">?: </span><span class="s2">boolean</span><span class="s1">;</span>
    <span class="s1">layout</span><span class="s0">: </span><span class="s2">Layout</span><span class="s1">;</span>
    <span class="s1">gestureDirection</span><span class="s0">: </span><span class="s2">GestureDirection</span><span class="s1">;</span>
  <span class="s1">}) =&gt; { 
    </span><span class="s7">if </span><span class="s1">(</span><span class="s0">!</span><span class="s2">closing</span><span class="s1">) {</span>
      <span class="s2">return </span><span class="s1">0; 
    }</span>

    <span class="s2">return </span><span class="s7">getDistanceForDirection</span><span class="s1">(</span><span class="s2">layout</span><span class="s1">, </span><span class="s2">gestureDirection</span><span class="s1">); 
  }; 
</span>
  <span class="s0">private </span><span class="s7">setPointerEventsEnabled </span><span class="s0">= </span><span class="s1">(</span><span class="s2">enabled</span><span class="s0">: </span><span class="s2">boolean</span><span class="s1">) </span><span class="s0">=&gt; </span><span class="s1">{</span>
    <span class="s0">const </span><span class="s1">pointerEvents </span><span class="s0">= </span><span class="s2">enabled </span><span class="s0">? </span><span class="s3">'box-none' </span><span class="s0">: </span><span class="s3">'none'</span><span class="s1">;</span>

    <span class="s2">this</span><span class="s1">.</span><span class="s2">ref</span><span class="s1">.</span><span class="s2">current</span><span class="s1">?.</span><span class="s7">setPointerEvents</span><span class="s1">(</span><span class="s2">pointerEvents</span><span class="s1">);</span>
  <span class="s1">}; 
</span>
  <span class="s0">private </span><span class="s7">handleStartInteraction </span><span class="s0">= </span><span class="s1">() </span><span class="s0">=&gt; </span><span class="s1">{</span>
    <span class="s0">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">interactionHandle </span><span class="s0">=== </span><span class="s4">undefined</span><span class="s1">) {</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s2">interactionHandle </span><span class="s0">= </span><span class="s2">InteractionManager</span><span class="s1">.</span><span class="s7">createInteractionHandle</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">}; 
</span>
  <span class="s0">private </span><span class="s7">handleEndInteraction </span><span class="s0">= </span><span class="s1">() </span><span class="s0">=&gt; </span><span class="s1">{</span>
    <span class="s0">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">interactionHandle </span><span class="s0">!== </span><span class="s4">undefined</span><span class="s1">) {</span>
      <span class="s2">InteractionManager</span><span class="s1">.</span><span class="s7">clearInteractionHandle</span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s2">interactionHandle</span><span class="s1">);</span>
      <span class="s2">this</span><span class="s1">.</span><span class="s2">interactionHandle </span><span class="s0">= </span><span class="s4">undefined</span><span class="s1">;</span>
    <span class="s1">}</span>
  <span class="s1">}; 
</span>
  <span class="s0">private </span><span class="s7">handleGestureStateChange </span><span class="s0">= </span><span class="s1">({</span>
    <span class="s2">nativeEvent</span><span class="s1">,</span>
  <span class="s1">}</span><span class="s0">: </span><span class="s2">PanGestureHandlerGestureEvent</span><span class="s1">) </span><span class="s0">=&gt; </span><span class="s1">{</span>
    <span class="s0">const </span><span class="s1">{</span>
      <span class="s1">layout,</span>
      <span class="s1">onClose,</span>
      <span class="s1">onGestureBegin,</span>
      <span class="s1">onGestureCanceled,</span>
      <span class="s1">onGestureEnd,</span>
      <span class="s1">gestureDirection,</span>
      <span class="s1">gestureVelocityImpact,</span>
    <span class="s1">} </span><span class="s0">= </span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">;</span>

    <span class="s0">switch </span><span class="s1">(</span><span class="s2">nativeEvent</span><span class="s1">.</span><span class="s2">state</span><span class="s1">) {</span>
      <span class="s0">case </span><span class="s2">GestureState</span><span class="s1">.</span><span class="s2">ACTIVE</span><span class="s1">:</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s2">isSwiping</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span><span class="s2">TRUE</span><span class="s1">);</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s7">handleStartInteraction</span><span class="s1">();</span>
        <span class="s7">onGestureBegin</span><span class="s1">?.();</span>
        <span class="s0">break</span><span class="s1">;</span>
      <span class="s0">case </span><span class="s2">GestureState</span><span class="s1">.</span><span class="s2">CANCELLED</span><span class="s1">: {</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s2">isSwiping</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span><span class="s2">FALSE</span><span class="s1">);</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s7">handleEndInteraction</span><span class="s1">();</span>

        <span class="s0">const </span><span class="s1">velocity </span><span class="s0">=</span>
          <span class="s2">gestureDirection </span><span class="s0">=== </span><span class="s3">'vertical' </span><span class="s0">||</span>
          <span class="s2">gestureDirection </span><span class="s0">=== </span><span class="s3">'vertical-inverted'</span>
            <span class="s0">? </span><span class="s2">nativeEvent</span><span class="s1">.</span><span class="s2">velocityY</span>
            <span class="s0">: </span><span class="s2">nativeEvent</span><span class="s1">.</span><span class="s2">velocityX</span><span class="s1">;</span>

        <span class="s2">this</span><span class="s1">.</span><span class="s7">animate</span><span class="s1">({ closing: </span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">closing</span><span class="s1">, </span><span class="s2">velocity </span><span class="s1">});</span>

        <span class="s7">onGestureCanceled</span><span class="s1">?.();</span>
        <span class="s0">break</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s0">case </span><span class="s2">GestureState</span><span class="s1">.</span><span class="s2">END</span><span class="s1">: {</span>
        <span class="s2">this</span><span class="s1">.</span><span class="s2">isSwiping</span><span class="s1">.</span><span class="s7">setValue</span><span class="s1">(</span><span class="s2">FALSE</span><span class="s1">);</span>

        <span class="s0">let </span><span class="s1">distance;</span>
        <span class="s0">let </span><span class="s1">translation;</span>
        <span class="s0">let </span><span class="s1">velocity;</span>

        <span class="s0">if </span><span class="s1">(</span>
          <span class="s2">gestureDirection </span><span class="s0">=== </span><span class="s3">'vertical' </span><span class="s0">||</span>
          <span class="s2">gestureDirection </span><span class="s0">=== </span><span class="s3">'vertical-inverted'</span>
        <span class="s1">) {</span>
          <span class="s2">distance </span><span class="s0">= </span><span class="s2">layout</span><span class="s1">.</span><span class="s2">height</span><span class="s1">;</span>
          <span class="s2">translation </span><span class="s0">= </span><span class="s2">nativeEvent</span><span class="s1">.</span><span class="s2">translationY</span><span class="s1">;</span>
          <span class="s2">velocity </span><span class="s0">= </span><span class="s2">nativeEvent</span><span class="s1">.</span><span class="s2">velocityY</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
          <span class="s2">distance </span><span class="s0">= </span><span class="s2">layout</span><span class="s1">.</span><span class="s2">width</span><span class="s1">;</span>
          <span class="s2">translation </span><span class="s0">= </span><span class="s2">nativeEvent</span><span class="s1">.</span><span class="s2">translationX</span><span class="s1">;</span>
          <span class="s2">velocity </span><span class="s0">= </span><span class="s2">nativeEvent</span><span class="s1">.</span><span class="s2">velocityX</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s0">const </span><span class="s1">closing </span><span class="s0">=</span>
          <span class="s1">(</span><span class="s2">translation </span><span class="s0">+ </span><span class="s2">velocity </span><span class="s0">* </span><span class="s2">gestureVelocityImpact</span><span class="s1">) </span><span class="s0">*</span>
            <span class="s7">getInvertedMultiplier</span><span class="s1">(</span><span class="s2">gestureDirection</span><span class="s1">) </span><span class="s0">&gt;</span>
          <span class="s2">distance </span><span class="s0">/ </span><span class="s5">2</span>
            <span class="s0">? </span><span class="s2">velocity </span><span class="s0">!== </span><span class="s5">0 </span><span class="s0">|| </span><span class="s2">translation </span><span class="s0">!== </span><span class="s5">0</span>
            <span class="s0">: </span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">closing</span><span class="s1">;</span>

        <span class="s2">this</span><span class="s1">.</span><span class="s7">animate</span><span class="s1">({ </span><span class="s2">closing</span><span class="s1">, </span><span class="s2">velocity </span><span class="s1">});</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s2">closing</span><span class="s1">) {</span>
          <span class="s6">// We call onClose with a delay to make sure that the animation has already started</span>
          <span class="s6">// This will make sure that the state update caused by this doesn't affect start of animation</span>
          <span class="s2">this</span><span class="s1">.</span><span class="s2">pendingGestureCallback </span><span class="s0">= </span><span class="s7">setTimeout</span><span class="s1">(() </span><span class="s0">=&gt; </span><span class="s1">{</span>
            <span class="s7">onClose</span><span class="s1">();</span>

            <span class="s6">// Trigger an update after we dispatch the action to remove the screen</span>
            <span class="s6">// This will make sure that we check if the screen didn't get removed so we can cancel the animation</span>
            <span class="s2">this</span><span class="s1">.</span><span class="s7">forceUpdate</span><span class="s1">();</span>
          <span class="s1">}, </span><span class="s5">32</span><span class="s1">) </span><span class="s0">as </span><span class="s2">any </span><span class="s0">as </span><span class="s2">number</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s7">onGestureEnd</span><span class="s1">?.();</span>
        <span class="s0">break</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}; 
</span>
  <span class="s6">// Memoize this to avoid extra work on re-render</span>
  <span class="s2">private getInterpolatedStyle </span><span class="s0">= </span><span class="s7">memoize</span><span class="s1">(</span>
    <span class="s1">(</span>
      <span class="s2">styleInterpolator</span><span class="s1">: </span><span class="s2">StackCardStyleInterpolator</span><span class="s1">,</span>
      <span class="s2">animation</span><span class="s1">: </span><span class="s2">StackCardInterpolationProps</span>
    <span class="s1">) </span><span class="s0">=&gt; </span><span class="s7">styleInterpolator</span><span class="s1">(</span><span class="s2">animation</span><span class="s1">)</span>
  <span class="s1">); 
</span>
  <span class="s6">// Keep track of the animation context when deps changes.</span>
  <span class="s2">private getCardAnimation </span><span class="s0">= </span><span class="s7">memoize</span><span class="s1">(</span>
    <span class="s1">(</span>
      <span class="s2">interpolationIndex</span><span class="s1">: </span><span class="s2">number</span><span class="s1">,</span>
      <span class="s2">current</span><span class="s1">: </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">AnimatedInterpolation</span><span class="s0">&lt;</span><span class="s2">number</span><span class="s0">&gt;</span><span class="s1">,</span>
      <span class="s2">next</span><span class="s1">: </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">AnimatedInterpolation</span><span class="s0">&lt;</span><span class="s2">number</span><span class="s0">&gt; | </span><span class="s4">undefined</span><span class="s1">,</span>
      <span class="s2">layout</span><span class="s1">: </span><span class="s2">Layout</span><span class="s1">,</span>
      <span class="s2">insetTop</span><span class="s1">: </span><span class="s2">number</span><span class="s1">,</span>
      <span class="s2">insetRight</span><span class="s1">: </span><span class="s2">number</span><span class="s1">,</span>
      <span class="s2">insetBottom</span><span class="s1">: </span><span class="s2">number</span><span class="s1">,</span>
      <span class="s2">insetLeft</span><span class="s1">: </span><span class="s2">number</span>
    <span class="s1">) </span><span class="s0">=&gt; </span><span class="s1">({</span>
      <span class="s1">index: </span><span class="s2">interpolationIndex</span><span class="s1">,</span>
      <span class="s1">current: { progress: </span><span class="s2">current </span><span class="s1">},</span>
      <span class="s1">next: </span><span class="s2">next </span><span class="s0">&amp;&amp; </span><span class="s1">{ progress: </span><span class="s2">next </span><span class="s1">},</span>
      <span class="s1">closing: </span><span class="s2">this</span><span class="s1">.</span><span class="s2">isClosing</span><span class="s1">,</span>
      <span class="s1">swiping: </span><span class="s2">this</span><span class="s1">.</span><span class="s2">isSwiping</span><span class="s1">,</span>
      <span class="s1">inverted: </span><span class="s2">this</span><span class="s1">.</span><span class="s2">inverted</span><span class="s1">,</span>
      <span class="s1">layouts: {</span>
        <span class="s1">screen: </span><span class="s2">layout</span><span class="s1">,</span>
      <span class="s1">},</span>
      <span class="s1">insets: {</span>
        <span class="s1">top: </span><span class="s2">insetTop</span><span class="s1">,</span>
        <span class="s1">right: </span><span class="s2">insetRight</span><span class="s1">,</span>
        <span class="s1">bottom: </span><span class="s2">insetBottom</span><span class="s1">,</span>
        <span class="s1">left: </span><span class="s2">insetLeft</span><span class="s1">,</span>
      <span class="s1">},</span>
    <span class="s1">})</span>
  <span class="s1">); 
</span>
  <span class="s2">private </span><span class="s7">gestureActivationCriteria</span><span class="s1">() {</span>
    <span class="s2">const </span><span class="s1">{ </span><span class="s2">layout</span><span class="s1">, </span><span class="s2">gestureDirection</span><span class="s1">, </span><span class="s2">gestureResponseDistance </span><span class="s1">} </span><span class="s0">= </span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">; 
    </span><span class="s2">const enableTrackpadTwoFingerGesture </span><span class="s0">= </span><span class="s4">true</span><span class="s1">; 
</span>
    <span class="s2">const distance </span><span class="s0">=</span>
      <span class="s2">gestureResponseDistance </span><span class="s0">!== </span><span class="s4">undefined</span>
        <span class="s1">? </span><span class="s2">gestureResponseDistance</span>
        <span class="s1">: </span><span class="s2">gestureDirection </span><span class="s1">=== '</span><span class="s2">vertical</span><span class="s1">' || 
          </span><span class="s2">gestureDirection </span><span class="s1">=== '</span><span class="s2">vertical</span><span class="s1">-</span><span class="s2">inverted</span><span class="s1">' 
        ? </span><span class="s2">GESTURE_RESPONSE_DISTANCE_VERTICAL</span>
        <span class="s1">: </span><span class="s2">GESTURE_RESPONSE_DISTANCE_HORIZONTAL</span><span class="s1">; 
</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">gestureDirection </span><span class="s1">=== '</span><span class="s2">vertical</span><span class="s1">') {</span>
      <span class="s2">return </span><span class="s1">{</span>
        <span class="s2">maxDeltaX</span><span class="s1">: </span><span class="s5">15</span><span class="s1">,</span>
        <span class="s2">minOffsetY</span><span class="s1">: </span><span class="s5">5</span><span class="s1">,</span>
        <span class="s2">hitSlop</span><span class="s1">: { </span><span class="s2">bottom</span><span class="s1">: -</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">height </span><span class="s1">+ </span><span class="s2">distance </span><span class="s1">},</span>
        <span class="s2">enableTrackpadTwoFingerGesture</span><span class="s1">,</span>
      <span class="s1">}; 
    } </span><span class="s2">else if </span><span class="s1">(</span><span class="s2">gestureDirection </span><span class="s1">=== '</span><span class="s2">vertical</span><span class="s1">-</span><span class="s2">inverted</span><span class="s1">') {</span>
      <span class="s2">return </span><span class="s1">{</span>
        <span class="s2">maxDeltaX</span><span class="s1">: </span><span class="s5">15</span><span class="s1">,</span>
        <span class="s2">minOffsetY</span><span class="s1">: -</span><span class="s5">5</span><span class="s1">,</span>
        <span class="s2">hitSlop</span><span class="s1">: { </span><span class="s2">top</span><span class="s1">: -</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">height </span><span class="s1">+ </span><span class="s2">distance </span><span class="s1">},</span>
        <span class="s2">enableTrackpadTwoFingerGesture</span><span class="s1">,</span>
      <span class="s1">}; 
    } </span><span class="s2">else </span><span class="s1">{</span>
      <span class="s2">const hitSlop </span><span class="s0">= -</span><span class="s2">layout</span><span class="s1">.</span><span class="s2">width </span><span class="s0">+ </span><span class="s2">distance</span><span class="s1">; 
      </span><span class="s2">const invertedMultiplier </span><span class="s0">= </span><span class="s7">getInvertedMultiplier</span><span class="s1">(</span><span class="s2">gestureDirection</span><span class="s1">); 
</span>
      <span class="s2">if </span><span class="s1">(</span><span class="s2">invertedMultiplier </span><span class="s1">=== 1) {</span>
        <span class="s2">return </span><span class="s1">{</span>
          <span class="s2">minOffsetX</span><span class="s1">: </span><span class="s5">5</span><span class="s1">,</span>
          <span class="s2">maxDeltaY</span><span class="s1">: </span><span class="s5">20</span><span class="s1">,</span>
          <span class="s2">hitSlop</span><span class="s1">: { </span><span class="s2">right</span><span class="s1">: </span><span class="s2">hitSlop </span><span class="s1">},</span>
          <span class="s2">enableTrackpadTwoFingerGesture</span><span class="s1">,</span>
        <span class="s1">}; 
      } </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s2">return </span><span class="s1">{</span>
          <span class="s2">minOffsetX</span><span class="s1">: -</span><span class="s5">5</span><span class="s1">,</span>
          <span class="s2">maxDeltaY</span><span class="s1">: </span><span class="s5">20</span><span class="s1">,</span>
          <span class="s2">hitSlop</span><span class="s1">: { </span><span class="s2">left</span><span class="s1">: </span><span class="s2">hitSlop </span><span class="s1">},</span>
          <span class="s2">enableTrackpadTwoFingerGesture</span><span class="s1">,</span>
        <span class="s1">}; 
      }</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">private ref </span><span class="s0">= </span><span class="s2">React</span><span class="s1">.</span><span class="s7">createRef</span><span class="s1">&lt;</span><span class="s2">CardSheetRef</span><span class="s1">&gt;(); 
</span>
  <span class="s7">render</span><span class="s1">() {</span>
    <span class="s2">const </span><span class="s1">{</span>
      <span class="s2">styleInterpolator</span><span class="s1">,</span>
      <span class="s2">interpolationIndex</span><span class="s1">,</span>
      <span class="s2">current</span><span class="s1">,</span>
      <span class="s2">gesture</span><span class="s1">,</span>
      <span class="s2">next</span><span class="s1">,</span>
      <span class="s2">layout</span><span class="s1">,</span>
      <span class="s2">insets</span><span class="s1">,</span>
      <span class="s2">overlay</span><span class="s1">,</span>
      <span class="s2">overlayEnabled</span><span class="s1">,</span>
      <span class="s2">shadowEnabled</span><span class="s1">,</span>
      <span class="s2">gestureEnabled</span><span class="s1">,</span>
      <span class="s2">gestureDirection</span><span class="s1">,</span>
      <span class="s2">pageOverflowEnabled</span><span class="s1">,</span>
      <span class="s2">headerDarkContent</span><span class="s1">,</span>
      <span class="s2">children</span><span class="s1">,</span>
      <span class="s2">containerStyle</span><span class="s1">: </span><span class="s2">customContainerStyle</span><span class="s1">,</span>
      <span class="s2">contentStyle</span><span class="s1">,</span>
      <span class="s0">...</span><span class="s2">rest</span>
    <span class="s1">} </span><span class="s0">= </span><span class="s2">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">; 
</span>
    <span class="s2">const interpolationProps </span><span class="s0">= </span><span class="s2">this</span><span class="s1">.</span><span class="s7">getCardAnimation</span><span class="s1">(</span>
      <span class="s2">interpolationIndex</span><span class="s1">,</span>
      <span class="s2">current</span><span class="s1">,</span>
      <span class="s2">next</span><span class="s1">,</span>
      <span class="s2">layout</span><span class="s1">,</span>
      <span class="s2">insets</span><span class="s1">.</span><span class="s2">top</span><span class="s1">,</span>
      <span class="s2">insets</span><span class="s1">.</span><span class="s2">right</span><span class="s1">,</span>
      <span class="s2">insets</span><span class="s1">.</span><span class="s2">bottom</span><span class="s1">,</span>
      <span class="s2">insets</span><span class="s1">.</span><span class="s2">left</span>
    <span class="s1">); 
</span>
    <span class="s2">const interpolatedStyle </span><span class="s0">= </span><span class="s2">this</span><span class="s1">.</span><span class="s7">getInterpolatedStyle</span><span class="s1">(</span>
      <span class="s2">styleInterpolator</span><span class="s1">,</span>
      <span class="s2">interpolationProps</span>
    <span class="s1">); 
</span>
    <span class="s2">const </span><span class="s1">{ </span><span class="s2">containerStyle</span><span class="s1">, </span><span class="s2">cardStyle</span><span class="s1">, </span><span class="s2">overlayStyle</span><span class="s1">, </span><span class="s2">shadowStyle </span><span class="s1">} </span><span class="s0">=</span>
      <span class="s2">interpolatedStyle</span><span class="s1">; 
</span>
    <span class="s2">const handleGestureEvent </span><span class="s0">= </span><span class="s2">gestureEnabled</span>
      <span class="s1">? </span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">event</span><span class="s1">( 
          [ 
            {</span>
              <span class="s2">nativeEvent</span><span class="s1">:</span>
                <span class="s2">gestureDirection </span><span class="s1">=== </span><span class="s3">'vertical' </span><span class="s1">|| 
                </span><span class="s2">gestureDirection </span><span class="s1">=== </span><span class="s3">'vertical-inverted'</span>
                  <span class="s1">? { </span><span class="s2">translationY</span><span class="s1">: </span><span class="s2">gesture </span><span class="s1">}</span>
                  <span class="s1">: { </span><span class="s2">translationX</span><span class="s1">: </span><span class="s2">gesture </span><span class="s1">},</span>
            <span class="s1">},</span>
          <span class="s1">],</span>
          <span class="s1">{ </span><span class="s2">useNativeDriver </span><span class="s1">}</span>
        <span class="s1">) 
      : </span><span class="s2">undefined</span><span class="s1">; 
</span>
    <span class="s2">const </span><span class="s1">{ </span><span class="s2">backgroundColor </span><span class="s1">} </span><span class="s0">= </span><span class="s2">StyleSheet</span><span class="s1">.</span><span class="s7">flatten</span><span class="s1">(</span><span class="s2">contentStyle </span><span class="s0">|| </span><span class="s1">{}); 
    </span><span class="s2">const isTransparent </span><span class="s0">=</span>
      <span class="s0">typeof </span><span class="s2">backgroundColor </span><span class="s0">=== </span><span class="s3">'string'</span>
        <span class="s1">? </span><span class="s2">Color</span><span class="s1">(</span><span class="s2">backgroundColor</span><span class="s1">).</span><span class="s2">alpha</span><span class="s1">() === 0 
        : </span><span class="s2">false</span><span class="s1">; 
</span>
    <span class="s2">return </span><span class="s1">( 
      &lt;</span><span class="s2">CardAnimationContext</span><span class="s1">.</span><span class="s2">Provider value</span><span class="s0">=</span><span class="s1">{</span><span class="s2">interpolationProps</span><span class="s1">}</span><span class="s0">&gt;</span>
        <span class="s1">{</span>
          <span class="s6">// StatusBar messes with translucent status bar on Android</span>
          <span class="s6">// So we should only enable it on iOS</span>
          <span class="s2">Platform</span><span class="s1">.</span><span class="s2">OS </span><span class="s1">=== '</span><span class="s2">ios</span><span class="s1">' &amp;&amp; 
          </span><span class="s2">overlayEnabled </span><span class="s1">&amp;&amp; 
          </span><span class="s2">next </span><span class="s1">&amp;&amp; 
          </span><span class="s2">getIsModalPresentation</span><span class="s1">(</span><span class="s2">styleInterpolator</span><span class="s1">) ? ( 
            &lt;</span><span class="s2">ModalStatusBarManager</span>
              <span class="s2">dark</span><span class="s0">=</span><span class="s1">{</span><span class="s2">headerDarkContent</span><span class="s1">}</span>
              <span class="s2">layout</span><span class="s0">=</span><span class="s1">{</span><span class="s2">layout</span><span class="s1">}</span>
              <span class="s2">insets</span><span class="s0">=</span><span class="s1">{</span><span class="s2">insets</span><span class="s1">}</span>
              <span class="s2">style</span><span class="s0">=</span><span class="s1">{</span><span class="s2">cardStyle</span><span class="s1">}</span>
            <span class="s1">/&gt; 
          ) : </span><span class="s2">null</span>
        <span class="s1">}</span>
        <span class="s1">&lt;</span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">View</span>
          <span class="s2">style</span><span class="s0">=</span><span class="s1">{{ 
            </span><span class="s6">// This is a dummy style that doesn't actually change anything visually.</span>
            <span class="s6">// Animated needs the animated value to be used somewhere, otherwise things don't update properly.</span>
            <span class="s6">// If we disable animations and hide header, it could end up making the value unused.</span>
            <span class="s6">// So we have this dummy style that will always be used regardless of what else changed.</span>
            <span class="s1">opacity: </span><span class="s2">current</span><span class="s1">,</span>
          <span class="s1">}}</span>
          <span class="s6">// Make sure that this view isn't removed. If this view is removed, our style with animated value won't apply</span>
          <span class="s2">collapsable</span><span class="s0">=</span><span class="s1">{</span><span class="s2">false</span><span class="s1">}</span>
        <span class="s0">/&gt;</span>
        <span class="s8">&lt;</span><span class="s9">View </span><span class="s11">pointerEvents</span><span class="s0">=</span><span class="s3">&quot;box-none&quot; </span><span class="s10">{</span><span class="s0">...</span><span class="s2">rest</span><span class="s10">}</span><span class="s8">&gt;</span>
          <span class="s10">{</span><span class="s2">overlayEnabled </span><span class="s0">? </span><span class="s10">(</span>
            <span class="s8">&lt;</span><span class="s9">View </span><span class="s11">pointerEvents</span><span class="s0">=</span><span class="s3">&quot;box-none&quot; </span><span class="s11">style</span><span class="s0">=</span><span class="s10">{</span><span class="s2">StyleSheet</span><span class="s10">.</span><span class="s2">absoluteFill</span><span class="s10">}</span><span class="s8">&gt;</span>
              <span class="s10">{</span><span class="s7">overlay</span><span class="s10">({ style: </span><span class="s2">overlayStyle </span><span class="s10">})}</span>
            <span class="s8">&lt;/</span><span class="s9">View</span><span class="s8">&gt;</span>
          <span class="s10">) </span><span class="s0">: </span><span class="s4">null</span><span class="s10">}</span>
          <span class="s8">&lt;</span><span class="s9">Animated.View</span>
            <span class="s11">style</span><span class="s0">=</span><span class="s10">{[</span><span class="s2">styles</span><span class="s10">.</span><span class="s2">container</span><span class="s10">, </span><span class="s2">containerStyle</span><span class="s10">, </span><span class="s2">customContainerStyle</span><span class="s10">]}</span>
            <span class="s11">pointerEvents</span><span class="s0">=</span><span class="s3">&quot;box-none&quot;</span>
          <span class="s10">&gt; 
            </span><span class="s8">&lt;</span><span class="s9">PanGestureHandler</span>
              <span class="s11">enabled</span><span class="s0">=</span><span class="s10">{</span><span class="s2">layout</span><span class="s10">.</span><span class="s2">width </span><span class="s0">!== </span><span class="s5">0 </span><span class="s0">&amp;&amp; </span><span class="s2">gestureEnabled</span><span class="s10">}</span>
              <span class="s11">onGestureEvent</span><span class="s0">=</span><span class="s10">{</span><span class="s2">handleGestureEvent</span><span class="s10">}</span>
              <span class="s11">onHandlerStateChange</span><span class="s0">=</span><span class="s10">{</span><span class="s2">this</span><span class="s10">.</span><span class="s2">handleGestureStateChange</span><span class="s10">}</span>
              <span class="s10">{</span><span class="s0">...</span><span class="s2">this</span><span class="s10">.</span><span class="s7">gestureActivationCriteria</span><span class="s10">()}</span>
            <span class="s8">&gt;</span>
              <span class="s8">&lt;</span><span class="s9">Animated.View</span>
                <span class="s11">needsOffscreenAlphaCompositing</span><span class="s0">=</span><span class="s10">{</span><span class="s7">hasOpacityStyle</span><span class="s10">(</span><span class="s2">cardStyle</span><span class="s10">)}</span>
                <span class="s11">style</span><span class="s0">=</span><span class="s10">{[</span><span class="s2">styles</span><span class="s10">.</span><span class="s2">container</span><span class="s10">, </span><span class="s2">cardStyle</span><span class="s10">]}</span>
              <span class="s10">&gt; 
                {shadowEnabled &amp;&amp; shadowStyle &amp;&amp; !isTransparent ? ( 
                  </span><span class="s8">&lt;</span><span class="s9">Animated.View</span>
                    <span class="s11">style</span><span class="s0">=</span><span class="s10">{[</span>
                      <span class="s2">styles</span><span class="s10">.</span><span class="s2">shadow</span><span class="s10">,</span>
                      <span class="s2">gestureDirection </span><span class="s0">=== </span><span class="s3">'horizontal'</span>
                        <span class="s0">? </span><span class="s10">[</span><span class="s2">styles</span><span class="s10">.</span><span class="s2">shadowHorizontal</span><span class="s10">, </span><span class="s2">styles</span><span class="s10">.</span><span class="s2">shadowLeft</span><span class="s10">]</span>
                        <span class="s0">: </span><span class="s2">gestureDirection </span><span class="s0">=== </span><span class="s3">'horizontal-inverted'</span>
                        <span class="s0">? </span><span class="s10">[</span><span class="s2">styles</span><span class="s10">.</span><span class="s2">shadowHorizontal</span><span class="s10">, </span><span class="s2">styles</span><span class="s10">.</span><span class="s2">shadowRight</span><span class="s10">]</span>
                        <span class="s0">: </span><span class="s2">gestureDirection </span><span class="s0">=== </span><span class="s3">'vertical'</span>
                        <span class="s0">? </span><span class="s10">[</span><span class="s2">styles</span><span class="s10">.</span><span class="s2">shadowVertical</span><span class="s10">, </span><span class="s2">styles</span><span class="s10">.</span><span class="s2">shadowTop</span><span class="s10">]</span>
                        <span class="s0">: </span><span class="s10">[</span><span class="s2">styles</span><span class="s10">.</span><span class="s2">shadowVertical</span><span class="s10">, </span><span class="s2">styles</span><span class="s10">.</span><span class="s2">shadowBottom</span><span class="s10">],</span>
                      <span class="s10">{ </span><span class="s2">backgroundColor </span><span class="s10">},</span>
                      <span class="s2">shadowStyle</span><span class="s10">,</span>
                    <span class="s10">]}</span>
                    <span class="s11">pointerEvents</span><span class="s0">=</span><span class="s3">&quot;none&quot;</span>
                  <span class="s8">/&gt;</span>
                <span class="s10">) : null} 
                </span><span class="s8">&lt;</span><span class="s9">CardSheet</span>
                  <span class="s11">ref</span><span class="s0">=</span><span class="s10">{</span><span class="s2">this</span><span class="s10">.</span><span class="s2">ref</span><span class="s10">}</span>
                  <span class="s11">enabled</span><span class="s0">=</span><span class="s10">{</span><span class="s2">pageOverflowEnabled</span><span class="s10">}</span>
                  <span class="s11">layout</span><span class="s0">=</span><span class="s10">{</span><span class="s2">layout</span><span class="s10">}</span>
                  <span class="s11">style</span><span class="s0">=</span><span class="s10">{</span><span class="s2">contentStyle</span><span class="s10">}</span>
                <span class="s10">&gt; 
                  {children} 
                </span><span class="s8">&lt;/</span><span class="s9">CardSheet</span><span class="s8">&gt;</span>
              <span class="s8">&lt;/</span><span class="s9">Animated.View</span><span class="s8">&gt;</span>
            <span class="s8">&lt;/</span><span class="s9">PanGestureHandler</span><span class="s8">&gt;</span>
          <span class="s0">&lt;/</span><span class="s2">Animated</span><span class="s1">.</span><span class="s2">View</span><span class="s0">&gt;</span>
        <span class="s0">&lt;/</span><span class="s2">View</span><span class="s0">&gt;</span>
      <span class="s0">&lt;/</span><span class="s2">CardAnimationContext</span><span class="s1">.</span><span class="s2">Provider</span><span class="s0">&gt;</span>
    <span class="s1">); 
  } 
} 
</span>
<span class="s2">export const </span><span class="s7">getIsModalPresentation </span><span class="s0">= </span><span class="s1">(</span>
  <span class="s2">cardStyleInterpolator</span><span class="s0">: </span><span class="s2">StackCardStyleInterpolator</span>
<span class="s1">) </span><span class="s0">=&gt; </span><span class="s1">{</span>
  <span class="s0">return </span><span class="s1">(</span>
    <span class="s2">cardStyleInterpolator </span><span class="s0">=== </span><span class="s2">forModalPresentationIOS </span><span class="s0">||</span>
    <span class="s6">// Handle custom modal presentation interpolators as well</span>
    <span class="s2">cardStyleInterpolator</span><span class="s1">.</span><span class="s2">name </span><span class="s0">=== </span><span class="s3">'forModalPresentationIOS'</span>
  <span class="s1">);</span>
<span class="s1">}; 
</span>
<span class="s2">const styles </span><span class="s0">= </span><span class="s2">StyleSheet</span><span class="s1">.</span><span class="s7">create</span><span class="s1">({</span>
  <span class="s1">container: {</span>
    <span class="s1">flex: </span><span class="s5">1</span><span class="s1">,</span>
  <span class="s1">},</span>
  <span class="s1">overlay: {</span>
    <span class="s1">flex: </span><span class="s5">1</span><span class="s1">,</span>
    <span class="s1">backgroundColor: </span><span class="s3">'#000'</span><span class="s1">,</span>
  <span class="s1">},</span>
  <span class="s1">shadow: {</span>
    <span class="s1">position: </span><span class="s3">'absolute'</span><span class="s1">,</span>
    <span class="s1">shadowRadius: </span><span class="s5">5</span><span class="s1">,</span>
    <span class="s1">shadowColor: </span><span class="s3">'#000'</span><span class="s1">,</span>
    <span class="s1">shadowOpacity: </span><span class="s5">0.3</span><span class="s1">,</span>
  <span class="s1">},</span>
  <span class="s1">shadowHorizontal: {</span>
    <span class="s1">top: </span><span class="s5">0</span><span class="s1">,</span>
    <span class="s1">bottom: </span><span class="s5">0</span><span class="s1">,</span>
    <span class="s1">width: </span><span class="s5">3</span><span class="s1">,</span>
    <span class="s1">shadowOffset: { width: </span><span class="s0">-</span><span class="s5">1</span><span class="s1">, height: </span><span class="s5">1 </span><span class="s1">},</span>
  <span class="s1">},</span>
  <span class="s1">shadowLeft: {</span>
    <span class="s1">left: </span><span class="s5">0</span><span class="s1">,</span>
  <span class="s1">},</span>
  <span class="s1">shadowRight: {</span>
    <span class="s1">right: </span><span class="s5">0</span><span class="s1">,</span>
  <span class="s1">},</span>
  <span class="s1">shadowVertical: {</span>
    <span class="s1">left: </span><span class="s5">0</span><span class="s1">,</span>
    <span class="s1">right: </span><span class="s5">0</span><span class="s1">,</span>
    <span class="s1">height: </span><span class="s5">3</span><span class="s1">,</span>
    <span class="s1">shadowOffset: { width: </span><span class="s5">1</span><span class="s1">, height: </span><span class="s0">-</span><span class="s5">1 </span><span class="s1">},</span>
  <span class="s1">},</span>
  <span class="s1">shadowTop: {</span>
    <span class="s1">top: </span><span class="s5">0</span><span class="s1">,</span>
  <span class="s1">},</span>
  <span class="s1">shadowBottom: {</span>
    <span class="s1">bottom: </span><span class="s5">0</span><span class="s1">,</span>
  <span class="s1">},</span>
<span class="s1">}); 
</span></pre>
</body>
</html>