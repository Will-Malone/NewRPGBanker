<html>
<head>
<title>object-schema.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #cc7832;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
object-schema.js</font>
</center></td></tr></table>
<pre><span class="s0">/** 
 * @filedescription Object Schema Tests 
 */</span>
<span class="s0">/* global it, describe, beforeEach */</span>

<span class="s2">&quot;use strict&quot;</span><span class="s1">;</span>

<span class="s0">//-----------------------------------------------------------------------------</span>
<span class="s0">// Requirements</span>
<span class="s0">//-----------------------------------------------------------------------------</span>

<span class="s1">const assert = require(</span><span class="s2">&quot;chai&quot;</span><span class="s1">).assert;</span>
<span class="s1">const { ObjectSchema } = require(</span><span class="s2">&quot;../src/&quot;</span><span class="s1">);</span>

<span class="s0">//-----------------------------------------------------------------------------</span>
<span class="s0">// Class</span>
<span class="s0">//-----------------------------------------------------------------------------</span>

<span class="s1">describe(</span><span class="s2">&quot;ObjectSchema&quot;</span><span class="s1">, () =&gt; {</span>

    <span class="s1">let schema;</span>

    <span class="s1">describe(</span><span class="s2">&quot;new ObjectSchema()&quot;</span><span class="s1">, () =&gt; {</span>

        <span class="s1">it(</span><span class="s2">&quot;should add a new key when a strategy is passed&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.isTrue(schema.hasKey(</span><span class="s2">&quot;foo&quot;</span><span class="s1">));</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when a strategy is missing a merge() method&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                    <span class="s1">foo: {</span>
                        <span class="s1">validate() { }</span>
                    <span class="s1">}</span>
                <span class="s1">});</span>
            <span class="s1">}, /Definition </span><span class="s3">for </span><span class="s1">key </span><span class="s2">&quot;foo&quot; </span><span class="s1">must have a merge property/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when a strategy is missing a merge() method&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema();</span>
            <span class="s1">}, /Schema definitions missing/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when a strategy is missing a validate() method&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                    <span class="s1">foo: {</span>
                        <span class="s1">merge() { },</span>
                    <span class="s1">}</span>
                <span class="s1">});</span>
            <span class="s1">}, /Definition </span><span class="s3">for </span><span class="s1">key </span><span class="s2">&quot;foo&quot; </span><span class="s1">must have a validate\(\) method/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when merge is an invalid string&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s3">new </span><span class="s1">ObjectSchema({</span>
                    <span class="s1">foo: {</span>
                        <span class="s1">merge: </span><span class="s2">&quot;bar&quot;</span><span class="s1">,</span>
                        <span class="s1">validate() { }</span>
                    <span class="s1">}</span>
                <span class="s1">});</span>
            <span class="s1">}, /key </span><span class="s2">&quot;foo&quot; </span><span class="s1">missing valid merge strategy/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when validate is an invalid string&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s3">new </span><span class="s1">ObjectSchema({</span>
                    <span class="s1">foo: {</span>
                        <span class="s1">merge: </span><span class="s2">&quot;assign&quot;</span><span class="s1">,</span>
                        <span class="s1">validate: </span><span class="s2">&quot;s&quot;</span>
                    <span class="s1">}</span>
                <span class="s1">});</span>
            <span class="s1">}, /key </span><span class="s2">&quot;foo&quot; </span><span class="s1">missing valid validation strategy/);</span>
        <span class="s1">});</span>

    <span class="s1">});</span>


    <span class="s1">describe(</span><span class="s2">&quot;merge()&quot;</span><span class="s1">, () =&gt; {</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when an unexpected key is found&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">let schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({});</span>

            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.merge({ foo: </span><span class="s3">true </span><span class="s1">}, { foo: </span><span class="s3">true </span><span class="s1">});</span>
            <span class="s1">}, /Unexpected key </span><span class="s2">&quot;foo&quot;</span><span class="s1">/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when merge() throws an error&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">let schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">throw new </span><span class="s1">Error(</span><span class="s2">&quot;Boom!&quot;</span><span class="s1">);</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.merge({ foo: </span><span class="s3">true </span><span class="s1">}, { foo: </span><span class="s3">true </span><span class="s1">});</span>
            <span class="s1">}, /Key </span><span class="s2">&quot;foo&quot;</span><span class="s1">: Boom!/);</span>
        
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should call the merge() strategy for one key when called&quot;</span><span class="s1">, () =&gt; {</span>
            
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">const result = schema.merge({ foo: </span><span class="s3">true </span><span class="s1">}, { foo: </span><span class="s3">false </span><span class="s1">});</span>
            <span class="s1">assert.propertyVal(result, </span><span class="s2">&quot;foo&quot;</span><span class="s1">, </span><span class="s2">&quot;bar&quot;</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should not call the merge() strategy when both objects don't contain the key&quot;</span><span class="s1">, () =&gt; {</span>
            
            <span class="s1">let called = </span><span class="s3">false</span><span class="s1">;</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s1">called = </span><span class="s3">true</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">schema.merge({}, {});</span>
            <span class="s1">assert.isFalse(called, </span><span class="s2">&quot;The merge() strategy should not have been called.&quot;</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should omit returning the key when the merge() strategy returns undefined&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s1">undefined;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">const result = schema.merge({ foo: </span><span class="s3">true </span><span class="s1">}, { foo: </span><span class="s3">false </span><span class="s1">});</span>
            <span class="s1">assert.notProperty(result, </span><span class="s2">&quot;foo&quot;</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should call the merge() strategy for two keys when called&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">},</span>
                <span class="s1">bar: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;baz&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">const result = schema.merge({ foo: </span><span class="s3">true</span><span class="s1">, bar: </span><span class="s4">1 </span><span class="s1">}, { foo: </span><span class="s3">true</span><span class="s1">, bar: </span><span class="s4">2 </span><span class="s1">});</span>
            <span class="s1">assert.propertyVal(result, </span><span class="s2">&quot;foo&quot;</span><span class="s1">, </span><span class="s2">&quot;bar&quot;</span><span class="s1">);</span>
            <span class="s1">assert.propertyVal(result, </span><span class="s2">&quot;bar&quot;</span><span class="s1">, </span><span class="s2">&quot;baz&quot;</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should call the merge() strategy for two keys when called on three objects&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">},</span>
                <span class="s1">bar: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;baz&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">const result = schema.merge(</span>
                <span class="s1">{ foo: </span><span class="s3">true</span><span class="s1">, bar: </span><span class="s4">1 </span><span class="s1">},</span>
                <span class="s1">{ foo: </span><span class="s3">true</span><span class="s1">, bar: </span><span class="s4">3 </span><span class="s1">},</span>
                <span class="s1">{ foo: </span><span class="s3">false</span><span class="s1">, bar: </span><span class="s4">2 </span><span class="s1">}</span>
            <span class="s1">);</span>
            <span class="s1">assert.propertyVal(result, </span><span class="s2">&quot;foo&quot;</span><span class="s1">, </span><span class="s2">&quot;bar&quot;</span><span class="s1">);</span>
            <span class="s1">assert.propertyVal(result, </span><span class="s2">&quot;bar&quot;</span><span class="s1">, </span><span class="s2">&quot;baz&quot;</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should call the merge() strategy when defined as 'overwrite'&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge: </span><span class="s2">&quot;overwrite&quot;</span><span class="s1">,</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">const result = schema.merge(</span>
                <span class="s1">{ foo: </span><span class="s3">true </span><span class="s1">},</span>
                <span class="s1">{ foo: </span><span class="s3">false </span><span class="s1">}</span>
            <span class="s1">);</span>
            <span class="s1">assert.propertyVal(result, </span><span class="s2">&quot;foo&quot;</span><span class="s1">, </span><span class="s3">false</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should call the merge() strategy when defined as 'assign'&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge: </span><span class="s2">&quot;assign&quot;</span><span class="s1">,</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">const result = schema.merge(</span>
                <span class="s1">{ foo: { bar: </span><span class="s3">true </span><span class="s1">} },</span>
                <span class="s1">{ foo: { baz: </span><span class="s3">false </span><span class="s1">} }</span>
            <span class="s1">);</span>

            <span class="s1">assert.strictEqual(result.foo.bar, </span><span class="s3">true</span><span class="s1">);</span>
            <span class="s1">assert.strictEqual(result.foo.baz, </span><span class="s3">false</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should call the merge strategy when there's a subschema&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">name: {</span>
                    <span class="s1">schema: {</span>
                        <span class="s1">first: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">},</span>
                        <span class="s1">last: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">const result = schema.merge({</span>
                <span class="s1">name: {</span>
                    <span class="s1">first: </span><span class="s2">&quot;n&quot;</span><span class="s1">,</span>
                    <span class="s1">last: </span><span class="s2">&quot;z&quot;</span>
                <span class="s1">}</span>
            <span class="s1">}, {</span>
                <span class="s1">name: {</span>
                    <span class="s1">first: </span><span class="s2">&quot;g&quot;</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.strictEqual(result.name.first, </span><span class="s2">&quot;g&quot;</span><span class="s1">);</span>
            <span class="s1">assert.strictEqual(result.name.last, </span><span class="s2">&quot;z&quot;</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should return separate objects when using subschema&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">age: {</span>
                    <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                    <span class="s1">validate: </span><span class="s2">&quot;number&quot;</span>
                <span class="s1">},</span>
                <span class="s1">address: {</span>
                    <span class="s1">schema: {</span>
                        <span class="s1">street: {</span>
                            <span class="s1">schema: {</span>
                                <span class="s1">number: {</span>
                                    <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                                    <span class="s1">validate: </span><span class="s2">&quot;number&quot;</span>
                                <span class="s1">},</span>
                                <span class="s1">streetName: {</span>
                                    <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                                    <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                                <span class="s1">}</span>
                            <span class="s1">}</span>
                        <span class="s1">},</span>
                        <span class="s1">state: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">const baseObject = {</span>
                <span class="s1">address: {</span>
                    <span class="s1">street: {</span>
                        <span class="s1">number: </span><span class="s4">100</span><span class="s1">,</span>
                        <span class="s1">streetName: </span><span class="s2">&quot;Foo St&quot;</span>
                    <span class="s1">},</span>
                    <span class="s1">state: </span><span class="s2">&quot;HA&quot;</span>
                <span class="s1">}</span>
            <span class="s1">};</span>

            <span class="s1">const result = schema.merge(baseObject, {</span>
                <span class="s1">age: </span><span class="s4">29</span>
            <span class="s1">});</span>

            <span class="s1">assert.notStrictEqual(result.address.street, baseObject.address.street);</span>
            <span class="s1">assert.deepStrictEqual(result.address, baseObject.address);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should not error when calling the merge strategy when there's a subschema and no matching key in second object&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">name: {</span>
                    <span class="s1">schema: {</span>
                        <span class="s1">first: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">},</span>
                        <span class="s1">last: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">const result = schema.merge({</span>
                <span class="s1">name: {</span>
                    <span class="s1">first: </span><span class="s2">&quot;n&quot;</span><span class="s1">,</span>
                    <span class="s1">last: </span><span class="s2">&quot;z&quot;</span>
                <span class="s1">}</span>
            <span class="s1">}, {</span>
            <span class="s1">});</span>

            <span class="s1">assert.strictEqual(result.name.first, </span><span class="s2">&quot;n&quot;</span><span class="s1">);</span>
            <span class="s1">assert.strictEqual(result.name.last, </span><span class="s2">&quot;z&quot;</span><span class="s1">);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should not error when calling the merge strategy when there's multiple subschemas and no matching key in second object&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">user: {</span>
                    <span class="s1">schema: {</span>
                        <span class="s1">name: {</span>
                            <span class="s1">schema: {</span>
                                <span class="s1">first: {</span>
                                    <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                                    <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                                <span class="s1">},</span>
                                <span class="s1">last: {</span>
                                    <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                                    <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                                <span class="s1">}</span>
                            <span class="s1">}</span>
                        <span class="s1">}</span>

                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">const result = schema.merge({</span>
                <span class="s1">user: {</span>
                    <span class="s1">name: {</span>
                        <span class="s1">first: </span><span class="s2">&quot;n&quot;</span><span class="s1">,</span>
                        <span class="s1">last: </span><span class="s2">&quot;z&quot;</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">}, {</span>
            <span class="s1">});</span>

            <span class="s1">assert.strictEqual(result.user.name.first, </span><span class="s2">&quot;n&quot;</span><span class="s1">);</span>
            <span class="s1">assert.strictEqual(result.user.name.last, </span><span class="s2">&quot;z&quot;</span><span class="s1">);</span>
        <span class="s1">});</span>


    <span class="s1">});</span>

    <span class="s1">describe(</span><span class="s2">&quot;validate()&quot;</span><span class="s1">, () =&gt; {</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when an unexpected key is found&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">let schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({});</span>
            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.validate({ foo: </span><span class="s3">true </span><span class="s1">});</span>
            <span class="s1">}, /Unexpected key </span><span class="s2">&quot;foo&quot;</span><span class="s1">/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should not throw an error when an expected key is found&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">schema.validate({ foo: </span><span class="s3">true </span><span class="s1">});</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should pass the property value into validate() when key is found&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate(value) {</span>
                        <span class="s1">assert.isTrue(value);</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">schema.validate({ foo: </span><span class="s3">true </span><span class="s1">});</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should not throw an error when expected keys are found&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">},</span>
                <span class="s1">bar: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;baz&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">schema.validate({ foo: </span><span class="s3">true</span><span class="s1">, bar: </span><span class="s3">true </span><span class="s1">});</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should not throw an error when expected keys are found with required keys&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">},</span>
                <span class="s1">bar: {</span>
                    <span class="s1">requires: [</span><span class="s2">&quot;foo&quot;</span><span class="s1">],</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;baz&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            
            <span class="s1">schema.validate({ foo: </span><span class="s3">true</span><span class="s1">, bar: </span><span class="s3">true </span><span class="s1">});</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when expected keys are found without required keys&quot;</span><span class="s1">, () =&gt; {</span>
            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">},</span>
                <span class="s1">baz: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;baz&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">},</span>
                <span class="s1">bar: {</span>
                    <span class="s1">name: </span><span class="s2">&quot;bar&quot;</span><span class="s1">,</span>
                    <span class="s1">requires: [</span><span class="s2">&quot;foo&quot;</span><span class="s1">, </span><span class="s2">&quot;baz&quot;</span><span class="s1">],</span>
                    <span class="s1">merge() { },</span>
                    <span class="s1">validate() { }</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.validate({ bar: </span><span class="s3">true </span><span class="s1">});</span>
            <span class="s1">}, /Key </span><span class="s2">&quot;bar&quot; </span><span class="s1">requires keys </span><span class="s2">&quot;foo&quot;</span><span class="s1">, </span><span class="s2">&quot;baz&quot;</span><span class="s1">./);</span>
        <span class="s1">});</span>


        <span class="s1">it(</span><span class="s2">&quot;should throw an error when an expected key is found but is invalid&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {</span>
                        <span class="s3">throw new </span><span class="s1">Error(</span><span class="s2">&quot;Invalid key.&quot;</span><span class="s1">);</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.validate({ foo: </span><span class="s3">true </span><span class="s1">});</span>
            <span class="s1">}, /Key </span><span class="s2">&quot;foo&quot;</span><span class="s1">: Invalid key/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when an expected key is found but is invalid with a string validator&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.validate({ foo: </span><span class="s3">true </span><span class="s1">});</span>
            <span class="s1">}, /Key </span><span class="s2">&quot;foo&quot;</span><span class="s1">: Expected a string/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when an expected key is found but is invalid with a number validator&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate: </span><span class="s2">&quot;number&quot;</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.validate({ foo: </span><span class="s3">true </span><span class="s1">});</span>
            <span class="s1">}, /Key </span><span class="s2">&quot;foo&quot;</span><span class="s1">: Expected a number/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when a required key is missing&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">foo: {</span>
                    <span class="s1">required: </span><span class="s3">true</span><span class="s1">,</span>
                    <span class="s1">merge() {</span>
                        <span class="s3">return </span><span class="s2">&quot;bar&quot;</span><span class="s1">;</span>
                    <span class="s1">},</span>
                    <span class="s1">validate() {}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.validate({});</span>
            <span class="s1">}, /Missing required key </span><span class="s2">&quot;foo&quot;</span><span class="s1">/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should throw an error when a subschema is provided and the value doesn't validate&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">name: {</span>
                    <span class="s1">schema: {</span>
                        <span class="s1">first: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">},</span>
                        <span class="s1">last: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">assert.throws(() =&gt; {</span>
                <span class="s1">schema.validate({</span>
                    <span class="s1">name: {</span>
                        <span class="s1">first: </span><span class="s4">123</span><span class="s1">,</span>
                        <span class="s1">last: </span><span class="s2">&quot;z&quot;</span>
                    <span class="s1">}</span>
                <span class="s1">});</span>
                        
            <span class="s1">}, /Key </span><span class="s2">&quot;name&quot;</span><span class="s1">: Key </span><span class="s2">&quot;first&quot;</span><span class="s1">: Expected a string/);</span>
        <span class="s1">});</span>

        <span class="s1">it(</span><span class="s2">&quot;should not throw an error when a subschema is provided and the value validates&quot;</span><span class="s1">, () =&gt; {</span>

            <span class="s1">schema = </span><span class="s3">new </span><span class="s1">ObjectSchema({</span>
                <span class="s1">name: {</span>
                    <span class="s1">schema: {</span>
                        <span class="s1">first: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">},</span>
                        <span class="s1">last: {</span>
                            <span class="s1">merge: </span><span class="s2">&quot;replace&quot;</span><span class="s1">,</span>
                            <span class="s1">validate: </span><span class="s2">&quot;string&quot;</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">});</span>

            <span class="s1">schema.validate({</span>
                <span class="s1">name: {</span>
                    <span class="s1">first: </span><span class="s2">&quot;n&quot;</span><span class="s1">,</span>
                    <span class="s1">last: </span><span class="s2">&quot;z&quot;</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
                    
        <span class="s1">});</span>

    <span class="s1">});</span>

<span class="s1">});</span>
</pre>
</body>
</html>