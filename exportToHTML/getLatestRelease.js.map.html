<html>
<head>
<title>getLatestRelease.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #a9b7c6;}
.s1 { color: #6a8759;}
.s2 { color: #6897bb; font-style: italic;}
.s3 { color: #cc7832; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
getLatestRelease.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;getLatestRelease&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;currentVersion&quot;</span><span class="s0">,</span><span class="s1">&quot;logger&quot;</span><span class="s0">,</span><span class="s1">&quot;debug&quot;</span><span class="s0">,</span><span class="s1">&quot;includes&quot;</span><span class="s0">,</span><span class="s1">&quot;cachedLatest&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheManager&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;aWeek&quot;</span><span class="s0">,</span><span class="s1">&quot;lastChecked&quot;</span><span class="s0">,</span><span class="s1">&quot;now&quot;</span><span class="s0">,</span><span class="s1">&quot;Date&quot;</span><span class="s0">,</span><span class="s1">&quot;Number&quot;</span><span class="s0">,</span><span class="s1">&quot;eTag&quot;</span><span class="s0">,</span><span class="s1">&quot;latestVersion&quot;</span><span class="s0">,</span><span class="s1">&quot;getLatestRnDiffPurgeVersion&quot;</span><span class="s0">,</span><span class="s1">&quot;semver&quot;</span><span class="s0">,</span><span class="s1">&quot;compare&quot;</span><span class="s0">,</span><span class="s1">&quot;prerelease&quot;</span><span class="s0">,</span><span class="s1">&quot;version&quot;</span><span class="s0">,</span><span class="s1">&quot;changelogUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;buildChangelogUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;diffUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;buildDiffUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;e&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;options&quot;</span><span class="s0">,</span><span class="s1">&quot;headers&quot;</span><span class="s0">,</span><span class="s1">&quot;data&quot;</span><span class="s0">,</span><span class="s1">&quot;status&quot;</span><span class="s0">,</span><span class="s1">&quot;fetch&quot;</span><span class="s0">,</span><span class="s1">&quot;body&quot;</span><span class="s0">,</span><span class="s1">&quot;substring&quot;</span><span class="s0">,</span><span class="s1">&quot;eTagHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">],</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/releaseChecker/getLatestRelease.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import semver from 'semver';</span><span class="s3">\n</span><span class="s1">import cacheManager from './releaseCacheManager';</span><span class="s3">\n</span><span class="s1">import {fetch} from '../fetch';</span><span class="s3">\n</span><span class="s1">import logger from '../logger';</span><span class="s3">\n\n</span><span class="s1">export type Release = {</span><span class="s3">\n  </span><span class="s1">version: string;</span><span class="s3">\n  </span><span class="s1">changelogUrl: string;</span><span class="s3">\n  </span><span class="s1">diffUrl: string;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Checks via GitHub API if there is a newer stable React Native release and,</span><span class="s3">\n </span><span class="s1">* if it exists, returns the release data.</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">* If the latest release is not newer or if it's a prerelease, the function</span><span class="s3">\n </span><span class="s1">* will return undefined.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export default async function getLatestRelease(</span><span class="s3">\n  </span><span class="s1">name: string,</span><span class="s3">\n  </span><span class="s1">currentVersion: string,</span><span class="s3">\n</span><span class="s1">): Promise&lt;Release | undefined&gt; {</span><span class="s3">\n  </span><span class="s1">logger.debug('Checking for a newer version of React Native');</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">logger.debug(`Current version: ${currentVersion}`);</span><span class="s3">\n\n    </span><span class="s1">// if the version is a 1000.0.0 version or 0.0.0, we want to bail</span><span class="s3">\n    </span><span class="s1">// since they are nightlies or unreleased versions</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">currentVersion.includes('1000.0.0') ||</span><span class="s3">\n      </span><span class="s1">currentVersion.includes('0.0.0')</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">return;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const cachedLatest = cacheManager.get(name, 'latestVersion');</span><span class="s3">\n\n    </span><span class="s1">if (cachedLatest) {</span><span class="s3">\n      </span><span class="s1">logger.debug(`Cached release version: ${cachedLatest}`);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const aWeek = 7 * 24 * 60 * 60 * 1000;</span><span class="s3">\n    </span><span class="s1">const lastChecked = cacheManager.get(name, 'lastChecked');</span><span class="s3">\n    </span><span class="s1">const now = new Date();</span><span class="s3">\n    </span><span class="s1">if (lastChecked &amp;&amp; Number(now) - Number(new Date(lastChecked)) &lt; aWeek) {</span><span class="s3">\n      </span><span class="s1">logger.debug('Cached release is still recent, skipping remote check');</span><span class="s3">\n      </span><span class="s1">return;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">logger.debug('Checking for newer releases on GitHub');</span><span class="s3">\n    </span><span class="s1">const eTag = cacheManager.get(name, 'eTag');</span><span class="s3">\n    </span><span class="s1">const latestVersion = await getLatestRnDiffPurgeVersion(name, eTag);</span><span class="s3">\n    </span><span class="s1">logger.debug(`Latest release: ${latestVersion}`);</span><span class="s3">\n\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">semver.compare(latestVersion, currentVersion) === 1 &amp;&amp;</span><span class="s3">\n      </span><span class="s1">!semver.prerelease(latestVersion)</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">version: latestVersion,</span><span class="s3">\n        </span><span class="s1">changelogUrl: buildChangelogUrl(latestVersion),</span><span class="s3">\n        </span><span class="s1">diffUrl: buildDiffUrl(currentVersion),</span><span class="s3">\n      </span><span class="s1">};</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} catch (e) {</span><span class="s3">\n    </span><span class="s1">logger.debug(</span><span class="s3">\n      </span><span class="s1">'Something went wrong with remote version checking, moving on',</span><span class="s3">\n    </span><span class="s1">);</span><span class="s3">\n    </span><span class="s1">logger.debug(e as any);</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return undefined;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function buildChangelogUrl(version: string) {</span><span class="s3">\n  </span><span class="s1">return `https://github.com/facebook/react-native/releases/tag/v${version}`;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function buildDiffUrl(version: string) {</span><span class="s3">\n  </span><span class="s1">return `https://react-native-community.github.io/upgrade-helper/?from=${version}`;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Returns the most recent React Native version available to upgrade to.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">async function getLatestRnDiffPurgeVersion(</span><span class="s3">\n  </span><span class="s1">name: string,</span><span class="s3">\n  </span><span class="s1">eTag?: string,</span><span class="s3">\n</span><span class="s1">): Promise&lt;string&gt; {</span><span class="s3">\n  </span><span class="s1">const options = {</span><span class="s3">\n    </span><span class="s1">// https://developer.github.com/v3/#user-agent-required</span><span class="s3">\n    </span><span class="s1">headers: {'User-Agent': 'React-Native-CLI'} as Headers,</span><span class="s3">\n  </span><span class="s1">};</span><span class="s3">\n\n  </span><span class="s1">if (eTag) {</span><span class="s3">\n    </span><span class="s1">options.headers['If-None-Match'] = eTag;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const {data, status, headers} = await fetch(</span><span class="s3">\n    </span><span class="s1">'https://api.github.com/repos/react-native-community/rn-diff-purge/tags',</span><span class="s3">\n    </span><span class="s1">options,</span><span class="s3">\n  </span><span class="s1">);</span><span class="s3">\n\n  </span><span class="s1">// Remote is newer.</span><span class="s3">\n  </span><span class="s1">if (status === 200) {</span><span class="s3">\n    </span><span class="s1">const body: Array&lt;any&gt; = data;</span><span class="s3">\n    </span><span class="s1">const latestVersion = body[0].name.substring(8);</span><span class="s3">\n    </span><span class="s1">const eTagHeader = headers.get('eTag');</span><span class="s3">\n\n    </span><span class="s1">// Update cache only if newer release is stable.</span><span class="s3">\n    </span><span class="s1">if (!semver.prerelease(latestVersion) &amp;&amp; eTagHeader) {</span><span class="s3">\n      </span><span class="s1">logger.debug(`Saving ${eTagHeader} to cache`);</span><span class="s3">\n      </span><span class="s1">cacheManager.set(name, 'eTag', eTagHeader);</span><span class="s3">\n      </span><span class="s1">cacheManager.set(name, 'latestVersion', latestVersion);</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return latestVersion;</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// Cache is still valid.</span><span class="s3">\n  </span><span class="s1">if (status === 304) {</span><span class="s3">\n    </span><span class="s1">const latestVersion = cacheManager.get(name, 'latestVersion');</span><span class="s3">\n    </span><span class="s1">if (latestVersion) {</span><span class="s3">\n      </span><span class="s1">return latestVersion;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// Should be returned only if something went wrong.</span><span class="s3">\n  </span><span class="s1">return '0.0.0';</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type Headers = {</span><span class="s3">\n  </span><span class="s1">'User-Agent': string;</span><span class="s3">\n  </span><span class="s1">[header: string]: string;</span><span class="s3">\n</span><span class="s1">};</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">}</span></pre>
</body>
</html>