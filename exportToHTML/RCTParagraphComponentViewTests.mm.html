<html>
<head>
<title>RCTParagraphComponentViewTests.mm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #bbb529;}
.s3 { color: #6a8759;}
.s4 { color: #cc7832;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
RCTParagraphComponentViewTests.mm</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 * Copyright (c) Meta Platforms, Inc. and affiliates. 
 * 
 * This source code is licensed under the MIT license found in the 
 * LICENSE file in the root directory of this source tree. 
 */</span>

<span class="s2">#import </span><span class="s3">&lt;React/RCTParagraphComponentAccessibilityProvider.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTParagraphComponentView.h&gt;</span>

<span class="s2">#import </span><span class="s3">&lt;XCTest/XCTest.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/attributedstring/AttributedString.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/attributedstring/ParagraphAttributes.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/attributedstring/TextAttributes.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/componentregistry/ComponentDescriptorProviderRegistry.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/root/RootComponentDescriptor.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/text/ParagraphComponentDescriptor.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/text/ParagraphShadowNode.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/text/ParagraphState.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/text/RawTextComponentDescriptor.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/text/RawTextShadowNode.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/text/TextComponentDescriptor.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/text/TextShadowNode.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/components/view/ViewComponentDescriptor.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/element/ComponentBuilder.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/element/Element.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/element/testUtils.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/textlayoutmanager/RCTTextLayoutManager.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;react/renderer/textlayoutmanager/TextLayoutManager.h&gt;</span>

<span class="s4">@interface </span><span class="s1">RCTParagraphComponentAccessibilityProviderTests : XCTestCase</span>

<span class="s4">@end</span>

<span class="s4">using namespace </span><span class="s1">facebook::react</span><span class="s4">;</span>

<span class="s0">//┌──    RootShadowNode    ─────────────────────────────┐</span>
<span class="s0">//│                                                     │</span>
<span class="s0">//│┌─── ParagraphShadowNodeA ─────────────────────────┐ │</span>
<span class="s0">//││ ┌─AA(AAA) ─────────┐ ┌─AB(ABA) ─┐ ┌─AC(ACA)────┐ │ │</span>
<span class="s0">//││ │ Please check out │ │ Facebook │ │    and     │ │ │</span>
<span class="s0">//││ └──────────────────┘ └──────────┘ └────────────┘ │ │</span>
<span class="s0">//││ ┌─AD(ADA) ──┐ ┌──AE(AEA) ──────────────────────┐ │ │</span>
<span class="s0">//││ │ Instagram │ │    for a full description.     │ │ │</span>
<span class="s0">//││ └───────────┘ └────────────────────────────────┘ │ │</span>
<span class="s0">//│└──────────────────────────────────────────────────┘ │</span>
<span class="s0">//│                                                     │</span>
<span class="s0">//│                                                     │</span>
<span class="s0">//│┌── ParagraphShadowNodeB ──────────────────────────┐ │</span>
<span class="s0">//││ ┌───BA(BAA) ───────────────────────────────────┐ │ │</span>
<span class="s0">//││ │   Lorem ipsum dolor sit amet, consectetur    │ │ │</span>
<span class="s0">//││ │ adipiscing elit. Maecenas ut risus et sapien │ │ │</span>
<span class="s0">//││ │   bibendum volutpat. Nulla facilisi. Cras    │ │ │</span>
<span class="s0">//││ │         imperdiet gravida tincidunt.         │ │ │</span>
<span class="s0">//││ └──────────────────────────────────────────────┘ │ │</span>
<span class="s0">//││ ┌─BB(BBA) ─────────────────────────────────────┐ │ │</span>
<span class="s0">//││ │  In tempor, tellus et vestibulum venenatis,  │ │ │</span>
<span class="s0">//││ │  lorem nunc eleifend lectus, a consectetur   │ │ │</span>
<span class="s0">//││ │             magna augue at arcu.             │ │ │</span>
<span class="s0">//││ └──────────────────────────────────────────────┘ │ │</span>
<span class="s0">//│└──────────────────────────────────────────────────┘ │</span>
<span class="s0">//│                                                     │</span>
<span class="s0">//│┌── ParagraphShadowNodeC ──────────────────────────┐ │</span>
<span class="s0">//││  ┌─CA(CAA) ────────┐                             │ │</span>
<span class="s0">//││  │   Lorem ipsum   │                             │ │</span>
<span class="s0">//││  └─────────────────┘                             │ │</span>
<span class="s0">//││ ┌─CB(CBA) ─────────────────────────────────────┐ │ │</span>
<span class="s0">//││ │ dolor sit amet, consectetur adipiscing elit. │ │ │</span>
<span class="s0">//││ │Maecenas ut risus et sapien bibendum volutpat.│ │ │</span>
<span class="s0">//││ │    Nulla facilisi. Cras imperdiet gravida    │ │ │</span>
<span class="s0">//││ │  tincidunt. In tempor, tellus et vestibulum  │ │ │</span>
<span class="s0">//││ │   venenatis, lorem nunc eleifend lectus, a   │ │ │</span>
<span class="s0">//││ │       consectetur magna augue at arcu.       │ │ │</span>
<span class="s0">//││ └──────────────────────────────────────────────┘ │ │</span>
<span class="s0">//││ ┌─CC(CCA) ────────┐                              │ │</span>
<span class="s0">//││ │    See Less     │                              │ │</span>
<span class="s0">//││ └─────────────────┘                              │ │</span>
<span class="s0">//│└──────────────────────────────────────────────────┘ │</span>
<span class="s0">//│                                                     │</span>
<span class="s0">//└─────────────────────────────────────────────────────┘</span>

<span class="s4">@implementation </span><span class="s1">RCTParagraphComponentAccessibilityProviderTests {</span>
  <span class="s1">std::shared_ptr&lt;ComponentBuilder&gt; builder_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RootShadowNode&gt; rootShadowNode_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;ParagraphShadowNode&gt; ParagrahShadowNodeA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;ParagraphShadowNode&gt; ParagrahShadowNodeB_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;ParagraphShadowNode&gt; ParagrahShadowNodeC_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeAA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeAB_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeAC_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeAD_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeAE_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeBA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeBB_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeCA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeCB_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;TextShadowNode&gt; TextShadowNodeCC_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeAAA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeABA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeACA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeADA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeAEA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeBAA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeBBA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeCAA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeCBA_</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;RawTextShadowNode&gt; RawTextShadowNodeCCA_</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)setUp</span>
<span class="s1">{</span>
  <span class="s1">[super setUp]</span><span class="s4">;</span>
  <span class="s1">builder_ = std::make_shared&lt;ComponentBuilder&gt;((simpleComponentBuilder()))</span><span class="s4">;</span>
  <span class="s4">auto </span><span class="s1">element =</span>
      <span class="s1">Element&lt;RootShadowNode&gt;()</span>
          <span class="s1">.reference(rootShadowNode_)</span>
          <span class="s1">.tag(</span><span class="s5">1</span><span class="s1">)</span>
          <span class="s1">.props([] {</span>
            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RootProps&gt;()</span><span class="s4">;</span>
            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
            <span class="s1">props.layoutConstraints = LayoutConstraints{{</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s1">}</span><span class="s4">, </span><span class="s1">{</span><span class="s5">500</span><span class="s4">, </span><span class="s5">500</span><span class="s1">}}</span><span class="s4">;</span>
            <span class="s4">auto </span><span class="s1">&amp;yogaStyle = props.yogaStyle</span><span class="s4">;</span>
            <span class="s1">yogaStyle.dimensions()[YGDimensionWidth] = YGValue{</span><span class="s5">200</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
            <span class="s1">yogaStyle.dimensions()[YGDimensionHeight] = YGValue{</span><span class="s5">200</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
          <span class="s1">})</span>
          <span class="s1">.children({</span>
              <span class="s1">Element&lt;ParagraphShadowNode&gt;()</span>
                  <span class="s1">.reference(ParagrahShadowNodeA_)</span>
                  <span class="s1">.props([] {</span>
                    <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;ParagraphProps&gt;()</span><span class="s4">;</span>
                    <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                    <span class="s1">props.accessible = </span><span class="s4">true;</span>
                    <span class="s4">auto </span><span class="s1">&amp;yogaStyle = props.yogaStyle</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.positionType() = YGPositionTypeAbsolute</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.position()[YGEdgeLeft] = YGValue{</span><span class="s5">0</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.position()[YGEdgeTop] = YGValue{</span><span class="s5">0</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.dimensions()[YGDimensionWidth] = YGValue{</span><span class="s5">200</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.dimensions()[YGDimensionHeight] = YGValue{</span><span class="s5">20</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                  <span class="s1">})</span>
                  <span class="s1">.children({</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeAA_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeAAA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text = </span><span class="s3">&quot;Please check out &quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeAB_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.textAttributes.accessibilityRole = AccessibilityRole::Link</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeABA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text = </span><span class="s3">&quot;facebook&quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeAC_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeACA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text = </span><span class="s3">&quot; and &quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeAD_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.textAttributes.accessibilityRole = AccessibilityRole::Link</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeADA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text = </span><span class="s3">&quot;instagram&quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeAE_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeAEA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text = </span><span class="s3">&quot; for a full description.&quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                  <span class="s1">})</span><span class="s4">,</span>
              <span class="s1">Element&lt;ParagraphShadowNode&gt;()</span>
                  <span class="s1">.reference(ParagrahShadowNodeB_)</span>
                  <span class="s1">.props([] {</span>
                    <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;ParagraphProps&gt;()</span><span class="s4">;</span>
                    <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                    <span class="s1">props.accessible = </span><span class="s4">true;</span>
                    <span class="s4">auto </span><span class="s1">&amp;yogaStyle = props.yogaStyle</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.positionType() = YGPositionTypeAbsolute</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.position()[YGEdgeLeft] = YGValue{</span><span class="s5">0</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.position()[YGEdgeTop] = YGValue{</span><span class="s5">30</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.dimensions()[YGDimensionWidth] = YGValue{</span><span class="s5">200</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.dimensions()[YGDimensionHeight] = YGValue{</span><span class="s5">50</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                  <span class="s1">})</span>
                  <span class="s1">.children({</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeBA_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.textAttributes.accessibilityRole = AccessibilityRole::Link</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeBAA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text =</span>
                                <span class="s3">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ut risus et sapien bibendum volutpat. Nulla facilisi. Cras imperdiet gravida tincidunt. &quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeBB_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeBBA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text =</span>
                                <span class="s3">&quot;In tempor, tellus et vestibulum venenatis, lorem nunc eleifend lectus, a consectetur magna augue at arcu.&quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                  <span class="s1">})</span><span class="s4">,</span>
              <span class="s1">Element&lt;ParagraphShadowNode&gt;()</span>
                  <span class="s1">.reference(ParagrahShadowNodeC_)</span>
                  <span class="s1">.props([] {</span>
                    <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;ParagraphProps&gt;()</span><span class="s4">;</span>
                    <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                    <span class="s1">props.accessible = </span><span class="s4">true;</span>
                    <span class="s4">auto </span><span class="s1">&amp;yogaStyle = props.yogaStyle</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.positionType() = YGPositionTypeAbsolute</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.position()[YGEdgeLeft] = YGValue{</span><span class="s5">0</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.position()[YGEdgeTop] = YGValue{</span><span class="s5">90</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.dimensions()[YGDimensionWidth] = YGValue{</span><span class="s5">200</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s1">yogaStyle.dimensions()[YGDimensionHeight] = YGValue{</span><span class="s5">50</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                    <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                  <span class="s1">})</span>
                  <span class="s1">.children({</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeCA_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.textAttributes.accessibilityRole = AccessibilityRole::Link</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeCAA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text = </span><span class="s3">&quot;Lorem ipsum&quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeCB_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeCBA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text =</span>
                                <span class="s3">&quot; dolor sit amet, consectetur adipiscing elit. Maecenas ut risus et sapien bibendum volutpat. Nulla facilisi. Cras imperdiet gravida tincidunt. In tempor, tellus et vestibulum venenatis, lorem nunc eleifend lectus, a consectetur magna augue at arcu. &quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                      <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                          <span class="s1">.reference(TextShadowNodeCC_)</span>
                          <span class="s1">.props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.textAttributes.accessibilityRole = AccessibilityRole::Button</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})</span>
                          <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeCCA_).props([] {</span>
                            <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                            <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                            <span class="s1">props.text = </span><span class="s3">&quot;See Less&quot;</span><span class="s4">;</span>
                            <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                          <span class="s1">})})</span><span class="s4">,</span>
                  <span class="s1">})</span><span class="s4">,</span>
          <span class="s1">})</span><span class="s4">;</span>
  <span class="s1">builder_-&gt;build(element)</span><span class="s4">;</span>
  <span class="s1">rootShadowNode_-&gt;layoutIfNeeded()</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">static </span><span class="s1">ParagraphShadowNode::ConcreteState::Shared stateWithShadowNode(</span>
    <span class="s1">std::shared_ptr&lt;ParagraphShadowNode&gt; paragraphShadowNode)</span>
<span class="s1">{</span>
  <span class="s4">auto </span><span class="s1">sharedState =</span>
      <span class="s1">std::static_pointer_cast&lt;ParagraphShadowNode::ConcreteState </span><span class="s4">const</span><span class="s1">&gt;(paragraphShadowNode-&gt;getState())</span><span class="s4">;</span>
  <span class="s4">return </span><span class="s1">sharedState</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)testAttributedString</span>
<span class="s1">{</span>
  <span class="s1">ParagraphShadowNode::ConcreteState::Shared _stateA = stateWithShadowNode(ParagrahShadowNodeA_)</span><span class="s4">;</span>
  <span class="s1">RCTParagraphComponentView *paragraphComponentViewA = [RCTParagraphComponentView </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentViewA updateProps:ParagrahShadowNodeA_-&gt;getProps() oldProps:</span><span class="s4">nullptr</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentViewA updateState:_stateA oldState:nil]</span><span class="s4">;</span>

  <span class="s1">ParagraphShadowNode::ConcreteState::Shared _stateB = stateWithShadowNode(ParagrahShadowNodeB_)</span><span class="s4">;</span>
  <span class="s1">RCTParagraphComponentView *paragraphComponentViewB = [RCTParagraphComponentView </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentViewB updateProps:ParagrahShadowNodeB_-&gt;getProps() oldProps:</span><span class="s4">nullptr</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentViewB updateState:_stateB oldState:nil]</span><span class="s4">;</span>

  <span class="s1">ParagraphShadowNode::ConcreteState::Shared _stateC = stateWithShadowNode(ParagrahShadowNodeC_)</span><span class="s4">;</span>
  <span class="s1">RCTParagraphComponentView *paragraphComponentViewC = [RCTParagraphComponentView </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentViewC updateProps:ParagrahShadowNodeC_-&gt;getProps() oldProps:</span><span class="s4">nullptr</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentViewC updateState:_stateC oldState:nil]</span><span class="s4">;</span>

  <span class="s0">// Check the correctness of attributedString</span>
  <span class="s1">XCTAssert([[paragraphComponentViewA.attributedText string]</span>
      <span class="s1">isEqual:</span><span class="s4">@</span><span class="s3">&quot;Please check out facebook and instagram for a full description.&quot;</span><span class="s1">])</span><span class="s4">;</span>
  <span class="s1">XCTAssertEqual(_stateA-&gt;getData().attributedString.getFragments().size()</span><span class="s4">, </span><span class="s5">5</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">XCTAssert([[paragraphComponentViewB.attributedText string]</span>
      <span class="s1">isEqual:</span>
          <span class="s4">@</span><span class="s3">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ut risus et sapien bibendum volutpat. Nulla facilisi. Cras imperdiet gravida tincidunt. In tempor, tellus et vestibulum venenatis, lorem nunc eleifend lectus, a consectetur magna augue at arcu.&quot;</span><span class="s1">])</span><span class="s4">;</span>
  <span class="s1">XCTAssertEqual(_stateB-&gt;getData().attributedString.getFragments().size()</span><span class="s4">, </span><span class="s5">2</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">XCTAssert([[paragraphComponentViewC.attributedText string]</span>
      <span class="s1">isEqual:</span>
          <span class="s4">@</span><span class="s3">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ut risus et sapien bibendum volutpat. Nulla facilisi. Cras imperdiet gravida tincidunt. In tempor, tellus et vestibulum venenatis, lorem nunc eleifend lectus, a consectetur magna augue at arcu. See Less&quot;</span><span class="s1">])</span><span class="s4">;</span>
  <span class="s1">XCTAssertEqual(_stateC-&gt;getData().attributedString.getFragments().size()</span><span class="s4">, </span><span class="s5">3</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#pragma </span><span class="s1">mark - Accessibility</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)testAccessibilityMultipleLinks</span>
<span class="s1">{</span>
  <span class="s0">// initialize the paragraphComponentView to get the accessibilityElements</span>
  <span class="s1">ParagraphShadowNode::ConcreteState::Shared _state = stateWithShadowNode(ParagrahShadowNodeA_)</span><span class="s4">;</span>
  <span class="s1">RCTParagraphComponentView *paragraphComponentView = [RCTParagraphComponentView </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentView updateProps:ParagrahShadowNodeA_-&gt;getProps() oldProps:</span><span class="s4">nullptr</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentView updateState:_state oldState:nil]</span><span class="s4">;</span>

  <span class="s1">NSArray&lt;UIAccessibilityElement *&gt; *elements = [paragraphComponentView accessibilityElements]</span><span class="s4">;</span>

  <span class="s0">// check the number of accessibilityElements</span>
  <span class="s1">XCTAssert(</span>
      <span class="s1">elements.count == </span><span class="s5">3</span><span class="s4">, @</span><span class="s3">&quot;Expected 4 accessibilityElements - one for the whole string, and the rest for the links&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s0">// check accessibility trait</span>
  <span class="s1">XCTAssert(</span>
      <span class="s1">elements[</span><span class="s5">1</span><span class="s1">].accessibilityTraits &amp; UIAccessibilityTraitLink</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;Expected the second accessibilityElement has link trait&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">XCTAssert(</span>
      <span class="s1">elements[</span><span class="s5">2</span><span class="s1">].accessibilityTraits &amp; UIAccessibilityTraitLink</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;Expected the second accessibilityElement has link trait&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)testAccessibilityLinkWrappingMultipleLines</span>
<span class="s1">{</span>
  <span class="s1">ParagraphShadowNode::ConcreteState::Shared _state = stateWithShadowNode(ParagrahShadowNodeB_)</span><span class="s4">;</span>
  <span class="s1">RCTParagraphComponentView *paragraphComponentView = [RCTParagraphComponentView </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentView updateProps:ParagrahShadowNodeB_-&gt;getProps() oldProps:</span><span class="s4">nullptr</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentView updateState:_state oldState:nil]</span><span class="s4">;</span>

  <span class="s1">NSArray&lt;UIAccessibilityElement *&gt; *elements = [paragraphComponentView accessibilityElements]</span><span class="s4">;</span>
  <span class="s1">XCTAssert(elements.count == </span><span class="s5">2</span><span class="s4">, @</span><span class="s3">&quot;Expected 2 accessibilityElements - one for the whole string, and one for the link&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">XCTAssert(</span>
      <span class="s1">elements[</span><span class="s5">1</span><span class="s1">].accessibilityTraits &amp; UIAccessibilityTraitLink</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;Expected the second accessibilityElement has link trait&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)testAccessibilityTruncatedText</span>
<span class="s1">{</span>
  <span class="s1">ParagraphShadowNode::ConcreteState::Shared _state = stateWithShadowNode(ParagrahShadowNodeC_)</span><span class="s4">;</span>
  <span class="s1">RCTParagraphComponentView *paragraphComponentView = [RCTParagraphComponentView </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentView updateProps:ParagrahShadowNodeC_-&gt;getProps() oldProps:</span><span class="s4">nullptr</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentView updateState:_state oldState:nil]</span><span class="s4">;</span>

  <span class="s1">NSArray&lt;UIAccessibilityElement *&gt; *elements = [paragraphComponentView accessibilityElements]</span><span class="s4">;</span>
  <span class="s1">XCTAssert(elements.count == </span><span class="s5">2</span><span class="s4">, @</span><span class="s3">&quot;Expected 2 accessibilityElements - one for the whole string, and one for the link&quot;</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">XCTAssert(</span>
      <span class="s1">elements[</span><span class="s5">1</span><span class="s1">].accessibilityTraits &amp; UIAccessibilityTraitLink</span><span class="s4">,</span>
      <span class="s4">@</span><span class="s3">&quot;Expected the second accessibilityElement has link trait&quot;</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)testEntireParagraphLink</span>
<span class="s1">{</span>
  <span class="s1">std::shared_ptr&lt;RootShadowNode&gt; rootShadowNode</span><span class="s4">;</span>
  <span class="s1">std::shared_ptr&lt;ParagraphShadowNode&gt; paragrahShadowNode</span><span class="s4">;</span>

  <span class="s4">auto </span><span class="s1">element = Element&lt;RootShadowNode&gt;()</span>
                     <span class="s1">.reference(rootShadowNode)</span>
                     <span class="s1">.tag(</span><span class="s5">1</span><span class="s1">)</span>
                     <span class="s1">.props([] {</span>
                       <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RootProps&gt;()</span><span class="s4">;</span>
                       <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                       <span class="s1">props.layoutConstraints = LayoutConstraints{{</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s1">}</span><span class="s4">, </span><span class="s1">{</span><span class="s5">500</span><span class="s4">, </span><span class="s5">500</span><span class="s1">}}</span><span class="s4">;</span>
                       <span class="s4">auto </span><span class="s1">&amp;yogaStyle = props.yogaStyle</span><span class="s4">;</span>
                       <span class="s1">yogaStyle.dimensions()[YGDimensionWidth] = YGValue{</span><span class="s5">200</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                       <span class="s1">yogaStyle.dimensions()[YGDimensionHeight] = YGValue{</span><span class="s5">200</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                       <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                     <span class="s1">})</span>
                     <span class="s1">.children({</span>
                         <span class="s1">Element&lt;ParagraphShadowNode&gt;()</span>
                             <span class="s1">.reference(paragrahShadowNode)</span>
                             <span class="s1">.props([] {</span>
                               <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;ParagraphProps&gt;()</span><span class="s4">;</span>
                               <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                               <span class="s1">props.accessible = </span><span class="s4">true;</span>
                               <span class="s1">props.accessibilityTraits = AccessibilityTraits::Link</span><span class="s4">;</span>
                               <span class="s4">auto </span><span class="s1">&amp;yogaStyle = props.yogaStyle</span><span class="s4">;</span>
                               <span class="s1">yogaStyle.positionType() = YGPositionTypeAbsolute</span><span class="s4">;</span>
                               <span class="s1">yogaStyle.position()[YGEdgeLeft] = YGValue{</span><span class="s5">0</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                               <span class="s1">yogaStyle.position()[YGEdgeTop] = YGValue{</span><span class="s5">0</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                               <span class="s1">yogaStyle.dimensions()[YGDimensionWidth] = YGValue{</span><span class="s5">200</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                               <span class="s1">yogaStyle.dimensions()[YGDimensionHeight] = YGValue{</span><span class="s5">20</span><span class="s4">, </span><span class="s1">YGUnitPoint}</span><span class="s4">;</span>
                               <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                             <span class="s1">})</span>
                             <span class="s1">.children({</span>
                                 <span class="s1">Element&lt;TextShadowNode&gt;()</span>
                                     <span class="s1">.props([] {</span>
                                       <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;TextProps&gt;()</span><span class="s4">;</span>
                                       <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                                       <span class="s1">props.textAttributes.accessibilityRole = AccessibilityRole::Link</span><span class="s4">;</span>
                                       <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                                     <span class="s1">})</span>
                                     <span class="s1">.children({Element&lt;RawTextShadowNode&gt;().reference(RawTextShadowNodeABA_).props([] {</span>
                                       <span class="s4">auto </span><span class="s1">sharedProps = std::make_shared&lt;RawTextProps&gt;()</span><span class="s4">;</span>
                                       <span class="s4">auto </span><span class="s1">&amp;props = *sharedProps</span><span class="s4">;</span>
                                       <span class="s1">props.text = </span><span class="s3">&quot;A long text that happens to be a link&quot;</span><span class="s4">;</span>
                                       <span class="s4">return </span><span class="s1">sharedProps</span><span class="s4">;</span>
                                     <span class="s1">})})</span><span class="s4">,</span>
                             <span class="s1">})</span><span class="s4">,</span>
                     <span class="s1">})</span><span class="s4">;</span>

  <span class="s1">builder_-&gt;build(element)</span><span class="s4">;</span>
  <span class="s1">rootShadowNode-&gt;layoutIfNeeded()</span><span class="s4">;</span>

  <span class="s1">ParagraphShadowNode::ConcreteState::Shared _state = stateWithShadowNode(paragrahShadowNode)</span><span class="s4">;</span>
  <span class="s1">RCTParagraphComponentView *paragraphComponentView = [RCTParagraphComponentView </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentView updateProps:paragrahShadowNode-&gt;getProps() oldProps:</span><span class="s4">nullptr</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">[paragraphComponentView updateState:_state oldState:nil]</span><span class="s4">;</span>

  <span class="s1">NSArray&lt;UIAccessibilityElement *&gt; *elements = paragraphComponentView.accessibilityElements</span><span class="s4">;</span>
  <span class="s1">XCTAssertEqual(elements.count</span><span class="s4">, </span><span class="s5">1</span><span class="s1">)</span><span class="s4">;</span>
  <span class="s1">XCTAssertTrue(elements[</span><span class="s5">0</span><span class="s1">].accessibilityTraits &amp; UIAccessibilityTraitLink)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">@end</span>
</pre>
</body>
</html>