<html>
<head>
<title>RCTPerfMonitor.mm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #bbb529;}
.s3 { color: #6a8759;}
.s4 { color: #cc7832;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
RCTPerfMonitor.mm</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 * Copyright (c) Meta Platforms, Inc. and affiliates. 
 * 
 * This source code is licensed under the MIT license found in the 
 * LICENSE file in the root directory of this source tree. 
 */</span>

<span class="s2">#import </span><span class="s3">&lt;React/RCTDefines.h&gt;</span>

<span class="s2">#import </span><span class="s3">&quot;CoreModulesPlugins.h&quot;</span>

<span class="s2">#if </span><span class="s1">RCT_DEV</span>

<span class="s2">#import </span><span class="s3">&lt;dlfcn.h&gt;</span>

<span class="s2">#import </span><span class="s3">&lt;mach/mach.h&gt;</span>

<span class="s2">#import </span><span class="s3">&lt;React/RCTDevSettings.h&gt;</span>

<span class="s2">#import </span><span class="s3">&lt;React/RCTBridge+Private.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTBridge.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTFPSGraph.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTInitializing.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTInvalidating.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTJavaScriptExecutor.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTPerformanceLogger.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTPerformanceLoggerLabels.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTRootView.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTUIManager.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTUtils.h&gt;</span>
<span class="s2">#import </span><span class="s3">&lt;ReactCommon/RCTTurboModule.h&gt;</span>

<span class="s2">#if </span><span class="s1">__has_include(&lt;React/RCTDevMenu.h&gt;)</span>
<span class="s2">#import </span><span class="s3">&lt;React/RCTDevMenu.h&gt;</span>
<span class="s2">#endif</span>

<span class="s4">static </span><span class="s1">NSString *</span><span class="s4">const </span><span class="s1">RCTPerfMonitorCellIdentifier = </span><span class="s4">@</span><span class="s3">&quot;RCTPerfMonitorCellIdentifier&quot;</span><span class="s4">;</span>

<span class="s4">static </span><span class="s1">CGFloat </span><span class="s4">const </span><span class="s1">RCTPerfMonitorBarHeight = </span><span class="s5">50</span><span class="s4">;</span>
<span class="s4">static </span><span class="s1">CGFloat </span><span class="s4">const </span><span class="s1">RCTPerfMonitorExpandHeight = </span><span class="s5">250</span><span class="s4">;</span>

<span class="s4">typedef </span><span class="s1">BOOL (*RCTJSCSetOptionType)(</span><span class="s4">const char </span><span class="s1">*)</span><span class="s4">;</span>

<span class="s1">NSArray&lt;NSString *&gt; *LabelsForRCTPerformanceLoggerTags()</span><span class="s4">;</span>

<span class="s4">static </span><span class="s1">BOOL RCTJSCSetOption(</span><span class="s4">const char </span><span class="s1">*option)</span>
<span class="s1">{</span>
  <span class="s4">static </span><span class="s1">RCTJSCSetOptionType setOption</span><span class="s4">;</span>
  <span class="s4">static </span><span class="s1">dispatch_once_t onceToken</span><span class="s4">;</span>

  <span class="s0">// As of iOS 13.4, it is no longer possible to change the JavaScriptCore</span>
  <span class="s0">// options at runtime. The options are protected and will cause an</span>
  <span class="s0">// exception when you try to change them after the VM has been initialized.</span>
  <span class="s0">// https://github.com/facebook/react-native/issues/28414</span>
  <span class="s4">if </span><span class="s1">(</span><span class="s4">@available</span><span class="s1">(iOS </span><span class="s5">13.4</span><span class="s4">, </span><span class="s1">*)) {</span>
    <span class="s4">return </span><span class="s1">NO</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s1">dispatch_once(&amp;onceToken</span><span class="s4">, </span><span class="s1">^{</span>
    <span class="s0">/** 
     * JSC private C++ static method to toggle options at runtime 
     * 
     * JSC::Options::setOptions - JavaScriptCore/runtime/Options.h 
     */</span>
    <span class="s1">setOption = </span><span class="s4">reinterpret_cast</span><span class="s1">&lt;RCTJSCSetOptionType&gt;(dlsym(RTLD_DEFAULT</span><span class="s4">, </span><span class="s3">&quot;_ZN3JSC7Options9setOptionEPKc&quot;</span><span class="s1">))</span><span class="s4">;</span>

    <span class="s4">if </span><span class="s1">(RCT_DEBUG &amp;&amp; setOption == NULL) {</span>
      <span class="s1">RCTLogWarn(</span><span class="s4">@</span><span class="s3">&quot;The symbol used to enable JSC runtime options is not available in this iOS version&quot;</span><span class="s1">)</span><span class="s4">;</span>
    <span class="s1">}</span>
  <span class="s1">})</span><span class="s4">;</span>

  <span class="s4">if </span><span class="s1">(setOption) {</span>
    <span class="s4">return </span><span class="s1">setOption(option)</span><span class="s4">;</span>
  <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
    <span class="s4">return </span><span class="s1">NO</span><span class="s4">;</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s4">static </span><span class="s1">vm_size_t RCTGetResidentMemorySize(</span><span class="s4">void</span><span class="s1">)</span>
<span class="s1">{</span>
  <span class="s1">vm_size_t memoryUsageInByte = </span><span class="s5">0</span><span class="s4">;</span>
  <span class="s1">task_vm_info_data_t vmInfo</span><span class="s4">;</span>
  <span class="s1">mach_msg_type_number_t count = TASK_VM_INFO_COUNT</span><span class="s4">;</span>
  <span class="s1">kern_return_t kernelReturn = task_info(mach_task_self()</span><span class="s4">, </span><span class="s1">TASK_VM_INFO</span><span class="s4">, </span><span class="s1">(task_info_t)&amp;vmInfo</span><span class="s4">, </span><span class="s1">&amp;count)</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(kernelReturn == KERN_SUCCESS) {</span>
    <span class="s1">memoryUsageInByte = (vm_size_t)vmInfo.phys_footprint</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">return </span><span class="s1">memoryUsageInByte</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">@interface </span><span class="s1">RCTPerfMonitor : NSObject &lt;</span>
                                <span class="s1">RCTBridgeModule</span><span class="s4">,</span>
                                <span class="s1">RCTTurboModule</span><span class="s4">,</span>
                                <span class="s1">RCTInitializing</span><span class="s4">,</span>
                                <span class="s1">RCTInvalidating</span><span class="s4">,</span>
                                <span class="s1">UITableViewDataSource</span><span class="s4">,</span>
                                <span class="s1">UITableViewDelegate&gt;</span>

<span class="s2">#if </span><span class="s1">__has_include(&lt;React/RCTDevMenu.h&gt;)</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) RCTDevMenuItem *devMenuItem</span><span class="s4">;</span>
<span class="s2">#endif</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) UIPanGestureRecognizer *gestureRecognizer</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) UIView *container</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) UILabel *memory</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) UILabel *heap</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) UILabel *views</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) UITableView *metrics</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) RCTFPSGraph *jsGraph</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) RCTFPSGraph *uiGraph</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) UILabel *jsGraphLabel</span><span class="s4">;</span>
<span class="s4">@property </span><span class="s1">(nonatomic</span><span class="s4">, </span><span class="s1">strong</span><span class="s4">, </span><span class="s1">readonly) UILabel *uiGraphLabel</span><span class="s4">;</span>

<span class="s4">@end</span>

<span class="s4">@implementation </span><span class="s1">RCTPerfMonitor {</span>
<span class="s2">#if </span><span class="s1">__has_include(&lt;React/RCTDevMenu.h&gt;)</span>
  <span class="s1">RCTDevMenuItem *_devMenuItem</span><span class="s4">;</span>
<span class="s2">#endif</span>
  <span class="s1">UIPanGestureRecognizer *_gestureRecognizer</span><span class="s4">;</span>
  <span class="s1">UIView *_container</span><span class="s4">;</span>
  <span class="s1">UILabel *_memory</span><span class="s4">;</span>
  <span class="s1">UILabel *_heap</span><span class="s4">;</span>
  <span class="s1">UILabel *_views</span><span class="s4">;</span>
  <span class="s1">UILabel *_uiGraphLabel</span><span class="s4">;</span>
  <span class="s1">UILabel *_jsGraphLabel</span><span class="s4">;</span>
  <span class="s1">UITableView *_metrics</span><span class="s4">;</span>

  <span class="s1">RCTFPSGraph *_uiGraph</span><span class="s4">;</span>
  <span class="s1">RCTFPSGraph *_jsGraph</span><span class="s4">;</span>

  <span class="s1">CADisplayLink *_uiDisplayLink</span><span class="s4">;</span>
  <span class="s1">CADisplayLink *_jsDisplayLink</span><span class="s4">;</span>

  <span class="s1">NSUInteger _heapSize</span><span class="s4">;</span>

  <span class="s1">dispatch_queue_t _queue</span><span class="s4">;</span>
  <span class="s1">dispatch_io_t _io</span><span class="s4">;</span>
  <span class="s4">int </span><span class="s1">_stderr</span><span class="s4">;</span>
  <span class="s4">int </span><span class="s1">_pipe[</span><span class="s5">2</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">NSString *_remaining</span><span class="s4">;</span>

  <span class="s1">CGRect _storedMonitorFrame</span><span class="s4">;</span>

  <span class="s1">NSArray *_perfLoggerMarks</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s4">@synthesize </span><span class="s1">bridge = _bridge</span><span class="s4">;</span>
<span class="s4">@synthesize </span><span class="s1">moduleRegistry = _moduleRegistry</span><span class="s4">;</span>

<span class="s1">RCT_EXPORT_MODULE()</span>

<span class="s1">+ (BOOL)requiresMainQueueSetup</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s1">YES</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (dispatch_queue_t)methodQueue</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s1">dispatch_get_main_queue()</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)initialize</span>
<span class="s1">{</span>
<span class="s2">#if </span><span class="s1">__has_include(&lt;React/RCTDevMenu.h&gt;)</span>
  <span class="s1">[(RCTDevMenu *)[_moduleRegistry moduleForName:</span><span class="s3">&quot;DevMenu&quot;</span><span class="s1">] addItem:self.devMenuItem]</span><span class="s4">;</span>
<span class="s2">#endif</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)invalidate</span>
<span class="s1">{</span>
  <span class="s1">[self hide]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#if </span><span class="s1">__has_include(&lt;React/RCTDevMenu.h&gt;)</span>
<span class="s1">- (RCTDevMenuItem *)devMenuItem</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_devMenuItem) {</span>
    <span class="s4">__weak __typeof__</span><span class="s1">(self) weakSelf = self</span><span class="s4">;</span>
    <span class="s4">__weak </span><span class="s1">RCTDevSettings *devSettings = [self-&gt;_moduleRegistry moduleForName:</span><span class="s3">&quot;DevSettings&quot;</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s4">if </span><span class="s1">(devSettings.isPerfMonitorShown) {</span>
      <span class="s1">[weakSelf show]</span><span class="s4">;</span>
    <span class="s1">}</span>
    <span class="s1">_devMenuItem = [RCTDevMenuItem</span>
        <span class="s1">buttonItemWithTitleBlock:^NSString * {</span>
          <span class="s4">return </span><span class="s1">(devSettings.isPerfMonitorShown) ? </span><span class="s4">@</span><span class="s3">&quot;Hide Perf Monitor&quot; </span><span class="s1">: </span><span class="s4">@</span><span class="s3">&quot;Show Perf Monitor&quot;</span><span class="s4">;</span>
        <span class="s1">}</span>
        <span class="s1">handler:^{</span>
          <span class="s4">if </span><span class="s1">(devSettings.isPerfMonitorShown) {</span>
            <span class="s1">[weakSelf hide]</span><span class="s4">;</span>
            <span class="s1">devSettings.isPerfMonitorShown = NO</span><span class="s4">;</span>
          <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
            <span class="s1">[weakSelf show]</span><span class="s4">;</span>
            <span class="s1">devSettings.isPerfMonitorShown = YES</span><span class="s4">;</span>
          <span class="s1">}</span>
        <span class="s1">}]</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_devMenuItem</span><span class="s4">;</span>
<span class="s1">}</span>
<span class="s2">#endif</span>

<span class="s1">- (UIPanGestureRecognizer *)gestureRecognizer</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_gestureRecognizer) {</span>
    <span class="s1">_gestureRecognizer = [[UIPanGestureRecognizer alloc] initWithTarget:self action:</span><span class="s4">@selector</span><span class="s1">(gesture:)]</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_gestureRecognizer</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (UIView *)container</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_container) {</span>
    <span class="s1">_container = [[UIView alloc] initWithFrame:CGRectMake(</span><span class="s5">10</span><span class="s4">, </span><span class="s5">25</span><span class="s4">, </span><span class="s5">180</span><span class="s4">, </span><span class="s1">RCTPerfMonitorBarHeight)]</span><span class="s4">;</span>
    <span class="s1">_container.layer.borderWidth = </span><span class="s5">2</span><span class="s4">;</span>
    <span class="s1">_container.layer.borderColor = [UIColor lightGrayColor].CGColor</span><span class="s4">;</span>
    <span class="s1">[_container addGestureRecognizer:self.gestureRecognizer]</span><span class="s4">;</span>
    <span class="s1">[_container addGestureRecognizer:[[UITapGestureRecognizer alloc] initWithTarget:self action:</span><span class="s4">@selector</span><span class="s1">(tap)]]</span><span class="s4">;</span>

    <span class="s1">_container.backgroundColor = [UIColor whiteColor]</span><span class="s4">;</span>
<span class="s2">#if </span><span class="s1">defined(__IPHONE_OS_VERSION_MAX_ALLOWED) &amp;&amp; defined(__IPHONE_13_0) &amp;&amp; \ 
    __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= __IPHONE_13_0</span>
    <span class="s4">if </span><span class="s1">(</span><span class="s4">@available</span><span class="s1">(iOS </span><span class="s5">13.0</span><span class="s4">, </span><span class="s1">*)) {</span>
      <span class="s1">_container.backgroundColor = [UIColor systemBackgroundColor]</span><span class="s4">;</span>
    <span class="s1">}</span>
<span class="s2">#endif</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_container</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (UILabel *)memory</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_memory) {</span>
    <span class="s1">_memory = [[UILabel alloc] initWithFrame:CGRectMake(</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, </span><span class="s5">44</span><span class="s4">, </span><span class="s1">RCTPerfMonitorBarHeight)]</span><span class="s4">;</span>
    <span class="s1">_memory.font = [UIFont systemFontOfSize:</span><span class="s5">12</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">_memory.numberOfLines = </span><span class="s5">3</span><span class="s4">;</span>
    <span class="s1">_memory.textAlignment = NSTextAlignmentCenter</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_memory</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (UILabel *)heap</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_heap) {</span>
    <span class="s1">_heap = [[UILabel alloc] initWithFrame:CGRectMake(</span><span class="s5">44</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, </span><span class="s5">44</span><span class="s4">, </span><span class="s1">RCTPerfMonitorBarHeight)]</span><span class="s4">;</span>
    <span class="s1">_heap.font = [UIFont systemFontOfSize:</span><span class="s5">12</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">_heap.numberOfLines = </span><span class="s5">3</span><span class="s4">;</span>
    <span class="s1">_heap.textAlignment = NSTextAlignmentCenter</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_heap</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (UILabel *)views</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_views) {</span>
    <span class="s1">_views = [[UILabel alloc] initWithFrame:CGRectMake(</span><span class="s5">88</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, </span><span class="s5">44</span><span class="s4">, </span><span class="s1">RCTPerfMonitorBarHeight)]</span><span class="s4">;</span>
    <span class="s1">_views.font = [UIFont systemFontOfSize:</span><span class="s5">12</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">_views.numberOfLines = </span><span class="s5">3</span><span class="s4">;</span>
    <span class="s1">_views.textAlignment = NSTextAlignmentCenter</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_views</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (RCTFPSGraph *)uiGraph</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_uiGraph) {</span>
    <span class="s1">_uiGraph = [[RCTFPSGraph alloc] initWithFrame:CGRectMake(</span><span class="s5">134</span><span class="s4">, </span><span class="s5">14</span><span class="s4">, </span><span class="s5">40</span><span class="s4">, </span><span class="s5">30</span><span class="s1">) color:[UIColor lightGrayColor]]</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">return </span><span class="s1">_uiGraph</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (RCTFPSGraph *)jsGraph</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_jsGraph) {</span>
    <span class="s1">_jsGraph = [[RCTFPSGraph alloc] initWithFrame:CGRectMake(</span><span class="s5">178</span><span class="s4">, </span><span class="s5">14</span><span class="s4">, </span><span class="s5">40</span><span class="s4">, </span><span class="s5">30</span><span class="s1">) color:[UIColor lightGrayColor]]</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">return </span><span class="s1">_jsGraph</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (UILabel *)uiGraphLabel</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_uiGraphLabel) {</span>
    <span class="s1">_uiGraphLabel = [[UILabel alloc] initWithFrame:CGRectMake(</span><span class="s5">134</span><span class="s4">, </span><span class="s5">3</span><span class="s4">, </span><span class="s5">40</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)]</span><span class="s4">;</span>
    <span class="s1">_uiGraphLabel.font = [UIFont systemFontOfSize:</span><span class="s5">11</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">_uiGraphLabel.textAlignment = NSTextAlignmentCenter</span><span class="s4">;</span>
    <span class="s1">_uiGraphLabel.text = </span><span class="s4">@</span><span class="s3">&quot;UI&quot;</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_uiGraphLabel</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (UILabel *)jsGraphLabel</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_jsGraphLabel) {</span>
    <span class="s1">_jsGraphLabel = [[UILabel alloc] initWithFrame:CGRectMake(</span><span class="s5">178</span><span class="s4">, </span><span class="s5">3</span><span class="s4">, </span><span class="s5">38</span><span class="s4">, </span><span class="s5">10</span><span class="s1">)]</span><span class="s4">;</span>
    <span class="s1">_jsGraphLabel.font = [UIFont systemFontOfSize:</span><span class="s5">11</span><span class="s1">]</span><span class="s4">;</span>
    <span class="s1">_jsGraphLabel.textAlignment = NSTextAlignmentCenter</span><span class="s4">;</span>
    <span class="s1">_jsGraphLabel.text = </span><span class="s4">@</span><span class="s3">&quot;JS&quot;</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_jsGraphLabel</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (UITableView *)metrics</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_metrics) {</span>
    <span class="s1">_metrics = [[UITableView alloc] initWithFrame:CGRectMake(</span>
                                                      <span class="s5">0</span><span class="s4">,</span>
                                                      <span class="s1">RCTPerfMonitorBarHeight</span><span class="s4">,</span>
                                                      <span class="s1">self.container.frame.size.width</span><span class="s4">,</span>
                                                      <span class="s1">self.container.frame.size.height - RCTPerfMonitorBarHeight)]</span><span class="s4">;</span>
    <span class="s1">_metrics.dataSource = self</span><span class="s4">;</span>
    <span class="s1">_metrics.delegate = self</span><span class="s4">;</span>
    <span class="s1">_metrics.autoresizingMask = UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleWidth</span><span class="s4">;</span>
    <span class="s1">[_metrics registerClass:[UITableViewCell </span><span class="s4">class</span><span class="s1">] forCellReuseIdentifier:RCTPerfMonitorCellIdentifier]</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s4">return </span><span class="s1">_metrics</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)show</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(_container) {</span>
    <span class="s4">return;</span>
  <span class="s1">}</span>

  <span class="s1">[self.container addSubview:self.memory]</span><span class="s4">;</span>
  <span class="s1">[self.container addSubview:self.heap]</span><span class="s4">;</span>
  <span class="s1">[self.container addSubview:self.views]</span><span class="s4">;</span>
  <span class="s1">[self.container addSubview:self.uiGraph]</span><span class="s4">;</span>
  <span class="s1">[self.container addSubview:self.uiGraphLabel]</span><span class="s4">;</span>

  <span class="s1">[self redirectLogs]</span><span class="s4">;</span>

  <span class="s1">RCTJSCSetOption(</span><span class="s3">&quot;logGC=1&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">[self updateStats]</span><span class="s4">;</span>

  <span class="s1">UIWindow *window = RCTSharedApplication().delegate.window</span><span class="s4">;</span>
  <span class="s1">[window addSubview:self.container]</span><span class="s4">;</span>

  <span class="s1">_uiDisplayLink = [CADisplayLink displayLinkWithTarget:self </span><span class="s4">selector</span><span class="s1">:</span><span class="s4">@selector</span><span class="s1">(threadUpdate:)]</span><span class="s4">;</span>
  <span class="s1">[_uiDisplayLink addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSRunLoopCommonModes]</span><span class="s4">;</span>

  <span class="s1">self.container.frame =</span>
      <span class="s1">(CGRect){self.container.frame.origin</span><span class="s4">, </span><span class="s1">{self.container.frame.size.width + </span><span class="s5">44</span><span class="s4">, </span><span class="s1">self.container.frame.size.height}}</span><span class="s4">;</span>
  <span class="s1">[self.container addSubview:self.jsGraph]</span><span class="s4">;</span>
  <span class="s1">[self.container addSubview:self.jsGraphLabel]</span><span class="s4">;</span>

  <span class="s1">[_bridge</span>
      <span class="s1">dispatchBlock:^{</span>
        <span class="s1">self-&gt;_jsDisplayLink = [CADisplayLink displayLinkWithTarget:self </span><span class="s4">selector</span><span class="s1">:</span><span class="s4">@selector</span><span class="s1">(threadUpdate:)]</span><span class="s4">;</span>
        <span class="s1">[self-&gt;_jsDisplayLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSRunLoopCommonModes]</span><span class="s4">;</span>
      <span class="s1">}</span>
              <span class="s1">queue:RCTJSThread]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)hide</span>
<span class="s1">{</span>
  <span class="s4">if </span><span class="s1">(!_container) {</span>
    <span class="s4">return;</span>
  <span class="s1">}</span>

  <span class="s1">[self.container removeFromSuperview]</span><span class="s4">;</span>
  <span class="s1">_container = nil</span><span class="s4">;</span>
  <span class="s1">_jsGraph = nil</span><span class="s4">;</span>
  <span class="s1">_uiGraph = nil</span><span class="s4">;</span>

  <span class="s1">RCTJSCSetOption(</span><span class="s3">&quot;logGC=0&quot;</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">[self stopLogs]</span><span class="s4">;</span>

  <span class="s1">[_uiDisplayLink invalidate]</span><span class="s4">;</span>
  <span class="s1">[_jsDisplayLink invalidate]</span><span class="s4">;</span>

  <span class="s1">_uiDisplayLink = nil</span><span class="s4">;</span>
  <span class="s1">_jsDisplayLink = nil</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)redirectLogs</span>
<span class="s1">{</span>
  <span class="s1">_stderr = dup(STDERR_FILENO)</span><span class="s4">;</span>

  <span class="s4">if </span><span class="s1">(pipe(_pipe) != </span><span class="s5">0</span><span class="s1">) {</span>
    <span class="s4">return;</span>
  <span class="s1">}</span>

  <span class="s1">dup2(_pipe[</span><span class="s5">1</span><span class="s1">]</span><span class="s4">, </span><span class="s1">STDERR_FILENO)</span><span class="s4">;</span>
  <span class="s1">close(_pipe[</span><span class="s5">1</span><span class="s1">])</span><span class="s4">;</span>

  <span class="s4">__weak __typeof__</span><span class="s1">(self) weakSelf = self</span><span class="s4">;</span>
  <span class="s1">_queue = dispatch_queue_create(</span><span class="s3">&quot;com.facebook.react.RCTPerfMonitor&quot;</span><span class="s4">, </span><span class="s1">DISPATCH_QUEUE_SERIAL)</span><span class="s4">;</span>
  <span class="s1">_io = dispatch_io_create(</span>
      <span class="s1">DISPATCH_IO_STREAM</span><span class="s4">,</span>
      <span class="s1">_pipe[</span><span class="s5">0</span><span class="s1">]</span><span class="s4">,</span>
      <span class="s1">_queue</span><span class="s4">,</span>
      <span class="s1">^(__unused </span><span class="s4">int </span><span class="s1">error){</span>
      <span class="s1">})</span><span class="s4">;</span>

  <span class="s1">dispatch_io_set_low_water(_io</span><span class="s4">, </span><span class="s5">20</span><span class="s1">)</span><span class="s4">;</span>

  <span class="s1">dispatch_io_read(_io</span><span class="s4">, </span><span class="s5">0</span><span class="s4">, </span><span class="s1">SIZE_MAX</span><span class="s4">, </span><span class="s1">_queue</span><span class="s4">, </span><span class="s1">^(__unused </span><span class="s4">bool </span><span class="s1">done</span><span class="s4">, </span><span class="s1">dispatch_data_t data</span><span class="s4">, </span><span class="s1">__unused </span><span class="s4">int </span><span class="s1">error) {</span>
    <span class="s4">if </span><span class="s1">(!data) {</span>
      <span class="s4">return;</span>
    <span class="s1">}</span>

    <span class="s1">dispatch_data_apply(</span>
        <span class="s1">data</span><span class="s4">, </span><span class="s1">^</span><span class="s4">bool</span><span class="s1">(__unused dispatch_data_t region</span><span class="s4">, </span><span class="s1">__unused size_t offset</span><span class="s4">, const void </span><span class="s1">*buffer</span><span class="s4">, </span><span class="s1">size_t size) {</span>
          <span class="s1">write(self-&gt;_stderr</span><span class="s4">, </span><span class="s1">buffer</span><span class="s4">, </span><span class="s1">size)</span><span class="s4">;</span>

          <span class="s1">NSString *log = [[NSString alloc] initWithBytes:buffer length:size encoding:NSUTF8StringEncoding]</span><span class="s4">;</span>
          <span class="s1">[weakSelf parse:log]</span><span class="s4">;</span>
          <span class="s4">return true;</span>
        <span class="s1">})</span><span class="s4">;</span>
  <span class="s1">})</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)stopLogs</span>
<span class="s1">{</span>
  <span class="s1">dup2(_stderr</span><span class="s4">, </span><span class="s1">STDERR_FILENO)</span><span class="s4">;</span>
  <span class="s1">dispatch_io_close(_io</span><span class="s4">, </span><span class="s5">0</span><span class="s1">)</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)parse:(NSString *)log</span>
<span class="s1">{</span>
  <span class="s4">static </span><span class="s1">NSRegularExpression *GCRegex</span><span class="s4">;</span>
  <span class="s4">static </span><span class="s1">dispatch_once_t onceToken</span><span class="s4">;</span>
  <span class="s1">dispatch_once(&amp;onceToken</span><span class="s4">, </span><span class="s1">^{</span>
    <span class="s1">NSString *pattern =</span>
        <span class="s4">@</span><span class="s3">&quot;</span><span class="s4">\\</span><span class="s3">[GC: [</span><span class="s4">\\</span><span class="s3">d</span><span class="s4">\\</span><span class="s3">.]+ </span><span class="s4">\\</span><span class="s3">wb =&gt; (Eden|Full)Collection, (?:Skipped copying|Did copy), ([</span><span class="s4">\\</span><span class="s3">d</span><span class="s4">\\</span><span class="s3">.]+) </span><span class="s4">\\</span><span class="s3">wb, [</span><span class="s4">\\</span><span class="s3">d.]+ </span><span class="s4">\\</span><span class="s3">ws</span><span class="s4">\\</span><span class="s3">]&quot;</span><span class="s4">;</span>
    <span class="s1">GCRegex = [NSRegularExpression regularExpressionWithPattern:pattern options:</span><span class="s5">0 </span><span class="s1">error:nil]</span><span class="s4">;</span>
  <span class="s1">})</span><span class="s4">;</span>

  <span class="s4">if </span><span class="s1">(_remaining) {</span>
    <span class="s1">log = [_remaining stringByAppendingString:log]</span><span class="s4">;</span>
    <span class="s1">_remaining = nil</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s1">NSArray&lt;NSString *&gt; *lines = [log componentsSeparatedByString:</span><span class="s4">@</span><span class="s3">&quot;</span><span class="s4">\n</span><span class="s3">&quot;</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(lines.count == </span><span class="s5">1</span><span class="s1">) { </span><span class="s0">// no newlines</span>
    <span class="s1">_remaining = log</span><span class="s4">;</span>
    <span class="s4">return;</span>
  <span class="s1">}</span>

  <span class="s4">for </span><span class="s1">(NSString *line in lines) {</span>
    <span class="s1">NSTextCheckingResult *match = [GCRegex firstMatchInString:line options:</span><span class="s5">0 </span><span class="s1">range:NSMakeRange(</span><span class="s5">0</span><span class="s4">, </span><span class="s1">line.length)]</span><span class="s4">;</span>
    <span class="s4">if </span><span class="s1">(match) {</span>
      <span class="s1">NSString *heapSizeStr = [line substringWithRange:[match rangeAtIndex:</span><span class="s5">2</span><span class="s1">]]</span><span class="s4">;</span>
      <span class="s1">_heapSize = [heapSizeStr integerValue]</span><span class="s4">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)updateStats</span>
<span class="s1">{</span>
  <span class="s1">NSDictionary&lt;NSNumber *</span><span class="s4">, </span><span class="s1">UIView *&gt; *views = [_bridge.uiManager valueForKey:</span><span class="s4">@</span><span class="s3">&quot;viewRegistry&quot;</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">NSUInteger viewCount = views.count</span><span class="s4">;</span>
  <span class="s1">NSUInteger visibleViewCount = </span><span class="s5">0</span><span class="s4">;</span>
  <span class="s4">for </span><span class="s1">(UIView *view in views.allValues) {</span>
    <span class="s4">if </span><span class="s1">(view.window || view.superview.window) {</span>
      <span class="s1">visibleViewCount++</span><span class="s4">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s4">double </span><span class="s1">mem = (</span><span class="s4">double</span><span class="s1">)RCTGetResidentMemorySize() / </span><span class="s5">1024 </span><span class="s1">/ </span><span class="s5">1024</span><span class="s4">;</span>
  <span class="s1">self.memory.text = [NSString stringWithFormat:</span><span class="s4">@</span><span class="s3">&quot;RAM</span><span class="s4">\n</span><span class="s3">%.2lf</span><span class="s4">\n</span><span class="s3">MB&quot;</span><span class="s4">, </span><span class="s1">mem]</span><span class="s4">;</span>
  <span class="s1">self.heap.text = [NSString stringWithFormat:</span><span class="s4">@</span><span class="s3">&quot;JSC</span><span class="s4">\n</span><span class="s3">%.2lf</span><span class="s4">\n</span><span class="s3">MB&quot;</span><span class="s4">, </span><span class="s1">(</span><span class="s4">double</span><span class="s1">)_heapSize / </span><span class="s5">1024</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">self.views.text =</span>
      <span class="s1">[NSString stringWithFormat:</span><span class="s4">@</span><span class="s3">&quot;Views</span><span class="s4">\n</span><span class="s3">%lu</span><span class="s4">\n</span><span class="s3">%lu&quot;</span><span class="s4">, </span><span class="s1">(</span><span class="s4">unsigned long</span><span class="s1">)visibleViewCount</span><span class="s4">, </span><span class="s1">(</span><span class="s4">unsigned long</span><span class="s1">)viewCount]</span><span class="s4">;</span>

  <span class="s4">__weak __typeof__</span><span class="s1">(self) weakSelf = self</span><span class="s4">;</span>
  <span class="s1">dispatch_after(dispatch_time(DISPATCH_TIME_NOW</span><span class="s4">, </span><span class="s1">(int64_t)(</span><span class="s5">1 </span><span class="s1">* NSEC_PER_SEC))</span><span class="s4">, </span><span class="s1">dispatch_get_main_queue()</span><span class="s4">, </span><span class="s1">^{</span>
    <span class="s4">__strong __typeof__</span><span class="s1">(weakSelf) strongSelf = weakSelf</span><span class="s4">;</span>
    <span class="s4">if </span><span class="s1">(strongSelf &amp;&amp; strongSelf-&gt;_container.superview) {</span>
      <span class="s1">[strongSelf updateStats]</span><span class="s4">;</span>
    <span class="s1">}</span>
  <span class="s1">})</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)gesture:(UIPanGestureRecognizer *)gestureRecognizer</span>
<span class="s1">{</span>
  <span class="s1">CGPoint translation = [gestureRecognizer translationInView:self.container.superview]</span><span class="s4">;</span>
  <span class="s1">self.container.center = CGPointMake(self.container.center.x + translation.x</span><span class="s4">, </span><span class="s1">self.container.center.y + translation.y)</span><span class="s4">;</span>
  <span class="s1">[gestureRecognizer setTranslation:CGPointMake(</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s1">) inView:self.container.superview]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)tap</span>
<span class="s1">{</span>
  <span class="s1">[self loadPerformanceLoggerData]</span><span class="s4">;</span>
  <span class="s4">if </span><span class="s1">(CGRectIsEmpty(_storedMonitorFrame)) {</span>
    <span class="s1">_storedMonitorFrame = CGRectMake(</span><span class="s5">0</span><span class="s4">, </span><span class="s5">20</span><span class="s4">, </span><span class="s1">self.container.window.frame.size.width</span><span class="s4">, </span><span class="s1">RCTPerfMonitorExpandHeight)</span><span class="s4">;</span>
    <span class="s1">[self.container addSubview:self.metrics]</span><span class="s4">;</span>
  <span class="s1">} </span><span class="s4">else </span><span class="s1">{</span>
    <span class="s1">[_metrics reloadData]</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s1">[UIView animateWithDuration:</span><span class="s5">.25</span>
                   <span class="s1">animations:^{</span>
                     <span class="s1">CGRect tmp = self.container.frame</span><span class="s4">;</span>
                     <span class="s1">self.container.frame = self-&gt;_storedMonitorFrame</span><span class="s4">;</span>
                     <span class="s1">self-&gt;_storedMonitorFrame = tmp</span><span class="s4">;</span>
                   <span class="s1">}]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)threadUpdate:(CADisplayLink *)displayLink</span>
<span class="s1">{</span>
  <span class="s1">RCTFPSGraph *graph = displayLink == _jsDisplayLink ? _jsGraph : _uiGraph</span><span class="s4">;</span>
  <span class="s1">[graph onTick:displayLink.timestamp]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (</span><span class="s4">void</span><span class="s1">)loadPerformanceLoggerData</span>
<span class="s1">{</span>
  <span class="s1">NSUInteger i = </span><span class="s5">0</span><span class="s4">;</span>
  <span class="s1">NSMutableArray&lt;NSString *&gt; *data = [NSMutableArray </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s1">RCTPerformanceLogger *performanceLogger = [_bridge performanceLogger]</span><span class="s4">;</span>
  <span class="s1">NSArray&lt;NSNumber *&gt; *values = [performanceLogger valuesForTags]</span><span class="s4">;</span>
  <span class="s4">for </span><span class="s1">(NSString *label in LabelsForRCTPerformanceLoggerTags()) {</span>
    <span class="s4">long long </span><span class="s1">value = values[i + </span><span class="s5">1</span><span class="s1">].longLongValue - values[i].longLongValue</span><span class="s4">;</span>
    <span class="s1">NSString *unit = </span><span class="s4">@</span><span class="s3">&quot;ms&quot;</span><span class="s4">;</span>
    <span class="s4">if </span><span class="s1">([label hasSuffix:</span><span class="s4">@</span><span class="s3">&quot;Size&quot;</span><span class="s1">]) {</span>
      <span class="s1">unit = </span><span class="s4">@</span><span class="s3">&quot;b&quot;</span><span class="s4">;</span>
    <span class="s1">} </span><span class="s4">else if </span><span class="s1">([label hasSuffix:</span><span class="s4">@</span><span class="s3">&quot;Count&quot;</span><span class="s1">]) {</span>
      <span class="s1">unit = </span><span class="s4">@</span><span class="s3">&quot;&quot;</span><span class="s4">;</span>
    <span class="s1">}</span>
    <span class="s1">[data addObject:[NSString stringWithFormat:</span><span class="s4">@</span><span class="s3">&quot;%@: %lld%@&quot;</span><span class="s4">, </span><span class="s1">label</span><span class="s4">, </span><span class="s1">value</span><span class="s4">, </span><span class="s1">unit]]</span><span class="s4">;</span>
    <span class="s1">i += </span><span class="s5">2</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s1">_perfLoggerMarks = [data copy]</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#pragma </span><span class="s1">mark - UITableViewDataSource</span>

<span class="s1">- (NSInteger)numberOfSectionsInTableView:(__unused UITableView *)tableView</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s5">1</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (NSInteger)tableView:(__unused UITableView *)tableView numberOfRowsInSection:(__unused NSInteger)section</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s1">_perfLoggerMarks.count</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath</span>
<span class="s1">{</span>
  <span class="s1">UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:RCTPerfMonitorCellIdentifier</span>
                                                          <span class="s1">forIndexPath:indexPath]</span><span class="s4">;</span>

  <span class="s4">if </span><span class="s1">(!cell) {</span>
    <span class="s1">cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault</span>
                                  <span class="s1">reuseIdentifier:RCTPerfMonitorCellIdentifier]</span><span class="s4">;</span>
  <span class="s1">}</span>

  <span class="s1">cell.textLabel.text = _perfLoggerMarks[indexPath.row]</span><span class="s4">;</span>
  <span class="s1">cell.textLabel.font = [UIFont systemFontOfSize:</span><span class="s5">12</span><span class="s1">]</span><span class="s4">;</span>

  <span class="s4">return </span><span class="s1">cell</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#pragma </span><span class="s1">mark - UITableViewDelegate</span>

<span class="s1">- (CGFloat)tableView:(__unused UITableView *)tableView heightForRowAtIndexPath:(__unused NSIndexPath *)indexPath</span>
<span class="s1">{</span>
  <span class="s4">return </span><span class="s5">20</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s1">- (std::shared_ptr&lt;facebook::react::TurboModule&gt;)getTurboModule:</span>
    <span class="s1">(</span><span class="s4">const </span><span class="s1">facebook::react::ObjCTurboModule::InitParams &amp;)params</span>
<span class="s1">{</span>
  <span class="s4">return nullptr;</span>
<span class="s1">}</span>

<span class="s4">@end</span>

<span class="s1">NSArray&lt;NSString *&gt; *LabelsForRCTPerformanceLoggerTags()</span>
<span class="s1">{</span>
  <span class="s1">NSMutableArray&lt;NSString *&gt; *labels = [NSMutableArray </span><span class="s4">new</span><span class="s1">]</span><span class="s4">;</span>
  <span class="s4">for </span><span class="s1">(</span><span class="s4">int </span><span class="s1">i = </span><span class="s5">0</span><span class="s4">; </span><span class="s1">i &lt; RCTPLSize</span><span class="s4">; </span><span class="s1">i++) {</span>
    <span class="s1">[labels addObject:RCTPLLabelForTag((RCTPLTag)i)]</span><span class="s4">;</span>
  <span class="s1">}</span>
  <span class="s4">return </span><span class="s1">labels</span><span class="s4">;</span>
<span class="s1">}</span>

<span class="s2">#endif</span>

<span class="s1">Class RCTPerfMonitorCls(</span><span class="s4">void</span><span class="s1">)</span>
<span class="s1">{</span>
<span class="s2">#if </span><span class="s1">RCT_DEV</span>
  <span class="s4">return </span><span class="s1">RCTPerfMonitor.</span><span class="s4">class;</span>
<span class="s2">#else</span>
  <span class="s4">return </span><span class="s1">nil</span><span class="s4">;</span>
<span class="s2">#endif</span>
<span class="s1">}</span>
</pre>
</body>
</html>